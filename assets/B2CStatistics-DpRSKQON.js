import{l as ot}from"./lodash-CiJWSuVn.js";import{_ as rt,b as it}from"./index-BBlsm_-Y.js";import{i as ut}from"./vuetify-use-dialog-C5oZ13xz.js";import{q as dt,Q as ct,w as P,v as z,a as E,A as qe,c as A,P as Se,_ as Ve,g as b,r as h,T as ce,f as D,d as mt,R as pt,C as me,D as pe,x as te,y as le,b as ge,J as Re,a1 as gt,O as ft,e as ae,V as se,E as vt,a2 as yt}from"./vuetify-CbddcmEc.js";import{r as p,f as fe,w as ve,k as xt,aS as bt,aV as f,Z as I,bH as s,b2 as kt,a8 as l,a0 as u,a7 as c,u as w,bJ as ye,bf as m,_ as ne,$ as C,aG as j,b0 as oe,F,aH as Ie}from"./@vue-Cr_z6yfx.js";import"./core-js-D2hAHviU.js";/* empty css             */import"./pinia-DBRIaiZ_.js";import"./vue-demi-Dq6ymT-8.js";import"./pinia-plugin-persistedstate-RV7uh3T-.js";import"./vue-router-BFBClpR6.js";import"./jspdf-DacfHTdZ.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./unplugin-vue-router-B1N3mqWX.js";import"./axios-upsvKRUO.js";import"./vue3-google-login-Dx7TV_Hx.js";import"./vue-easy-lightbox-D952uME8.js";import"./perfect-debounce-Cp2ysxOb.js";import"./hookable-B8xFkYCm.js";const Pt={class:"d-flex flex-column"},ht={class:"d-flex flex-column"},_t={class:"d-flex flex-column"},wt={class:"d-flex flex-column"},Ct={class:"d-flex flex-column"},qt={class:"d-flex align-center"},St={key:0},Vt={class:"text-caption text-grey-darken-1"},Rt=["innerHTML"],It={class:"d-flex align-center"},Nt={class:"white-space-pre-wrap flex-grow-1"},zt={key:0,class:"text-caption text-grey-darken-1"},Dt={key:1,class:"text-grey"},Tt={key:0,class:"d-flex justify-center align-center",style:{"min-height":"200px"}},Lt={key:1},$t={class:"d-flex align-center mb-6"},Et={key:0,class:"d-flex justify-center align-center",style:{"min-height":"200px"}},At={key:1},Mt={key:0,class:"text-center pa-4 text-grey"},Bt={style:{"font-size":"12px",color:"#fff"}},Ot={class:"card-title px-6 py-1 mb-2 d-flex justify-space-between align-center bg-teal-darken-2"},Ut={class:"d-flex justify-space-between align-center"},Wt={class:"card-title text-grey-darken-2 mb-3"},jt={__name:"B2CStatistics",setup(Ft){const{apiAuth:q}=it(),y=ut(),{smAndUp:_}=dt(),re=p(!1),S=p(!1),T=p(null),Ne=[{title:"日期 / 時間",key:"inquiryDate",minWidth:"118px",align:"start",sortable:!0},{title:"來源",key:"source",width:"90px",align:"start",sortable:!0},{title:"地區",key:"inquiryPlace",minWidth:"90px",align:"start",sortable:!0},{title:"詢問內容",key:"inquiryContent",minWidth:"185px",maxWidth:"240px",align:"start",sortable:!0},{title:"客戶姓名",key:"customerName",minWidth:"105px",align:"start",sortable:!0},{title:"稱謂",key:"customerTitle",align:"start",sortable:!0},{title:"電話",key:"customerPhone",align:"start",sortable:!0},{title:"Line ID",key:"customerLineId",align:"start",minWidth:"100px",sortable:!0},{title:"Email",key:"customerEmail",align:"start",minWidth:"90px",sortable:!0},{title:"業務",key:"salesPerson.name",align:"start",minWidth:"107px",sortable:!0},{title:"詢問結果",key:"inquiryResult",minWidth:"112px",align:"start",sortable:!0},{title:"最新進度 / 備註",key:"latestProgressNote.content",minWidth:"180px",width:"220px",align:"start",sortable:!0}],H=p(!1),k=p([]),Y=p(1),G=p(10),xe=p(0),M=p([{key:"inquiryDate",order:"desc"}]),B=p(""),g=p({source:null,salesPerson:null,dateRange:null,inquiryPlace:null,inquiryResult:null}),ze=[{text:"Facebook",value:"Facebook"},{text:"Line@",value:"Line@"},{text:"IG",value:"IG"},{text:"非常婚禮",value:"非常婚禮"},{text:"其他",value:"其他"}],be=[{text:"成交",value:"成交"},{text:"不成交",value:"不成交"},{text:"其他",value:"其他"}],ke=p([]),De=["先生","小姐","其他"],Te=fe(()=>Ne),J=p(!1),N=p(""),O=p(!1),L=p(!1),Le=[{title:"進度/備註內容",key:"content",align:"start"},{title:"建立時間",key:"createdAt",width:"170px",align:"start"}],v=p({open:!1,id:null,originalResult:null,pendingResult:null,requireNote:!1}),Q=p({open:!1}),ie=p(!1),Z=p([]),$=p(new Map),Pe=p([]),K=p(new Set),X=p(new Set),ue=p(new Set),V=p({open:!1,itemId:null,salesPersonId:null,salesPersonName:"",customerName:"",isLoading:!1}),he=fe(()=>v.value.requireNote&&(!N.value||!N.value.trim())?'更改詢問結果為"不成交"或是"其他"時，請新增一筆進度/備註紀錄說明原因':""),$e=fe(()=>{const a=k.value.find(e=>e._id===v.value.id);return(a==null?void 0:a.progressNotes)||[]}),Ee=async()=>{var a,e;try{const{data:n}=await q.get("/users/profile");return n.success&&n.result.employeeLink&&n.result.employeeLink&&typeof n.result.employeeLink=="object"?(T.value=n.result.employeeLink.company,n.result.employeeLink.company):null}catch(n){return console.error("載入用戶員工資料失敗:",n),y({text:((e=(a=n==null?void 0:n.response)==null?void 0:a.data)==null?void 0:e.message)||"載入用戶員工資料失敗",snackbarProps:{color:"red-lighten-1"}}),null}},Ae=async()=>{var a,e;try{const{data:n}=await q.get("/lineCategories/all-second-level");n.success&&(ke.value=n.result.sort((t,o)=>t.order-o.order).map(t=>t.name))}catch(n){console.error("載入地區選項失敗:",n),y({text:((e=(a=n==null?void 0:n.response)==null?void 0:a.data)==null?void 0:e.message)||"載入地區選項失敗",snackbarProps:{color:"red-lighten-1"}})}},Me=async()=>{var a,e;try{const n={showInB2C:!0};T.value&&(n.company=T.value._id);const{data:t}=await q.get("/employees/suggestions",{params:n});if(t.success){const o=t.result.sort((r,i)=>{const d=typeof r.order=="number"?r.order:9999,x=typeof i.order=="number"?i.order:9999;return d!==x?d-x:r.name.localeCompare(i.name)});Pe.value=o}}catch(n){console.error("載入業務列表失敗:",n),y({text:((e=(a=n==null?void 0:n.response)==null?void 0:a.data)==null?void 0:e.message)||"載入業務列表失敗",snackbarProps:{color:"red-lighten-1"}})}},Be=async a=>{try{const{data:e}=await q.get("/employees/suggestions",{params:{showInB2C:!0,company:a}});if(e.success){const n=e.result.sort((t,o)=>{const r=typeof t.order=="number"?t.order:9999,i=typeof o.order=="number"?o.order:9999;return r!==i?r-i:t.name.localeCompare(o.name)});$.value.set(a,n)}}catch(e){console.error("載入業務列表失敗:",e),$.value.set(a,[])}},Oe=a=>{g.value.dateRange=a},Ue=a=>{a||(g.value.salesPerson=null)},R=async()=>{var a,e,n,t;try{const o={page:Y.value,itemsPerPage:G.value,sortBy:((a=M.value[0])==null?void 0:a.key)||"inquiryDate",sortOrder:((e=M.value[0])==null?void 0:e.order)||"desc",quickSearch:B.value,source:g.value.source,inquiryPlace:g.value.inquiryPlace,salesPerson:g.value.salesPerson,inquiryResult:g.value.inquiryResult};if(T.value&&(o.company=T.value._id),Array.isArray(g.value.dateRange)&&g.value.dateRange.length>0){const d=new Date(g.value.dateRange[0]),x=new Date(g.value.dateRange[g.value.dateRange.length-1]);d.setHours(0,0,0,0),x.setHours(23,59,59,999),o.dateStart=d.toISOString(),o.dateEnd=x.toISOString()}const r="/customerInquiries/all",{data:i}=await q.get(r,{params:o});i.success&&(k.value=i.result.data,xe.value=i.result.totalItems)}catch(o){console.error("搜尋失敗:",o),y({text:((t=(n=o==null?void 0:o.response)==null?void 0:n.data)==null?void 0:t.message)||"搜尋失敗",snackbarProps:{color:"red-lighten-1"}})}finally{re.value=!1}},We=()=>{g.value={source:null,salesPerson:null,dateRange:null,inquiryPlace:null,inquiryResult:null},B.value="",S.value=!1,R()},je=async a=>{var e;Y.value=a.page,G.value=a.itemsPerPage,((e=a.sortBy)==null?void 0:e.length)>0&&(M.value=a.sortBy),await R()},Fe=ot.debounce(()=>{Y.value=1,R()},300);ve(B,()=>{re.value=!0,Fe()});const He=async()=>{var a,e;Q.value.open=!0,ie.value=!0;try{const n={showInB2C:!0,employmentStatus:"在職"};T.value&&(n.company=T.value._id);const{data:t}=await q.get("/employees/suggestions",{params:n});if(t.success){const o=t.result.sort((r,i)=>{const d=typeof r.order=="number"?r.order:9999,x=typeof i.order=="number"?i.order:9999;return d!==x?d-x:r.name.localeCompare(i.name)});Z.value=o}}catch(n){console.error("載入業務列表失敗:",n),y({text:((e=(a=n==null?void 0:n.response)==null?void 0:a.data)==null?void 0:e.message)||"載入業務列表失敗",snackbarProps:{color:"red-lighten-1"}})}finally{ie.value=!1}},_e=()=>{Q.value.open=!1,Z.value=[]},Ye=async a=>{var e,n;if(!(a!=null&&a._id)){console.error("無效的項目ID");return}try{J.value=!0,v.value={open:!0,id:a._id,originalResult:null,pendingResult:null,requireNote:!1},await R(),J.value=!1}catch(t){console.error("載入詢問資料失敗:",t),y({text:((n=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:n.message)||"載入詢問資料失敗",snackbarProps:{color:"red-lighten-1"}}),ee()}},ee=()=>{if(v.value.requireNote&&v.value.pendingResult){const a=k.value.find(e=>e._id===v.value.id);a&&(a.inquiryResult=v.value.originalResult)}v.value={open:!1,id:null,originalResult:null,pendingResult:null,requireNote:!1},N.value="",L.value=!1,J.value=!1},Ge=async()=>{var a,e,n,t;if(!((a=N.value)!=null&&a.trim())){y({text:"請輸入進度/備註內容",snackbarProps:{color:"red-lighten-1"}});return}O.value=!0;try{const o=await q.post(`/customerInquiries/${v.value.id}/progress-notes`,{content:N.value});if(o.data.success){if(v.value.requireNote&&v.value.pendingResult){const i=`/customerInquiries/${v.value.id}`,d=k.value.find(W=>W._id===v.value.id),x={inquiryResult:v.value.pendingResult,salesPerson:((e=d.salesPerson)==null?void 0:e._id)||null,customerTitle:d.customerTitle||null,customerPhone:d.customerPhone||null,customerLineId:d.customerLineId||null,customerEmail:d.customerEmail||null,inquiryContent:d.inquiryContent||null,inquiryPlace:d.inquiryPlace||null,source:d.source||null},{data:U}=await q.patch(i,x);U.success&&Object.assign(d,{inquiryResult:v.value.pendingResult,customerTitle:d.customerTitle,customerPhone:d.customerPhone,customerLineId:d.customerLineId,customerEmail:d.customerEmail,inquiryContent:d.inquiryContent,inquiryPlace:d.inquiryPlace,source:d.source})}const r=k.value.findIndex(i=>i._id===v.value.id);r!==-1&&(k.value[r].progressNotes||(k.value[r].progressNotes=[]),k.value[r].progressNotes.unshift(o.data.result),k.value[r].latestProgressNote=o.data.result),N.value="",L.value=!1,v.value.requireNote&&ee(),y({text:"進度/備註已新增",snackbarProps:{color:"teal-lighten-1"}}),await R()}}catch(o){if(console.error("新增進度/備註錯誤:",o),y({text:((t=(n=o.response)==null?void 0:n.data)==null?void 0:t.message)||"新增進度/備註時發生錯誤",snackbarProps:{color:"red-lighten-1"}}),v.value.requireNote){const r=k.value.find(i=>i._id===v.value.id);r&&(r.inquiryResult=v.value.originalResult)}}finally{O.value=!1}},Je=async(a,e)=>{var n,t,o;try{const r=k.value.find(x=>x._id===a);if(((n=r.salesPerson)==null?void 0:n._id)===e){y({text:"資料未做任何變更",snackbarProps:{color:"red-lighten-1"}});return}const d=($.value.get(r.company._id)||[]).find(x=>x._id===e);if(!d){y({text:"無法選擇其他公司的業務",snackbarProps:{color:"red-lighten-1"}});return}V.value={open:!0,itemId:a,salesPersonId:e,salesPersonName:d.nickname||d.name,customerName:r.customerName||"未命名客戶"}}catch(r){y({text:((o=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:o.message)||"更新失敗",snackbarProps:{color:"red-lighten-1"}})}},Qe=async()=>{var a,e;try{V.value.isLoading=!0;const{itemId:n,salesPersonId:t}=V.value,o=k.value.find(x=>x._id===n);if(!o){y({text:"找不到該項目",snackbarProps:{color:"red-lighten-1"}});return}K.value.add(n);const r=`/customerInquiries/${n}`,i={salesPerson:t,inquiryResult:o.inquiryResult||null,customerTitle:o.customerTitle||null,customerPhone:o.customerPhone||null,customerLineId:o.customerLineId||null,customerEmail:o.customerEmail||null,sendEmailNotification:!0},{data:d}=await q.patch(r,i);if(d.success){const U=($.value.get(o.company._id)||[]).find(W=>W._id===t);Object.assign(o,{salesPerson:U,customerTitle:o.customerTitle,customerPhone:o.customerPhone,customerLineId:o.customerLineId,customerEmail:o.customerEmail,inquiryResult:o.inquiryResult}),await R(),y({text:"更新業務成功，已發送通知給被指派的業務",snackbarProps:{color:"teal-lighten-1"}})}}catch(n){y({text:((e=(a=n==null?void 0:n.response)==null?void 0:a.data)==null?void 0:e.message)||"更新失敗",snackbarProps:{color:"red-lighten-1"}})}finally{K.value.delete(V.value.itemId),de()}},de=()=>{V.value={open:!1,itemId:null,salesPersonId:null,salesPersonName:"",customerName:"",isLoading:!1}},Ze=a=>{switch(a){case"成交":return"teal-lighten-1";case"不成交":return"red-lighten-1";case"其他":return"grey-darken-1";default:return"grey-lighten-2"}},Ke=async(a,e)=>{var n,t,o;try{const r=k.value.find(W=>W._id===a),i=r.inquiryResult;if(r.inquiryResult===e){y({text:"資料未做任何變更",snackbarProps:{color:"red-lighten-1"}});return}if(e==="不成交"||e==="其他"){v.value={open:!0,id:a,originalResult:i,pendingResult:e,requireNote:!0};return}X.value.add(a);const d=`/customerInquiries/${a}`,x={inquiryResult:e,salesPerson:((n=r.salesPerson)==null?void 0:n._id)||null,customerTitle:r.customerTitle||null},{data:U}=await q.patch(d,x);U.success&&(Object.assign(r,{inquiryResult:e,customerTitle:r.customerTitle}),await R(),y({text:"更新詢問結果成功",snackbarProps:{color:"teal-lighten-1"}}))}catch(r){y({text:((o=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:o.message)||"更新失敗",snackbarProps:{color:"red-lighten-1"}})}finally{X.value.delete(a)}},Xe=async(a,e)=>{var n,t,o;try{const r=k.value.find(x=>x._id===a);if(r.customerTitle===e){y({text:"資料未做任何變更",snackbarProps:{color:"red-lighten-1"}});return}ue.value.add(a);const i=`/customerInquiries/${a}`,{data:d}=await q.patch(i,{customerTitle:e,inquiryResult:r.inquiryResult||"",salesPerson:((n=r.salesPerson)==null?void 0:n._id)||null});d.success&&(r.customerTitle=e,await R(),y({text:"更新稱謂成功",snackbarProps:{color:"teal-lighten-1"}}))}catch(r){y({text:((o=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:o.message)||"更新失敗",snackbarProps:{color:"red-lighten-1"}})}finally{ue.value.delete(a)}};ve(()=>k.value,async a=>{if(!a)return;const e=new Set(a.map(n=>n.company._id));for(const n of e)$.value.has(n)||await Be(n)},{immediate:!0});const we=a=>{var o;if(!a||a.isB2CSupervisor)return"";const e=((o=a.company)==null?void 0:o._id)||a.company;if(!e)return typeof a.order=="number"?`${a.order+1}.`:"";const t=($.value.get(e)||[]).findIndex(r=>r._id===a._id);return t!==-1?`${t+1}.`:typeof a.order=="number"?`${a.order+1}.`:""},et=a=>{if(!a)return"";try{const e=new Date(a);return isNaN(e.getTime())?"":e.toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit"})}catch(e){return console.error("Error formatting date part:",e),""}},tt=a=>{if(!a)return"";try{const e=new Date(a);return isNaN(e.getTime())?"":e.toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}catch(e){return console.error("Error formatting time part:",e),""}},Ce=a=>{if(!a)return"";const e=new Date(a);return`${e.getFullYear()}/${String(e.getMonth()+1).padStart(2,"0")}/${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`},lt=a=>a?a.replace(/<a href="([^"]+)" target="_blank" class="url-button">↗<\/a>/g,(e,n)=>`<a href="${n}" target="_blank" class="url-button">↗</a>`):"",at=a=>{switch(a){case"小姐":return"pink-lighten-1";case"先生":return"blue-darken-1";case"其他":return"grey-darken-2";default:return"grey"}},st=()=>{if(S.value){const a=new Date,e=new Date(a.getFullYear(),a.getMonth(),1),n=new Date(a.getFullYear(),a.getMonth()+1,0);g.value.dateRange=[e,n]}else g.value.dateRange=null;R()},nt=()=>{S.value=!S.value,st()};return ve(()=>g.value.dateRange,a=>{if(a&&S.value){const e=new Date,n=new Date(e.getFullYear(),e.getMonth(),1),t=new Date(e.getFullYear(),e.getMonth()+1,0);a.length===2&&new Date(a[0]).getTime()===n.getTime()&&new Date(a[1]).getTime()===t.getTime()||(S.value=!1)}else!a&&S.value&&(S.value=!1)}),xt(async()=>{try{H.value=!0,await Ee(),await Promise.all([Me(),Ae()]),await R()}catch(a){console.error("初始化失敗:",a),y({text:"初始化失敗",snackbarProps:{color:"red-lighten-1"}})}finally{H.value=!1}}),bt(()=>{}),(a,e)=>{const n=kt("v-date-input");return f(),I(ct,{"max-width":"2400"},{default:s(()=>[l(z,{class:"pt-md-5 px-lg-0 px-xxl-6"},{default:s(()=>[l(P,{cols:"12"},{default:s(()=>[l(z,null,{default:s(()=>[l(P,{cols:"12"},{default:s(()=>[l(z,null,{default:s(()=>[l(P,{cols:"12",class:"mt-1 px-lg-6 px-xl-4 px-xxl-2"},{default:s(()=>[l(E,{class:"elevation-4 rounded-lg py-3 py-sm-7 px-0"},{default:s(()=>[e[30]||(e[30]=u("div",{class:"d-flex align-center pt-2 pt-sm-0 px-4 px-sm-7"},[u("h3",{class:"me-4"}," 直客詢問統計表 ")],-1)),l(qe,{class:"mt-5 mb-6"}),l(A,{class:"pt-0 pt-lg-3 px-6 ps-sm-8 pe-sm-7 px-md-9 pb-2"},{default:s(()=>[l(z,{class:"mb-2"},{default:s(()=>[l(P,{cols:"12",sm:"6",md:"4",lg:"2",class:"px-1 pe-sm-2 py-1"},{default:s(()=>[u("div",Pt,[e[16]||(e[16]=u("span",{class:"text-label"},"來源 :",-1)),l(Se,{modelValue:g.value.source,"onUpdate:modelValue":e[0]||(e[0]=t=>g.value.source=t),items:ze,"item-title":"text","item-value":"value",variant:"outlined",density:"compact",placeholder:"請選擇來源","hide-details":"",clearable:"",disabled:!1},null,8,["modelValue"])])]),_:1}),l(P,{cols:"12",sm:"6",md:"4",lg:"2",class:"px-1 pe-sm-2 py-1"},{default:s(()=>[u("div",ht,[e[17]||(e[17]=u("span",{class:"text-label"},"業務 :",-1)),l(Ve,{modelValue:g.value.salesPerson,"onUpdate:modelValue":[e[1]||(e[1]=t=>g.value.salesPerson=t),Ue],items:Pe.value,"item-title":t=>t?typeof t=="string"?t:`${t.name} ( ${t.nickname?t.nickname+" ":""} ${t.employeeCode} )`:"","item-value":"_id",variant:"outlined",density:"compact",placeholder:"請選擇業務","hide-details":"",clearable:"",disabled:!1},null,8,["modelValue","items","item-title"])])]),_:1}),l(P,{cols:"12",sm:"6",md:"4",lg:"2",class:"px-1 pe-sm-2 py-1"},{default:s(()=>[u("div",_t,[e[18]||(e[18]=u("span",{class:"text-label"},"日期 :",-1)),l(n,{modelValue:g.value.dateRange,"onUpdate:modelValue":[e[2]||(e[2]=t=>g.value.dateRange=t),Oe],variant:"outlined",density:"compact","prepend-icon":"","hide-details":"",clearable:"",placeholder:"請選擇日期",multiple:"range","cancel-text":"取消","ok-text":"確認",disabled:!1},null,8,["modelValue"])])]),_:1}),l(P,{cols:"12",sm:"6",md:"4",lg:"2",class:"px-1 pe-sm-2 py-1"},{default:s(()=>[u("div",wt,[e[19]||(e[19]=u("span",{class:"text-label"},"地區 :",-1)),l(Ve,{modelValue:g.value.inquiryPlace,"onUpdate:modelValue":e[3]||(e[3]=t=>g.value.inquiryPlace=t),items:ke.value,variant:"outlined",density:"compact",clearable:"",placeholder:"請選擇地區","hide-details":"",disabled:!1},null,8,["modelValue","items"])])]),_:1}),l(P,{cols:"12",sm:"6",md:"4",lg:"2",class:"px-1 pe-sm-2 py-1"},{default:s(()=>[u("div",Ct,[e[20]||(e[20]=u("span",{class:"text-label"},"結果 :",-1)),l(Se,{modelValue:g.value.inquiryResult,"onUpdate:modelValue":e[4]||(e[4]=t=>g.value.inquiryResult=t),items:be,"item-title":"text","item-value":"value",variant:"outlined",density:"compact",clearable:"",placeholder:"請選擇結果","hide-details":"",disabled:!1},null,8,["modelValue"])])]),_:1}),l(P,{cols:"12",sm:"6",md:"4",lg:"2",class:"pe-sm-4 d-flex"},{default:s(()=>[l(z,null,{default:s(()=>[l(P,{cols:"8",sm:"8",lg:"8",class:"ps-1 pe-0 pb-2 d-flex align-end"},{default:s(()=>[l(b,{color:"cyan-darken-2","prepend-icon":"mdi-magnify",loading:H.value,disabled:!1,block:"",onClick:R},{default:s(()=>e[21]||(e[21]=[c(" 搜尋 ")])),_:1},8,["loading"])]),_:1}),l(P,{cols:"4",sm:"4",lg:"4",class:"pe-1 pb-2 d-flex align-end"},{default:s(()=>[l(b,{color:"grey",width:"40",block:"",disabled:!1,onClick:We},{default:s(()=>[l(h,null,{default:s(()=>e[22]||(e[22]=[c("mdi-refresh")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(qe,{class:"my-0 my-lg-3"}),l(z,{class:"px-1 px-sm-3 px-md-7 mt-1 bg-white"},{default:s(()=>[l(P,{cols:"12",class:"ps-4 pb-sm-4"},{default:s(()=>[l(z,{class:"d-flex align-center px-5 px-md-2"},{default:s(()=>[l(P,{cols:"6",md:"4",lg:"3",class:"px-0"},{default:s(()=>[l(b,{"prepend-icon":"mdi-account-switch",variant:"outlined",color:"blue-grey-darken-2",class:"me-sm-4",onClick:He},{default:s(()=>e[23]||(e[23]=[c(" 業務輪流表 ")])),_:1}),w(_)?ye((f(),I(b,{key:0,icon:"",color:S.value?"orange-darken-2":"cyan-darken-2",variant:"text",size:"34",onClick:nt},{default:s(()=>[l(h,{size:"20",style:{"padding-top":"2px"}},{default:s(()=>[c(m(S.value?"mdi-calendar-remove":"mdi-calendar-month"),1)]),_:1})]),_:1},8,["color"])),[[ce,S.value?"取消本月篩選":"查看本月"]]):ne("",!0)]),_:1}),l(D),l(P,{cols:"6",md:"5",lg:"3",xl:"2",class:"ps-0 pe-1 my-1"},{default:s(()=>[u("div",qt,[w(_)?ye((f(),I(h,{key:0,icon:"mdi-information",size:"small",color:"blue-grey-darken-2",class:"me-2"},null,512)),[[ce,"可搜尋客戶姓名、電話、Email、Line ID、詢問內容、進度 / 備註","start"]]):ne("",!0),l(mt,{modelValue:B.value,"onUpdate:modelValue":e[5]||(e[5]=t=>B.value=t),loading:re.value,density:"compact",variant:"outlined",label:"快速搜尋","append-inner-icon":"mdi-magnify","hide-details":"",clearable:"",disabled:!1},null,8,["modelValue","loading"])])]),_:1})]),_:1})]),_:1})]),_:1}),l(A,{class:"px-sm-6 px-md-7"},{default:s(()=>[l(pt,{"items-per-page":G.value,"onUpdate:itemsPerPage":e[6]||(e[6]=t=>G.value=t),"sort-by":M.value,"onUpdate:sortBy":e[7]||(e[7]=t=>M.value=t),"items-per-page-options":[10,20,50,100],items:k.value,headers:Te.value,loading:H.value,"items-length":xe.value,page:Y.value,hover:"",density:"compact",class:"rounded-ts-lg rounded-te-lg","onUpdate:options":je},{item:s(({item:t,index:o})=>{var r;return[u("tr",{class:Ie({"odd-row":o%2===0,"even-row":o%2!==0})},[u("td",null,[t.inquiryDate?(f(),C("div",St,[u("div",null,m(et(t.inquiryDate)),1),u("div",Vt,[l(h,{size:"14",style:{"padding-bottom":"2px"}},{default:s(()=>e[24]||(e[24]=[c(" mdi-clock-outline ")])),_:1}),c(" "+m(tt(t.inquiryDate)),1)])])):ne("",!0)]),u("td",null,m(t.source),1),u("td",null,m(t.inquiryPlace),1),u("td",null,[u("div",{class:"white-space-pre-wrap",innerHTML:lt(t.inquiryContent)},null,8,Rt)]),u("td",null,m(t.customerName),1),u("td",null,[l(me,null,{activator:s(({props:i})=>[l(b,j(i,{color:at(t.customerTitle),variant:"outlined",class:"px-2",size:"small",loading:ue.value.has(t._id)}),{default:s(()=>[c(m(t.customerTitle||"選擇稱謂"),1)]),_:2},1040,["color","loading"])]),default:s(()=>[l(pe,null,{default:s(()=>[(f(),C(F,null,oe(De,i=>l(te,{key:i,onClick:d=>Xe(t._id,i)},{default:s(()=>[l(le,null,{default:s(()=>[c(m(i),1)]),_:2},1024)]),_:2},1032,["onClick"])),64))]),_:2},1024)]),_:2},1024)]),u("td",null,m(t.customerPhone),1),u("td",null,m(t.customerLineId),1),u("td",null,m(t.customerEmail),1),u("td",null,[l(me,{"max-height":"320"},{activator:s(({props:i})=>[t.salesPerson?(f(),I(b,j({key:0},i,{color:"blue-darken-1",variant:"outlined",class:"px-2",size:"small",loading:K.value.has(t._id)}),{default:s(()=>[c(m(we(t.salesPerson))+" "+m(t.salesPerson.nickname||t.salesPerson.name),1)]),_:2},1040,["loading"])):(f(),I(b,j({key:1},i,{color:"grey",variant:"outlined",class:"px-2",size:"small",loading:K.value.has(t._id)}),{default:s(()=>e[25]||(e[25]=[c(" 選擇業務 ")])),_:2},1040,["loading"]))]),default:s(()=>[l(pe,null,{default:s(()=>[(f(!0),C(F,null,oe($.value.get(t.company._id)||[],i=>(f(),I(te,{key:i._id,onClick:d=>Je(t._id,i._id)},{default:s(()=>[l(le,null,{default:s(()=>[c(m(we(i))+" "+m(i.nickname||i.name)+" ("+m(i.employeeCode)+")",1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1024)]),u("td",null,[l(me,{"max-height":"360"},{activator:s(({props:i})=>[t.inquiryResult?(f(),I(b,j({key:0},i,{color:Ze(t.inquiryResult),variant:"outlined",class:"px-2 opacity-100",size:"small",loading:X.value.has(t._id)}),{default:s(()=>[c(m(t.inquiryResult),1)]),_:2},1040,["color","loading"])):(f(),I(b,j({key:1},i,{color:"grey",variant:"outlined",class:"px-2 opacity-100",size:"small",loading:X.value.has(t._id)}),{default:s(()=>e[26]||(e[26]=[c(" 選擇結果 ")])),_:2},1040,["loading"]))]),default:s(()=>[l(pe,null,{default:s(()=>[(f(),C(F,null,oe(be,i=>l(te,{key:i.value,onClick:d=>Ke(t._id,i.value)},{default:s(()=>[l(le,null,{default:s(()=>[c(m(i.text),1)]),_:2},1024)]),_:2},1032,["onClick"])),64))]),_:2},1024)]),_:2},1024)]),u("td",null,[u("div",It,[u("div",Nt,[(r=t.latestProgressNote)!=null&&r.content?(f(),C(F,{key:0},[c(m(t.latestProgressNote.content)+" ",1),t.latestProgressNote?(f(),C("div",zt,[l(h,{size:"14",style:{"padding-bottom":"2px"}},{default:s(()=>e[27]||(e[27]=[c(" mdi-clock-outline ")])),_:1}),e[28]||(e[28]=c()),u("span",null,m(Ce(t.latestProgressNote.createdAt)),1)])):ne("",!0)],64)):(f(),C("div",Dt," 【 請點擊右側按鈕新增 】 "))]),ye((f(),I(b,{icon:"",color:"blue-grey-darken-3",variant:"plain",size:"15",class:"ms-2",ripple:!1,onClick:i=>Ye(t)},{default:s(()=>[l(h,null,{default:s(()=>e[29]||(e[29]=[c("mdi-history")])),_:1})]),_:2},1032,["onClick"])),[[ce,"新增及查看紀錄","top"]])])])],2)]}),_:1},8,["items-per-page","sort-by","items","headers","loading","items-length","page"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(se,{modelValue:v.value.open,"onUpdate:modelValue":e[10]||(e[10]=t=>v.value.open=t),persistent:"","max-width":"720"},{default:s(()=>[l(E,{class:"rounded-lg"},{default:s(()=>[l(ge,{class:"d-flex align-center px-6 py-2 bg-blue-grey-darken-2"},{default:s(()=>[l(h,{icon:"mdi-history",size:w(_)?"20":"18",color:"white",class:"me-2"},null,8,["size"]),e[32]||(e[32]=u("span",{class:"card-title"},"進度 / 備註 - 歷史紀錄",-1)),l(D),l(b,{icon:"",variant:"plain",class:"opacity-100",ripple:!1,color:"white",size:w(_)?"36":"32",onClick:ee},{default:s(()=>[l(h,{size:w(_)?"22":"18"},{default:s(()=>e[31]||(e[31]=[c(" mdi-close ")])),_:1},8,["size"])]),_:1},8,["size"])]),_:1}),l(A,{class:"px-6 pt-6 pb-0"},{default:s(()=>{var t;return[J.value?(f(),C("div",Tt,[l(Re,{indeterminate:"",color:"amber-darken-4",size:"64",width:"8"})])):(f(),C("div",Lt,[u("div",$t,[l(gt,{modelValue:N.value,"onUpdate:modelValue":e[8]||(e[8]=o=>N.value=o),label:"新增進度 / 備註",variant:"outlined",density:"compact",error:!!he.value,"error-messages":he.value,rows:"2","hide-details":"auto",class:"me-2",disabled:O.value},null,8,["modelValue","error","error-messages","disabled"]),l(b,{color:"teal-darken-1",elevation:"1",loading:O.value,disabled:!((t=N.value)!=null&&t.trim()),onClick:e[9]||(e[9]=o=>L.value=!0)},{default:s(()=>e[33]||(e[33]=[c(" 新增 ")])),_:1},8,["loading","disabled"])]),l(ft,{headers:Le,items:$e.value,class:"elevation-0 rounded-sm progress-notes-table",density:"compact","sort-by":[{key:"createdAt",order:"desc"}]},{item:s(({item:o,index:r})=>[u("tr",{class:Ie({"odd-row":r%2===0,"even-row":r%2!==0})},[u("td",null,m(o.content),1),u("td",null,m(Ce(o.createdAt)),1)],2)]),_:1},8,["items"])]))]}),_:1}),l(ae,{class:"px-6 pb-5 pt-2"},{default:s(()=>[l(D),l(b,{variant:"outlined",color:"grey",size:w(_)?"default":"small",onClick:ee},{default:s(()=>e[34]||(e[34]=[c(" 關閉 ")])),_:1},8,["size"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(se,{modelValue:L.value,"onUpdate:modelValue":e[13]||(e[13]=t=>L.value=t),"max-width":"340"},{default:s(()=>[l(E,{class:"rounded-lg"},{default:s(()=>[l(ge,{class:"d-flex align-center px-6 py-2 bg-teal-darken-2"},{default:s(()=>[l(h,{size:w(_)?"20":"18",color:"white",class:"me-2"},{default:s(()=>e[35]||(e[35]=[c(" mdi-check-circle ")])),_:1},8,["size"]),e[37]||(e[37]=u("span",{class:"card-title text-white"},"確認新增",-1)),l(D),l(b,{icon:"",variant:"plain",class:"opacity-100",ripple:!1,size:w(_)?"36":"32",color:"white",onClick:e[11]||(e[11]=t=>L.value=!1)},{default:s(()=>[l(h,{size:w(_)?"22":"18"},{default:s(()=>e[36]||(e[36]=[c(" mdi-close ")])),_:1},8,["size"])]),_:1},8,["size"])]),_:1}),l(A,{class:"px-6 pt-4"},{default:s(()=>[e[38]||(e[38]=u("div",{class:"card-content mb-4"}," 請確認是否要新增以下進度/備註？新增後將無法修改或刪除。 ",-1)),l(E,{variant:"outlined",color:"grey-darken-1",class:"pa-3 card-content"},{default:s(()=>[c(m(N.value),1)]),_:1})]),_:1}),l(ae,{class:"px-6 pb-5 pt-0"},{default:s(()=>[l(D),l(b,{color:"grey-darken-1",variant:"outlined",onClick:e[12]||(e[12]=t=>L.value=!1)},{default:s(()=>e[39]||(e[39]=[c(" 取消 ")])),_:1}),l(b,{color:"teal-darken-1",variant:"outlined",loading:O.value,class:"ms-2",onClick:Ge},{default:s(()=>e[40]||(e[40]=[c(" 確認 ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(se,{modelValue:Q.value.open,"onUpdate:modelValue":e[14]||(e[14]=t=>Q.value.open=t),"max-width":"890"},{default:s(()=>[l(E,{class:"rounded-lg pb-2"},{default:s(()=>[l(ge,{class:"d-flex align-center px-6 py-2 bg-blue-grey-darken-2"},{default:s(()=>[l(h,{icon:"mdi-account-switch",size:w(_)?"20":"18",color:"white",class:"me-2"},null,8,["size"]),e[42]||(e[42]=u("span",{class:"card-title"},"業務輪流表",-1)),l(D),l(b,{icon:"",variant:"plain",class:"opacity-100",ripple:!1,color:"white",size:w(_)?"36":"32",onClick:_e},{default:s(()=>[l(h,{size:w(_)?"22":"18"},{default:s(()=>e[41]||(e[41]=[c(" mdi-close ")])),_:1},8,["size"])]),_:1},8,["size"])]),_:1}),l(A,{class:"px-7 py-7"},{default:s(()=>[ie.value?(f(),C("div",Et,[l(Re,{indeterminate:"",color:"amber-darken-4",size:"64",width:"8"})])):(f(),C("div",At,[Z.value.length===0?(f(),C("div",Mt," 目前尚無業務資料 ")):(f(),I(z,{key:1},{default:s(()=>[(f(!0),C(F,null,oe(Z.value,(t,o)=>(f(),I(P,{key:t._id,cols:"12",sm:"3",class:"pa-1"},{default:s(()=>[l(te,{class:"px-3 pt-2 py-3 rounded-lg",density:"compact",style:{border:"1px solid #e0e0e0"}},{prepend:s(()=>[l(vt,{color:"amber-darken-4",size:"18"},{default:s(()=>[u("span",Bt,m(o+1),1)]),_:2},1024)]),default:s(()=>[l(le,{style:{"font-size":"15px"}},{default:s(()=>[c(m(t.nickname||t.name),1)]),_:2},1024),l(yt,{style:{"font-size":"13px"}},{default:s(()=>[c(" 員工編號："+m(t.employeeCode),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}))]))]),_:1}),l(ae,{class:"px-6 pb-5 pt-0"},{default:s(()=>[l(D),l(b,{variant:"outlined",color:"grey",size:w(_)?"default":"small",onClick:_e},{default:s(()=>e[43]||(e[43]=[c(" 關閉 ")])),_:1},8,["size"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(se,{modelValue:V.value.open,"onUpdate:modelValue":e[15]||(e[15]=t=>V.value.open=t),persistent:"","max-width":"340"},{default:s(()=>[l(E,{class:"rounded-lg"},{default:s(()=>[u("div",Ot,[u("div",null,[l(h,{size:"20",class:"me-2"},{default:s(()=>e[44]||(e[44]=[c(" mdi-check-circle ")])),_:1}),e[45]||(e[45]=c("確認業務指派 "))]),l(b,{icon:"",variant:"text",size:"40",onClick:de},{default:s(()=>[l(h,{size:"20"},{default:s(()=>e[46]||(e[46]=[c(" mdi-close ")])),_:1})]),_:1})]),l(A,{class:"px-6 py-3"},{default:s(()=>[u("div",Ut,[u("div",null,[u("div",Wt," 被指派的業務："+m(V.value.salesPersonName),1),e[47]||(e[47]=u("div",{class:"text-grey-darken-2"}," 請確認指派業務是否正確，確認後會發送Email給被指派的業務。 ",-1))])])]),_:1}),l(ae,{class:"px-6 py-4 mb-2"},{default:s(()=>[l(D),l(b,{color:"grey",variant:"outlined",class:"me-1",disabled:V.value.isLoading,onClick:de},{default:s(()=>e[48]||(e[48]=[c(" 取消 ")])),_:1},8,["disabled"]),l(b,{color:"teal-darken-1",variant:"outlined",loading:V.value.isLoading,disabled:V.value.isLoading,onClick:Qe},{default:s(()=>e[49]||(e[49]=[c(" 確認 ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}},ml=rt(jt,[["__scopeId","data-v-fad34329"]]);export{ml as default};

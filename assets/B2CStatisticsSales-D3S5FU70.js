import{l as St}from"./lodash-CiJWSuVn.js";import{_ as De,u as It,b as We}from"./index-BBlsm_-Y.js";import{i as Qe}from"./vuetify-use-dialog-C5oZ13xz.js";import{g as k,a as H,c as K,a5 as Ct,a6 as Vt,r as S,e as ke,f as F,C as be,b as xe,V as re,q as qt,Q as Tt,v as J,w as T,A as Fe,P as Ge,_ as Je,T as Ce,d as Rt,R as Dt,D as Ve,x as ve,y as fe,J as He,a1 as Lt,O as Nt,E as At,a2 as zt}from"./vuetify-CbddcmEc.js";import{r as p,k as Le,aV as v,Z as N,bH as a,a8 as t,aG as ae,a0 as i,$ as q,F as Z,b0 as ie,aH as Re,bf as g,_ as ue,a7 as d,f as he,u as $t,w as ye,aS as Et,b2 as Mt,bJ as qe}from"./@vue-Cr_z6yfx.js";import{C as Ot}from"./vue3-google-login-Dx7TV_Hx.js";import{b as Ye}from"./route-block-B_A1xBdJ.js";import"./core-js-D2hAHviU.js";/* empty css             */import"./pinia-DBRIaiZ_.js";import"./vue-demi-Dq6ymT-8.js";import"./pinia-plugin-persistedstate-RV7uh3T-.js";import"./vue-router-BFBClpR6.js";import"./jspdf-DacfHTdZ.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./unplugin-vue-router-B1N3mqWX.js";import"./axios-upsvKRUO.js";import"./vue-easy-lightbox-D952uME8.js";import"./perfect-debounce-Cp2ysxOb.js";import"./hookable-B8xFkYCm.js";const Bt={class:"d-flex justify-space-between align-center mb-4"},Ut={class:"d-flex align-center"},jt={class:"tour-step-title"},Ft={key:0,class:"tour-step-description text-amber-darken-4"},Gt={__name:"TourGuide",setup(_e,{expose:w}){const y=It(),L=p(!1),V=p(0),A=[{icon:"mdi-login-variant",title:"員工登入",description:"請點擊右上角的「 登入 」按鈕，使用您的公司 Google 帳號進行登入。登入成功後系統會自動載入您所屬公司的資料。"},{icon:"mdi-magnify",title:"搜尋功能",description:"1. 您可以使用上方的搜尋條件（來源、業務、日期、地區、結果）去搜尋特定紀錄。 2. 「 業務 」、「 地區 」可使用輸入的方式快速找到選項。 3. 右側重置按鈕，可快速重置搜尋條件。 4. 畫面中間右測的「 快速搜尋 」也可搜尋特定條件的紀錄。"},{icon:"mdi-account-switch",title:"業務輪流表",description:"點擊「 業務輪流表 」按鈕可以查看目前公司的業務排序。"},{icon:"mdi-calendar-month",title:"查看本月",description:"點擊「 查看本月 」按鈕可以快速查看當月份的所有詢問紀錄。"},{icon:"mdi-table",title:"表格相關",description:"1. 點擊詢問內容的「 連結 」可打開該連結網址。 2.「 稱謂 」、「 業務 」、「 詢問結果 」可直接點擊修改。 3. 「 進度 / 備註 」可點擊最右側圖示打開對話框進行新增或查看。"},{icon:"mdi-help-circle-outline",title:"詢問結果",description:"當詢問結果欲修改成「 不成交 」或是「 其他 」時，會跳出「 進度 / 備註 - 歷史紀錄 」 對話框，請新增一筆紀錄說明原因。"},{icon:"mdi-timer-sand",title:"登入時效",description:"右上角會顯示剩餘的登入時間。時效到期後需要重新登入。若有操作頁面功能或是重新整理頁面，時效會重新計算。"},{icon:"mdi-logout",title:"登出功能",description:"如果要提前登出，可以點擊右上角員工姓名旁的登出按鈕。"}],R=()=>{if(y.isLogin)return;localStorage.getItem("hasVisitedB2CStatistics")||(L.value=!0,localStorage.setItem("hasVisitedB2CStatistics","true"))},B=()=>{V.value<A.length-1&&V.value++},m=()=>{V.value>0&&V.value--},x=z=>{V.value=z},O=()=>{L.value=!1,V.value=0};return Le(()=>{R()}),w({openTour:()=>{V.value=0,L.value=!0}}),(z,_)=>(v(),N(be,{modelValue:L.value,"onUpdate:modelValue":_[1]||(_[1]=$=>L.value=$),"close-on-content-click":!1,location:"top",transition:"scale-transition"},{activator:a(({props:$})=>[t(k,ae($,{color:"amber-darken-4",icon:"mdi-help-circle",class:"tour-guide-btn",elevation:"4"}),null,16)]),default:a(()=>[t(H,{"min-width":"300","max-width":"440",class:"tour-guide-card rounded-lg px-4 pt-2 mb-2"},{default:a(()=>[t(K,{class:"pa-4"},{default:a(()=>[i("div",Bt,[_[2]||(_[2]=i("div",{class:"tour-guide-title"}," 歡迎使用功能導覽 ",-1)),t(k,{icon:"mdi-close",variant:"text",size:"small",color:"blue-grey-darken-2",onClick:_[0]||(_[0]=$=>L.value=!1)})]),_[6]||(_[6]=i("div",{class:"mb-4 text-grey-darken-2"}," 請選擇以下功能將為您進行說明: ",-1)),t(Ct,{density:"compact"},{default:a(()=>[(v(),q(Z,null,ie(A,($,E)=>t(Vt,{key:E,"dot-color":V.value===E?"amber-darken-4":"blue-grey-darken-2",size:"small",class:"timeline-item",onClick:b=>x(E)},{default:a(()=>[i("div",{class:Re(["tour-step",{"active-step":V.value===E}])},[i("div",Ut,[t(S,{icon:$.icon,size:"18",class:"me-2",color:V.value===E?"amber-darken-4":"blue-grey-darken-2"},null,8,["icon","color"]),i("div",null,[i("div",jt,g($.title),1),V.value===E?(v(),q("div",Ft,g($.description),1)):ue("",!0)])])],2)]),_:2},1032,["dot-color","onClick"])),64))]),_:1}),t(ke,{class:"pa-0 mt-4"},{default:a(()=>[t(F),V.value>0?(v(),N(k,{key:0,color:"blue-grey-darken-2",onClick:m},{default:a(()=>_[3]||(_[3]=[d(" 上一步 ")])),_:1})):ue("",!0),V.value<A.length-1?(v(),N(k,{key:1,color:"blue-grey-darken-2",onClick:B},{default:a(()=>_[4]||(_[4]=[d(" 下一步 ")])),_:1})):(v(),N(k,{key:2,color:"blue-grey-darken-2",onClick:O},{default:a(()=>_[5]||(_[5]=[d(" 完成導覽 ")])),_:1}))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Jt=De(Gt,[["__scopeId","data-v-26a7a86d"]]),Ht={key:1,class:"d-flex align-center"},Yt={class:"employee-badge"},Wt={class:"employee-name"},Qt={class:"employee-code"},Xt={class:"text-center"},Zt="276416380558-pgfrsn7bb9fot96r8s3kbeu9cqghind3.apps.googleusercontent.com",Kt={__name:"EmployeeLogin",props:{required:{type:Boolean,default:!1},loginEndpoint:{type:String,default:"/employees/google-login"}},emits:["login-success","logout"],setup(_e,{expose:w,emit:y}){const L=y,{api:V}=We(),A=Qe(),R=_e,B=p(!1),m=p(!1),x=p(null),O=he(()=>!!x.value),z=async b=>{var f,D;try{if(m.value=!0,!b.code)throw new Error("未收到 Google 授權碼");const{data:I}=await V.post(R.loginEndpoint,{code:b.code});I.success?(localStorage.setItem("employeeAuth",JSON.stringify({token:I.result.token,employee:I.result.employee,timestamp:new Date().getTime()})),x.value=I.result.employee,V.defaults.headers.common.Authorization=`Bearer ${I.result.token}`,B.value=!1,A({text:"登入成功",snackbarProps:{color:"teal-lighten-1"}}),L("login-success",I.result.employee)):(localStorage.removeItem("employeeAuth"),x.value=null,A({text:I.message||"登入失敗",snackbarProps:{color:"red-light-1"}}))}catch(I){console.error("Google 登入錯誤:",I),localStorage.removeItem("employeeAuth"),x.value=null,A({text:((D=(f=I==null?void 0:I.response)==null?void 0:f.data)==null?void 0:D.message)||"Google 登入失敗，請稍後再試",snackbarProps:{color:"red-lighten-1"}})}finally{m.value=!1}},_=()=>{m.value||(B.value=!1)},$=()=>{localStorage.removeItem("employeeAuth"),x.value=null,A({text:"已登出員工帳號",snackbarProps:{color:"teal-lighten-1"}}),L("logout")},E=()=>{const b=localStorage.getItem("employeeAuth");if(b)try{const{token:f,employee:D,timestamp:I}=JSON.parse(b),Y=new Date().getTime(),W=I+1*60*60*1e3;Y<=W?(x.value=D,V.defaults.headers.common.Authorization=`Bearer ${f}`,L("login-success",D)):(localStorage.removeItem("employeeAuth"),x.value=null,L("logout"))}catch(f){console.error("解析登入資料失敗:",f),localStorage.removeItem("employeeAuth"),x.value=null,L("logout")}};return Le(()=>{E()}),w({currentEmployee:x,isEmployeeLoggedIn:O,handleLogout:$}),(b,f)=>(v(),q("div",null,[O.value?(v(),q("div",Ht,[i("div",Yt,[t(S,{icon:"mdi-account",size:"16",class:"me-2",color:"blue-darken-2"}),i("span",Wt,[d(g(x.value.name)+" ",1),i("span",Qt,"("+g(x.value.employeeCode)+")",1)])]),t(k,{icon:"",size:"small",color:"grey-darken-1",variant:"plain",ripple:!1,class:"logout-btn",onClick:$},{default:a(()=>[t(S,null,{default:a(()=>f[3]||(f[3]=[d("mdi-logout")])),_:1})]),_:1})])):(v(),N(k,{key:0,color:"blue-darken-3","prepend-icon":"mdi-login-variant",variant:"outlined",loading:m.value,disabled:m.value,onClick:f[0]||(f[0]=D=>B.value=!0)},{default:a(()=>f[2]||(f[2]=[d(" 登入 ")])),_:1},8,["loading","disabled"])),t(re,{modelValue:B.value,"onUpdate:modelValue":f[1]||(f[1]=D=>B.value=D),"max-width":"340",persistent:""},{default:a(()=>[t(H,{class:"rounded-lg"},{default:a(()=>[t(xe,{class:"d-flex align-center px-6 py-1 bg-blue-darken-3"},{default:a(()=>[t(S,{size:"20",class:"me-3",color:"white"},{default:a(()=>f[4]||(f[4]=[d(" mdi-login-variant ")])),_:1}),f[6]||(f[6]=i("span",{class:"text-white font-weight-bold card-title"},"登入",-1)),t(F),t(k,{icon:"",variant:"text",color:"white",onClick:_},{default:a(()=>[t(S,null,{default:a(()=>f[5]||(f[5]=[d("mdi-close")])),_:1})]),_:1})]),_:1}),t(K,{class:"px-6 pt-6 pb-8"},{default:a(()=>[f[8]||(f[8]=i("div",{class:"text-center mb-6"},[i("p",{class:"card-title mb-2"}," 請使用公司 Google 帳號登入 ")],-1)),i("div",Xt,[t($t(Ot),{callback:z,"client-id":Zt,"auto-login":!1,ux_mode:"popup",redirect_uri:"postmessage"},{default:a(({signIn:D})=>[t(k,{block:"",size:"large",color:"blue-darken-2",loading:m.value,disabled:m.value,onClick:D},{default:a(()=>[t(S,{icon:"mdi-google",size:"24",class:"me-2"}),f[7]||(f[7]=d(" 使用 Google 登入 "))]),_:2},1032,["loading","disabled","onClick"])]),_:1})])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},el=De(Kt,[["__scopeId","data-v-56e72093"]]),tl={class:"d-flex align-center px-7"},ll={key:0,class:"clock-container"},al={class:"d-flex align-center"},sl={class:"text-orange-darken-4",style:{"font-size":"15px","font-weight":"600","letter-spacing":"1px"}},ol={class:"d-flex align-center"},nl={class:"d-flex align-center"},rl={class:"d-flex align-center"},il={class:"d-flex align-center"},ul={class:"d-flex align-center"},dl={class:"d-flex justify-space-between align-center"},cl={key:0},ml={class:"text-caption text-grey-darken-1"},pl=["innerHTML"],gl={class:"d-flex align-center"},vl={class:"white-space-pre-wrap flex-grow-1"},fl={key:0,class:"text-caption text-grey-darken-1"},yl={key:1,class:"text-grey"},kl={key:0,class:"d-flex justify-center align-center",style:{"min-height":"200px"}},bl={key:1},xl={class:"d-flex align-center mb-6"},hl={key:0,class:"d-flex justify-center align-center",style:{"min-height":"200px"}},_l={key:1},Pl={key:0,class:"text-center pa-4 text-grey"},wl={style:{"font-size":"12px",color:"#fff"}},Sl={class:"card-title px-6 py-1 mb-2 d-flex justify-space-between align-center bg-teal-darken-2"},Il={class:"d-flex justify-space-between align-center"},Cl={class:"card-title text-grey-darken-2 mb-3"},Te=1,Xe={__name:"B2CStatisticsSales",setup(_e){const{api:w}=We(),y=Qe(),{smAndUp:L,mdAndUp:V}=qt(),A=p(!1),R=p(!1),B=p(null),m=p(null),x=p(null),O=p(null),z=p(0),_=p({fiveMinutes:!1,oneMinute:!1}),$=[{title:"日期 / 時間",key:"inquiryDate",minWidth:"116px",align:"start",sortable:!0},{title:"來源",key:"source",width:"90px",align:"start",sortable:!0},{title:"地區",key:"inquiryPlace",minWidth:"84px",align:"start",sortable:!0},{title:"詢問內容",key:"inquiryContent",width:"240px",align:"start",sortable:!0},{title:"客戶姓名",key:"customerName",minWidth:"104px",align:"start",sortable:!0},{title:"稱謂",key:"customerTitle",align:"start",sortable:!0},{title:"電話",key:"customerPhone",align:"start",sortable:!0},{title:"Line ID",key:"customerLineId",align:"start",sortable:!0},{title:"Email",key:"customerEmail",align:"start",sortable:!0},{title:"業務",key:"salesPerson.name",align:"start",sortable:!0},{title:"詢問結果",key:"inquiryResult",width:"110px",align:"start",sortable:!0},{title:"最新進度 / 備註",key:"latestProgressNote.content",width:"220px",align:"start",sortable:!0}],E=p(!1),b=p([]),f=p(1),D=p(10),I=p(0),Y=p([{key:"inquiryDate",order:"desc"}]),W=p(""),h=p({source:null,salesPerson:null,dateRange:null,inquiryPlace:null,inquiryResult:null}),Ze=[{text:"Facebook",value:"Facebook"},{text:"Line@",value:"Line@"},{text:"IG",value:"IG"},{text:"非常婚禮",value:"非常婚禮"},{text:"其他",value:"其他"}],Ne=[{text:"成交",value:"成交"},{text:"不成交",value:"不成交"},{text:"其他",value:"其他"}],Ae=p([]),Ke=["先生","小姐","其他"],et=he(()=>{let s=$;return L.value||(s=s.filter(e=>["inquiryDate","customerName"].includes(e.key))),V.value||(s=s.filter(e=>!["inquiryPlace"].includes(e.key))),s}),de=p(!1),j=p(""),se=p(!1),Q=p(!1),tt=[{title:"進度/備註內容",key:"content",align:"start"},{title:"建立時間",key:"createdAt",width:"170px",align:"start"}],P=p({open:!1,id:null,originalResult:null,pendingResult:null,requireNote:!1}),ce=p({open:!1}),Pe=p(!1),me=p([]),X=p(new Map),ze=p([]),pe=p(new Set),ge=p(new Set),we=p(new Set),U=p({open:!1,itemId:null,salesPersonId:null,salesPersonName:"",customerName:"",isLoading:!1}),$e=he(()=>P.value.requireNote&&(!j.value||!j.value.trim())?'更改詢問結果為"不成交"或是"其他"時，請新增一筆進度/備註紀錄說明原因':""),lt=he(()=>{const s=b.value.find(e=>e._id===P.value.id);return(s==null?void 0:s.progressNotes)||[]}),oe=async()=>{var s,e;try{const{data:n}=await w.get("/lineCategories/all-second-level");n.success&&(Ae.value=n.result.sort((l,o)=>l.order-o.order).map(l=>l.name))}catch(n){console.error("載入地區選項失敗:",n),y({text:((e=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:e.message)||"載入地區選項失敗",snackbarProps:{color:"red-lighten-1"}})}},ee=async()=>{var s,e,n;try{const l={showInB2C:!0};if(m.value&&(l.company=m.value.company._id),!w.defaults.headers.common.Authorization){const r=localStorage.getItem("employeeAuth");if(r){const{token:u}=JSON.parse(r);w.defaults.headers.common.Authorization=`Bearer ${u}`}}const{data:o}=await w.get("/employees/suggestions",{params:l});if(o.success){const r=o.result.sort((u,c)=>{const C=typeof u.order=="number"?u.order:9999,G=typeof c.order=="number"?c.order:9999;return C!==G?C-G:u.name.localeCompare(c.name)});ze.value=r}}catch(l){console.error("載入業務列表失敗:",l),((s=l==null?void 0:l.response)==null?void 0:s.status)!==401&&y({text:((n=(e=l==null?void 0:l.response)==null?void 0:e.data)==null?void 0:n.message)||"載入業務列表失敗",snackbarProps:{color:"red-lighten-1"}})}},at=async s=>{try{const{data:e}=await w.get("/employees/suggestions",{params:{showInB2C:!0,company:s}});if(e.success){const n=e.result.sort((l,o)=>{const r=typeof l.order=="number"?l.order:9999,u=typeof o.order=="number"?o.order:9999;return r!==u?r-u:l.name.localeCompare(o.name)});X.value.set(s,n)}}catch(e){console.error("載入業務列表失敗:",e),X.value.set(s,[])}},st=s=>{h.value.dateRange=s},ot=s=>{!s&&m.value&&(h.value.salesPerson=null)},nt=()=>{if(!m.value)return;const s=localStorage.getItem("employeeAuth");if(!s)return;const{timestamp:e}=JSON.parse(s),n=new Date().getTime(),l=e+Te*60*60*1e3;n>l&&(localStorage.removeItem("employeeAuth"),m.value=null,B.value&&B.value.handleLogout(),b.value=[],I.value=0,M(),y({text:"登入時效已到期，已自動登出",snackbarProps:{color:"warning",timeout:-1,location:"top"}}),x.value&&(clearInterval(x.value),x.value=null))},Ee=()=>{x.value&&clearInterval(x.value),x.value=setInterval(nt,1e3)},Me=()=>{const s=localStorage.getItem("employeeAuth");if(s){const e=JSON.parse(s);e.timestamp=new Date().getTime(),localStorage.setItem("employeeAuth",JSON.stringify(e)),_.value={fiveMinutes:!1,oneMinute:!1},te()}},te=()=>{const s=localStorage.getItem("employeeAuth");if(!s){z.value=0;return}const{timestamp:e}=JSON.parse(s),n=new Date().getTime(),l=e+Te*60*60*1e3,o=Math.max(0,Math.floor((l-n)/1e3));z.value=o;const r=Math.floor(o/60);r===5&&!_.value.fiveMinutes&&(y({text:"系統將在 5 分鐘後自動登出，請注意資料保存",snackbarProps:{color:"warning",timeout:1e4,location:"top"}}),_.value.fiveMinutes=!0),r===1&&!_.value.oneMinute&&(y({text:"系統將在 1 分鐘後自動登出，請立即保存資料！",snackbarProps:{color:"warning",timeout:1e4,location:"top"}}),_.value.oneMinute=!0)},rt=async s=>{m.value=s;const e=localStorage.getItem("employeeAuth");if(e){const{token:n}=JSON.parse(e);w.defaults.headers.common.Authorization=`Bearer ${n}`}await ee(),await M(),Ee(),te(),O.value=setInterval(()=>{te()},1e3)},it=()=>{m.value=null,b.value=[],I.value=0,Oe(),delete w.defaults.headers.common.Authorization,x.value&&(clearInterval(x.value),x.value=null),O.value&&(clearInterval(O.value),O.value=null),z.value=0,_.value={fiveMinutes:!1,oneMinute:!1}},M=async()=>{var s,e,n,l;if(!m.value){b.value=[],I.value=0,A.value=!1;return}try{if(!w.defaults.headers.common.Authorization){const c=localStorage.getItem("employeeAuth");if(c){const{token:C}=JSON.parse(c);w.defaults.headers.common.Authorization=`Bearer ${C}`}}const o={page:f.value,itemsPerPage:D.value,sortBy:((s=Y.value[0])==null?void 0:s.key)||"inquiryDate",sortOrder:((e=Y.value[0])==null?void 0:e.order)||"desc",quickSearch:W.value,source:h.value.source,inquiryPlace:h.value.inquiryPlace,salesPerson:h.value.salesPerson,inquiryResult:h.value.inquiryResult};if(Array.isArray(h.value.dateRange)&&h.value.dateRange.length>0){const c=new Date(h.value.dateRange[0]),C=new Date(h.value.dateRange[h.value.dateRange.length-1]);c.setHours(0,0,0,0),C.setHours(23,59,59,999),o.dateStart=c.toISOString(),o.dateEnd=C.toISOString()}const r="/customerInquiries/employee/all";Me();const{data:u}=await w.get(r,{params:o});u.success&&(b.value=u.result.data,I.value=u.result.totalItems)}catch(o){console.error("搜尋失敗:",o),y({text:((l=(n=o==null?void 0:o.response)==null?void 0:n.data)==null?void 0:l.message)||"搜尋失敗",snackbarProps:{color:"red-lighten-1"}})}finally{A.value=!1}},Oe=()=>{h.value={source:null,salesPerson:null,dateRange:null,inquiryPlace:null,inquiryResult:null},W.value="",R.value=!1,M()},ut=async s=>{var e;f.value=s.page,D.value=s.itemsPerPage,((e=s.sortBy)==null?void 0:e.length)>0&&(Y.value=s.sortBy),await M()},dt=St.debounce(()=>{f.value=1,M()},300);ye(W,()=>{A.value=!0,dt()});const ct=async()=>{var s,e;ce.value.open=!0,Pe.value=!0;try{const{data:n}=await w.get("/employees/suggestions",{params:{showInB2C:!0,employmentStatus:"在職",company:m.value.company._id}});if(n.success){const l=n.result.sort((o,r)=>{const u=typeof o.order=="number"?o.order:9999,c=typeof r.order=="number"?r.order:9999;return u!==c?u-c:o.name.localeCompare(r.name)});me.value=l}}catch(n){console.error("載入業務列表失敗:",n),y({text:((e=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:e.message)||"載入業務列表失敗",snackbarProps:{color:"red-lighten-1"}})}finally{Pe.value=!1}},Be=()=>{ce.value.open=!1,me.value=[]},mt=async s=>{var e,n;if(!(s!=null&&s._id)){console.error("無效的項目ID");return}try{de.value=!0,P.value={open:!0,id:s._id,originalResult:null,pendingResult:null,requireNote:!1},await M(),de.value=!1}catch(l){console.error("載入詢問資料失敗:",l),y({text:((n=(e=l==null?void 0:l.response)==null?void 0:e.data)==null?void 0:n.message)||"載入詢問資料失敗",snackbarProps:{color:"red-lighten-1"}}),Se()}},Se=()=>{if(P.value.requireNote&&P.value.pendingResult){const s=b.value.find(e=>e._id===P.value.id);s&&(s.inquiryResult=P.value.originalResult)}P.value={open:!1,id:null,originalResult:null,pendingResult:null,requireNote:!1},j.value="",Q.value=!1,de.value=!1},pt=async()=>{var s,e,n,l;if(!((s=j.value)!=null&&s.trim())){y({text:"請輸入進度/備註內容",snackbarProps:{color:"red-lighten-1"}});return}se.value=!0;try{const o=await w.post(`/customerInquiries/employee/${P.value.id}/progress-notes`,{content:j.value});if(o.data.success){if(P.value.requireNote&&P.value.pendingResult){const u=`/customerInquiries/employee/${P.value.id}`,c=b.value.find(ne=>ne._id===P.value.id),C={inquiryResult:P.value.pendingResult,salesPerson:((e=c.salesPerson)==null?void 0:e._id)||null,customerTitle:c.customerTitle||null,customerPhone:c.customerPhone||null,customerLineId:c.customerLineId||null,customerEmail:c.customerEmail||null,inquiryContent:c.inquiryContent||null,inquiryPlace:c.inquiryPlace||null,source:c.source||null},{data:G}=await w.patch(u,C);G.success&&Object.assign(c,{inquiryResult:P.value.pendingResult,customerTitle:c.customerTitle,customerPhone:c.customerPhone,customerLineId:c.customerLineId,customerEmail:c.customerEmail,inquiryContent:c.inquiryContent,inquiryPlace:c.inquiryPlace,source:c.source})}const r=b.value.findIndex(u=>u._id===P.value.id);r!==-1&&(b.value[r].progressNotes||(b.value[r].progressNotes=[]),b.value[r].progressNotes.unshift(o.data.result),b.value[r].latestProgressNote=o.data.result),j.value="",Q.value=!1,P.value.requireNote&&Se(),y({text:"進度/備註已新增",snackbarProps:{color:"teal-lighten-1"}}),await M()}}catch(o){if(console.error("新增進度/備註錯誤:",o),y({text:((l=(n=o.response)==null?void 0:n.data)==null?void 0:l.message)||"新增進度/備註時發生錯誤",snackbarProps:{color:"red-lighten-1"}}),P.value.requireNote){const r=b.value.find(u=>u._id===P.value.id);r&&(r.inquiryResult=P.value.originalResult)}}finally{se.value=!1}},gt=async(s,e)=>{var n,l,o;try{const r=b.value.find(C=>C._id===s);if(((n=r.salesPerson)==null?void 0:n._id)===e){y({text:"資料未做任何變更",snackbarProps:{color:"red-lighten-1"}});return}const c=(X.value.get(r.company._id)||[]).find(C=>C._id===e);if(!c){y({text:"無法選擇其他公司的業務",snackbarProps:{color:"red-lighten-1"}});return}U.value={open:!0,itemId:s,salesPersonId:e,salesPersonName:c.nickname||c.name,customerName:r.customerName||"未命名客戶"}}catch(r){y({text:((o=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:o.message)||"更新失敗",snackbarProps:{color:"red-lighten-1"}})}},vt=async()=>{var s,e;try{U.value.isLoading=!0;const{itemId:n,salesPersonId:l}=U.value,o=b.value.find(C=>C._id===n);if(!o){y({text:"找不到該項目",snackbarProps:{color:"red-lighten-1"}});return}pe.value.add(n);const r=`/customerInquiries/employee/${n}`,u={salesPerson:l,inquiryResult:o.inquiryResult||null,customerTitle:o.customerTitle||null,customerPhone:o.customerPhone||null,customerLineId:o.customerLineId||null,customerEmail:o.customerEmail||null,sendEmailNotification:!0},{data:c}=await w.patch(r,u);if(c.success){const G=(X.value.get(o.company._id)||[]).find(ne=>ne._id===l);Object.assign(o,{salesPerson:G,customerTitle:o.customerTitle,customerPhone:o.customerPhone,customerLineId:o.customerLineId,customerEmail:o.customerEmail,inquiryResult:o.inquiryResult}),await M(),y({text:"更新業務成功，已發送通知給被指派的業務",snackbarProps:{color:"teal-lighten-1"}})}}catch(n){y({text:((e=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:e.message)||"更新失敗",snackbarProps:{color:"red-lighten-1"}})}finally{pe.value.delete(U.value.itemId),Ie()}},Ie=()=>{U.value={open:!1,itemId:null,salesPersonId:null,salesPersonName:"",customerName:"",isLoading:!1}},ft=s=>{switch(s){case"成交":return"teal-lighten-1";case"不成交":return"red-lighten-1";case"其他":return"grey-darken-1";default:return"grey-lighten-2"}},yt=async(s,e)=>{var n,l,o;try{const r=b.value.find(ne=>ne._id===s),u=r.inquiryResult;if(r.inquiryResult===e){y({text:"資料未做任何變更",snackbarProps:{color:"red-lighten-1"}});return}if(e==="不成交"||e==="其他"){P.value={open:!0,id:s,originalResult:u,pendingResult:e,requireNote:!0};return}ge.value.add(s);const c=`/customerInquiries/employee/${s}`,C={inquiryResult:e,salesPerson:((n=r.salesPerson)==null?void 0:n._id)||null,customerTitle:r.customerTitle||null},{data:G}=await w.patch(c,C);G.success&&(Object.assign(r,{inquiryResult:e,customerTitle:r.customerTitle}),await M(),y({text:"更新詢問結果成功",snackbarProps:{color:"teal-lighten-1"}}))}catch(r){y({text:((o=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:o.message)||"更新失敗",snackbarProps:{color:"red-lighten-1"}})}finally{ge.value.delete(s)}},kt=async(s,e)=>{var n,l,o;try{const r=b.value.find(C=>C._id===s);if(r.customerTitle===e){y({text:"資料未做任何變更",snackbarProps:{color:"red-lighten-1"}});return}we.value.add(s);const u=`/customerInquiries/employee/${s}`,{data:c}=await w.patch(u,{customerTitle:e,inquiryResult:r.inquiryResult||"",salesPerson:((n=r.salesPerson)==null?void 0:n._id)||null});c.success&&(r.customerTitle=e,await M(),y({text:"更新稱謂成功",snackbarProps:{color:"teal-lighten-1"}}))}catch(r){y({text:((o=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:o.message)||"更新失敗",snackbarProps:{color:"red-lighten-1"}})}finally{we.value.delete(s)}};ye(()=>b.value,async s=>{if(!s)return;const e=new Set(s.map(n=>n.company._id));for(const n of e)X.value.has(n)||await at(n)},{immediate:!0});const Ue=s=>{var o;if(!s||s.isB2CSupervisor)return"";const e=((o=s.company)==null?void 0:o._id)||s.company;if(!e)return typeof s.order=="number"?`${s.order+1}.`:"";const l=(X.value.get(e)||[]).findIndex(r=>r._id===s._id);return l!==-1?`${l+1}.`:typeof s.order=="number"?`${s.order+1}.`:""},bt=s=>{if(!s)return"";try{const e=new Date(s);return isNaN(e.getTime())?"":e.toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit"})}catch(e){return console.error("Error formatting date part:",e),""}},xt=s=>{if(!s)return"";try{const e=new Date(s);return isNaN(e.getTime())?"":e.toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}catch(e){return console.error("Error formatting time part:",e),""}},je=s=>{if(!s)return"";const e=new Date(s);return`${e.getFullYear()}/${String(e.getMonth()+1).padStart(2,"0")}/${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`},ht=s=>s?s.replace(/<a href="([^"]+)" target="_blank" class="url-button">↗<\/a>/g,(e,n)=>`<a href="${n}" target="_blank" class="url-button">↗</a>`):"",_t=s=>{switch(s){case"小姐":return"pink-lighten-1";case"先生":return"blue-darken-1";case"其他":return"grey-darken-2";default:return"grey"}},Pt=()=>{if(R.value){const s=new Date,e=new Date(s.getFullYear(),s.getMonth(),1),n=new Date(s.getFullYear(),s.getMonth()+1,0);h.value.dateRange=[e,n]}else h.value.dateRange=null;M()},wt=()=>{R.value=!R.value,Pt()};ye(()=>h.value.dateRange,s=>{if(s&&R.value){const e=new Date,n=new Date(e.getFullYear(),e.getMonth(),1),l=new Date(e.getFullYear(),e.getMonth()+1,0);s.length===2&&new Date(s[0]).getTime()===n.getTime()&&new Date(s[1]).getTime()===l.getTime()||(R.value=!1)}else!s&&R.value&&(R.value=!1)}),ye(()=>m.value,s=>{s?te():z.value=0});const le=()=>{m.value&&Me()};return Le(async()=>{try{E.value=!0,await new Promise(e=>setTimeout(e,100));const s=localStorage.getItem("employeeAuth");if(s)try{const{token:e,employee:n,timestamp:l}=JSON.parse(s),o=new Date().getTime(),r=l+Te*60*60*1e3;if(o<=r){if(!n.showInB2C&&!n.isB2CSupervisor){localStorage.removeItem("employeeAuth"),m.value=null,y({text:"此員工帳號未開放使用「 直客詢問統計表 」功能，如有疑問請聯絡管理者",snackbarProps:{color:"red-lighten-1",timeout:-1}}),await Promise.all([ee(),oe()]);return}m.value=n,w.defaults.headers.common.Authorization=`Bearer ${e}`,await Promise.all([ee(),oe()]),await M(),Ee(),te(),O.value=setInterval(()=>{te()},1e3)}else localStorage.removeItem("employeeAuth"),m.value=null,await Promise.all([ee(),oe()])}catch(e){console.error("解析登入資料失敗:",e),localStorage.removeItem("employeeAuth"),m.value=null,await Promise.all([ee(),oe()])}else m.value=null,await Promise.all([ee(),oe()]);document.addEventListener("click",le),document.addEventListener("keydown",le),document.addEventListener("scroll",le)}catch(s){console.error("初始化失敗:",s),y({text:"初始化失敗",snackbarProps:{color:"red-lighten-1"}})}finally{E.value=!1}}),Et(()=>{x.value&&clearInterval(x.value),O.value&&clearInterval(O.value),document.removeEventListener("click",le),document.removeEventListener("keydown",le),document.removeEventListener("scroll",le)}),(s,e)=>{const n=Mt("v-date-input");return v(),q(Z,null,[t(Tt,{"max-width":"2400"},{default:a(()=>[t(J,{class:"pt-md-5 px-2 px-xxl-0"},{default:a(()=>[t(T,{cols:"12"},{default:a(()=>[t(J,null,{default:a(()=>[t(T,{cols:"12"},{default:a(()=>[t(J,null,{default:a(()=>[t(T,{cols:"12",class:"mt-1 px-lg-6 px-xl-12 px-xxl-2"},{default:a(()=>[t(H,{class:"elevation-4 rounded-lg py-7 px-0"},{default:a(()=>[i("div",tl,[e[16]||(e[16]=i("h3",{class:"me-4"}," 直客詢問統計表 ",-1)),t(F),m.value&&z.value>0?(v(),q("div",ll,[i("div",al,[t(S,{icon:"mdi-timer-sand",size:"18",class:"me-2",color:"orange-darken-4"}),i("div",sl,g(Math.floor(z.value/60))+":"+g(String(z.value%60).padStart(2,"0")),1)])])):ue("",!0),t(el,{ref_key:"employeeLoginRef",ref:B,"login-endpoint":"/employees/google-login",onLoginSuccess:rt,onLogout:it},null,512)]),t(Fe,{class:"mt-5 mb-6"}),t(K,{class:"pt-4 px-9"},{default:a(()=>[t(J,{class:"mb-2"},{default:a(()=>[t(T,{cols:"2"},{default:a(()=>[i("div",ol,[e[17]||(e[17]=i("span",{class:"text-label"},"來源 :",-1)),t(Ge,{modelValue:h.value.source,"onUpdate:modelValue":e[0]||(e[0]=l=>h.value.source=l),items:Ze,"item-title":"text","item-value":"value",variant:"outlined",density:"compact",placeholder:"請選擇來源","hide-details":"",clearable:"",class:"ms-4",disabled:!m.value},null,8,["modelValue","disabled"])])]),_:1}),t(T,{cols:"2"},{default:a(()=>[i("div",nl,[e[18]||(e[18]=i("span",{class:"text-label"},"業務 :",-1)),t(Je,{modelValue:h.value.salesPerson,"onUpdate:modelValue":[e[1]||(e[1]=l=>h.value.salesPerson=l),ot],class:"ms-4",items:ze.value,"item-title":l=>l?typeof l=="string"?l:`${l.name} ( ${l.nickname?l.nickname+" ":""} ${l.employeeCode} )`:"","item-value":"_id",variant:"outlined",density:"compact",placeholder:"請選擇業務","hide-details":"",clearable:"",disabled:!m.value},null,8,["modelValue","items","item-title","disabled"])])]),_:1}),t(T,{cols:"2",class:"pe-1"},{default:a(()=>[i("div",rl,[e[19]||(e[19]=i("span",{class:"text-label"},"日期 :",-1)),t(n,{modelValue:h.value.dateRange,"onUpdate:modelValue":[e[2]||(e[2]=l=>h.value.dateRange=l),st],class:"ms-4",variant:"outlined",density:"compact","prepend-icon":"","hide-details":"",clearable:"",placeholder:"請選擇日期",multiple:"range","cancel-text":"取消","ok-text":"確認",disabled:!m.value},null,8,["modelValue","disabled"])])]),_:1}),t(T,{cols:"2"},{default:a(()=>[i("div",il,[e[20]||(e[20]=i("span",{class:"text-label"},"地區 :",-1)),t(Je,{modelValue:h.value.inquiryPlace,"onUpdate:modelValue":e[3]||(e[3]=l=>h.value.inquiryPlace=l),class:"ms-4",items:Ae.value,variant:"outlined",density:"compact",clearable:"",placeholder:"請選擇地區","hide-details":"",disabled:!m.value},null,8,["modelValue","items","disabled"])])]),_:1}),t(T,{cols:"2"},{default:a(()=>[i("div",ul,[e[21]||(e[21]=i("span",{class:"text-label"},"結果 :",-1)),t(Ge,{modelValue:h.value.inquiryResult,"onUpdate:modelValue":e[4]||(e[4]=l=>h.value.inquiryResult=l),class:"ms-4",items:Ne,"item-title":"text","item-value":"value",variant:"outlined",density:"compact",clearable:"",placeholder:"請選擇結果","hide-details":"",disabled:!m.value},null,8,["modelValue","disabled"])])]),_:1}),t(T,{cols:"2"},{default:a(()=>[t(J,{class:"d-flex justify-end"},{default:a(()=>[t(T,{cols:"8",class:"ps-0"},{default:a(()=>[t(k,{color:"cyan-darken-2","prepend-icon":"mdi-magnify",loading:E.value,disabled:!m.value,block:"",onClick:M},{default:a(()=>e[22]||(e[22]=[d(" 搜尋 ")])),_:1},8,["loading","disabled"])]),_:1}),t(T,{cols:"3",class:"ps-0"},{default:a(()=>[t(k,{color:"grey",width:"40",block:"",disabled:!m.value,onClick:Oe},{default:a(()=>[t(S,null,{default:a(()=>e[23]||(e[23]=[d("mdi-refresh")])),_:1})]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(Fe,{class:"my-2"}),t(J,{class:"px-1 px-md-7 mt-1 bg-white"},{default:a(()=>[t(T,{cols:"12",class:"ps-4 pb-sm-4"},{default:a(()=>[t(J,null,{default:a(()=>[t(T,{class:"d-flex justify-space-between align-center"},{default:a(()=>[i("div",dl,[t(k,{"prepend-icon":"mdi-account-switch",variant:"outlined",color:"blue-grey-darken-2",class:"me-4",disabled:!m.value,onClick:ct},{default:a(()=>e[24]||(e[24]=[d(" 業務輪流表 ")])),_:1},8,["disabled"]),qe((v(),N(k,{icon:"",color:R.value?"orange-darken-2":"cyan-darken-2",variant:"text",size:"34",class:"me-4",disabled:!m.value,onClick:wt},{default:a(()=>[t(S,{size:"20",style:{"padding-top":"2px"}},{default:a(()=>[d(g(R.value?"mdi-calendar-remove":"mdi-calendar-month"),1)]),_:1})]),_:1},8,["color","disabled"])),[[Ce,R.value?"取消本月篩選":"查看本月"]])]),t(T,{cols:"2",class:"d-flex align-center pe-1"},{default:a(()=>[qe(t(S,{icon:"mdi-information",size:"small",color:"blue-grey-darken-2",class:"me-2"},null,512),[[Ce,"可搜尋客戶姓名、電話、Email、Line ID、詢問內容、進度 / 備註","start"]]),t(Rt,{modelValue:W.value,"onUpdate:modelValue":e[5]||(e[5]=l=>W.value=l),loading:A.value,density:"compact",variant:"outlined",label:"快速搜尋","append-inner-icon":"mdi-magnify","hide-details":"",clearable:"",disabled:!m.value},null,8,["modelValue","loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1}),t(T,{cols:"12"},{default:a(()=>[t(Dt,{"items-per-page":D.value,"onUpdate:itemsPerPage":e[6]||(e[6]=l=>D.value=l),"sort-by":Y.value,"onUpdate:sortBy":e[7]||(e[7]=l=>Y.value=l),"items-per-page-options":[10,20,50,100],items:b.value,headers:et.value,loading:E.value,"items-length":I.value,page:f.value,hover:"",density:"compact",class:"rounded-ts-lg rounded-te-lg","onUpdate:options":ut},{item:a(({item:l,index:o})=>{var r;return[i("tr",{class:Re({"odd-row":o%2===0,"even-row":o%2!==0})},[i("td",null,[l.inquiryDate?(v(),q("div",cl,[i("div",null,g(bt(l.inquiryDate)),1),i("div",ml,[t(S,{size:"14",style:{"padding-bottom":"2px"}},{default:a(()=>e[25]||(e[25]=[d(" mdi-clock-outline ")])),_:1}),d(" "+g(xt(l.inquiryDate)),1)])])):ue("",!0)]),i("td",null,g(l.source),1),i("td",null,g(l.inquiryPlace),1),i("td",null,[i("div",{class:"white-space-pre-wrap",innerHTML:ht(l.inquiryContent)},null,8,pl)]),i("td",null,g(l.customerName),1),i("td",null,[t(be,null,{activator:a(({props:u})=>[t(k,ae(u,{color:_t(l.customerTitle),variant:"outlined",class:"px-2",size:"small",loading:we.value.has(l._id)}),{default:a(()=>[d(g(l.customerTitle||"選擇稱謂"),1)]),_:2},1040,["color","loading"])]),default:a(()=>[t(Ve,null,{default:a(()=>[(v(),q(Z,null,ie(Ke,u=>t(ve,{key:u,onClick:c=>kt(l._id,u)},{default:a(()=>[t(fe,null,{default:a(()=>[d(g(u),1)]),_:2},1024)]),_:2},1032,["onClick"])),64))]),_:2},1024)]),_:2},1024)]),i("td",null,g(l.customerPhone),1),i("td",null,g(l.customerLineId),1),i("td",null,g(l.customerEmail),1),i("td",null,[t(be,{"max-height":"320"},{activator:a(({props:u})=>[l.salesPerson?(v(),N(k,ae({key:0},u,{color:"blue-darken-1",variant:"outlined",class:"px-2",size:"small",loading:pe.value.has(l._id)}),{default:a(()=>[d(g(Ue(l.salesPerson))+" "+g(l.salesPerson.nickname||l.salesPerson.name),1)]),_:2},1040,["loading"])):(v(),N(k,ae({key:1},u,{color:"grey",variant:"outlined",class:"px-2",size:"small",loading:pe.value.has(l._id)}),{default:a(()=>e[26]||(e[26]=[d(" 選擇業務 ")])),_:2},1040,["loading"]))]),default:a(()=>[t(Ve,null,{default:a(()=>[(v(!0),q(Z,null,ie(X.value.get(l.company._id)||[],u=>(v(),N(ve,{key:u._id,onClick:c=>gt(l._id,u._id)},{default:a(()=>[t(fe,null,{default:a(()=>[d(g(Ue(u))+" "+g(u.nickname||u.name)+" ("+g(u.employeeCode)+")",1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1024)]),i("td",null,[t(be,{"max-height":"360"},{activator:a(({props:u})=>[l.inquiryResult?(v(),N(k,ae({key:0},u,{color:ft(l.inquiryResult),variant:"outlined",class:"px-2 opacity-100",size:"small",loading:ge.value.has(l._id)}),{default:a(()=>[d(g(l.inquiryResult),1)]),_:2},1040,["color","loading"])):(v(),N(k,ae({key:1},u,{color:"grey",variant:"outlined",class:"px-2 opacity-100",size:"small",loading:ge.value.has(l._id)}),{default:a(()=>e[27]||(e[27]=[d(" 選擇結果 ")])),_:2},1040,["loading"]))]),default:a(()=>[t(Ve,null,{default:a(()=>[(v(),q(Z,null,ie(Ne,u=>t(ve,{key:u.value,onClick:c=>yt(l._id,u.value)},{default:a(()=>[t(fe,null,{default:a(()=>[d(g(u.text),1)]),_:2},1024)]),_:2},1032,["onClick"])),64))]),_:2},1024)]),_:2},1024)]),i("td",null,[i("div",gl,[i("div",vl,[(r=l.latestProgressNote)!=null&&r.content?(v(),q(Z,{key:0},[d(g(l.latestProgressNote.content)+" ",1),l.latestProgressNote?(v(),q("div",fl,[t(S,{size:"14",style:{"padding-bottom":"2px"}},{default:a(()=>e[28]||(e[28]=[d(" mdi-clock-outline ")])),_:1}),e[29]||(e[29]=d()),i("span",null,g(je(l.latestProgressNote.createdAt)),1)])):ue("",!0)],64)):(v(),q("div",yl," 【 請點擊右方按鈕新增 】 "))]),qe((v(),N(k,{icon:"",color:"blue-grey-darken-3",variant:"plain",size:"15",class:"ms-2",ripple:!1,onClick:u=>mt(l)},{default:a(()=>[t(S,null,{default:a(()=>e[30]||(e[30]=[d("mdi-history")])),_:1})]),_:2},1032,["onClick"])),[[Ce,"新增及查看紀錄","top"]])])])],2)]}),_:1},8,["items-per-page","sort-by","items","headers","loading","items-length","page"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(re,{modelValue:P.value.open,"onUpdate:modelValue":e[10]||(e[10]=l=>P.value.open=l),persistent:"","max-width":"720"},{default:a(()=>[t(H,{class:"rounded-lg"},{default:a(()=>[t(xe,{class:"d-flex align-center px-6 py-1 mb-2 bg-blue-grey-darken-2"},{default:a(()=>[t(S,{size:"20",class:"me-2"},{default:a(()=>e[31]||(e[31]=[d(" mdi-history ")])),_:1}),e[33]||(e[33]=i("span",{class:"card-title text-white"},"進度 / 備註 - 歷史紀錄",-1)),t(F),t(k,{icon:"",variant:"text",color:"white",onClick:Se},{default:a(()=>[t(S,null,{default:a(()=>e[32]||(e[32]=[d("mdi-close")])),_:1})]),_:1})]),_:1}),t(K,{class:"px-6 py-7"},{default:a(()=>{var l;return[de.value?(v(),q("div",kl,[t(He,{indeterminate:"",color:"amber-darken-4",size:"64",width:"8"})])):(v(),q("div",bl,[i("div",xl,[t(Lt,{modelValue:j.value,"onUpdate:modelValue":e[8]||(e[8]=o=>j.value=o),label:"新增進度 / 備註",variant:"outlined",density:"compact",error:!!$e.value,"error-messages":$e.value,rows:"2","hide-details":"auto",class:"flex-grow-1 me-2",disabled:se.value},null,8,["modelValue","error","error-messages","disabled"]),t(k,{color:"teal-darken-1",loading:se.value,disabled:!((l=j.value)!=null&&l.trim()),onClick:e[9]||(e[9]=o=>Q.value=!0)},{default:a(()=>e[34]||(e[34]=[d(" 新增 ")])),_:1},8,["loading","disabled"])]),t(Nt,{headers:tt,items:lt.value,class:"elevation-0 rounded-sm progress-notes-table",density:"compact","sort-by":[{key:"createdAt",order:"desc"}]},{item:a(({item:o,index:r})=>[i("tr",{class:Re({"odd-row":r%2===0,"even-row":r%2!==0})},[i("td",null,g(o.content),1),i("td",null,g(je(o.createdAt)),1)],2)]),_:1},8,["items"])]))]}),_:1})]),_:1})]),_:1},8,["modelValue"]),t(re,{modelValue:Q.value,"onUpdate:modelValue":e[13]||(e[13]=l=>Q.value=l),"max-width":"340"},{default:a(()=>[t(H,{class:"rounded-lg"},{default:a(()=>[t(xe,{class:"d-flex align-center px-6 py-1 mb-2 bg-teal-darken-2"},{default:a(()=>[t(S,{size:"20",class:"me-2"},{default:a(()=>e[35]||(e[35]=[d(" mdi-check-circle ")])),_:1}),e[37]||(e[37]=i("span",{class:"card-title text-white"},"確認新增",-1)),t(F),t(k,{icon:"",variant:"text",color:"white",onClick:e[11]||(e[11]=l=>Q.value=!1)},{default:a(()=>[t(S,null,{default:a(()=>e[36]||(e[36]=[d("mdi-close")])),_:1})]),_:1})]),_:1}),t(K,{class:"px-6 pt-3 pb-0"},{default:a(()=>[e[38]||(e[38]=i("div",{class:"mb-4"}," 請確認是否要新增以下進度/備註？新增後將無法修改或刪除。 ",-1)),t(H,{variant:"outlined",color:"grey-darken-1",class:"pa-3"},{default:a(()=>[d(g(j.value),1)]),_:1})]),_:1}),t(ke,{class:"px-6 py-6"},{default:a(()=>[t(F),t(k,{color:"grey-darken-1",variant:"outlined",onClick:e[12]||(e[12]=l=>Q.value=!1)},{default:a(()=>e[39]||(e[39]=[d(" 取消 ")])),_:1}),t(k,{color:"teal-darken-1",variant:"outlined",loading:se.value,class:"ms-2",onClick:pt},{default:a(()=>e[40]||(e[40]=[d(" 確認 ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(re,{modelValue:ce.value.open,"onUpdate:modelValue":e[14]||(e[14]=l=>ce.value.open=l),"max-width":"890"},{default:a(()=>[t(H,{class:"rounded-lg pb-2"},{default:a(()=>[t(xe,{class:"d-flex align-center px-6 py-1 mb-2 bg-blue-grey-darken-2"},{default:a(()=>[t(S,{size:"20",class:"me-2"},{default:a(()=>e[41]||(e[41]=[d(" mdi-account-switch ")])),_:1}),e[43]||(e[43]=i("span",{class:"card-title text-white"},"業務輪流表",-1)),t(F),t(k,{icon:"",variant:"text",color:"white",onClick:Be},{default:a(()=>[t(S,null,{default:a(()=>e[42]||(e[42]=[d("mdi-close")])),_:1})]),_:1})]),_:1}),t(K,{class:"px-7 py-7"},{default:a(()=>[Pe.value?(v(),q("div",hl,[t(He,{indeterminate:"",color:"amber-darken-4",size:"64",width:"8"})])):(v(),q("div",_l,[me.value.length===0?(v(),q("div",Pl," 目前尚無業務資料 ")):(v(),N(J,{key:1},{default:a(()=>[(v(!0),q(Z,null,ie(me.value,(l,o)=>(v(),N(T,{key:l._id,cols:"12",sm:"3",class:"pa-1"},{default:a(()=>[t(ve,{class:"px-3 pt-2 py-3 rounded-lg",density:"compact",style:{border:"1px solid #e0e0e0"}},{prepend:a(()=>[t(At,{color:"amber-darken-4",size:"18"},{default:a(()=>[i("span",wl,g(o+1),1)]),_:2},1024)]),default:a(()=>[t(fe,{style:{"font-size":"15px"}},{default:a(()=>[d(g(l.nickname||l.name),1)]),_:2},1024),t(zt,{style:{"font-size":"13px"}},{default:a(()=>[d(" 員工編號："+g(l.employeeCode),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}))]))]),_:1}),t(ke,{class:"px-6 py-4"},{default:a(()=>[t(F),t(k,{color:"grey-darken-1",variant:"outlined",onClick:Be},{default:a(()=>e[44]||(e[44]=[d(" 關閉 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(re,{modelValue:U.value.open,"onUpdate:modelValue":e[15]||(e[15]=l=>U.value.open=l),persistent:"","max-width":"340"},{default:a(()=>[t(H,{class:"rounded-lg"},{default:a(()=>[i("div",Sl,[i("div",null,[t(S,{size:"20",class:"me-2"},{default:a(()=>e[45]||(e[45]=[d(" mdi-check-circle ")])),_:1}),e[46]||(e[46]=d("確認業務指派 "))]),t(k,{icon:"",variant:"text",size:"40",onClick:Ie},{default:a(()=>[t(S,{size:"20"},{default:a(()=>e[47]||(e[47]=[d(" mdi-close ")])),_:1})]),_:1})]),t(K,{class:"px-6 py-3"},{default:a(()=>[i("div",Il,[i("div",null,[i("div",Cl," 被指派的業務："+g(U.value.salesPersonName),1),e[48]||(e[48]=i("div",{class:"text-grey-darken-2"}," 請確認指派業務是否正確，確認後會發送Email給被指派的業務。 ",-1))])])]),_:1}),t(ke,{class:"px-6 py-4 mb-2"},{default:a(()=>[t(F),t(k,{color:"grey",variant:"outlined",class:"me-1",disabled:U.value.isLoading,onClick:Ie},{default:a(()=>e[49]||(e[49]=[d(" 取消 ")])),_:1},8,["disabled"]),t(k,{color:"teal-darken-1",variant:"outlined",loading:U.value.isLoading,disabled:U.value.isLoading,onClick:vt},{default:a(()=>e[50]||(e[50]=[d(" 確認 ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(Jt,{ref:"tourGuide"},null,512)],64)}}};typeof Ye=="function"&&Ye(Xe);const Wl=De(Xe,[["__scopeId","data-v-d16c2c08"]]);export{Wl as default};

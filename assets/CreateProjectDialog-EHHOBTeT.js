import{f as g,r,w as J,k as K,aV as _,Z as Q,bH as t,a8 as l,a0 as q,a7 as i,bM as W,aI as X,ao as Y,bf as h,$ as A,_ as ee,F as ae,b0 as le}from"./@vue-Cr_z6yfx.js";import{_ as te,u as oe,b as se}from"./index-ZcDhEpUM.js";import{i as ie}from"./vuetify-use-dialog-C5oZ13xz.js";import{u as ne}from"./team-_bHli350.js";import{q as ue,a as de,r as m,f as F,g as f,c as re,U as me,v as ce,w as V,d as fe,P as pe,x as ve,a2 as ge,a1 as Ve,af as be,e as Ce,V as ye}from"./vuetify-CbddcmEc.js";const ke={class:"card-title px-6 py-4 bg-blue-grey-darken-2 d-flex align-center"},xe={key:0,class:"text-caption text-medium-emphasis mt-1"},ze={class:"color-grid"},Te={__name:"CreateProjectDialog",props:{modelValue:{type:Boolean,default:!1},defaultTeamId:{type:String,default:null}},emits:["update:modelValue","project-created"],setup(L,{emit:N}){const d=L,w=N,{apiAuth:I}=se(),b=ie(),{smAndUp:C,lgAndUp:U}=ue(),M=oe(),y=ne(),P=g(()=>C.value?"default":"small"),B=g(()=>C.value?U.value?40:36:26),j=g(()=>C.value?U.value?24:20:14),$=r(null),p=r(!1),k=r(!1),x=r(!1),s=r({name:"",team:"",description:"",iconColor:void 0}),z=()=>{s.value={name:"",team:d.defaultTeamId||"",description:"",iconColor:void 0}},D=r([]),O=[{title:"紅色",value:"red-accent-3"},{title:"粉色",value:"pink-accent-2"},{title:"紫色",value:"purple-accent-1"},{title:"深紫",value:"deep-purple-accent-1"},{title:"靛藍",value:"indigo-accent-2"},{title:"藍色",value:"#92a9d1"},{title:"淺藍",value:"light-blue-accent-3"},{title:"青色",value:"#46b5ac"},{title:"青綠",value:"teal-accent-2"},{title:"綠色",value:"green-accent-3"},{title:"翠綠",value:"#009572"},{title:"黃色",value:"#efbf59"},{title:"深橙",value:"deep-orange-accent-3"}],E=[o=>!!o||"請輸入專案名稱",o=>o&&o.length>=1||"專案名稱至少需要2個字元",o=>o&&o.length<=50||"專案名稱不能超過50個字元"],H=[o=>!!o||"請選擇負責團隊"],T=g({get:()=>d.modelValue,set:o=>w("update:modelValue",o)}),R=async()=>{var o,e;try{x.value=!0;let a=y.teams&&y.teams.length>0?y.teams:[];if(a.length===0){const{data:u}=await I.get("/teams/my-teams");a=u.success?u.data||[]:[]}const n=a.filter(u=>{var v;return(v=u==null?void 0:u.managers)==null?void 0:v.some(G=>G._id===M._id)});let c=n;if(d.defaultTeamId&&!n.some(u=>u._id===d.defaultTeamId)){const u=a.find(v=>v._id===d.defaultTeamId);u&&(c=[u,...n])}D.value=c}catch(a){console.error("取得團隊列表失敗:",a),b({text:((e=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:e.message)||"取得團隊列表失敗",snackbarProps:{color:"red-lighten-1"}})}finally{x.value=!1}},Z=async()=>{var o,e;if(p.value)try{k.value=!0;const a={name:s.value.name,team:s.value.team,description:s.value.description,...s.value.iconColor?{iconColor:s.value.iconColor}:{iconColor:null}},{data:n}=await I.post("/projects",a);n.success&&(b({text:"專案建立成功",snackbarProps:{color:"teal-lighten-1"}}),w("project-created",n.data),S())}catch(a){console.error("建立專案失敗:",a);const n=((e=(o=a.response)==null?void 0:o.data)==null?void 0:e.message)||"建立專案失敗";b({text:n,snackbarProps:{color:"red-lighten-1"}})}finally{k.value=!1}},S=()=>{z(),T.value=!1};return J(()=>d.modelValue,o=>{o&&(R(),z())}),K(()=>{R(),z()}),(o,e)=>(_(),Q(ye,{modelValue:T.value,"onUpdate:modelValue":e[5]||(e[5]=a=>T.value=a),"max-width":"520px",persistent:""},{default:t(()=>[l(de,{class:"rounded-lg"},{default:t(()=>[q("div",ke,[l(m,{size:"20",color:"white",class:"me-2"},{default:t(()=>e[6]||(e[6]=[i(" mdi-folder-plus ")])),_:1}),e[8]||(e[8]=i(" 建立新專案 ")),l(F),l(f,{icon:"",color:"white",variant:"plain",class:"opacity-100",ripple:!1,size:"20",onClick:S},{default:t(()=>[l(m,{size:"20"},{default:t(()=>e[7]||(e[7]=[i(" mdi-close ")])),_:1})]),_:1})]),l(re,{class:"mt-3 mb-2 px-6 pb-2"},{default:t(()=>[l(me,{ref_key:"formRef",ref:$,modelValue:p.value,"onUpdate:modelValue":e[4]||(e[4]=a=>p.value=a),onSubmit:W(Z,["prevent"])},{default:t(()=>[l(ce,null,{default:t(()=>[l(V,{cols:"12"},{default:t(()=>[l(fe,{modelValue:s.value.name,"onUpdate:modelValue":e[0]||(e[0]=a=>s.value.name=a),label:"*專案名稱",rules:E,required:"",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),l(V,{cols:"12"},{default:t(()=>[l(pe,{modelValue:s.value.team,"onUpdate:modelValue":e[1]||(e[1]=a=>s.value.team=a),items:D.value,"item-title":"name","item-value":"_id",label:"*負責團隊",rules:H,required:"",variant:"outlined",density:"compact",loading:x.value,disabled:!!d.defaultTeamId,"hide-details":"",clearable:!d.defaultTeamId},{item:t(({props:a,item:n})=>[l(ve,X(Y(a)),{prepend:t(()=>[l(m,null,{default:t(()=>e[9]||(e[9]=[i("mdi-account-group")])),_:1})]),default:t(()=>[l(ge,null,{default:t(()=>{var c;return[i(h(((c=n.raw.members)==null?void 0:c.length)||0)+" 位成員 ",1)]}),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","items","loading","disabled","clearable"]),d.defaultTeamId?(_(),A("div",xe,[l(m,{size:"14",class:"me-1"},{default:t(()=>e[10]||(e[10]=[i(" mdi-information-outline ")])),_:1}),e[11]||(e[11]=i(" 此專案將建立在當前團隊下 "))])):ee("",!0)]),_:1}),l(V,{cols:"12"},{default:t(()=>[l(Ve,{modelValue:s.value.description,"onUpdate:modelValue":e[2]||(e[2]=a=>s.value.description=a),label:"專案描述",variant:"outlined",density:"compact",rows:"6","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),l(V,{cols:"12"},{default:t(()=>[l(be,{class:"text-body-2 mb-3 d-block"},{default:t(()=>e[12]||(e[12]=[i(" 專案圖示顏色 ")])),_:1}),q("div",ze,[l(f,{variant:s.value.iconColor===void 0?"flat":"outlined",color:"grey",size:B.value,icon:"",onClick:e[3]||(e[3]=a=>s.value.iconColor=void 0)},{default:t(()=>[l(m,{size:j.value},{default:t(()=>e[13]||(e[13]=[i(" mdi-square-rounded-outline ")])),_:1},8,["size"])]),_:1},8,["variant","size"]),(_(),A(ae,null,le(O,a=>l(f,{key:a.value,color:a.value,variant:s.value.iconColor===a.value?"flat":"outlined",size:B.value,icon:"",onClick:n=>s.value.iconColor=a.value},{default:t(()=>[l(m,{size:j.value},{default:t(()=>e[14]||(e[14]=[i(" mdi-square-rounded ")])),_:1},8,["size"])]),_:2},1032,["color","variant","size","onClick"])),64))])]),_:1})]),_:1}),l(Ce,{class:"px-0 mt-4"},{default:t(()=>[l(F),l(f,{color:"grey-darken-1",variant:"outlined",class:"me-1",size:P.value,onClick:S},{default:t(()=>e[15]||(e[15]=[i(" 取消 ")])),_:1},8,["size"]),l(f,{color:"teal-darken-1",variant:"outlined",type:"submit",class:"ms-1",size:P.value,loading:k.value,disabled:!p.value},{default:t(()=>e[16]||(e[16]=[i(" 建立專案 ")])),_:1},8,["size","loading","disabled"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Pe=te(Te,[["__scopeId","data-v-60ed842f"]]);export{Pe as C};

import{f as C,r as i,w as F,k as N,aV as q,Z as L,bH as s,a8 as l,a0 as j,a7 as n,bM as G,aG as H,bf as U,aI as O,ao as Z}from"./@vue-Cr_z6yfx.js";import{u as $,b as E}from"./index-mGnb0KKF.js";import{i as J}from"./vuetify-use-dialog-C5oZ13xz.js";import{_ as S}from"./UserAvatar-CwvpGxzs.js";import{q as K,a as Q,r as h,f as P,g,c as W,U as X,v as Y,w as b,d as ee,a1 as ae,ae as le,F as se,x as te,a2 as oe,e as re,V as ie}from"./vuetify-CbddcmEc.js";const ne={class:"card-title px-6 py-4 bg-blue-grey-darken-2 d-flex align-center"},fe={__name:"CreateTeamDialog",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","team-created"],setup(B,{emit:D}){const y=B,x=D,{apiAuth:w}=E(),m=J(),R=$(),{smAndUp:T}=K(),_=C(()=>T.value?"default":"small"),A=i(null),d=i(!1),p=i(!1),c=i(!1),r=i({name:"",description:""}),u=i([]),k=i([]),I=[t=>!!t||"請輸入團隊名稱",t=>t&&t.length>=2||"團隊名稱至少需要2個字元",t=>t&&t.length<=50||"團隊名稱不能超過50個字元"],f=C({get:()=>y.modelValue,set:t=>x("update:modelValue",t)}),z=async()=>{var t,e;try{c.value=!0;const{data:a}=await w.get("/teams/users/list");a.success&&(k.value=a.data.filter(o=>o._id!==R._id))}catch(a){console.error("取得使用者列表失敗:",a),m({text:((e=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:e.message)||"取得使用者列表失敗",snackbarProps:{color:"red-lighten-1"}})}finally{c.value=!1}},M=async()=>{var t,e;if(d.value)try{p.value=!0;const a={name:r.value.name,description:r.value.description,members:u.value.map(v=>typeof v=="object"?v._id:v)},{data:o}=await w.post("/teams",a);o.success&&(m({text:"團隊建立成功",snackbarProps:{color:"teal-lighten-1"}}),x("team-created",o.data),V())}catch(a){console.error("建立團隊失敗:",a);const o=((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||"建立團隊失敗";m({text:o,snackbarProps:{color:"red-lighten-1"}})}finally{p.value=!1}},V=()=>{r.value={name:"",description:""},u.value=[],f.value=!1};return F(()=>y.modelValue,t=>{t&&z()}),N(()=>{z()}),(t,e)=>(q(),L(ie,{modelValue:f.value,"onUpdate:modelValue":e[4]||(e[4]=a=>f.value=a),"max-width":"480px",persistent:""},{default:s(()=>[l(Q,{class:"rounded-lg"},{default:s(()=>[j("div",ne,[l(h,{size:"20",color:"white",class:"me-2"},{default:s(()=>e[5]||(e[5]=[n(" mdi-account-group ")])),_:1}),e[7]||(e[7]=n(" 建立新團隊 ")),l(P),l(g,{icon:"",color:"white",variant:"plain",class:"opacity-100",ripple:!1,size:"20",onClick:V},{default:s(()=>[l(h,{size:"20"},{default:s(()=>e[6]||(e[6]=[n(" mdi-close ")])),_:1})]),_:1})]),l(W,{class:"mt-3 mb-2 px-6 pb-2"},{default:s(()=>[l(X,{ref_key:"formRef",ref:A,modelValue:d.value,"onUpdate:modelValue":e[3]||(e[3]=a=>d.value=a),onSubmit:G(M,["prevent"])},{default:s(()=>[l(Y,null,{default:s(()=>[l(b,{cols:"12"},{default:s(()=>[l(ee,{modelValue:r.value.name,"onUpdate:modelValue":e[0]||(e[0]=a=>r.value.name=a),label:"*團隊名稱",rules:I,required:"",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),l(b,{cols:"12"},{default:s(()=>[l(ae,{modelValue:r.value.description,"onUpdate:modelValue":e[1]||(e[1]=a=>r.value.description=a),label:"團隊描述",variant:"outlined",density:"compact",rows:"3","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),l(b,{cols:"12"},{default:s(()=>[l(le,{modelValue:u.value,"onUpdate:modelValue":e[2]||(e[2]=a=>u.value=a),items:k.value,"item-title":"name","item-value":"_id",multiple:"",chips:"","closable-chips":"",variant:"outlined",density:"compact",placeholder:"搜尋並選擇團隊成員",loading:c.value,"hide-details":"",clearable:""},{chip:s(({props:a,item:o})=>[l(se,H(a,{color:"primary",variant:"tonal"}),{prepend:s(()=>[l(S,{user:o.raw,size:24,"avatar-class":"me-2"},null,8,["user"])]),default:s(()=>[n(" "+U(o.raw.name),1)]),_:2},1040)]),item:s(({props:a,item:o})=>[l(te,O(Z(a)),{prepend:s(()=>[l(S,{user:o.raw,size:32,"avatar-class":"me-3"},null,8,["user"])]),default:s(()=>[l(oe,null,{default:s(()=>[n(U(o.raw.email),1)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","items","loading"])]),_:1})]),_:1}),l(re,{class:"px-0 mt-4"},{default:s(()=>[l(P),l(g,{color:"grey-darken-1",variant:"outlined",class:"me-1",size:_.value,onClick:V},{default:s(()=>e[8]||(e[8]=[n(" 取消 ")])),_:1},8,["size"]),l(g,{color:"teal-darken-1",variant:"outlined",type:"submit",class:"ms-1",size:_.value,loading:p.value,disabled:!d.value},{default:s(()=>e[9]||(e[9]=[n(" 確認 ")])),_:1},8,["size","loading","disabled"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};export{fe as _};

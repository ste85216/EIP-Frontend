import{b as xa,u as _a}from"./vue-router-CS4OewbW.js";import{_ as zt,b as Vt,u as Zt,a as Xt}from"./index-ZcDhEpUM.js";import{i as jt}from"./vuetify-use-dialog-C5oZ13xz.js";import{u as Ca}from"./project-C-PnggKy.js";import{u as ea}from"./team-_bHli350.js";import{f as ee,r as x,w as at,k as Bt,aV as u,Z as B,bH as t,a8 as a,a0 as i,a7 as r,bM as ie,aI as ta,ao as aa,bf as P,$ as _,_ as J,F as Ve,b0 as Be,b2 as la,aH as Ke,aS as ha,aG as le,bJ as wa,bK as At,aJ as Ut,bB as za,u as _e}from"./@vue-Cr_z6yfx.js";import{q as sa,a as De,r as v,f as $e,g as A,c as Pe,U as oa,v as wt,w as je,d as Ze,P as Xe,x as me,a2 as na,a1 as Va,af as ja,e as qe,V as He,J as Et,O as It,a0 as Wt,F as Le,$ as Da,K as Ce,E as ht,C as et,D as tt,ao as $a,Q as Pa,y as Gt,H as Ta,Y as Sa}from"./vuetify-CbddcmEc.js";import{C as ra}from"./ConfirmDeleteDialogWithTextField-DtpfDroW.js";import{_ as ia}from"./ConfirmDeleteDialog-CuZPFffe.js";import{_ as ke}from"./UserAvatar-CKm7U33U.js";import{_ as Qt}from"./ConfirmDialog-CJtUY0XN.js";import{T as Aa}from"./TaskSidebar-Dx_n_v7c.js";import{b as Yt}from"./route-block-B_A1xBdJ.js";/* empty css             */import"./pinia-DBRIaiZ_.js";import"./vue-demi-Dq6ymT-8.js";import"./pinia-plugin-persistedstate-RV7uh3T-.js";import"./jspdf-DacfHTdZ.js";import"./core-js-D2hAHviU.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./unplugin-vue-router-B1N3mqWX.js";import"./axios-upsvKRUO.js";import"./vue3-google-login-Dx7TV_Hx.js";import"./vue-easy-lightbox-D952uME8.js";import"./perfect-debounce-Cp2ysxOb.js";import"./hookable-B8xFkYCm.js";import"./RichTextEditor-DtFH-le8.js";import"./quill-CgyjECRE.js";import"./parchment-Crftfyop.js";import"./quill-delta-sRnrIlQj.js";import"./fast-diff-Az_-rVRq.js";import"./lodash.clonedeep-BdMlQXCI.js";import"./lodash.isequal-Cpo1Lurr.js";import"./eventemitter3-DGZIYkDQ.js";import"./lodash-es-BKPNmaDy.js";const Ua={class:"card-title px-6 py-4 bg-blue-grey-darken-2 d-flex align-center"},Ia={key:0,class:"text-caption text-medium-emphasis mt-1"},Ba={class:"color-grid"},Ea={__name:"EditProjectDialog",props:{modelValue:{type:Boolean,default:!1},project:{type:Object,default:null},teamDisabled:{type:Boolean,default:!1},allowedTeamIds:{type:Array,default:()=>[]}},emits:["update:modelValue","project-updated"],setup(ye,{emit:Te}){const b=ye,W=Te,{apiAuth:F}=Vt(),V=jt(),{smAndUp:H,lgAndUp:te}=sa(),pe=ee(()=>H.value?"default":"small"),se=ee(()=>H.value?te.value?40:32:28),ve=x(null),G=x(!1),j=x(!1),h=x(!1),L=x({name:"",team:"",description:"",iconColor:void 0}),ce=x([]),K=[{title:"ç´…è‰²",value:"red-accent-3"},{title:"ç²‰è‰²",value:"pink-accent-2"},{title:"ç´«è‰²",value:"purple-accent-1"},{title:"æ·±ç´«",value:"deep-purple-accent-1"},{title:"é›è—",value:"indigo-accent-2"},{title:"è—è‰²",value:"#92a9d1"},{title:"æ·ºè—",value:"light-blue-accent-3"},{title:"é’è‰²",value:"#46b5ac"},{title:"é’ç¶ ",value:"teal-accent-2"},{title:"ç¶ è‰²",value:"green-accent-3"},{title:"ç¿ ç¶ ",value:"#009572"},{title:"é»ƒè‰²",value:"#efbf59"},{title:"æ·±æ©™",value:"deep-orange-accent-3"}],fe=[U=>!!U||"è«‹è¼¸å…¥å°ˆæ¡ˆåç¨±",U=>U&&U.length>=2||"å°ˆæ¡ˆåç¨±è‡³å°‘éœ€è¦2å€‹å­—å…ƒ",U=>U&&U.length<=50||"å°ˆæ¡ˆåç¨±ä¸èƒ½è¶…éŽ50å€‹å­—å…ƒ"],be=[U=>!!U||"è«‹é¸æ“‡è² è²¬åœ˜éšŠ"],E=ee({get:()=>b.modelValue,set:U=>W("update:modelValue",U)}),N=async()=>{var U,y;try{h.value=!0;const{data:$}=await F.get("/projects/teams/list");if($.success){const de=$.data||[];b.allowedTeamIds&&b.allowedTeamIds.length>0?ce.value=de.filter(X=>b.allowedTeamIds.includes(X._id)):ce.value=[]}}catch($){console.error("å–å¾—åœ˜éšŠåˆ—è¡¨å¤±æ•—:",$),V({text:((y=(U=$==null?void 0:$.response)==null?void 0:U.data)==null?void 0:y.message)||"å–å¾—åœ˜éšŠåˆ—è¡¨å¤±æ•—",snackbarProps:{color:"red-lighten-1"}})}finally{h.value=!1}},g=async()=>{var U,y,$;if(G.value)try{j.value=!0;const de={name:L.value.name,team:L.value.team,description:L.value.description,status:(U=b.project)==null?void 0:U.status,...L.value.iconColor?{iconColor:L.value.iconColor}:{iconColor:null}},{data:X}=await F.put(`/projects/${b.project._id}`,de);X.success&&(V({text:"å°ˆæ¡ˆæ›´æ–°æˆåŠŸ",snackbarProps:{color:"teal-lighten-1"}}),W("project-updated",X.data),oe())}catch(de){console.error("æ›´æ–°å°ˆæ¡ˆå¤±æ•—:",de);const X=(($=(y=de.response)==null?void 0:y.data)==null?void 0:$.message)||"æ›´æ–°å°ˆæ¡ˆå¤±æ•—";V({text:X,snackbarProps:{color:"red-lighten-1"}})}finally{j.value=!1}},oe=()=>{E.value=!1},T=()=>{var U;b.project&&(L.value={name:b.project.name||"",team:((U=b.project.team)==null?void 0:U._id)||"",description:b.project.description||"",iconColor:b.project.iconColor||void 0})};return at(()=>b.modelValue,U=>{U&&(N(),T())}),at(()=>b.project,()=>{b.modelValue&&T()}),Bt(()=>{N()}),(U,y)=>(u(),B(He,{modelValue:E.value,"onUpdate:modelValue":y[5]||(y[5]=$=>E.value=$),"max-width":"520px",persistent:""},{default:t(()=>[a(De,{class:"rounded-lg"},{default:t(()=>[i("div",Ua,[a(v,{size:"20",color:"white",class:"me-2"},{default:t(()=>y[6]||(y[6]=[r(" mdi-pencil ")])),_:1}),y[8]||(y[8]=r(" ç·¨è¼¯å°ˆæ¡ˆ ")),a($e),a(A,{icon:"",color:"white",variant:"plain",class:"opacity-100",ripple:!1,size:"20",onClick:oe},{default:t(()=>[a(v,{size:"20"},{default:t(()=>y[7]||(y[7]=[r(" mdi-close ")])),_:1})]),_:1})]),a(Pe,{class:"mt-3 mb-2 px-6 pb-2"},{default:t(()=>[a(oa,{ref_key:"formRef",ref:ve,modelValue:G.value,"onUpdate:modelValue":y[4]||(y[4]=$=>G.value=$),onSubmit:ie(g,["prevent"])},{default:t(()=>[a(wt,null,{default:t(()=>[a(je,{cols:"12"},{default:t(()=>[a(Ze,{modelValue:L.value.name,"onUpdate:modelValue":y[0]||(y[0]=$=>L.value.name=$),label:"*å°ˆæ¡ˆåç¨±",rules:fe,required:"",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),a(je,{cols:"12"},{default:t(()=>[a(Xe,{modelValue:L.value.team,"onUpdate:modelValue":y[1]||(y[1]=$=>L.value.team=$),items:ce.value,"item-title":"name","item-value":"_id",label:"*è² è²¬åœ˜éšŠ",rules:be,required:"",variant:"outlined",density:"compact",loading:h.value,disabled:b.teamDisabled,"hide-details":"",clearable:!b.teamDisabled},{item:t(({props:$,item:de})=>[a(me,ta(aa($)),{prepend:t(()=>[a(v,null,{default:t(()=>y[9]||(y[9]=[r("mdi-account-group")])),_:1})]),default:t(()=>[a(na,null,{default:t(()=>{var X;return[r(P(((X=de.raw.members)==null?void 0:X.length)||0)+" ä½æˆå“¡ ",1)]}),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","items","loading","disabled","clearable"]),b.teamDisabled?(u(),_("div",Ia,[a(v,{size:"14",class:"me-1"},{default:t(()=>y[10]||(y[10]=[r(" mdi-information-outline ")])),_:1}),y[11]||(y[11]=r(" åªæœ‰æ­¤å°ˆæ¡ˆçš„åœ˜éšŠç®¡ç†è€…å¯è®Šæ›´è² è²¬åœ˜éšŠï¼Œä¸”åƒ…å¯è½‰ç§»åˆ°æ‚¨åŒæ™‚ç‚ºè©²åœ˜éšŠç®¡ç†è€…çš„åœ˜éšŠ "))])):J("",!0)]),_:1}),a(je,{cols:"12"},{default:t(()=>[a(Va,{modelValue:L.value.description,"onUpdate:modelValue":y[2]||(y[2]=$=>L.value.description=$),label:"å°ˆæ¡ˆæè¿°",variant:"outlined",density:"compact",rows:"6","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),a(je,{cols:"12"},{default:t(()=>[a(ja,{class:"text-body-2 mb-2 d-block"},{default:t(()=>y[12]||(y[12]=[r(" å°ˆæ¡ˆåœ–ç¤ºé¡è‰² ")])),_:1}),i("div",Ba,[a(A,{variant:L.value.iconColor===void 0?"flat":"outlined",color:"grey",size:se.value,icon:"",onClick:y[3]||(y[3]=$=>L.value.iconColor=void 0)},{default:t(()=>[a(v,null,{default:t(()=>y[13]||(y[13]=[r("mdi-square-rounded-outline")])),_:1})]),_:1},8,["variant","size"]),(u(),_(Ve,null,Be(K,$=>a(A,{key:$.value,color:$.value,variant:L.value.iconColor===$.value?"flat":"outlined",size:se.value,icon:"",onClick:de=>L.value.iconColor=$.value},{default:t(()=>[a(v,null,{default:t(()=>y[14]||(y[14]=[r("mdi-square-rounded")])),_:1})]),_:2},1032,["color","variant","size","onClick"])),64))])]),_:1})]),_:1}),a(qe,{class:"px-0 mt-4"},{default:t(()=>[a($e),a(A,{color:"grey-darken-1",variant:"outlined",class:"me-1",size:pe.value,onClick:oe},{default:t(()=>y[15]||(y[15]=[r(" å–æ¶ˆ ")])),_:1},8,["size"]),a(A,{color:"teal-darken-1",variant:"outlined",type:"submit",class:"ms-1",size:pe.value,loading:j.value,disabled:!G.value},{default:t(()=>y[16]||(y[16]=[r(" æ›´æ–°å°ˆæ¡ˆ ")])),_:1},8,["size","loading","disabled"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Na=zt(Ea,[["__scopeId","data-v-74dea007"]]),Oa={class:"card-title px-6 py-4 bg-blue-grey-darken-2 d-flex align-center"},Fa={class:"mb-6"},Ma={key:0,class:"d-flex justify-center py-8"},Ra={key:1},La={class:"mb-6"},Ka={class:"text-h4 font-weight-bold text-orange-darken-1"},qa={class:"text-h4 font-weight-bold text-blue-darken-1"},Ha={class:"text-h4 font-weight-bold text-green-darken-1"},Ja={class:"mb-4"},Wa={class:"d-flex align-center"},Ga={class:"font-weight-bold text-grey-darken-2"},Qa={key:0,class:"text-center py-8"},Ya={__name:"TaskStatisticsDialog",props:{modelValue:{type:Boolean,default:!1},project:{type:Object,default:null}},emits:["update:modelValue"],setup(ye,{emit:Te}){const b=ye,W=Te,{apiAuth:F}=Vt(),V=jt(),H=ee({get:()=>b.modelValue,set:N=>W("update:modelValue",N)}),te=x([]),pe=x([]),se=x(!1),ve=x([]),G=x({pending:0,inProgress:0,completed:0}),j=x(0),h=x(0),L=x(0),ce=[{title:"åˆ†é¡ž",key:"category",sortable:!0},{title:"å¾…è™•ç†",key:"pending",sortable:!0,align:"center"},{title:"é€²è¡Œä¸­",key:"inProgress",sortable:!0,align:"center"},{title:"å·²å®Œæˆ",key:"completed",sortable:!0,align:"center"},{title:"ç¸½è¨ˆ",key:"total",sortable:!0,align:"center"}],K=ee(()=>{const N=[];if(ve.value.forEach(g=>{const oe=(g.pending||0)+(g.inProgress||0)+(g.completed||0);N.push({category:g.name,pending:g.pending||0,inProgress:g.inProgress||0,completed:g.completed||0,total:oe,isUncategorized:!1})}),G.value&&(G.value.pending>0||G.value.inProgress>0||G.value.completed>0)){const g=(G.value.pending||0)+(G.value.inProgress||0)+(G.value.completed||0);N.push({category:"æœªåˆ†é¡ž",pending:G.value.pending||0,inProgress:G.value.inProgress||0,completed:G.value.completed||0,total:g,isUncategorized:!0})}return N}),fe=async()=>{var N,g,oe;if((N=b.project)!=null&&N._id){se.value=!0;try{const T={projectId:b.project._id};if(te.value&&te.value.length>0){const y=new Date(te.value[0]);y.setHours(0,0,0,0);const $=new Date(te.value[te.value.length-1]);$.setHours(23,59,59,999),T.startDate=y.toISOString(),T.endDate=$.toISOString(),pe.value=[T.startDate,T.endDate]}const{data:U}=await F.get("/tasks/statistics",{params:T});if(U.success){const y=U.data;ve.value=y.categoryStatistics||[],G.value=y.uncategorizedStats||{pending:0,inProgress:0,completed:0},j.value=y.totalPendingTasks||0,h.value=y.totalInProgressTasks||0,L.value=y.totalCompletedTasks||0,V({text:"çµ±è¨ˆè³‡æ–™è¼‰å…¥å®Œæˆ",snackbarProps:{color:"teal-lighten-1"}})}}catch(T){console.error("å–å¾—çµ±è¨ˆè³‡æ–™å¤±æ•—:",T),V({text:((oe=(g=T==null?void 0:T.response)==null?void 0:g.data)==null?void 0:oe.message)||"å–å¾—çµ±è¨ˆè³‡æ–™å¤±æ•—",snackbarProps:{color:"red-lighten-1"}})}finally{se.value=!1}}},be=async()=>{se.value||(te.value=[],pe.value=[],await fe())},E=()=>{H.value=!1};return at(H,N=>{N&&b.project?fe():N||(te.value=[],pe.value=[])}),(N,g)=>{const oe=la("v-date-input");return u(),B(He,{modelValue:H.value,"onUpdate:modelValue":g[1]||(g[1]=T=>H.value=T),"max-width":"840px",persistent:""},{default:t(()=>[a(De,{class:"rounded-lg"},{default:t(()=>[i("div",Oa,[a(v,{size:"20",color:"white",class:"me-2"},{default:t(()=>g[2]||(g[2]=[r(" mdi-chart-box ")])),_:1}),g[4]||(g[4]=r(" ä»»å‹™çµ±è¨ˆ ")),a($e),a(A,{icon:"",color:"white",variant:"plain",class:"opacity-100",ripple:!1,size:"20",onClick:E},{default:t(()=>[a(v,{size:"20"},{default:t(()=>g[3]||(g[3]=[r(" mdi-close ")])),_:1})]),_:1})]),a(Pe,{class:"px-6 pt-8"},{default:t(()=>[i("div",Fa,[a(wt,null,{default:t(()=>[a(je,{cols:"12",md:"6"},{default:t(()=>[a(oe,{modelValue:te.value,"onUpdate:modelValue":g[0]||(g[0]=T=>te.value=T),label:"æ—¥æœŸå€é–“ ( å·²å®Œæˆä»»å‹™ )",variant:"outlined",density:"compact",multiple:"range","prepend-icon":"mdi-calendar",clearable:"","hide-details":"","cancel-text":"å–æ¶ˆ","ok-text":"ç¢ºèª"},null,8,["modelValue"])]),_:1}),a(je,{cols:"12",md:"6",class:"d-flex align-center"},{default:t(()=>[a(A,{color:"cyan-darken-2",loading:se.value,elevation:"1",onClick:fe},{default:t(()=>g[5]||(g[5]=[r(" æŸ¥è©¢ ")])),_:1},8,["loading"]),a(A,{label:"",class:"ms-3",size:"36",color:"grey",elevation:"1",loading:se.value,onClick:be},{default:t(()=>[a(v,{size:"18"},{default:t(()=>g[6]||(g[6]=[r(" mdi-refresh ")])),_:1})]),_:1},8,["loading"])]),_:1})]),_:1})]),se.value?(u(),_("div",Ma,[a(Et,{indeterminate:"",color:"grey",size:"48"})])):(u(),_("div",Ra,[i("div",La,[a(wt,null,{default:t(()=>[a(je,{cols:"12",md:"4"},{default:t(()=>[a(De,{class:"rounded-lg border",elevation:"0",color:"orange-lighten-5"},{default:t(()=>[a(Pe,{class:"text-center py-4"},{default:t(()=>[g[7]||(g[7]=i("div",{class:"card-title text-orange-darken-2 mb-1"}," å¾…è™•ç† ",-1)),i("div",Ka,P(j.value),1),g[8]||(g[8]=i("div",{class:"sub-title text-medium-emphasis"}," ä»»å‹™æ•¸é‡ ",-1))]),_:1})]),_:1})]),_:1}),a(je,{cols:"12",md:"4"},{default:t(()=>[a(De,{class:"rounded-lg border",elevation:"0",color:"blue-lighten-5"},{default:t(()=>[a(Pe,{class:"text-center py-4"},{default:t(()=>[g[9]||(g[9]=i("div",{class:"card-title text-blue-darken-2 mb-1"}," é€²è¡Œä¸­ ",-1)),i("div",qa,P(h.value),1),g[10]||(g[10]=i("div",{class:"sub-title text-medium-emphasis"}," ä»»å‹™æ•¸é‡ ",-1))]),_:1})]),_:1})]),_:1}),a(je,{cols:"12",md:"4"},{default:t(()=>[a(De,{class:"rounded-lg border",elevation:"0",color:"green-lighten-5"},{default:t(()=>[a(Pe,{class:"text-center py-4"},{default:t(()=>[g[11]||(g[11]=i("div",{class:"card-title text-green-darken-2 mb-1"}," å·²å®Œæˆ ",-1)),i("div",Ha,P(L.value),1),g[12]||(g[12]=i("div",{class:"sub-title text-medium-emphasis"}," ä»»å‹™æ•¸é‡ ",-1))]),_:1})]),_:1})]),_:1})]),_:1})]),i("div",Ja,[g[14]||(g[14]=i("h4",{class:"card-title mb-3"}," å„åˆ†é¡žä»»å‹™çµ±è¨ˆè¡¨ ",-1)),a(It,{headers:ce,items:K.value,"items-per-page":-1,class:"statistics-table border rounded-lg","hide-default-footer":""},{"item.category":t(({item:T})=>[i("div",Wa,[T.isUncategorized?(u(),B(v,{key:0,color:"grey-darken-1",size:"20",class:"me-2"},{default:t(()=>g[13]||(g[13]=[r(" mdi-folder-question ")])),_:1})):J("",!0),i("span",{class:Ke(["font-weight-medium",T.isUncategorized?"text-grey-darken-1":"text-grey-darken-3"])},P(T.category),3)])]),"item.pending":t(({item:T})=>[i("span",{class:Ke(["font-weight-bold",T.pending>0?"text-orange-darken-1":"text-medium-emphasis"])},P(T.pending),3)]),"item.inProgress":t(({item:T})=>[i("span",{class:Ke(["font-weight-bold",T.inProgress>0?"text-blue-darken-1":"text-medium-emphasis"])},P(T.inProgress),3)]),"item.completed":t(({item:T})=>[i("span",{class:Ke(["font-weight-bold",T.completed>0?"text-green-darken-1":"text-medium-emphasis"])},P(T.completed),3)]),"item.total":t(({item:T})=>[i("span",Ga,P(T.total),1)]),_:2},1032,["items"])]),K.value.length===0?(u(),_("div",Qa,[a(v,{size:"48",color:"grey-lighten-1",class:"mb-3"},{default:t(()=>g[15]||(g[15]=[r(" mdi-chart-line-variant ")])),_:1}),g[16]||(g[16]=i("h4",{class:"text-h6 text-medium-emphasis mb-2"}," æ­¤å°ˆæ¡ˆæš«ç„¡ä»»å‹™ ",-1)),g[17]||(g[17]=i("p",{class:"text-body-2 text-medium-emphasis"}," è«‹å…ˆå»ºç«‹ä»»å‹™æˆ–æª¢æŸ¥å°ˆæ¡ˆè¨­å®š ",-1))])):J("",!0)]))]),_:1}),a(qe,{class:"px-6 pb-5"},{default:t(()=>[a($e),a(A,{color:"grey-darken-1",variant:"outlined",onClick:E},{default:t(()=>g[18]||(g[18]=[r(" é—œé–‰ ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},Za=zt(Ya,[["__scopeId","data-v-4da0f606"]]),Xa={class:"task-table-container"},el={key:0,class:"d-flex justify-center py-8"},tl={key:1},al={class:"task-tabs-container mb-4"},ll={class:"d-flex align-center justify-space-between"},sl={class:"d-flex align-center"},ol={class:"search-container d-flex align-center"},nl={key:0},rl={key:0,class:"empty-state text-center py-12"},il={key:0},dl={key:1},ul={class:"text-body-2 text-medium-emphasis mb-4"},cl={key:0},ml={key:1},pl={class:"task-categories-container"},vl=["onClick"],fl={class:"d-flex align-center justify-space-between w-100",style:{height:"20px"}},gl={class:"d-flex align-center"},kl={class:"expand-panel-title"},yl={key:0,class:"d-flex flex-column opacity-0 ms-2 category-sort-buttons"},bl={class:"pa-0"},xl={class:"task-table-wrapper"},_l={class:"d-flex align-center"},Cl={key:1,class:"d-flex align-center task-name-container"},hl={class:"d-flex align-center"},wl={key:1,class:"d-flex align-center assignee-container"},zl={class:"d-flex align-center"},Vl={key:1,class:"d-flex align-center due-date-container"},jl={class:"d-flex align-center"},Dl={key:0,class:"text-caption ms-1"},$l={key:1,class:"text-caption text-medium-emphasis"},Pl={class:"d-flex align-center"},Tl={class:"d-flex align-center"},Sl={class:"add-task-row"},Al={colspan:"8",class:"add-task-cell"},Ul={key:1,class:"d-flex justify-start mt-2"},Il={key:1,class:"d-flex align-center text-caption text-grey-darken-1 mt-2"},Bl={key:1},El={key:0,class:"empty-state text-center py-12"},Nl={key:0},Ol={key:1},Fl={key:1},Ml={class:"d-flex align-center"},Rl={class:"task-name"},Ll={key:1,class:"text-medium-emphasis"},Kl={key:0},ql={key:1,class:"text-medium-emphasis"},Hl={class:"text-caption"},Jl={key:1,class:"text-medium-emphasis"},Wl={key:1,class:"text-medium-emphasis"},Gl={key:1,class:"text-medium-emphasis"},Ql={class:"d-flex justify-center"},Yl={class:"card-title px-6 py-2 mb-2 d-flex justify-space-between align-center bg-blue-grey-darken-2"},Zl={class:"card-title px-6 py-2 mb-2 d-flex justify-space-between align-center bg-blue-grey-darken-2"},Xl={class:"card-title px-6 py-2 mb-2 d-flex justify-space-between align-center bg-blue-grey-darken-2"},es={class:"card-title px-6 py-2 mb-2 d-flex justify-space-between align-center bg-blue-grey-darken-2"},ts={class:"text-grey-darken-2 mb-4"},as={__name:"TaskTable",props:{project:{type:Object,required:!0},taskCategories:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["task-selected","task-updated","task-deleted","category-updated","task-created","category-created","project-updated"],setup(ye,{emit:Te}){const b=ye,W=Te,{apiAuth:F}=Vt(),V=jt(),H=Zt(),te=ea(),pe=Xt(),se=ee(()=>!b.project||!H._id?!1:pe.hasPermission("PROJECT_AND_TASK_MANAGE")?!0:te.isProjectTeamManager(b.project,H._id)),ve=ee(()=>{var l,e;return!b.project||!H._id?!1:pe.hasPermission("PROJECT_AND_TASK_MANAGE")?!0:((e=(l=b.project.team)==null?void 0:l.members)==null?void 0:e.some(n=>n._id===H._id))||!1}),G=x("in-progress"),j=x([]),h=x(!1),L=x(!1),ce=x(""),K=x({name:"",assignee:null,collaborators:[],dueDate:null,category:""}),fe=x(!1),be=x(!1),E=x(null),N=x(!1),g=x(""),oe=x(null),T=x(!1),U=x(""),y=x(!1),$=x(null),de=x(!1),X=x(!1),ge=x(null),Se=x(!1),Ae=x(null),he=x(!1),Ue=x(null),Ie=x(""),Ee=x(!1),Fe=x(null),Je=x(!1),Me=x(null),lt=x(!1),it=l=>{const e=j.value.indexOf(l);e>-1?j.value.splice(e,1):j.value.push(l)},dt=l=>j.value.includes(l),Ne=ee(()=>{let l=b.taskCategories.map(e=>{const n=e.tasks.filter(d=>d.status!=="completed").sort((d,k)=>d.order!==void 0&&k.order!==void 0?d.order-k.order:d.order!==void 0&&k.order===void 0?-1:d.order===void 0&&k.order!==void 0?1:new Date(k.createdAt)-new Date(d.createdAt));return{...e,tasks:n}});return l.sort((e,n)=>(e.order||0)-(n.order||0)),U.value&&U.value.trim()&&(l=l.map(e=>({...e,tasks:e.tasks.filter(n=>n.name.toLowerCase().includes(U.value.toLowerCase()))})).filter(e=>e.tasks.length>0)),l}),ut=ee(()=>U.value&&U.value.trim().length>0),We=ee(()=>{const l=[];b.taskCategories.forEach(n=>{n.tasks.forEach(d=>{d.status==="completed"&&l.push(d)})});let e=l;return U.value&&U.value.trim()&&(e=l.filter(n=>n.name.toLowerCase().includes(U.value.toLowerCase()))),e.sort((n,d)=>{const k=new Date(d.completedAt)-new Date(n.completedAt);return k!==0?k:n.order!==void 0&&d.order!==void 0?n.order-d.order:0})}),ct=ee(()=>Ne.value.reduce((l,e)=>l+e.tasks.length,0)),mt=ee(()=>We.value.length),pt=l=>!We.value.some(n=>n.category===l),Dt=[{title:"åç¨±",key:"name",sortable:!0},{title:"ç‹€æ…‹",key:"status",sortable:!0},{title:"æŒ‡æ´¾å°è±¡",key:"assignee",sortable:!0},{title:"æˆªæ­¢æ—¥æœŸ",key:"dueDate",sortable:!0},{title:"å”ä½œè€…",key:"collaborators",sortable:!1},{title:"ä¸Šæ¬¡ä¿®æ”¹æ™‚é–“",key:"updatedAt",sortable:!0},{title:"å»ºç«‹è€…",key:"createdBy",sortable:!0},{title:"æ“ä½œ",key:"actions",align:"center",sortable:!1,width:"80px"}],$t=[{title:"åç¨±",key:"name",sortable:!0},{title:"åˆ†é¡ž",key:"category",sortable:!0},{title:"æŒ‡æ´¾å°è±¡",key:"assignee",sortable:!0},{title:"æˆªæ­¢æ—¥æœŸ",key:"dueDate",sortable:!0},{title:"å”ä½œè€…",key:"collaborators",sortable:!1},{title:"å®Œæˆè€…",key:"completedBy",sortable:!0},{title:"å®Œæˆæ–¼",key:"completedAt",sortable:!0},{title:"å»ºç«‹è€…",key:"createdBy",sortable:!0},{title:"æ“ä½œ",key:"actions",align:"center",sortable:!1,width:"80px"}],Re=l=>l?new Date(l).toLocaleDateString("zh-TW",{month:"numeric",day:"numeric"}):"-",Ge=l=>l?new Date(l).toLocaleString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}):"-",Pt=l=>{var k,z,M,Y,Z,ae;if(!l)return null;if(typeof l=="object"&&l._id)return l;const e=typeof l=="string"?l:l==null?void 0:l._id,n=(M=(z=(k=b.project)==null?void 0:k.team)==null?void 0:z.members)==null?void 0:M.find(re=>re._id===e);if(n)return n;const d=(ae=(Z=(Y=b.project)==null?void 0:Y.team)==null?void 0:Z.managers)==null?void 0:ae.find(re=>re._id===e);return d||null},st=l=>{var d,k,z,M;const e=l==null?void 0:l.completedBy,n=Pt(e);return n||console.log("[TaskTable] ç„¡æ³•è§£æžå®Œæˆè€…",{taskId:l==null?void 0:l._id,completedByRaw:e,teamMembers:(((k=(d=b.project)==null?void 0:d.team)==null?void 0:k.members)||[]).map(Y=>Y._id),teamManagers:(((M=(z=b.project)==null?void 0:z.team)==null?void 0:M.managers)||[]).map(Y=>Y._id)}),n},vt=l=>{switch(l){case"pending":return"orange";case"in_progress":return"blue";case"completed":return"green";default:return"grey"}},ft=l=>{switch(l){case"pending":return"å¾…è™•ç†";case"in_progress":return"é€²è¡Œä¸­";case"completed":return"å·²å®Œæˆ";default:return"æœªçŸ¥"}},gt=l=>{if(!l)return"text-medium-emphasis";const e=new Date,d=new Date(l)-e,k=Math.ceil(d/(1e3*60*60*24));return k<0?"text-red-darken-1":k<=3?"text-purple-darken-1":k<=10?"text-light-blue-accent-4":"text-medium-emphasis"},kt=(l,{item:e})=>{console.log("TaskTable é¸æ“‡çš„ä»»å‹™è³‡æ–™:",e),W("task-selected",e)},yt=()=>{$.value&&clearTimeout($.value),$.value=setTimeout(()=>{},300)},Tt=l=>{l.status!=="completed"?(Fe.value=l,Ee.value=!0):o(l,!1)},o=async(l,e=!0)=>{var n,d,k,z,M,Y;try{const Z=e?{status:"completed",completedBy:H._id}:{status:"pending",completedBy:null,completedAt:null},{data:ae}=await F.put(`/tasks/${l._id}`,Z);if(ae.success){const re=ae.data||{};if(re.completedBy&&typeof re.completedBy=="string"){const Qe=(((d=(n=b.project)==null?void 0:n.team)==null?void 0:d.members)||[]).find(m=>m._id===re.completedBy)||(((z=(k=b.project)==null?void 0:k.team)==null?void 0:z.managers)||[]).find(m=>m._id===re.completedBy)||{_id:H._id,name:H.name,email:H.email,avatar:H.avatar};re.completedBy=Qe}W("task-updated",re),V({text:e?"ä»»å‹™å·²å®Œæˆ":"ä»»å‹™å·²æ¨™è¨˜ç‚ºæœªå®Œæˆ",snackbarProps:{color:"teal-lighten-1"}})}}catch(Z){console.error("æ›´æ–°ä»»å‹™ç‹€æ…‹å¤±æ•—:",Z),V({text:((Y=(M=Z==null?void 0:Z.response)==null?void 0:M.data)==null?void 0:Y.message)||"æ›´æ–°ä»»å‹™ç‹€æ…‹å¤±æ•—",snackbarProps:{color:"red-lighten-1"}})}},s=async()=>{if(!Fe.value)return;const l=Fe.value;Ee.value=!1,await o(l,!0),Fe.value=null},c=()=>{ce.value="",h.value=!0},C=()=>{lt.value=!0},w=l=>{oe.value=l,g.value=l.name,N.value=!0},f=l=>{ge.value=l,X.value=!0},S=l=>{if(!l||!l._id){console.error("ä»»å‹™è³‡æ–™ä¸å®Œæ•´:",l),V({text:"ä»»å‹™è³‡æ–™ä¸å®Œæ•´ï¼Œç„¡æ³•åˆªé™¤",snackbarProps:{color:"red-lighten-1"}});return}Ae.value=l,Se.value=!0},D=async()=>{var e,n;if(!ce.value.trim())return;const l=ce.value.trim();try{fe.value=!0;const d=b.project.taskCategories||[];if(console.log("ðŸ” æ–°å¢žåˆ†é¡žæ™‚çš„å°ˆæ¡ˆè³‡æ–™:",{projectId:b.project._id,categoriesCount:d.length,categories:d.map(Z=>({name:Z.name,order:Z.order}))}),d.some(Z=>Z.name===l)){V({text:`åˆ†é¡žåç¨±ã€Œ${l}ã€å·²å­˜åœ¨ï¼Œè«‹ä½¿ç”¨ä¸åŒçš„åç¨±`,snackbarProps:{color:"red-lighten-1"}});return}const z=d.length>0?Math.max(...d.map(Z=>Z.order||0)):-1,M={name:l,order:z+1},{data:Y}=await F.put(`/projects/${b.project._id}`,{taskCategories:[...d,M]});Y.success&&(h.value=!1,ce.value="",W("category-created",{category:M,project:Y.data}),V({text:"ä»»å‹™åˆ†é¡žå»ºç«‹æˆåŠŸ",snackbarProps:{color:"teal-lighten-1"}}))}catch(d){console.error("å»ºç«‹ä»»å‹™åˆ†é¡žå¤±æ•—:",d),V({text:((n=(e=d==null?void 0:d.response)==null?void 0:e.data)==null?void 0:n.message)||"å»ºç«‹ä»»å‹™åˆ†é¡žå¤±æ•—",snackbarProps:{color:"red-lighten-1"}})}finally{fe.value=!1}},q=async()=>{var l,e;if(!(!g.value.trim()||!oe.value))try{T.value=!0;const d=(b.project.taskCategories||[]).map(z=>z.name===oe.value.name?{...z,name:g.value.trim()}:z),{data:k}=await F.put(`/projects/${b.project._id}`,{taskCategories:d});k.success&&(N.value=!1,g.value="",oe.value=null,W("category-updated",{project:k.data,categoryNameChanges:k.categoryNameChanges||[]}),V({text:k.message||"ä»»å‹™åˆ†é¡žæ›´æ–°æˆåŠŸ",snackbarProps:{color:"teal-lighten-1"}}),k.categoryNameChanges&&k.categoryNameChanges.length>0&&console.log("âœ… åˆ†é¡žåç¨±è®Šæ›´è©³æƒ…ï¼š",k.categoryNameChanges))}catch(n){console.error("æ›´æ–°ä»»å‹™åˆ†é¡žå¤±æ•—:",n),V({text:((e=(l=n==null?void 0:n.response)==null?void 0:l.data)==null?void 0:e.message)||"æ›´æ–°ä»»å‹™åˆ†é¡žå¤±æ•—",snackbarProps:{color:"red-lighten-1"}})}finally{T.value=!1}},I=async()=>{var l,e;if(!ge.value||!ge.value.name){console.error("åˆªé™¤ä»»å‹™åˆ†é¡žå¤±æ•—: åˆ†é¡žè³‡æ–™ä¸å®Œæ•´"),V({text:"åˆªé™¤ä»»å‹™åˆ†é¡žå¤±æ•—: åˆ†é¡žè³‡æ–™ä¸å®Œæ•´",snackbarProps:{color:"red-lighten-1"}});return}try{const n=encodeURIComponent(ge.value.name),{data:d}=await F.delete(`/projects/${b.project._id}/categories/${n}`);d.success&&(X.value=!1,ge.value=null,W("category-updated",{project:d.data,categoryNameChanges:[]}),V({text:d.message||"ä»»å‹™åˆ†é¡žåˆªé™¤æˆåŠŸ",snackbarProps:{color:"teal-lighten-1"}}))}catch(n){console.error("åˆªé™¤ä»»å‹™åˆ†é¡žå¤±æ•—:",n),V({text:((e=(l=n==null?void 0:n.response)==null?void 0:l.data)==null?void 0:e.message)||"åˆªé™¤ä»»å‹™åˆ†é¡žå¤±æ•—",snackbarProps:{color:"red-lighten-1"}})}},Q=async()=>{var l,e;if(!Ae.value||!Ae.value._id){console.error("åˆªé™¤ä»»å‹™å¤±æ•—: ä»»å‹™è³‡æ–™ä¸å®Œæ•´"),V({text:"åˆªé™¤ä»»å‹™å¤±æ•—: ä»»å‹™è³‡æ–™ä¸å®Œæ•´",snackbarProps:{color:"red-lighten-1"}});return}try{const{data:n}=await F.delete(`/tasks/${Ae.value._id}`);if(n.success){const d=Ae.value._id;Se.value=!1,Ae.value=null,W("task-deleted",d),V({text:"ä»»å‹™åˆªé™¤æˆåŠŸ",snackbarProps:{color:"teal-lighten-1"}})}}catch(n){console.error("åˆªé™¤ä»»å‹™å¤±æ•—:",n),V({text:((e=(l=n==null?void 0:n.response)==null?void 0:l.data)==null?void 0:e.message)||"åˆªé™¤ä»»å‹™å¤±æ•—",snackbarProps:{color:"red-lighten-1"}})}},ne=async l=>{var e,n;try{const d=l.assignee?"in_progress":"pending",{data:k}=await F.put(`/tasks/${l._id}`,{status:d,completedAt:null});if(k.success){const z=k.data;b.taskCategories.forEach(M=>{const Y=M.tasks.findIndex(Z=>Z._id===l._id);Y!==-1&&(M.tasks[Y]=z)}),W("task-updated",z),V({text:"ä»»å‹™å·²é‡æ–°é–‹å•Ÿ",snackbarProps:{color:"teal-lighten-1"}})}}catch(d){console.error("é‡æ–°é–‹å•Ÿä»»å‹™å¤±æ•—:",d),V({text:((n=(e=d==null?void 0:d.response)==null?void 0:e.data)==null?void 0:n.message)||"é‡æ–°é–‹å•Ÿä»»å‹™å¤±æ•—",snackbarProps:{color:"red-lighten-1"}})}},we=l=>{Me.value=l,Je.value=!0},ze=async()=>{if(!Me.value)return;const l=Me.value;Je.value=!1,await ne(l),Me.value=null},bt=l=>{K.value={name:"",assignee:null,collaborators:[],dueDate:null,category:l},L.value=!0},ot=async()=>{var l,e;if(K.value.name.trim())try{be.value=!0;const n={name:K.value.name.trim(),assignee:K.value.assignee,collaborators:K.value.collaborators||[],dueDate:K.value.dueDate?K.value.dueDate instanceof Date?K.value.dueDate.toISOString():K.value.dueDate:null,category:K.value.category,project:b.project._id},{data:d}=await F.post("/tasks",n);d.success&&(L.value=!1,W("task-created",{task:d.data,category:K.value.category}),V({text:"ä»»å‹™å»ºç«‹æˆåŠŸ",snackbarProps:{color:"teal-lighten-1"}}))}catch(n){console.error("å»ºç«‹ä»»å‹™å¤±æ•—:",n),V({text:((e=(l=n==null?void 0:n.response)==null?void 0:l.data)==null?void 0:e.message)||"å»ºç«‹ä»»å‹™å¤±æ•—",snackbarProps:{color:"red-lighten-1"}})}finally{be.value=!1}},xt=l=>{E.value={...l,editingField:"name"}},_t=l=>{var e;E.value={...l,editingField:"assignee",collaborators:((e=l.collaborators)==null?void 0:e.map(n=>typeof n=="object"?n._id:n).filter(Boolean))||[]}},ua=l=>{var e;E.value={...l,editingField:"dueDate",collaborators:((e=l.collaborators)==null?void 0:e.map(n=>typeof n=="object"?n._id:n).filter(Boolean))||[]}},ca=l=>{var e;E.value={...l,editingField:"collaborators",collaborators:((e=l.collaborators)==null?void 0:e.map(n=>typeof n=="object"?n._id:n).filter(Boolean))||[]}},Nt=()=>{E.value=null},Ct=async(l,e)=>{var n,d;try{de.value=!0;const{data:k}=await F.put(`/tasks/${l}`,e);k.success&&(W("task-updated",k.data),E.value=null,V({text:"ä»»å‹™æ›´æ–°æˆåŠŸ",snackbarProps:{color:"teal-lighten-1"}}))}catch(k){console.error("æ›´æ–°ä»»å‹™å¤±æ•—:",k),V({text:((d=(n=k==null?void 0:k.response)==null?void 0:n.data)==null?void 0:d.message)||"æ›´æ–°ä»»å‹™å¤±æ•—",snackbarProps:{color:"red-lighten-1"}})}finally{de.value=!1}},ma=async(l,e)=>{var k;const n=((k=l.assignee)==null?void 0:k._id)||l.assignee,d=n!==e;if(console.log("æŒ‡æ´¾å°è±¡è®Šæ›´æª¢æŸ¥:",{original:n,new:e,hasChanged:d}),d){const z=e?"in_progress":"pending";await Ct(l._id,{assignee:e,status:z})}else console.log("æŒ‡æ´¾å°è±¡æ²’æœ‰è®Šæ›´ï¼Œè·³éŽæ›´æ–°")},Ot=async(l,e)=>{const n=e?e instanceof Date?e.toISOString():e:null,d=l.dueDate?l.dueDate instanceof Date?l.dueDate.toISOString():l.dueDate:null,k=d!==n;console.log("æˆªæ­¢æ—¥æœŸè®Šæ›´æª¢æŸ¥:",{original:d,new:n,hasChanged:k}),k?await Ct(l._id,{dueDate:n}):console.log("æˆªæ­¢æ—¥æœŸæ²’æœ‰è®Šæ›´ï¼Œè·³éŽæ›´æ–°")},pa=async(l,e)=>{if(E.value&&E.value._id===l._id){const n=(e||[]).filter(d=>d&&typeof d=="string");E.value.collaborators=n,console.log("æ›´æ–°å”ä½œè€…:",n)}},Ft=async l=>{var e;if(E.value&&E.value._id===l._id){const n=(e=E.value.name)==null?void 0:e.trim();n&&n!==l.name&&await Ct(l._id,{name:n})}},va=async l=>{if(E.value&&E.value._id===l._id){const n=(E.value.collaborators||[]).filter(z=>z&&typeof z=="string"),d=(l.collaborators||[]).map(z=>typeof z=="object"?z._id:z).filter(Boolean),k=JSON.stringify(d.sort())!==JSON.stringify(n.sort());console.log("å”ä½œè€…è®Šæ›´æª¢æŸ¥:",{original:d,new:n,hasChanged:k}),k?await Ct(l._id,{collaborators:n}):console.log("å”ä½œè€…æ²’æœ‰è®Šæ›´ï¼Œè·³éŽæ›´æ–°")}},nt=(l,e=null)=>!E.value||E.value._id!==l._id?!1:e?E.value.editingField===e:!0,xe=l=>nt(l)&&E.value?(E.value.collaborators||[]).map(n=>{var d,k,z;return(z=(k=(d=b.project)==null?void 0:d.team)==null?void 0:k.members)==null?void 0:z.find(M=>M._id===n)}).filter(Boolean):l.collaborators||[],Mt=l=>{const e=xe(l);return!e||e.length===0?"ç„¡å”ä½œè€…":`${e.map(n=>n.name).join("ã€")}`};at(()=>Ne.value,(l,e)=>{if(l.length>0&&j.value.length===0){j.value=l.map((n,d)=>d);return}if(e&&l.length>e.length){const n=new Set(e.map(d=>d.name));l.forEach((d,k)=>{n.has(d.name)||j.value.includes(k)||j.value.push(k)})}e&&l.length<e.length&&(j.value=j.value.filter(n=>n<l.length))},{immediate:!0});const Rt=l=>{l.key==="Escape"&&E.value&&Nt()},Lt=l=>{if(E.value){const e=l.target.closest(".assignee-select, .due-date-input, .collaborators-select, .task-name-input"),n=l.target.closest(".v-date-picker, .v-picker, .v-overlay__content"),d=l.target.closest(".v-overlay__content .v-list, .v-menu__content");!e&&!n&&!d&&Nt()}},fa=async l=>{if(l!==0)try{const e=[...b.project.taskCategories],n=e[l];e[l]=e[l-1],e[l-1]=n;const d=e.map((z,M)=>({...z,order:M})),k={...b.project,taskCategories:d};W("project-updated",k);try{await F.put(`/projects/${b.project._id}/categories/order`,{taskCategories:d.map(z=>({name:z.name,color:z.color||"grey",order:z.order}))}),console.log("âœ… ä»»å‹™åˆ†é¡žæŽ’åº API æ›´æ–°æˆåŠŸ")}catch(z){console.error("âŒ ä»»å‹™åˆ†é¡žæŽ’åº API æ›´æ–°å¤±æ•—:",z),V({text:"æŽ’åºæ›´æ–°å¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†é é¢",snackbarProps:{color:"red-lighten-1"}})}}catch(e){console.error("âŒ ä»»å‹™åˆ†é¡žæŽ’åºæœ¬åœ°æ›´æ–°å¤±æ•—:",e),V({text:"æŽ’åºæ›´æ–°å¤±æ•—",snackbarProps:{color:"red-lighten-1"}})}},ga=async l=>{if(l!==b.project.taskCategories.length-1)try{const e=[...b.project.taskCategories],n=e[l];e[l]=e[l+1],e[l+1]=n;const d=e.map((z,M)=>({...z,order:M})),k={...b.project,taskCategories:d};W("project-updated",k);try{await F.put(`/projects/${b.project._id}/categories/order`,{taskCategories:d.map(z=>({name:z.name,color:z.color||"grey",order:z.order}))}),console.log("âœ… ä»»å‹™åˆ†é¡žæŽ’åº API æ›´æ–°æˆåŠŸ")}catch(z){console.error("âŒ ä»»å‹™åˆ†é¡žæŽ’åº API æ›´æ–°å¤±æ•—:",z),V({text:"æŽ’åºæ›´æ–°å¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†é é¢",snackbarProps:{color:"red-lighten-1"}})}}catch(e){console.error("âŒ ä»»å‹™åˆ†é¡žæŽ’åºæœ¬åœ°æ›´æ–°å¤±æ•—:",e),V({text:"æŽ’åºæ›´æ–°å¤±æ•—",snackbarProps:{color:"red-lighten-1"}})}},Kt=l=>{Ue.value=l,Ie.value=l.category||"",he.value=!0},ka=async()=>{var l,e;if(!(!Ue.value||!Ie.value))try{const{data:n}=await F.put(`/tasks/${Ue.value._id}`,{category:Ie.value});n.success&&(W("task-updated",n.data),he.value=!1,Ue.value=null,Ie.value="",V({text:"ä»»å‹™åˆ†é¡žæ›´æ–°æˆåŠŸ",snackbarProps:{color:"teal-lighten-1"}}))}catch(n){console.error("ç§»å‹•ä»»å‹™å¤±æ•—:",n),V({text:((e=(l=n==null?void 0:n.response)==null?void 0:l.data)==null?void 0:e.message)||"ç§»å‹•ä»»å‹™å¤±æ•—",snackbarProps:{color:"red-lighten-1"}})}},ya=ee(()=>{var e;return((e=b.project)==null?void 0:e.taskCategories)||[]}),ba=ee(()=>{var e,n;return(((n=(e=b.project)==null?void 0:e.team)==null?void 0:n.members)||[]).filter(d=>d&&d._id!==H._id)}),qt=async l=>{var e,n,d,k,z;try{let Y=`${l.name}-è¤‡æœ¬`,ae=await(async re=>{const{data:Qe}=await F.post("/tasks",{name:re,description:l.description||"",category:l.category||"",project:b.project._id});return Qe})(Y);if(!ae.success)throw new Error(ae.message||"è¤‡è£½ä»»å‹™å¤±æ•—");if(ae.success){W("task-created",{task:ae.data,category:l.category||""}),V({text:"ä»»å‹™è¤‡è£½æˆåŠŸ",snackbarProps:{color:"teal-lighten-1"}});return}}catch(M){const Y=((n=(e=M==null?void 0:M.response)==null?void 0:e.data)==null?void 0:n.message)||"";if(!(Y.includes("å·²å­˜åœ¨")||((d=M==null?void 0:M.response)==null?void 0:d.status)===409)){console.error("è¤‡è£½ä»»å‹™å¤±æ•—:",M),V({text:Y||"è¤‡è£½ä»»å‹™å¤±æ•—",snackbarProps:{color:"red-lighten-1"}});return}try{const ae=`${l.name}-è¤‡æœ¬ (2)`,{data:re}=await F.post("/tasks",{name:ae,description:l.description||"",category:l.category||"",project:b.project._id});if(re.success){W("task-created",{task:re.data,category:l.category||""}),V({text:"ä»»å‹™è¤‡è£½æˆåŠŸ",snackbarProps:{color:"teal-lighten-1"}});return}throw new Error(re.message||"è¤‡è£½ä»»å‹™å¤±æ•—")}catch(ae){console.error("è¤‡è£½ä»»å‹™å¤±æ•— (ç¬¬äºŒæ¬¡å˜—è©¦):",ae),V({text:((z=(k=ae==null?void 0:ae.response)==null?void 0:k.data)==null?void 0:z.message)||"è¤‡è£½ä»»å‹™å¤±æ•—",snackbarProps:{color:"red-lighten-1"}})}}};return Bt(()=>{document.addEventListener("keydown",Rt),document.addEventListener("click",Lt)}),ha(()=>{document.removeEventListener("keydown",Rt),document.removeEventListener("click",Lt)}),(l,e)=>{var z,M,Y,Z,ae,re,Qe;const n=la("v-date-input"),d=ra,k=ia;return u(),_("div",Xa,[ye.loading?(u(),_("div",el,[a(Et,{indeterminate:"",color:"primary",size:"48"})])):(u(),_("div",tl,[i("div",al,[i("div",ll,[a(Da,{modelValue:G.value,"onUpdate:modelValue":e[0]||(e[0]=m=>G.value=m),color:"teal-darken-1","align-tabs":"start"},{default:t(()=>[a(Wt,{value:"in-progress"},{default:t(()=>[a(v,{class:"me-2"},{default:t(()=>e[33]||(e[33]=[r(" mdi-clock-outline ")])),_:1}),e[34]||(e[34]=r(" é€²è¡Œä¸­ ")),ct.value>0?(u(),B(Le,{key:0,size:"x-small",color:G.value==="in-progress"?"teal-darken-1":"grey",variant:"tonal",class:"ms-2"},{default:t(()=>[r(P(ct.value),1)]),_:1},8,["color"])):J("",!0)]),_:1}),a(Wt,{value:"completed"},{default:t(()=>[a(v,{class:"me-2"},{default:t(()=>e[35]||(e[35]=[r(" mdi-check-circle-outline ")])),_:1}),e[36]||(e[36]=r(" å·²å®Œæˆ ")),mt.value>0?(u(),B(Le,{key:0,size:"x-small",color:G.value==="completed"?"green-darken-1":"grey",variant:"tonal",class:"ms-2"},{default:t(()=>[r(P(mt.value),1)]),_:1},8,["color"])):J("",!0)]),_:1})]),_:1},8,["modelValue"]),i("div",sl,[a(A,{color:"blue-grey-darken-1",variant:"outlined",class:"me-4","prepend-icon":"mdi-chart-box",onClick:C},{default:t(()=>e[37]||(e[37]=[r(" çµ±è¨ˆ ")])),_:1}),i("div",ol,[a(Ze,{modelValue:U.value,"onUpdate:modelValue":e[1]||(e[1]=m=>U.value=m),label:"æœå°‹ä»»å‹™åç¨±","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact","hide-details":"",clearable:"",class:"search-field",loading:y.value,onInput:yt},null,8,["modelValue","loading"])])])])]),G.value==="in-progress"?(u(),_("div",nl,[Ne.value.length===0?(u(),_("div",rl,[ut.value?(u(),_("div",il,[a(v,{size:"56",color:"grey-lighten-1",class:"mb-2"},{default:t(()=>e[38]||(e[38]=[r(" mdi-magnify-remove ")])),_:1}),e[39]||(e[39]=i("h3",{class:"text-h6 text-medium-emphasis mb-2"}," æ²’æœ‰æœå°‹åˆ°ç›¸é—œä»»å‹™ ",-1)),e[40]||(e[40]=i("p",{class:"text-body-2 text-medium-emphasis mb-4"}," è«‹å˜—è©¦å…¶ä»–æœå°‹é—œéµå­— ",-1))])):(u(),_("div",dl,[a(v,{size:"56",color:"grey-lighten-1",class:"mb-2"},{default:t(()=>e[41]||(e[41]=[r(" mdi-clipboard-list-outline ")])),_:1}),e[43]||(e[43]=i("h3",{class:"text-h6 text-medium-emphasis mb-2"}," å°šç„¡ä»»å‹™åˆ†é¡ž ",-1)),i("p",ul,[se.value?(u(),_("span",cl,"é»žæ“Šä¸‹æ–¹çš„æŒ‰éˆ•ä¾†å»ºç«‹ç¬¬ä¸€å€‹ä»»å‹™åˆ†é¡ž")):(u(),_("span",ml,"è«‹è¯ç¹«åœ˜éšŠç®¡ç†è€…å»ºç«‹ä»»å‹™åˆ†é¡ž"))]),se.value?(u(),B(A,{key:0,color:"primary",variant:"outlined","prepend-icon":"mdi-plus",onClick:c},{default:t(()=>e[42]||(e[42]=[r(" å»ºç«‹ä»»å‹™åˆ†é¡ž ")])),_:1})):J("",!0)]))])):J("",!0),i("div",pl,[(u(!0),_(Ve,null,Be(Ne.value,(m,O)=>(u(),_("div",{key:m.name,class:"task-category-panel"},[i("div",{class:"category-header",onClick:p=>it(O)},[i("div",fl,[i("div",gl,[i("span",kl,P(m.name),1),a(Le,{label:"",size:"small",class:"ms-3",color:"light-blue-darken-3",variant:"tonal"},{default:t(()=>[r(P(m.tasks.length),1)]),_:2},1024),se.value?(u(),_("div",yl,[a(A,{icon:"",size:"14",variant:"plain",color:"grey-darken-1",disabled:O===0,onClick:ie(p=>fa(O),["stop"])},{default:t(()=>[a(v,{size:"14"},{default:t(()=>e[44]||(e[44]=[r(" mdi-chevron-up ")])),_:1})]),_:2},1032,["disabled","onClick"]),a(A,{icon:"",size:"14",variant:"plain",color:"grey-darken-1",disabled:O===Ne.value.length-1,onClick:ie(p=>ga(O),["stop"])},{default:t(()=>[a(v,{size:"14"},{default:t(()=>e[45]||(e[45]=[r(" mdi-chevron-down ")])),_:1})]),_:2},1032,["disabled","onClick"])])):J("",!0),se.value?(u(),B(A,{key:1,icon:"",size:"x-small",variant:"plain",color:"light-blue-darken-3",class:"ms-2 opacity-0 category-edit-btn",onClick:ie(p=>w(m),["stop"])},{default:t(()=>[a(v,{size:"16"},{default:t(()=>e[46]||(e[46]=[r(" mdi-pencil ")])),_:1})]),_:2},1032,["onClick"])):J("",!0),se.value&&pt(m.name)?(u(),B(A,{key:2,icon:"",size:"x-small",variant:"plain",color:"red-lighten-1",class:"opacity-0 category-delete-btn",onClick:ie(p=>f(m),["stop"])},{default:t(()=>[a(v,{size:"16"},{default:t(()=>e[47]||(e[47]=[r(" mdi-delete ")])),_:1})]),_:2},1032,["onClick"])):J("",!0),se.value&&!pt(m.name)?(u(),B(Ce,{key:3,text:"æ­¤åˆ†é¡žä¸‹æœ‰å·²å®Œæˆä»»å‹™ï¼Œç„¡æ³•åˆªé™¤",location:"top"},{activator:t(({props:p})=>[i("div",le({ref_for:!0},p),[a(A,{icon:"",size:"x-small",variant:"plain",color:"grey",disabled:"",class:"opacity-0 category-delete-btn"},{default:t(()=>[a(v,{size:"16"},{default:t(()=>e[48]||(e[48]=[r(" mdi-delete ")])),_:1})]),_:1})],16)]),_:1})):J("",!0)]),a(v,{class:Ke([{"rotate-180":dt(O)},"transition-transform"])},{default:t(()=>e[49]||(e[49]=[r(" mdi-chevron-down ")])),_:2},1032,["class"])])],8,vl),a($a,null,{default:t(()=>[wa(i("div",bl,[i("div",xl,[a(It,{headers:Dt,items:m.tasks,"items-per-page":-1,density:"compact",class:"task-table","hide-default-footer":"","onClick:row":kt},{"item.name":t(({item:p})=>[i("div",_l,[a(v,{color:p.status==="completed"?"teal-lighten-1":"grey-lighten-1",class:"me-2 pt-1",size:"20"},{default:t(()=>[r(P(p.status==="completed"?"mdi-check-circle":"mdi-check-circle-outline"),1)]),_:2},1032,["color"]),nt(p,"name")?(u(),B(Ze,{key:0,modelValue:E.value.name,"onUpdate:modelValue":e[2]||(e[2]=R=>E.value.name=R),variant:"outlined",density:"compact","hide-details":"",class:"task-name-input",onBlur:R=>Ft(p),onKeyup:At(R=>Ft(p),["enter"]),onClick:e[3]||(e[3]=ie(()=>{},["stop"]))},null,8,["modelValue","onBlur","onKeyup"])):(u(),_("div",Cl,[i("span",{class:Ke(["task-name",{"text-decoration-line-through":p.status==="completed"}])},P(p.name),3),a(v,{size:"14",class:"ms-1 task-name-edit-btn cursor-pointer",onClick:ie(R=>xt(p),["stop"])},{default:t(()=>e[50]||(e[50]=[r(" mdi-pencil ")])),_:2},1032,["onClick"])]))])]),"item.status":t(({item:p})=>[a(Le,{color:vt(p.status),size:"small",variant:"tonal"},{default:t(()=>[r(P(ft(p.status)),1)]),_:2},1032,["color"])]),"item.assignee":t(({item:p})=>{var R,Oe,rt;return[i("div",hl,[nt(p,"assignee")?(u(),B(Xe,{key:0,"model-value":(R=E.value.assignee)==null?void 0:R._id,items:((rt=(Oe=ye.project)==null?void 0:Oe.team)==null?void 0:rt.members)||[],"item-title":"name","item-value":"_id",variant:"outlined",density:"compact","hide-details":"",clearable:"",class:"assignee-select","onUpdate:modelValue":ue=>ma(p,ue),onClick:e[4]||(e[4]=ie(()=>{},["stop"]))},{item:t(({props:ue,item:Ye})=>[a(me,le({ref_for:!0},ue),{prepend:t(()=>[a(ke,{user:Ye.raw,size:"24","avatar-class":"me-2"},null,8,["user"])]),_:2},1040)]),selection:t(({item:ue})=>[a(ke,{user:ue.raw,size:"24","avatar-class":"me-2"},null,8,["user"])]),_:2},1032,["model-value","items","onUpdate:modelValue"])):(u(),_("div",wl,[p.assignee?(u(),B(Ce,{key:0,text:p.assignee.name,location:"top"},{activator:t(({props:ue})=>[a(ke,le({ref_for:!0},ue,{user:p.assignee,size:"24"}),null,16,["user"])]),_:2},1032,["text"])):(u(),B(ht,{key:1,size:"24",variant:"outlined",color:"grey-lighten-1"},{default:t(()=>[a(v,{size:"16",color:"grey"},{default:t(()=>e[51]||(e[51]=[r(" mdi-account-outline ")])),_:1})]),_:1})),a(v,{size:"14",class:"ms-1 assignee-edit-btn cursor-pointer",onClick:ie(ue=>_t(p),["stop"])},{default:t(()=>e[52]||(e[52]=[r(" mdi-pencil ")])),_:2},1032,["onClick"])]))])]}),"item.dueDate":t(({item:p})=>[i("div",zl,[nt(p,"dueDate")?(u(),B(n,{key:0,"model-value":E.value.dueDate?new Date(E.value.dueDate):null,variant:"outlined",density:"compact","hide-details":"",clearable:"","prepend-icon":"","ok-text":"ç¢ºèª","cancel-text":"å–æ¶ˆ",class:"due-date-input","onUpdate:modelValue":R=>Ot(p,R),"onClick:clear":()=>Ot(p,null),onClick:e[5]||(e[5]=ie(()=>{},["stop"]))},null,8,["model-value","onUpdate:modelValue","onClick:clear"])):(u(),_("div",Vl,[p.dueDate?(u(),B(v,{key:0,size:"16",class:"me-1",color:gt(p.dueDate)},{default:t(()=>e[53]||(e[53]=[r(" mdi-calendar-clock-outline ")])),_:2},1032,["color"])):J("",!0),i("span",{class:Ke([gt(p.dueDate),"due-date-text"])},P(Re(p.dueDate)),3),a(v,{size:"14",class:"ms-1 due-date-edit-btn cursor-pointer",onClick:ie(R=>ua(p),["stop"])},{default:t(()=>e[54]||(e[54]=[r(" mdi-pencil ")])),_:2},1032,["onClick"])]))])]),"item.collaborators":t(({item:p})=>{var R,Oe,rt;return[i("div",jl,[nt(p,"collaborators")?(u(),B(Xe,{key:0,"model-value":E.value.collaborators||[],items:((Oe=(R=ye.project)==null?void 0:R.team)==null?void 0:Oe.members)||[],"item-title":"name","item-value":"_id",variant:"outlined",density:"compact","hide-details":"",multiple:"",class:"collaborators-select","onUpdate:modelValue":ue=>pa(p,ue),onBlur:ue=>va(p),onClick:e[6]||(e[6]=ie(()=>{},["stop"]))},{item:t(({props:ue,item:Ye})=>[a(me,le({ref_for:!0},ue),{prepend:t(()=>[a(ke,{user:Ye.raw,size:"24","avatar-class":"me-2"},null,8,["user"])]),_:2},1040)]),selection:t(({item:ue})=>[a(ke,{user:ue.raw,size:"24","avatar-class":"me-1"},null,8,["user"])]),_:2},1032,["model-value","items","onUpdate:modelValue","onBlur"])):(u(),B(Ce,{key:1,text:Mt(p),location:"top",disabled:!((rt=xe(p))!=null&&rt.length)},{activator:t(({props:ue})=>{var Ye,Ht;return[i("div",le({ref_for:!0},ue,{class:"d-flex align-center collaborators-container"}),[(u(!0),_(Ve,null,Be((Ye=xe(p))==null?void 0:Ye.slice(0,3),(St,Jt)=>(u(),B(ke,{key:St._id,user:St,size:"24","avatar-class":"collaborator-avatar",style:Ut({marginLeft:Jt>0?"-8px":"0",zIndex:10-Jt})},null,8,["user","style"]))),128)),((Ht=xe(p))==null?void 0:Ht.length)>3?(u(),_("span",Dl," +"+P(xe(p).length-3),1)):J("",!0),a(v,{size:"14",class:"ms-1 collaborators-edit-btn cursor-pointer",onClick:ie(St=>ca(p),["stop"])},{default:t(()=>e[55]||(e[55]=[r(" mdi-pencil ")])),_:2},1032,["onClick"])],16)]}),_:2},1032,["text","disabled"]))])]}),"item.updatedAt":t(({item:p})=>[a(Ce,{location:"top"},{activator:t(({props:R})=>[i("span",le({ref_for:!0},R,{class:"cursor-pointer"}),P(Re(p.updatedAt)),17)]),default:t(()=>{var R;return[i("div",null,P(Ge(p.updatedAt))+" , "+P(((R=p.lastModifiedBy)==null?void 0:R.name)||"æœªçŸ¥"),1)]}),_:2},1024)]),"item.completedAt":t(({item:p})=>[p.completedAt?(u(),B(Ce,{key:0,text:Ge(p.completedAt),location:"top"},{activator:t(({props:R})=>[i("span",le({ref_for:!0},R,{class:"cursor-pointer"}),P(Re(p.completedAt)),17)]),_:2},1032,["text"])):(u(),_("span",$l," - "))]),"item.createdBy":t(({item:p})=>[i("div",Pl,[p.createdBy?(u(),B(Ce,{key:0,text:p.createdBy.name,location:"top"},{activator:t(({props:R})=>[a(ke,le({ref_for:!0},R,{user:p.createdBy,size:"24","avatar-class":"cursor-pointer"}),null,16,["user"])]),_:2},1032,["text"])):(u(),B(ht,{key:1,size:"24",color:"grey-lighten-1"},{default:t(()=>[a(v,{size:"16"},{default:t(()=>e[56]||(e[56]=[r(" mdi-account-outline ")])),_:1})]),_:1}))])]),"item.actions":t(({item:p})=>[i("div",Tl,[a(A,{icon:"",size:"30",variant:"plain",onClick:ie(R=>Tt(p),["stop"])},{default:t(()=>[a(v,{color:p.status==="completed"?"green":"grey",size:"20"},{default:t(()=>[r(P(p.status==="completed"?"mdi-check-bold":"mdi-check-outline"),1)]),_:2},1032,["color"])]),_:2},1032,["onClick"]),a(et,null,{activator:t(({props:R})=>[a(A,le({ref_for:!0},R,{icon:"",size:"30",variant:"plain",color:"grey-darken-1",onClick:e[7]||(e[7]=ie(()=>{},["stop"]))}),{default:t(()=>[a(v,{size:"20"},{default:t(()=>e[57]||(e[57]=[r(" mdi-dots-horizontal ")])),_:1})]),_:2},1040)]),default:t(()=>[a(tt,{density:"compact",slim:""},{default:t(()=>[a(me,{title:"è¤‡è£½ä»»å‹™",onClick:R=>qt(p)},{prepend:t(()=>[a(v,{size:"18"},{default:t(()=>e[58]||(e[58]=[r(" mdi-content-copy ")])),_:1})]),_:2},1032,["onClick"]),a(me,{title:"ç§»å‹•åˆ°å…¶ä»–åˆ†é¡ž",onClick:R=>Kt(p)},{prepend:t(()=>[a(v,{size:"18"},{default:t(()=>e[59]||(e[59]=[r(" mdi-folder-move ")])),_:1})]),_:2},1032,["onClick"]),ve.value?(u(),B(me,{key:0,title:"åˆªé™¤ä»»å‹™","base-color":"red-darken-2",onClick:R=>S(p)},{prepend:t(()=>[a(v,{size:"18"},{default:t(()=>e[60]||(e[60]=[r(" mdi-delete ")])),_:1})]),_:2},1032,["onClick"])):J("",!0)]),_:2},1024)]),_:2},1024)])]),bottom:t(()=>[i("tr",Sl,[i("td",Al,[a(A,{variant:"text",color:"primary","prepend-icon":"mdi-plus",class:"ms-3 px-3",onClick:p=>bt(m.name)},{default:t(()=>e[61]||(e[61]=[r(" æ–°å¢žä»»å‹™... ")])),_:2},1032,["onClick"])])])]),_:2},1032,["items"])])],512),[[za,dt(O)]])]),_:2},1024)]))),128))]),Ne.value.length>0?(u(),_("div",Ul,[se.value?(u(),B(A,{key:0,variant:"text",color:"teal-darken-1","prepend-icon":"mdi-plus",class:"add-category-btn",onClick:c},{default:t(()=>e[62]||(e[62]=[r(" æ–°å¢žä»»å‹™åˆ†é¡ž ")])),_:1})):(u(),_("div",Il,[a(v,{size:"16",class:"me-1",color:"grey-darken-1"},{default:t(()=>e[63]||(e[63]=[r(" mdi-information-outline ")])),_:1}),e[64]||(e[64]=r(" éœ€è¦åœ˜éšŠç®¡ç†è€…æ¬Šé™æ‰èƒ½æ–°å¢žä»»å‹™åˆ†é¡ž "))]))])):J("",!0)])):G.value==="completed"?(u(),_("div",Bl,[We.value.length===0?(u(),_("div",El,[ut.value?(u(),_("div",Nl,[a(v,{size:"56",color:"grey-lighten-1",class:"mb-2"},{default:t(()=>e[65]||(e[65]=[r(" mdi-magnify-remove ")])),_:1}),e[66]||(e[66]=i("h3",{class:"text-h6 text-medium-emphasis mb-2"}," æ²’æœ‰æœå°‹åˆ°ç›¸é—œä»»å‹™ ",-1)),e[67]||(e[67]=i("p",{class:"text-body-2 text-medium-emphasis"}," è«‹å˜—è©¦å…¶ä»–æœå°‹é—œéµå­— ",-1))])):(u(),_("div",Ol,[a(v,{size:"56",color:"grey-lighten-1",class:"mb-2"},{default:t(()=>e[68]||(e[68]=[r(" mdi-check-circle-outline ")])),_:1}),e[69]||(e[69]=i("h3",{class:"text-h6 text-medium-emphasis mb-2"}," å°šç„¡å·²å®Œæˆçš„ä»»å‹™ ",-1)),e[70]||(e[70]=i("p",{class:"text-body-2 text-medium-emphasis"}," å®Œæˆçš„ä»»å‹™æœƒé¡¯ç¤ºåœ¨é€™è£¡ ",-1))]))])):(u(),_("div",Fl,[a(It,{headers:$t,items:We.value,"items-per-page":20,hover:"",density:"compact",class:"completed-tasks-table","onClick:row":kt},{"item.name":t(({item:m})=>[i("div",Ml,[a(v,{color:"teal",class:"me-2 pt-1",size:"20"},{default:t(()=>e[71]||(e[71]=[r(" mdi-check-circle ")])),_:1}),i("span",Rl,P(m.name),1)])]),"item.assignee":t(({item:m})=>[m.assignee?(u(),B(Ce,{key:0,text:m.assignee.name,location:"top"},{activator:t(({props:O})=>[a(ke,le(O,{user:m.assignee,size:"24"}),null,16,["user"])]),_:2},1032,["text"])):(u(),_("span",Ll,"-"))]),"item.dueDate":t(({item:m})=>[m.dueDate?(u(),_("span",Kl,P(Re(m.dueDate)),1)):(u(),_("span",ql,"-"))]),"item.collaborators":t(({item:m})=>{var O;return[a(Ce,{text:Mt(m),location:"top",disabled:!((O=xe(m))!=null&&O.length)},{activator:t(({props:p})=>[i("div",le(p,{class:"d-flex align-center"}),[(u(!0),_(Ve,null,Be(xe(m),(R,Oe)=>(u(),B(ke,{key:R._id,user:R,size:"24","avatar-class":"collaborator-avatar",style:Ut({marginLeft:Oe>0?"-8px":"0",zIndex:10-Oe})},null,8,["user","style"]))),128)),xe(m).length>3?(u(),B(ht,{key:0,size:"24",class:"collaborator-avatar ms-n2",color:"grey-lighten-2",style:{"z-index":"7"}},{default:t(()=>[i("span",Hl,"+"+P(xe(m).length-3),1)]),_:2},1024)):J("",!0),!xe(m)||xe(m).length===0?(u(),_("span",Jl," - ")):J("",!0)],16)]),_:2},1032,["text","disabled"])]}),"item.completedAt":t(({item:m})=>[a(Ce,{text:Ge(m.completedAt),location:"top"},{activator:t(({props:O})=>[i("span",le(O,{class:"cursor-pointer"}),P(Re(m.completedAt)),17)]),_:2},1032,["text"])]),"item.completedBy":t(({item:m})=>{var O;return[st(m)?(u(),B(Ce,{key:0,text:(O=st(m))==null?void 0:O.name,location:"top"},{activator:t(({props:p})=>[a(ke,le(p,{user:st(m),size:"24"}),null,16,["user"])]),_:2},1032,["text"])):(u(),_("span",Wl,"-"))]}),"item.createdBy":t(({item:m})=>[m.createdBy?(u(),B(Ce,{key:0,text:m.createdBy.name,location:"top"},{activator:t(({props:O})=>[a(ke,le(O,{user:m.createdBy,size:"24"}),null,16,["user"])]),_:2},1032,["text"])):(u(),_("span",Gl,"-"))]),"item.category":t(({item:m})=>[a(Le,{label:"",size:"small",color:"blue-darken-2"},{default:t(()=>[r(P(m.category||"æœªåˆ†é¡ž"),1)]),_:2},1024)]),"item.actions":t(({item:m})=>[i("div",Ql,[a(A,{icon:"",size:"30",variant:"plain",color:"teal-darken-1",onClick:ie(O=>we(m),["stop"])},{default:t(()=>[a(v,{size:"18"},{default:t(()=>e[72]||(e[72]=[r(" mdi-undo ")])),_:1})]),_:2},1032,["onClick"]),a(et,null,{activator:t(({props:O})=>[a(A,le(O,{icon:"",size:"30",variant:"plain",color:"grey-darken-1",onClick:e[8]||(e[8]=ie(()=>{},["stop"]))}),{default:t(()=>[a(v,{size:"18"},{default:t(()=>e[73]||(e[73]=[r(" mdi-dots-horizontal ")])),_:1})]),_:2},1040)]),default:t(()=>[a(tt,{density:"compact",slim:""},{default:t(()=>[a(me,{title:"è¤‡è£½ä»»å‹™",onClick:O=>qt(m)},{prepend:t(()=>[a(v,{size:"18"},{default:t(()=>e[74]||(e[74]=[r(" mdi-content-copy ")])),_:1})]),_:2},1032,["onClick"]),a(me,{title:"ç§»å‹•åˆ°å…¶ä»–åˆ†é¡ž",onClick:O=>Kt(m)},{prepend:t(()=>[a(v,{size:"18"},{default:t(()=>e[75]||(e[75]=[r(" mdi-folder-move ")])),_:1})]),_:2},1032,["onClick"]),ve.value?(u(),B(me,{key:0,title:"åˆªé™¤ä»»å‹™","base-color":"red-darken-2",onClick:O=>S(m)},{prepend:t(()=>[a(v,{size:"18"},{default:t(()=>e[76]||(e[76]=[r(" mdi-delete ")])),_:1})]),_:2},1032,["onClick"])):J("",!0)]),_:2},1024)]),_:2},1024)])]),_:2},1032,["items"])]))])):J("",!0)])),a(He,{modelValue:h.value,"onUpdate:modelValue":e[12]||(e[12]=m=>h.value=m),"max-width":"400px",persistent:""},{default:t(()=>[a(De,{class:"rounded-lg"},{default:t(()=>[i("div",Yl,[i("div",null,[a(v,{size:"20",class:"me-2"},{default:t(()=>e[77]||(e[77]=[r(" mdi-folder-plus ")])),_:1}),e[78]||(e[78]=r("æ–°å¢žä»»å‹™åˆ†é¡ž "))]),a(A,{icon:"",variant:"plain",size:"36",class:"opacity-100",ripple:!1,onClick:e[9]||(e[9]=m=>h.value=!1)},{default:t(()=>[a(v,{size:"20"},{default:t(()=>e[79]||(e[79]=[r(" mdi-close ")])),_:1})]),_:1})]),a(Pe,{class:"px-6 py-3"},{default:t(()=>[e[80]||(e[80]=i("div",{class:"text-grey-darken-2 mb-4"}," è«‹è¼¸å…¥æ–°çš„ä»»å‹™åˆ†é¡žåç¨±ã€‚ ",-1)),a(Ze,{modelValue:ce.value,"onUpdate:modelValue":e[10]||(e[10]=m=>ce.value=m),label:"åˆ†é¡žåç¨±",variant:"outlined",density:"compact","hide-details":"",rules:[m=>!!m||"è«‹è¼¸å…¥åˆ†é¡žåç¨±"],onKeyup:At(D,["enter"])},null,8,["modelValue","rules"])]),_:1}),a(qe,{class:"px-6 py-4 mb-2"},{default:t(()=>[a($e),a(A,{color:"grey",variant:"outlined",class:"me-1",loading:fe.value,onClick:e[11]||(e[11]=m=>h.value=!1)},{default:t(()=>e[81]||(e[81]=[r(" å–æ¶ˆ ")])),_:1},8,["loading"]),a(A,{color:"teal-darken-1",variant:"outlined",disabled:!ce.value.trim()||fe.value,loading:fe.value,onClick:D},{default:t(()=>e[82]||(e[82]=[r(" å»ºç«‹ ")])),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(He,{modelValue:N.value,"onUpdate:modelValue":e[16]||(e[16]=m=>N.value=m),"max-width":"320px",persistent:""},{default:t(()=>[a(De,{class:"rounded-lg"},{default:t(()=>[i("div",Zl,[i("div",null,[a(v,{size:"20",class:"me-2"},{default:t(()=>e[83]||(e[83]=[r(" mdi-pencil ")])),_:1}),e[84]||(e[84]=r("ç·¨è¼¯ä»»å‹™åˆ†é¡ž "))]),a(A,{icon:"",variant:"plain",size:"36",class:"opacity-100",ripple:!1,onClick:e[13]||(e[13]=m=>N.value=!1)},{default:t(()=>[a(v,{size:"20"},{default:t(()=>e[85]||(e[85]=[r(" mdi-close ")])),_:1})]),_:1})]),a(Pe,{class:"px-6 pt-4 pb-3"},{default:t(()=>[a(Ze,{modelValue:g.value,"onUpdate:modelValue":e[14]||(e[14]=m=>g.value=m),label:"åˆ†é¡žåç¨±",variant:"outlined",density:"compact","hide-details":"",rules:[m=>!!m||"è«‹è¼¸å…¥åˆ†é¡žåç¨±"],onKeyup:At(q,["enter"])},null,8,["modelValue","rules"])]),_:1}),a(qe,{class:"px-6 py-4 mb-2"},{default:t(()=>[a($e),a(A,{color:"grey",variant:"outlined",class:"me-1",loading:T.value,onClick:e[15]||(e[15]=m=>N.value=!1)},{default:t(()=>e[86]||(e[86]=[r(" å–æ¶ˆ ")])),_:1},8,["loading"]),a(A,{color:"teal-darken-1",variant:"outlined",disabled:!g.value.trim()||T.value,loading:T.value,onClick:q},{default:t(()=>e[87]||(e[87]=[r(" æ›´æ–° ")])),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(d,{modelValue:X.value,"onUpdate:modelValue":e[17]||(e[17]=m=>X.value=m),title:"ç¢ºèªåˆªé™¤ä»»å‹™åˆ†é¡ž",message:`æ‚¨ç¢ºå®šè¦åˆªé™¤ä»»å‹™åˆ†é¡žã€Œ<span class='font-weight-bold text-red-darken-2'>${(z=ge.value)==null?void 0:z.name}</span>ã€å—Žï¼Ÿæ­¤æ“ä½œå°‡åŒæ™‚åˆªé™¤è©²åˆ†é¡žä¸‹çš„æ‰€æœ‰ä»»å‹™ï¼ˆå…± ${((Y=(M=ge.value)==null?void 0:M.tasks)==null?void 0:Y.length)||0} å€‹ï¼‰ï¼Œä¸”ç„¡æ³•å¾©åŽŸã€‚`,"expected-name":(Z=ge.value)==null?void 0:Z.name,"input-label":"ä»»å‹™åˆ†é¡žåç¨±","confirm-button-text":"åˆªé™¤",onConfirm:I},null,8,["modelValue","message","expected-name"]),a(k,{modelValue:Se.value,"onUpdate:modelValue":e[18]||(e[18]=m=>Se.value=m),title:"ç¢ºèªåˆªé™¤ä»»å‹™","dialog-width":"320",message:`æ‚¨ç¢ºå®šè¦åˆªé™¤ä»»å‹™ã€Œ<span class='font-weight-bold text-red-darken-2'>${(ae=Ae.value)==null?void 0:ae.name}</span>ã€å—Žï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŽŸã€‚`,"confirm-button-text":"åˆªé™¤",onConfirm:Q},null,8,["modelValue","message"]),a(Qt,{modelValue:Ee.value,"onUpdate:modelValue":e[19]||(e[19]=m=>Ee.value=m),"dialog-width":"320",title:"ç¢ºèªå®Œæˆä»»å‹™",message:`æ‚¨ç¢ºå®šè¦å°‡ä»»å‹™ã€Œ<span class='font-weight-bold text-teal-darken-2'>${((re=Fe.value)==null?void 0:re.name)||""}</span>ã€æ¨™è¨˜ç‚ºå®Œæˆå—Žï¼Ÿ`,"confirm-button-text":"ç¢ºèª","cancel-button-text":"å–æ¶ˆ","confirm-button-color":"teal-darken-1","header-color":"bg-teal-darken-1","header-icon":"mdi-check-circle",onConfirm:s},null,8,["modelValue","message"]),a(Qt,{modelValue:Je.value,"onUpdate:modelValue":e[20]||(e[20]=m=>Je.value=m),"dialog-width":"320",title:"ç¢ºèªé‡æ–°é–‹å•Ÿä»»å‹™",message:`æ‚¨ç¢ºå®šè¦å°‡ä»»å‹™ã€Œ<span class='font-weight-bold text-teal-darken-2'>${((Qe=Me.value)==null?void 0:Qe.name)||""}</span>ã€é‡æ–°é–‹å•Ÿå—Žï¼Ÿ`,"confirm-button-text":"ç¢ºèª","cancel-button-text":"å–æ¶ˆ","confirm-button-color":"teal-darken-1","header-color":"bg-teal-darken-1","header-icon":"mdi-undo",onConfirm:ze},null,8,["modelValue","message"]),a(He,{modelValue:L.value,"onUpdate:modelValue":e[27]||(e[27]=m=>L.value=m),"max-width":"500px",persistent:""},{default:t(()=>[a(De,{class:"rounded-lg"},{default:t(()=>[i("div",Xl,[i("div",null,[a(v,{size:"20",class:"me-2"},{default:t(()=>e[88]||(e[88]=[r(" mdi-plus-circle ")])),_:1}),e[89]||(e[89]=r("æ–°å¢žä»»å‹™ "))]),a(A,{icon:"",variant:"plain",size:"36",class:"opacity-100",ripple:!1,onClick:e[21]||(e[21]=m=>L.value=!1)},{default:t(()=>[a(v,{size:"20"},{default:t(()=>e[90]||(e[90]=[r(" mdi-close ")])),_:1})]),_:1})]),a(Pe,{class:"px-6 py-3"},{default:t(()=>[a(oa,{ref:"taskForm",onSubmit:ie(ot,["prevent"])},{default:t(()=>{var m,O;return[a(Ze,{modelValue:K.value.name,"onUpdate:modelValue":e[22]||(e[22]=p=>K.value.name=p),label:"*ä»»å‹™åç¨±",variant:"outlined",density:"compact",rules:[p=>!!p||"è«‹è¼¸å…¥ä»»å‹™åç¨±"],class:"mb-4 mt-2"},null,8,["modelValue","rules"]),a(Xe,{modelValue:K.value.assignee,"onUpdate:modelValue":e[23]||(e[23]=p=>K.value.assignee=p),label:"æŒ‡æ´¾å°è±¡",variant:"outlined",density:"compact",items:((O=(m=ye.project)==null?void 0:m.team)==null?void 0:O.members)||[],"item-title":"name","item-value":"_id",clearable:"",class:"mb-4"},null,8,["modelValue","items"]),a(Xe,{modelValue:K.value.collaborators,"onUpdate:modelValue":e[24]||(e[24]=p=>K.value.collaborators=p),label:"å”ä½œè€…",variant:"outlined",density:"compact",items:ba.value,"item-title":"name","item-value":"_id",multiple:"",chips:"",clearable:"",class:"mb-4"},null,8,["modelValue","items"]),a(n,{modelValue:K.value.dueDate,"onUpdate:modelValue":e[25]||(e[25]=p=>K.value.dueDate=p),label:"æˆªæ­¢æ—¥æœŸ",variant:"outlined",density:"compact",clearable:"","prepend-icon":"","ok-text":"ç¢ºèª","cancel-text":"å–æ¶ˆ","hide-details":"",class:"mb-4"},null,8,["modelValue"])]}),_:1},512)]),_:1}),a(qe,{class:"px-6 pb-4 mb-2"},{default:t(()=>[a($e),a(A,{color:"grey",variant:"outlined",class:"me-1",loading:be.value,onClick:e[26]||(e[26]=m=>L.value=!1)},{default:t(()=>e[91]||(e[91]=[r(" å–æ¶ˆ ")])),_:1},8,["loading"]),a(A,{color:"teal-darken-1",variant:"outlined",disabled:!K.value.name.trim()||be.value,loading:be.value,onClick:ot},{default:t(()=>e[92]||(e[92]=[r(" å»ºç«‹ ")])),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(He,{modelValue:he.value,"onUpdate:modelValue":e[31]||(e[31]=m=>he.value=m),"max-width":"360px",persistent:""},{default:t(()=>[a(De,{class:"rounded-lg"},{default:t(()=>[i("div",es,[i("div",null,[a(v,{size:"20",class:"me-2"},{default:t(()=>e[93]||(e[93]=[r(" mdi-folder-move ")])),_:1}),e[94]||(e[94]=r("ç§»å‹•ä»»å‹™ "))]),a(A,{icon:"",variant:"plain",size:"36",class:"opacity-100",ripple:!1,onClick:e[28]||(e[28]=m=>he.value=!1)},{default:t(()=>[a(v,{size:"20"},{default:t(()=>e[95]||(e[95]=[r(" mdi-close ")])),_:1})]),_:1})]),a(Pe,{class:"px-6 py-3"},{default:t(()=>{var m;return[i("div",ts," å°‡ä»»å‹™ã€Œ"+P((m=Ue.value)==null?void 0:m.name)+"ã€ç§»å‹•åˆ°æ–°çš„åˆ†é¡ž ",1),a(Xe,{modelValue:Ie.value,"onUpdate:modelValue":e[29]||(e[29]=O=>Ie.value=O),label:"é¸æ“‡æ–°åˆ†é¡ž",items:ya.value,"item-title":"name","item-value":"name",variant:"outlined",density:"compact",rules:[O=>!!O||"è«‹é¸æ“‡åˆ†é¡ž"]},{item:t(({props:O,item:p})=>[a(me,ta(aa(O)),{prepend:t(()=>[a(v,{size:"16",color:p.raw.color||"primary"},{default:t(()=>e[96]||(e[96]=[r(" mdi-folder ")])),_:2},1032,["color"])]),_:2},1040)]),_:1},8,["modelValue","items","rules"])]}),_:1}),a(qe,{class:"px-6 pb-4 pt-0 mb-2"},{default:t(()=>[a($e),a(A,{color:"grey",variant:"outlined",class:"me-1",onClick:e[30]||(e[30]=m=>he.value=!1)},{default:t(()=>e[97]||(e[97]=[r(" å–æ¶ˆ ")])),_:1}),a(A,{color:"teal-darken-1",variant:"outlined",disabled:!Ie.value,onClick:ka},{default:t(()=>e[98]||(e[98]=[r(" ç§»å‹• ")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(Za,{modelValue:lt.value,"onUpdate:modelValue":e[32]||(e[32]=m=>lt.value=m),project:ye.project},null,8,["modelValue","project"])])}}},ls=zt(as,[["__scopeId","data-v-6e4018e7"]]),ss={key:0,class:"d-flex justify-center pt-16 mt-16"},os={key:1},ns={class:"d-flex align-center pb-6 ps-7 pe-4 border border-t-0 border-e-0 border-s-0"},rs={class:"flex-grow-1"},is={class:"d-flex align-center"},ds={class:"page-title"},us={class:"d-flex align-center"},cs={class:"d-flex align-center"},ms={class:"text-caption"},ps={class:"d-flex align-center mb-1"},vs={style:{"font-size":"14px"}},fs={class:"task-area"},gs={key:2,class:"text-center py-8"},ks={class:"card-title px-6 py-4 bg-blue-grey-darken-2 d-flex align-center"},ys={class:"mb-6"},bs={key:0,class:"text-body-1",style:{"white-space":"pre-wrap","word-wrap":"break-word"}},xs={key:1,class:"text-body-1 text-medium-emphasis text-center py-4"},_s={class:"attachments-section"},Cs={class:"d-flex align-center justify-space-between mb-3"},hs={key:0,class:"mb-3 d-flex"},ws={class:"d-flex flex-wrap align-center",style:{gap:"4px"}},zs={key:1,class:"text-overline text-grey-darken-3 ms-1"},Vs={key:1,class:"attachment-list"},js={class:"text-caption text-grey mb-2"},Ds=["title"],$s={key:2,class:"no-attachments text-center py-8"},da={__name:"[id]",setup(ye){const Te=xa(),b=_a(),{apiAuth:W}=Vt(),F=jt(),{smAndUp:V}=sa(),H=Ca(),te=Zt(),pe=ea(),se=Xt(),ve=ee(()=>V.value?20:15),G=ee(()=>V.value?"default":"small"),j=ee(()=>{if(!h.value)return null;const o=H.projects.find(s=>s._id===h.value._id);if(o){const s={...h.value,...o};return Object.prototype.hasOwnProperty.call(o,"iconColor")&&(s.iconColor=o.iconColor),Object.prototype.hasOwnProperty.call(o,"status")&&(s.status=o.status),o.favorites&&Array.isArray(o.favorites)?s.favorites=o.favorites.map(c=>({...c,user:c.user?{_id:c.user._id,name:c.user.name,email:c.user.email}:c.user})):h.value.favorites&&Array.isArray(h.value.favorites)&&(s.favorites=h.value.favorites.map(c=>({...c,user:c.user?{_id:c.user._id,name:c.user.name,email:c.user.email}:c.user}))),s}return h.value}),h=x(null),L=x(!0),ce=ee(()=>{var c;const o=(c=h.value)==null?void 0:c.favorites,s=te._id;return(o==null?void 0:o.some(C=>C.user._id===s))||!1}),K=ee(()=>!h.value||!te._id?!1:se.hasPermission("PROJECT_AND_TASK_MANAGE")?!0:pe.isProjectTeamManager(h.value,te._id)),fe=ee(()=>(pe.teams||[]).filter(s=>{var c,C;return((c=s==null?void 0:s.members)==null?void 0:c.some(w=>w._id===te._id))&&((C=s==null?void 0:s.managers)==null?void 0:C.some(w=>w._id===te._id))}).map(s=>s._id)),be=o=>{var s,c;return(c=(s=j.value)==null?void 0:s.team)!=null&&c.managers?j.value.team.managers.some(C=>C._id===o):!1},E=ee(()=>K.value),N=x([]),g=x(!1),oe=x(!1),T=x(!1),U=x(!1),y=x(null),$=x([]),de=x(!1),X=x(!1),ge=x(!1),Se=x(null),Ae=[{title:"è¨­å®šç‹€æ…‹",value:void 0},{title:"é€²åº¦æ­£å¸¸",value:"on-track"},{title:"å­˜åœ¨é¢¨éšª",value:"at-risk"},{title:"åé›¢é€²åº¦",value:"off-track"},{title:"æ“±ç½®ä¸­",value:"on-hold"},{title:"å®Œæˆ",value:"completed"}],he=async()=>{var o,s;try{L.value=!0;const[c,C]=await Promise.all([W.get(`/projects/${Te.params.id}`),W.get(`/tasks/project/${Te.params.id}`)]);if(c.data.success&&C.data.success){const w=c.data.data,f=C.data.data;h.value=w,H.updateProject(w._id,w);const S=w.taskCategories||[],D={};f.forEach(I=>{const Q=I.category||"æœªåˆ†é¡ž";D[Q]||(D[Q]=[]),D[Q].push(I)});const q=new Set([...S.map(I=>I.name),...Object.keys(D)]);N.value=Array.from(q).map(I=>{const Q=S.find(ne=>ne.name===I);return{name:I,color:(Q==null?void 0:Q.color)||"primary",expanded:!0,tasks:D[I]||[]}})}}catch(c){console.error("å–å¾—å°ˆæ¡ˆè³‡æ–™å¤±æ•—:",c),F({text:((s=(o=c==null?void 0:c.response)==null?void 0:o.data)==null?void 0:s.message)||"å–å¾—å°ˆæ¡ˆè³‡æ–™å¤±æ•—",snackbarProps:{color:"red-lighten-1"}})}finally{L.value=!1}},Ue=o=>{switch(o){case"on-track":return"green";case"at-risk":return"orange";case"off-track":return"red";case"on-hold":return"grey";case"completed":return"blue";default:return"grey-lighten-1"}},Ie=o=>{switch(o){case"on-track":return"é€²åº¦æ­£å¸¸";case"at-risk":return"å­˜åœ¨é¢¨éšª";case"off-track":return"åé›¢é€²åº¦";case"on-hold":return"æ“±ç½®ä¸­";case"completed":return"å®Œæˆ";default:return"è¨­å®šç‹€æ…‹"}},Ee=o=>{switch(o){case"on-track":return"mdi-check-circle";case"at-risk":return"mdi-alert-circle";case"off-track":return"mdi-close-circle";case"on-hold":return"mdi-pause-circle";case"completed":return"mdi-check-circle";default:return"mdi-cog"}},Fe=async()=>{var o,s;try{const{data:c}=await W.post(`/projects/${h.value._id}/favorite`);c.success&&(h.value=c.data,H.updateProject(h.value._id,c.data),F({text:c.message,snackbarProps:{color:"teal-lighten-1"}}))}catch(c){console.error("åˆ‡æ›æ”¶è—ç‹€æ…‹å¤±æ•—:",c),F({text:((s=(o=c==null?void 0:c.response)==null?void 0:o.data)==null?void 0:s.message)||"åˆ‡æ›æ”¶è—ç‹€æ…‹å¤±æ•—",snackbarProps:{color:"red-lighten-1"}})}},Je=async o=>{var s,c;try{const{data:C}=await W.put(`/projects/${h.value._id}`,{status:o});if(C.success){h.value=C.data;const w={...C.data};o===void 0&&!Object.prototype.hasOwnProperty.call(C.data,"status")&&(w.status=void 0),H.updateProject(h.value._id,w),F({text:"å°ˆæ¡ˆç‹€æ…‹æ›´æ–°æˆåŠŸ",snackbarProps:{color:"teal-lighten-1"}})}}catch(C){console.error("æ›´æ–°å°ˆæ¡ˆç‹€æ…‹å¤±æ•—:",C),F({text:((c=(s=C==null?void 0:C.response)==null?void 0:s.data)==null?void 0:c.message)||"æ›´æ–°å°ˆæ¡ˆç‹€æ…‹å¤±æ•—",snackbarProps:{color:"red-lighten-1"}})}},Me=()=>{if(!K.value){F({text:"åªæœ‰åœ˜éšŠç®¡ç†è€…å¯ä»¥ä¿®æ”¹å°ˆæ¡ˆè©³æƒ…",snackbarProps:{color:"red-lighten-1"}});return}g.value=!0},lt=()=>{if(!K.value){F({text:"åªæœ‰åœ˜éšŠç®¡ç†è€…å¯ä»¥åˆªé™¤å°ˆæ¡ˆ",snackbarProps:{color:"red-lighten-1"}});return}oe.value=!0},it=()=>{T.value=!0};at(T,o=>{o||($.value=[],X.value=!1,de.value=!1)});const dt=()=>{X.value=!X.value},Ne=o=>{console.log("é¸æ“‡äº†æª”æ¡ˆ:",(o==null?void 0:o.length)||0,"å€‹")},ut=async()=>{var o,s,c;if(!(!$.value||$.value.length===0)&&(o=h.value)!=null&&o._id){de.value=!0;try{const C=new FormData;$.value.forEach(f=>{C.append("attachments",f)});const{data:w}=await W.post(`/projects/${h.value._id}/attachments`,C,{headers:{"Content-Type":"multipart/form-data"}});if(w.success){F({text:`æˆåŠŸä¸Šå‚³ ${$.value.length} å€‹é™„ä»¶`,snackbarProps:{color:"success"}}),$.value=[],X.value=!1;const f=w.data,S=(()=>{var I;const D=(I=h.value)==null?void 0:I.team,q=f==null?void 0:f.team;return typeof q=="string"?D:q&&(!q.managers||!Array.isArray(q.managers))?D||q:q||D})();h.value={...f,team:S},H.updateProject(h.value._id,w.data)}}catch(C){console.error("ä¸Šå‚³é™„ä»¶å¤±æ•—:",C),F({text:((c=(s=C==null?void 0:C.response)==null?void 0:s.data)==null?void 0:c.message)||"ä¸Šå‚³é™„ä»¶å¤±æ•—",snackbarProps:{color:"error"}})}finally{de.value=!1}}},We=o=>{try{const s=`https://eip.ystravel.com.tw/TEST-Backend/api//uploads/projects/${o.filename}`,c=document.createElement("a");c.href=s,c.download=o.originalName,c.target="_blank",document.body.appendChild(c),c.click(),document.body.removeChild(c),console.log("é–‹å§‹ä¸‹è¼‰é™„ä»¶:",o.originalName)}catch(s){console.error("ä¸‹è¼‰é™„ä»¶å¤±æ•—:",s),F({text:"ä¸‹è¼‰é™„ä»¶å¤±æ•—",snackbarProps:{color:"error"}})}},ct=o=>{Se.value=o,ge.value=!0},mt=async()=>{var o,s;try{const c=Se.value;if(!c)return;const{data:C}=await W.delete(`/projects/${h.value._id}/attachments/${c._id}`);if(C.success){F({text:"é™„ä»¶åˆªé™¤æˆåŠŸ",snackbarProps:{color:"success"}});const w=C.data,f=(()=>{var q;const S=(q=h.value)==null?void 0:q.team,D=w==null?void 0:w.team;return typeof D=="string"?S:D&&(!D.managers||!Array.isArray(D.managers))?S||D:D||S})();h.value={...w,team:f},H.updateProject(h.value._id,C.data)}}catch(c){console.error("åˆªé™¤é™„ä»¶å¤±æ•—:",c),F({text:((s=(o=c==null?void 0:c.response)==null?void 0:o.data)==null?void 0:s.message)||"åˆªé™¤é™„ä»¶å¤±æ•—",snackbarProps:{color:"error"}})}finally{Se.value=null,ge.value=!1}},pt=o=>o.startsWith("image/")?"mdi-file-image":o.includes("pdf")?"mdi-file-pdf-box":o.includes("word")||o.includes("document")?"mdi-file-word":o.includes("excel")||o.includes("spreadsheet")?"mdi-file-excel":o.includes("powerpoint")||o.includes("presentation")?"mdi-file-powerpoint":o.includes("zip")||o.includes("rar")||o.includes("7z")?"mdi-folder-zip":o.includes("text")?"mdi-file-document":"mdi-file",Dt=o=>o.startsWith("image/")?"green":o.includes("pdf")?"red":o.includes("word")||o.includes("document")?"blue":o.includes("excel")||o.includes("spreadsheet")?"green":o.includes("powerpoint")||o.includes("presentation")?"orange":o.includes("zip")||o.includes("rar")||o.includes("7z")?"purple":"grey",$t=(o,s=15)=>o.length<=s?o:o.substring(0,s)+"...",Re=()=>{var o,s;(s=(o=j.value)==null?void 0:o.team)!=null&&s._id&&b.push(`/projectAndTaskManagement/teams/${j.value.team._id}`)},Ge=o=>{h.value=o,H.updateProject(o._id,o);const s=o.taskCategories||[],c={};N.value.forEach(w=>{w.tasks.forEach(f=>{const S=f.category||"æœªåˆ†é¡ž";c[S]||(c[S]=[]),c[S].push(f)})});const C=new Set([...s.map(w=>w.name),...Object.keys(c)]);N.value=Array.from(C).map(w=>{const f=s.find(S=>S.name===w);return{name:w,color:(f==null?void 0:f.color)||"primary",order:(f==null?void 0:f.order)||0,expanded:!0,tasks:c[w]||[]}})},Pt=async()=>{var o,s;try{const{data:c}=await W.delete(`/projects/${h.value._id}`);c.success&&(H.removeProject(h.value._id),F({text:"å°ˆæ¡ˆåˆªé™¤æˆåŠŸ",snackbarProps:{color:"teal-lighten-1"}}),b.push("/projectAndTaskManagement/projects"))}catch(c){console.error("åˆªé™¤å°ˆæ¡ˆå¤±æ•—:",c),F({text:((s=(o=c==null?void 0:c.response)==null?void 0:o.data)==null?void 0:s.message)||"åˆªé™¤å°ˆæ¡ˆå¤±æ•—",snackbarProps:{color:"red-lighten-1"}})}};Bt(()=>{he()});const st=o=>{y.value=o,U.value=!0},vt=o=>{var C,w;let s=!1,c=null;if(N.value.forEach(f=>{const S=f.tasks.findIndex(D=>D._id===o._id);S!==-1&&(s=!0,c=f.name,f.name===o.category?f.tasks[S]=o:f.tasks.splice(S,1))}),s&&c!==o.category){let f=N.value.find(S=>S.name===o.category);if(!f){const S=(w=(C=h.value)==null?void 0:C.taskCategories)==null?void 0:w.find(D=>D.name===o.category);f={name:o.category||"æœªåˆ†é¡ž",color:(S==null?void 0:S.color)||"primary",order:(S==null?void 0:S.order)||999,expanded:!0,tasks:[]},N.value.push(f)}f.tasks.push(o),N.value.sort((S,D)=>(S.order||999)-(D.order||999)),console.log(`âœ… ä»»å‹™ã€Œ${o.name}ã€å·²å¾žã€Œ${c}ã€ç§»å‹•åˆ°ã€Œ${o.category}ã€`)}y.value&&y.value._id===o._id&&(y.value=o)},ft=o=>{N.value.forEach(s=>{s.tasks=s.tasks.filter(c=>c._id!==o)}),y.value&&y.value._id===o&&(y.value=null,U.value=!1)},gt=({task:o,category:s})=>{const c=N.value.findIndex(C=>C.name===s);if(c!==-1){const C=N.value[c].tasks,w=C.findIndex(f=>f.order!==void 0&&f.order>(o.order||0));w===-1?C.push(o):C.splice(w,0,o)}},kt=({project:o})=>{h.value=o,H.updateProject(o._id,o),yt()},yt=()=>{if(!h.value)return;const o=h.value.taskCategories||[],s={},c=new Set(o.map(w=>w.name));N.value.forEach(w=>{w.tasks.forEach(f=>{const S=f.category||"æœªåˆ†é¡ž";(c.has(S)||S==="æœªåˆ†é¡ž")&&(s[S]||(s[S]=[]),s[S].push(f))})});const C=new Set([...o.map(w=>w.name),...s.æœªåˆ†é¡ž?["æœªåˆ†é¡ž"]:[]]);N.value=Array.from(C).map(w=>{const f=o.find(q=>q.name===w),D=(s[w]||[]).sort((q,I)=>q.order!==void 0&&I.order!==void 0?q.order-I.order:q.order!==void 0&&I.order===void 0?-1:q.order===void 0&&I.order!==void 0?1:new Date(I.createdAt)-new Date(q.createdAt));return{name:w,color:(f==null?void 0:f.color)||"primary",order:(f==null?void 0:f.order)!==void 0?f.order:999,expanded:!0,tasks:D}}),N.value.sort((w,f)=>(w.order||999)-(f.order||999)),console.log("âœ… ä»»å‹™åˆ†é¡žè³‡æ–™é‡æ–°çµ„ç¹”å®Œæˆ")},Tt=async o=>{console.log("âœ¨ åˆ†é¡žæ›´æ–°ï¼Œç›´æŽ¥æ›´æ–°æœ¬åœ°ç‹€æ…‹..."),o&&o.project?(h.value=o.project,H.updateProject(o.project._id,o.project),o.categoryNameChanges&&o.categoryNameChanges.length>0&&o.categoryNameChanges.forEach(s=>{N.value.forEach(c=>{c.tasks.forEach(C=>{C.category===s.oldName&&(C.category=s.newName)})})}),yt()):(console.log("ðŸ”„ æœªæ”¶åˆ°æ›´æ–°è³‡æ–™ï¼Œé‡æ–°è¼‰å…¥..."),await he())};return at(()=>Te.params.id,()=>{he()}),(o,s)=>(u(),B(Pa,{fluid:"",class:"pt-0 pt-sm-4 px-0"},{default:t(()=>{var c,C,w;return[a(wt,{class:"mt-2 mx-0 py-2 px-0 rounded-lg bg-white"},{default:t(()=>[a(je,{cols:"12",class:"pa-0"},{default:t(()=>{var f,S,D,q;return[L.value?(u(),_("div",ss,[a(Et,{indeterminate:"",color:"grey",width:"8",size:"88"})])):h.value?(u(),_("div",os,[i("div",ns,[a(v,{size:_e(V)?32:24,class:"me-2 me-sm-3 pt-1",color:(f=j.value)!=null&&f.iconColor&&((S=j.value)==null?void 0:S.iconColor)!=="white"?(D=j.value)==null?void 0:D.iconColor:"grey-lighten-1"},{default:t(()=>{var I,Q;return[r(P((I=j.value)!=null&&I.iconColor&&((Q=j.value)==null?void 0:Q.iconColor)!=="white"?"mdi-square-rounded":"mdi-square-rounded-outline"),1)]}),_:1},8,["size","color"]),i("div",rs,[i("div",is,[i("span",ds,P((q=j.value)==null?void 0:q.name),1),K.value?(u(),B(et,{key:0},{activator:t(({props:I})=>[a(A,le(I,{size:_e(V)?"24":"18",class:"ms-2",variant:"plain",ripple:!1,color:"grey-darken-1"}),{default:t(()=>[a(v,{size:_e(V)?"24":"18"},{default:t(()=>s[8]||(s[8]=[r(" mdi-chevron-down ")])),_:1},8,["size"])]),_:2},1040,["size"])]),default:t(()=>[a(tt,{density:"compact",slim:""},{default:t(()=>[a(me,{title:"ä¿®æ”¹å°ˆæ¡ˆè©³æƒ…",onClick:Me},{prepend:t(()=>[a(v,{size:ve.value},{default:t(()=>s[9]||(s[9]=[r(" mdi-pencil ")])),_:1},8,["size"])]),_:1}),a(me,{title:"å°ˆæ¡ˆæè¿°",onClick:it},{prepend:t(()=>[a(v,{size:ve.value},{default:t(()=>s[10]||(s[10]=[r(" mdi-text-box-outline ")])),_:1},8,["size"])]),_:1}),a(me,{"base-color":"red-darken-3",title:"åˆªé™¤å°ˆæ¡ˆ",onClick:lt},{prepend:t(()=>[a(v,{size:ve.value},{default:t(()=>s[11]||(s[11]=[r(" mdi-delete ")])),_:1},8,["size"])]),_:1})]),_:1})]),_:1})):(u(),B(et,{key:1},{activator:t(({props:I})=>[a(A,le(I,{size:_e(V)?"24":"18",class:"ms-2",variant:"plain",ripple:!1,color:"grey-darken-1"}),{default:t(()=>[a(v,{size:_e(V)?"24":"18"},{default:t(()=>s[12]||(s[12]=[r(" mdi-chevron-down ")])),_:1},8,["size"])]),_:2},1040,["size"])]),default:t(()=>[a(tt,{density:"compact",slim:""},{default:t(()=>[a(me,{title:"å°ˆæ¡ˆæè¿°",onClick:it},{prepend:t(()=>[a(v,{size:ve.value},{default:t(()=>s[13]||(s[13]=[r(" mdi-text-box-outline ")])),_:1},8,["size"])]),_:1})]),_:1})]),_:1})),a(A,{icon:ce.value?"mdi-star":"mdi-star-outline",size:"small",variant:"plain",class:"opacity-100 me-1",ripple:!1,color:ce.value?"amber":"grey",onClick:Fe},null,8,["icon","color"]),a(et,null,{activator:t(({props:I})=>{var Q,ne,we;return[_e(V)?(u(),B(A,le({key:0,"prepend-icon":Ee((Q=j.value)==null?void 0:Q.status),size:"small",variant:"outlined",color:Ue((ne=j.value)==null?void 0:ne.status)},I),{default:t(()=>{var ze;return[r(P(Ie((ze=j.value)==null?void 0:ze.status)),1)]}),_:2},1040,["prepend-icon","color"])):J("",!0),_e(V)?J("",!0):(u(),B(A,le({key:1,icon:"",size:"24",variant:"plain",class:"opacity-100",ripple:!1,color:Ue((we=j.value)==null?void 0:we.status)},I),{default:t(()=>[a(v,{size:"18"},{default:t(()=>{var ze;return[r(P(Ee((ze=j.value)==null?void 0:ze.status)),1)]}),_:1})]),_:2},1040,["color"]))]}),default:t(()=>[a(tt,{density:"compact",slim:""},{default:t(()=>[(u(),_(Ve,null,Be(Ae,(I,Q)=>a(me,{key:Q,onClick:ne=>Je(I.value)},{prepend:t(()=>[a(v,{size:ve.value,color:Ue(I.value)},{default:t(()=>[r(P(Ee(I.value)),1)]),_:2},1032,["size","color"])]),default:t(()=>[a(Gt,null,{default:t(()=>[r(P(I.title),1)]),_:2},1024)]),_:2},1032,["onClick"])),64))]),_:1})]),_:1})])]),i("div",us,[a(et,null,{activator:t(({props:I})=>{var Q,ne,we,ze,bt,ot;return[i("div",le({class:"d-flex align-center me-3 member-hover-container"},I),[i("div",cs,[(u(!0),_(Ve,null,Be((we=(ne=(Q=j.value)==null?void 0:Q.team)==null?void 0:ne.members)==null?void 0:we.slice(0,3),(xt,_t)=>(u(),B(ke,{key:xt._id,user:xt,size:_e(V)?36:26,"avatar-class":"member-avatar",style:Ut({marginLeft:_t>0?"-16px":"0",zIndex:10-_t})},null,8,["user","size","style"]))),128)),((ot=(bt=(ze=j.value)==null?void 0:ze.team)==null?void 0:bt.members)==null?void 0:ot.length)>3?(u(),B(ht,{key:0,size:_e(V)?36:26,class:"member-avatar ms-n2",color:"grey-lighten-2",style:{"z-index":"7"}},{default:t(()=>[i("span",ms,"+"+P(j.value.team.members.length-3),1)]),_:1},8,["size"])):J("",!0)])],16)]}),default:t(()=>[a(tt,{density:"compact",slim:""},{default:t(()=>{var I,Q;return[a(Ta,{class:"team-name-clickable",onClick:Re},{default:t(()=>{var ne,we;return[r(P(((we=(ne=j.value)==null?void 0:ne.team)==null?void 0:we.name)||"åœ˜éšŠæˆå“¡"),1)]}),_:1}),(u(!0),_(Ve,null,Be((Q=(I=j.value)==null?void 0:I.team)==null?void 0:Q.members,ne=>(u(),B(me,{key:ne._id},{prepend:t(()=>[a(ke,{user:ne,size:"32","avatar-class":"me-2"},null,8,["user"])]),default:t(()=>[a(Gt,null,{default:t(()=>[i("div",ps,[i("span",vs,P(ne.name),1),be(ne._id)?(u(),B(Le,{key:0,size:"x-small",color:"teal-darken-1",variant:"outlined",class:"ms-2"},{default:t(()=>s[14]||(s[14]=[r(" åœ˜éšŠç®¡ç†è€… ")])),_:1})):J("",!0)])]),_:2},1024),a(na,{style:{"font-size":"13px"}},{default:t(()=>[r(P(ne.email),1)]),_:2},1024)]),_:2},1024))),128))]}),_:1})]),_:1})])]),i("div",fs,[a(ls,{project:j.value,"task-categories":N.value,onTaskSelected:st,onTaskUpdated:vt,onTaskDeleted:ft,onTaskCreated:gt,onCategoryCreated:kt,onCategoryUpdated:Tt,onProjectUpdated:Ge},null,8,["project","task-categories"])])])):(u(),_("div",gs,[a(v,{size:"48",color:"red-darken-2"},{default:t(()=>s[15]||(s[15]=[r(" mdi-alert-circle ")])),_:1}),s[17]||(s[17]=i("h2",{class:"page-title mt-4 mb-2"}," æ‰¾ä¸åˆ°å°ˆæ¡ˆ ",-1)),s[18]||(s[18]=i("p",{class:"text-body-1 text-medium-emphasis"}," å°ˆæ¡ˆå¯èƒ½å·²è¢«åˆªé™¤æˆ–æ˜¯ç¶²å€ä¸æ­£ç¢º ",-1)),a(A,{color:"grey-darken-1",variant:"outlined",class:"mt-4",to:"/projectAndTaskManagement"},{default:t(()=>s[16]||(s[16]=[r(" è¿”å›žé¦–é  ")])),_:1})]))]}),_:1})]),_:1}),a(Na,{modelValue:g.value,"onUpdate:modelValue":s[0]||(s[0]=f=>g.value=f),project:h.value,"team-disabled":!_e(pe).isProjectTeamManager(h.value,_e(te)._id),"allowed-team-ids":fe.value,onProjectUpdated:Ge},null,8,["modelValue","project","team-disabled","allowed-team-ids"]),a(ra,{modelValue:oe.value,"onUpdate:modelValue":s[1]||(s[1]=f=>oe.value=f),title:"ç¢ºèªåˆªé™¤å°ˆæ¡ˆ",message:`æ‚¨ç¢ºå®šè¦åˆªé™¤å°ˆæ¡ˆã€Œ<span class='font-weight-bold text-red-darken-2'>${(c=j.value)==null?void 0:c.name}</span>ã€å—Žï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŽŸï¼Œå°ˆæ¡ˆå…§çš„æ‰€æœ‰ä»»å‹™ä¹Ÿæœƒè¢«åˆªé™¤ã€‚`,"expected-name":(C=j.value)==null?void 0:C.name,"input-label":"å°ˆæ¡ˆåç¨±","confirm-button-text":"åˆªé™¤",onConfirm:Pt},null,8,["modelValue","message","expected-name"]),a(Aa,{modelValue:U.value,"onUpdate:modelValue":s[2]||(s[2]=f=>U.value=f),task:y.value,project:j.value,onTaskUpdated:vt,onTaskDeleted:ft},null,8,["modelValue","task","project"]),a(He,{modelValue:T.value,"onUpdate:modelValue":s[6]||(s[6]=f=>T.value=f),"max-width":"680px"},{default:t(()=>[a(De,{class:"rounded-lg"},{default:t(()=>[i("div",ks,[a(v,{size:"20",color:"white",class:"me-2"},{default:t(()=>s[19]||(s[19]=[r(" mdi-text-box-outline ")])),_:1}),s[21]||(s[21]=r(" å°ˆæ¡ˆæè¿° ")),a($e),a(A,{icon:"",color:"white",variant:"plain",class:"opacity-100",ripple:!1,size:"20",onClick:s[3]||(s[3]=f=>T.value=!1)},{default:t(()=>[a(v,{size:"20"},{default:t(()=>s[20]||(s[20]=[r(" mdi-close ")])),_:1})]),_:1})]),a(Pe,{class:"px-6 py-6"},{default:t(()=>{var f,S;return[i("div",ys,[(f=j.value)!=null&&f.description?(u(),_("div",bs,P(j.value.description),1)):(u(),_("div",xs,[a(v,{size:"32",color:"grey-lighten-1",class:"mb-2"},{default:t(()=>s[22]||(s[22]=[r(" mdi-text-box-outline ")])),_:1}),s[23]||(s[23]=i("p",null,"æ­¤å°ˆæ¡ˆå°šç„¡æè¿°",-1))]))]),i("div",_s,[i("div",Cs,[s[24]||(s[24]=i("div",{class:"card-title"}," å°ˆæ¡ˆé™„ä»¶ ",-1)),E.value?(u(),B(v,{key:0,size:"16",color:"grey",class:"me-2 edit-icon",onClick:dt},{default:t(()=>[r(P(X.value?"mdi-minus":"mdi-plus"),1)]),_:1})):J("",!0)]),X.value&&E.value?(u(),_("div",hs,[a(Sa,{ref:"fileInputRef",modelValue:$.value,"onUpdate:modelValue":[s[4]||(s[4]=D=>$.value=D),Ne],label:"é¸æ“‡æª”æ¡ˆ",variant:"outlined",density:"compact",multiple:"","prepend-icon":"mdi-paperclip",chips:"",counter:"",rules:[D=>!D||D.length<=10||"æœ€å¤šåªèƒ½ä¸Šå‚³ 10 å€‹æª”æ¡ˆ"]},{selection:t(({fileNames:D})=>[i("div",ws,[(u(!0),_(Ve,null,Be(D,(q,I)=>(u(),_(Ve,{key:q},[I<3?(u(),B(Le,{key:0,color:"blue-darken-1",size:"small",label:"",class:"mb-1"},{default:t(()=>[r(P($t(q,15)),1)]),_:2},1024)):J("",!0),I===3?(u(),_("span",zs," +"+P(D.length-3)+" å€‹æª”æ¡ˆ ",1)):J("",!0)],64))),128))])]),_:1},8,["modelValue","rules"]),$.value&&$.value.length>0?(u(),B(A,{key:0,color:"teal-darken-1",size:"small",class:"ms-3 mt-2",variant:"outlined",loading:de.value,onClick:ut},{default:t(()=>s[25]||(s[25]=[r(" ä¸Šå‚³ ")])),_:1},8,["loading"])):J("",!0)])):J("",!0),(S=j.value)!=null&&S.attachments&&j.value.attachments.length>0?(u(),_("div",Vs,[i("div",js," å·²ä¸Šå‚³çš„é™„ä»¶ ("+P(j.value.attachments.length)+") ",1),(u(!0),_(Ve,null,Be(j.value.attachments,D=>(u(),_("div",{key:D._id,class:"attachment-item d-flex align-center mb-2"},[a(v,{color:Dt(D.mimeType),size:"20",class:"me-2"},{default:t(()=>[r(P(pt(D.mimeType)),1)]),_:2},1032,["color"]),i("span",{class:"attachment-name flex-grow-1 text-body-2",title:D.originalName},P(D.originalName),9,Ds),a(A,{icon:"",size:"x-small",color:"blue-grey-lighten-1",variant:"text",title:"ä¸‹è¼‰ "+D.originalName,onClick:q=>We(D)},{default:t(()=>[a(v,{size:"16"},{default:t(()=>s[26]||(s[26]=[r(" mdi-download ")])),_:1})]),_:2},1032,["title","onClick"]),E.value?(u(),B(A,{key:0,icon:"",size:"x-small",color:"red-lighten-1",variant:"text",title:"åˆªé™¤ "+D.originalName,onClick:q=>ct(D)},{default:t(()=>[a(v,{size:"16"},{default:t(()=>s[27]||(s[27]=[r(" mdi-delete ")])),_:1})]),_:2},1032,["title","onClick"])):J("",!0)]))),128))])):(u(),_("div",$s,[a(v,{size:"48",color:"grey-lighten-1",class:"mb-4"},{default:t(()=>s[28]||(s[28]=[r(" mdi-paperclip ")])),_:1}),s[29]||(s[29]=i("p",{class:"text-body-2 text-medium-emphasis"}," å°šç„¡é™„ä»¶ ",-1))]))])]}),_:1}),a(qe,{class:"px-6 pb-5"},{default:t(()=>[a($e),a(A,{color:"grey-darken-1",variant:"outlined",size:G.value,onClick:s[5]||(s[5]=f=>T.value=!1)},{default:t(()=>s[30]||(s[30]=[r(" é—œé–‰ ")])),_:1},8,["size"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(ia,{modelValue:ge.value,"onUpdate:modelValue":s[7]||(s[7]=f=>ge.value=f),title:"åˆªé™¤é™„ä»¶",message:`ç¢ºå®šè¦åˆªé™¤é™„ä»¶ã€Œ${((w=Se.value)==null?void 0:w.originalName)||""}ã€å—Žï¼Ÿ<br>æ­¤æ“ä½œç„¡æ³•æ¢å¾©ã€‚`,onConfirm:mt},null,8,["modelValue","message"])]}),_:1}))}};typeof Yt=="function"&&Yt(da);const po=zt(da,[["__scopeId","data-v-0d3506d0"]]);export{po as default};

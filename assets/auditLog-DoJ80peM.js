import{f as me,aV as N,$ as S,a8 as c,bH as p,a0 as y,_ as se,F as ae,b0 as he,bf as x,aH as _e,a7 as z,r as R,w as ze,k as Ht,bK as zt,b2 as Vt,u as Te,a5 as Yt,aG as Jt,bJ as It}from"./@vue-Cr_z6yfx.js";import{_ as ht,b as Qt}from"./index-wwmbXvRV.js";import{l as ct}from"./lodash-CiJWSuVn.js";import{i as Wt}from"./vuetify-use-dialog-C5oZ13xz.js";import{Z as Gt,r as le,q as Zt,Q as Xt,V as Mt,v as pe,w as W,a as ut,b as Kt,c as dt,_ as Dt,K as kt,P as Ct,g as ge,d as Nt,$ as ea,a0 as ft,O as ta,A as Re,e as St,f as pt,L as aa,T as Tt}from"./vuetify-CbddcmEc.js";import{_ as sa}from"./ConfirmDeleteDialog-CuZPFffe.js";import"./perfect-debounce-Cp2ysxOb.js";import"./hookable-B8xFkYCm.js";/* empty css             */import"./pinia-DBRIaiZ_.js";import"./vue-demi-Dq6ymT-8.js";import"./pinia-plugin-persistedstate-RV7uh3T-.js";import"./vue-router-CS4OewbW.js";import"./jspdf-DacfHTdZ.js";import"./core-js-D2hAHviU.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./unplugin-vue-router-B1N3mqWX.js";import"./axios-upsvKRUO.js";import"./vue3-google-login-Dx7TV_Hx.js";import"./vue-easy-lightbox-D952uME8.js";const na={class:"budget-table"},oa={key:0},ra={key:0,class:"order-change-indicator"},la=["rowspan"],ia={__name:"BudgetTable",props:{data:{type:Object,required:!0},changedFields:{type:Array,default:()=>[]},orderNumbers:{type:Boolean,default:!1},orderChanges:{type:Object,default:()=>({})},isMini:{type:Boolean,default:!1}},setup(Y){const T=Y,xe={JAN:"一月",FEB:"二月",MAR:"三月",APR:"四月",MAY:"五月",JUN:"六月",JUL:"七月",AUG:"八月",SEP:"九月",OCT:"十月",NOV:"十一月",DEC:"十二月"},Ee=me(()=>{var U;const M=((U=T.data)==null?void 0:U.changes)!==void 0;let L=null;return M?T.data.action==="創建"?L=T.data.changes.after:T.data.action==="刪除"?L=T.data.changes.before:L=T.data.changes.after||T.data.changes.before:L=T.data,L!=null&&L.items?L.items.reduce((q,D)=>{var v,ie,ce;const _=(D==null?void 0:D.channel)||{},b=(D==null?void 0:D.platform)||{},B=_.name||((v=_._id)!=null&&v.$oid?_._id.$oid:_._id)||"未知渠道";return q[B]||(q[B]=[]),q[B].push({channel:{_id:((ie=_._id)==null?void 0:ie.$oid)||_._id||B,name:_.name||B},platform:{_id:((ce=b._id)==null?void 0:ce.$oid)||b._id||"未知平台",name:b.name||"未知平台"},monthlyBudget:(D==null?void 0:D.monthlyBudget)||{}}),q},{}):{}}),G=M=>M==null||M===""?"-":new Intl.NumberFormat("zh-TW").format(M),J=(M,L)=>{var q,D,_,b,B,v;if(!((q=T.changedFields)!=null&&q.length)||!(((D=T.data)==null?void 0:D.changes)!==void 0))return!1;if(T.changedFields.includes("items")){const ie=Q((_=T.data.changes.before)==null?void 0:_.items,M),ce=Q((b=T.data.changes.after)==null?void 0:b.items,M);if(L==="channel"||L==="platform")return!1;const fe=(B=ie==null?void 0:ie.monthlyBudget)==null?void 0:B[L],Be=(v=ce==null?void 0:ce.monthlyBudget)==null?void 0:v[L];return fe!==Be}return!1},Q=(M=[],L)=>M!=null&&M.length?M.find(U=>{var fe,Be,r,Pe;const q=(U==null?void 0:U.channel)||{},D=(L==null?void 0:L.channel)||{},_=(U==null?void 0:U.platform)||{},b=(L==null?void 0:L.platform)||{},B=((fe=q._id)==null?void 0:fe.$oid)||q._id,v=((Be=D._id)==null?void 0:Be.$oid)||D._id,ie=((r=_._id)==null?void 0:r.$oid)||_._id,ce=((Pe=b._id)==null?void 0:Pe.$oid)||b._id;return B===v&&ie===ce}):null,E=M=>{var _,b,B;if(!T.orderChanges||!(((_=T.data)==null?void 0:_.changes)!==void 0))return!1;const U=((b=M==null?void 0:M.channel)==null?void 0:b.name)||"未知渠道",q=((B=M==null?void 0:M.platform)==null?void 0:B.name)||"未知平台",D=`${U}-${q}`;return T.orderChanges[D]!==void 0},V=M=>{var b,B,v;if(!E(M)||!(((b=T.data)==null?void 0:b.changes)!==void 0))return"";const U=((B=M==null?void 0:M.channel)==null?void 0:B.name)||"未知渠道",q=((v=M==null?void 0:M.platform)==null?void 0:v.name)||"未知平台",D=`${U}-${q}`,_=T.orderChanges[D];return _?`← ${_.oldIndex}`:""};return(M,L)=>(N(),S("div",na,[c(Gt,{density:"compact",class:_e({"mini-table":Y.isMini})},{default:p(()=>[y("thead",null,[y("tr",null,[Y.orderNumbers?(N(),S("th",oa," # ")):se("",!0),L[0]||(L[0]=y("th",null,"廣告渠道",-1)),L[1]||(L[1]=y("th",null,"平台",-1)),(N(),S(ae,null,he(xe,(U,q)=>y("th",{key:q,class:"text-center"},x(U),1)),64))])]),y("tbody",null,[(N(!0),S(ae,null,he(Ee.value,(U,q)=>(N(),S(ae,{key:q},[(N(!0),S(ae,null,he(U,(D,_)=>(N(),S("tr",{key:`${D.channel._id}-${D.platform._id}`},[Y.orderNumbers?(N(),S("td",{key:0,class:_e(["text-center order-number",{"order-changed":E(D)}])},[z(x(_+1)+" ",1),E(D)?(N(),S("div",ra,x(V(D)),1)):se("",!0)],2)):se("",!0),_===0?(N(),S("td",{key:1,rowspan:U.length,class:_e(["text-center",{"changed-field":J(D,"channel")}])},x(D.channel.name),11,la)):se("",!0),y("td",{class:_e(["text-center",{"changed-field":J(D,"platform")}])},x(D.platform.name),3),(N(),S(ae,null,he(xe,(b,B)=>y("td",{key:B,class:_e(["text-center",{"changed-field":J(D,B)}])},x(G(D.monthlyBudget[B])),3)),64))]))),128))],64))),128))])]),_:1},8,["class"])]))}},gt=ht(ia,[["__scopeId","data-v-fcc27ba9"]]),ca={class:"budget-change-table"},ua={key:0,class:"single-table"},da={key:0,class:"change-list"},fa={key:0},pa={key:1},ga={key:2},ha={key:1,class:"tables-container"},ma={class:"table-wrapper"},$a={class:"arrow-wrapper"},ba={class:"table-wrapper"},va={__name:"MarketingBudgetChangeTable",props:{action:{type:String,required:!0},changes:{type:Object,required:!0}},setup(Y){const T=Y,xe=me(()=>{var Q;return(Q=T.changes)!=null&&Q.changedFields?!T.changes.changedFields.some(E=>E.startsWith("items")):!1}),Ee=me(()=>{var Q,E,V,M;return((E=(Q=T.changes)==null?void 0:Q.before)==null?void 0:E.year)!==((M=(V=T.changes)==null?void 0:V.after)==null?void 0:M.year)}),G=me(()=>{var V,M,L,U,q,D,_,b,B,v;const Q=((L=(M=(V=T.changes)==null?void 0:V.before)==null?void 0:M.theme)==null?void 0:L.$oid)||((q=(U=T.changes)==null?void 0:U.before)==null?void 0:q.theme),E=((b=(_=(D=T.changes)==null?void 0:D.after)==null?void 0:_.theme)==null?void 0:b.$oid)||((v=(B=T.changes)==null?void 0:B.after)==null?void 0:v.theme);return Q!==E}),J=me(()=>{var Q,E,V,M;return((E=(Q=T.changes)==null?void 0:Q.before)==null?void 0:E.note)!==((M=(V=T.changes)==null?void 0:V.after)==null?void 0:M.note)});return(Q,E)=>{var V,M;return N(),S("div",ca,[Y.action==="創建"?(N(),S("div",ua,[E[0]||(E[0]=y("div",{class:"table-title mb-2"}," 新增預算表 ",-1)),c(gt,{data:Y.changes.after,"is-mini":!0},null,8,["data"])])):Y.action==="修改"?(N(),S(ae,{key:1},[xe.value?(N(),S("ul",da,[Ee.value?(N(),S("li",fa," 年度："+x(Y.changes.before.year)+" → "+x(Y.changes.after.year),1)):se("",!0),G.value?(N(),S("li",pa," 行銷主題："+x(((V=Y.changes.before.theme)==null?void 0:V.name)||"(無)")+" → "+x(((M=Y.changes.after.theme)==null?void 0:M.name)||"(無)"),1)):se("",!0),J.value?(N(),S("li",ga," 備註："+x(Y.changes.before.note||"(無)")+" → "+x(Y.changes.after.note||"(無)"),1)):se("",!0)])):(N(),S("div",ha,[y("div",ma,[E[1]||(E[1]=y("div",{class:"table-title mb-2"}," 修改前 ",-1)),c(gt,{data:Y.changes.before,"is-mini":!0},null,8,["data"])]),y("div",$a,[c(le,{size:"40",color:"light-blue-lighten-1"},{default:p(()=>E[2]||(E[2]=[z(" mdi-arrow-right-bold ")])),_:1})]),y("div",ba,[E[3]||(E[3]=y("div",{class:"table-title mb-2"}," 修改後 ",-1)),c(gt,{data:Y.changes.after,"is-mini":!0},null,8,["data"])])]))],64)):se("",!0)])}}},ya=ht(va,[["__scopeId","data-v-0057f683"]]),Ia={key:0},Ma={key:1},Da={key:2},Ca={key:3,class:"py-3",style:{"max-width":"420px","overflow-wrap":"break-word"}},Na={class:"text-center"},Sa={class:"d-flex align-center justify-center"},Ta={class:"d-flex flex-column gap-4"},xa={class:"list-content"},Pa={class:"list-content"},Aa={class:"list-content"},La={class:"list-content"},wa={class:"list-content"},_a={key:0,class:"list-content budget-content"},Ea={key:1,class:"list-content"},Ba={class:"change-list"},ja={key:2,class:"list-content"},qa={class:"change-list"},Oa={class:"change-list"},Ra={key:3,class:"list-content"},Ua={class:"change-list"},Fa={key:4},Ha={class:"card-title px-6 py-3 bg-red-lighten-1 d-flex align-center"},za={__name:"auditLog",setup(Y){const{smAndUp:T,mdAndUp:xe,lgAndUp:Ee}=Zt(),{apiAuth:G}=Qt(),J=Wt(),Q=me(()=>T.value?"default":"small"),E=R([]),V=R(!1),M=R(""),L=R([]),U=R(""),q=R(!1),D=R([]),_=R(0),b=R({operatorId:null,targetId:null,action:"",targetModel:"",dateRange:[],quickSearch:""}),B=R(!1),v=R(null),ie=[{title:"創建",value:"創建"},{title:"修改",value:"修改"},{title:"刪除",value:"刪除"}],ce=[{title:"全部",value:""},{title:"用戶",value:"users"},{title:"表單",value:"forms"},{title:"表單模板",value:"formTemplates"},{title:"行銷分類",value:"marketingCategories"},{title:"行銷預算",value:"marketingBudgets"},{title:"行銷實際支出",value:"marketingExpenses"},{title:"硬體維修記錄",value:"hardwareMaintenanceRecords"},{title:"硬體類型",value:"hardwareCategories"},{title:"硬體設備",value:"hardwareDevices"},{title:"員工",value:"employees"},{title:"公司",value:"companies"},{title:"部門",value:"departments"},{title:"直客詢問紀錄",value:"customerInquiries"},{title:"線別分類",value:"lineCategories"},{title:"行銷美編需求申請",value:"designRequests"},{title:"通知 EMAIL",value:"notificationEmails"},{title:"權限",value:"permissions"},{title:"角色",value:"roles"},{title:"輪播圖",value:"carousels"},{title:"跑馬燈",value:"marquees"},{title:"公告",value:"announcements"},{title:"共享資源",value:"sharedResources"},{title:"廠商",value:"manufacturers"},{title:"倉庫",value:"warehouses"},{title:"備品",value:"spareParts"},{title:"備品庫存",value:"sparePartInventories"}],fe=[{title:"操作時間",align:"start",sortable:!0,key:"createdAt"},{title:"操作人員",align:"start",sortable:!0,key:"operator.name"},{title:"資料類型",align:"start",sortable:!0,key:"targetModel"},{title:"操作類型",align:"start",sortable:!0,key:"action"},{title:"操作對象",align:"start",sortable:!0,key:"targetInfo.name"},{title:"異動內容",align:"start",sortable:!1,key:"changes"},{title:"操作",align:"center",sortable:!1,key:"actions"}],Be=me(()=>T.value?xe.value?Ee.value?fe:fe.filter(a=>a.key!=="changes"):fe.filter(a=>["createdAt","operator.name","targetModel","action","actions"].includes(a.key)):fe.filter(a=>["createdAt","targetModel","actions"].includes(a.key))),r={name:"資料名稱",email:"電子郵件",role:"權限",roles:"權限",permissions:"權限",userId:"使用者編號",adminId:"管理者編號",formNumber:"表單編號",clientName:"客戶名稱",projectName:"專案名稱",type:"類型",componentName:"組件名稱",note:"備註",isActive:"啟用狀態",employmentStatus:"任職狀態",marketingExpenses:"行銷實際支出",marketingBudgets:"行銷預算",expense:"花費金額",invoiceDate:"發票日期",theme:"行銷主題",channel:"廣告渠道",platform:"平台",detail:"線別",relatedBudget:"關聯預算表",year:"年度",order:"排序",maintenanceDate:"維修日期",maintenanceContent:"維修內容",maintenanceResult:"維修結果",reportUser:"報修人",annualTotalBudget:"年度總預算",employeeCode:"科威員編",extNumber:"分機號碼",printNumber:"列印機編號",emailPassword:"Email密碼",company:"公司",department:"部門",employeeId:"系統員編",departmentId:"部門編號",hireDate:"到職日期",resignationDate:"離職日期",unpaidLeaveStartDate:"留職停薪開始日期",reinstatementDate:"復職日期",purchaseDate:"進貨日期",serialNumber:"序號",loginName:"登入名稱",deviceName:"裝置名稱",stockStatus:"庫存狀態",expenseStatus:"報帳狀態",office2021Account:"office2021帳號",office365Account:"office365帳號",office2021InstallDate:"office2021安裝日期",user:"使用者",macAddress:"MAC",IPAddress:"IP",VPNAccount:"VPN帳號",VPNApplyReason:"VPN申請原因",location:"地點",expenseObject:"報帳對象",expenseDate:"報帳日期",companyId:"公司編號",employmentType:"聘僱類型",jobTitle:"職稱",nickname:"暱稱",inquiryDate:"詢問日期",inquiryContent:"詢問內容",inquiryResult:"詢問結果",inquiryPlace:"詢問地點",source:"來源",customerName:"客戶姓名",customerPhone:"客戶電話",customerEmail:"客戶Email",customerLineId:"客戶Line ID",salesPerson:"業務",progress:"進度",inquiryResultAndNote:"詢問結果 / 備註",showInB2C:"B2C業務",customerTitle:"稱謂",lineLink:"Line 連結",lineID:"Line ID",progressNotes:"進度 / 備註",designRequestNumber:"申請編號",productType:"申請類型",applicant:"申請人",status:"狀態",applicationDate:"申請日期",assignedDesigner:"處理人員",title:"標題",style:"風格",imageSubject:"圖片主題",content:"內容",requestedByDate:"希望交付日",quantity:"數量",useInfoBookletCover:"使用說資封面",otherNote:"其他備註",files:"檔案",referenceImage:"參考圖片",images:"圖片",groupId:"團號",useQuickTemplate:"使用快速版型",quickTemplateNumber:"快速版型編號",subtitle:"副標",departureDate:"出發日期",tripHighlights:"行程特色",attractionImage:"指定景點圖片",agentPrice:"同業價",retailPrice:"直客價",promotions:"優惠",airlineHighlightNote:"航空公司特色備註",useLogo:"使用Logo",subtitleAndHighlights:"副標/特色",itinerary:"行程",groupName:"團體名稱",printingTypes:"印刷類型",infoBookletCover:"說資封面",banner:"布條",coachSign:"車頭牌",other:"其他",categories:"大分類",reportUserId:"報修人",isB2CSupervisor:"業務主管",departmentNote:"部門備註",newElectronicInfo:"新電子說資",code:"代碼",description:"描述",level:"層級",module:"模組",resource:"資源",action:"操作類型",image:"圖片",startDate:"開始日期",endDate:"結束日期",isPinned:"置頂",lineUserId:"Line ID",lineBoundAt:"Line 綁定時間",notificationPreferences:"通知偏好設定",line:"LINE",inbox:"內部收件匣",warehouse:"倉庫",packaging:"包裝形式",manufacturer:"廠商",cost:"成本",price:"價格",sparePart:"備品",sparePartName:"備品名稱",warehouseName:"倉庫名稱",quantityChange:"數量變更",warehouses:"倉庫列表"},Pe={0:"行銷主題",1:"廣告渠道",2:"平台",3:"線別",4:"平台細項"},Ue={0:"設備",1:"維修"},Xe=a=>{if(!a)return"-";const t=new Date(a),d=g=>String(g).padStart(2,"0");return`${t.getFullYear()}/${d(t.getMonth()+1)}/${d(t.getDate())} ${d(t.getHours())}:${d(t.getMinutes())}`},F=a=>{if(!a)return"-";const t=new Date(a),d=g=>String(g).padStart(2,"0");return`${t.getFullYear()}/${d(t.getMonth()+1)}/${d(t.getDate())}`},Ve=a=>a==null?"(無)":typeof a=="object"&&a!==null?a.name||a.code||"未知角色":{0:"一般用戶",1:"經理",2:"管理者",3:"IT人員",4:"美編人員",5:"行銷人員",6:"人資",7:"總管"}[a]||a,Ke=a=>!a||!Array.isArray(a)||a.length===0?"(無)":a.map(t=>Ve(t)).join("、"),Ae=a=>({printing:"印刷相關",infoBookletCover:"說資封面",banner:"布條",coachSign:"車頭牌",seriesMap:"Series地圖",seriesMapModify:"修改Series地圖",SPMap:"SP地圖",newDMSingle:"新DM(單支)",newDMMultiple:"新DM(多支)",modifyDM:"修改DM",newElectronicInfo:"新電子說資"})[a]||a,Ye=a=>({pending:"待處理",in_progress:"處理中",completed:"已完成",cancelled:"已取消",rejected:"已拒絕"})[a]||a,ke=a=>({users:"用戶",forms:"表單",formTemplates:"表單模板",marketingCategories:"行銷分類",marketingExpenses:"行銷實際支出",marketingBudgets:"行銷預算",hardwareMaintenanceRecords:"硬體維修記錄",hardwareCategories:"硬體類型",hardwareDevices:"硬體設備",employees:"員工",companies:"公司",departments:"部門",customerInquiries:"直客詢問紀錄",lineCategories:"線別分類",designRequests:"行銷美編需求申請",notificationEmails:"通知 EMAIL",permissions:"權限",roles:"角色",carousels:"輪播圖",marquees:"跑馬燈",announcements:"公告",sharedResources:"共享資源",manufacturers:"廠商",warehouses:"倉庫",spareParts:"備品",sparePartInventories:"備品庫存"})[a]||a,et=a=>{if(!(a!=null&&a.operatorInfo))return"-";const{name:t,userId:d,adminId:g,employeeCode:h}=a.operatorInfo;return h?`${t} (${h}) 【員工】`:g?`${t} (${g}) 【系統】`:`${t}${d?` (${d})`:""} 【系統】`},mt=a=>{var h,C,w,ne,be,ve,ye,Ie,m,oe,K,ue,Me,De,Ce,Ne,s,n,e,o,l,i,$,P,j,H,k,ee,re,Se,de,X;if(!(a!=null&&a.targetInfo)&&!((h=a==null?void 0:a.changes)!=null&&h.before))return"-";if(a.action==="刪除"&&((C=a.changes)!=null&&C.before)){if(a.targetModel==="marketingBudgets"){const{year:u}=a.changes.before,f=((w=a.changes.before.theme)==null?void 0:w.name)||"(無)";return`${u}年度 - ${f}`}if(a.targetModel==="hardwareCategories"){const{name:u,type:f}=a.changes.before;return`${u} (${Ue[f]})`}if(a.targetModel==="designRequests"){const u=a.targetInfo||{},f=((ne=a.changes)==null?void 0:ne.after)||{},I=u.name||f.designRequestNumber||"-",A=u.productType||f.productType,te=u.applicant&&u.applicant.name||f.applicant&&f.applicant.name||(typeof u.applicant=="string"?u.applicant:void 0)||"-",Ze=u.status||f.status,it=Ae(A),Ft=Ye(Ze);return`${I} - ${it} (${te}) - ${Ft}`}if(a.targetModel==="notificationEmails"){const u=a.targetInfo||{},f=((be=a.changes)==null?void 0:be.after)||{},I=u.name||f.user&&f.user.name||"(無)",A=u.userId||f.user&&(f.user.userId||f.user.adminId)||"";return`${I}${A?` (${A})`:""}`}if(a.targetModel==="carousels"){const u=a.changes.before,f=u.title||"(無標題)",I=u.order||0,te=(u.isActive!==void 0?u.isActive:!0)?"啟用":"停用";return`${f} (排序: ${I}, ${te})`}if(a.targetModel==="manufacturers")return a.changes.before.name||"(無)";if(a.targetModel==="warehouses"){const u=a.changes.before,f=u.name||"(無)",I=((ve=u.company)==null?void 0:ve.name)||"";return I?`${f} (${I})`:f}if(a.targetModel==="spareParts"){const u=a.changes.before,f=u.name||"(無)",I=((ye=u.manufacturer)==null?void 0:ye.name)||"";return I?`${f} (${I})`:f}if(a.targetModel==="sparePartInventories"){const u=a.changes.before,f=((Ie=u.sparePart)==null?void 0:Ie.name)||"(無)",I=((m=u.warehouse)==null?void 0:m.name)||"(無)";return`${f} - ${I}`}}if(a.targetModel==="marketingBudgets"){const u=a.targetInfo||{},f=((oe=a.changes)==null?void 0:oe.after)||{},I=u.year||f.year,A=u.theme||((K=f.theme)==null?void 0:K.name)||f.theme;return`${I}年度 - ${A}`}if(a.targetModel==="marketingExpenses"){const{invoiceDate:u,theme:f}=a.targetInfo||{};return u?`${F(u)} - ${f||"(無)"}`:"-"}const{name:t,userId:d,formNumber:g}=(a==null?void 0:a.targetInfo)||{};if(g)return`${g}`;if(a.targetModel==="marketingCategories")return`${t} (${Pe[a.targetInfo.type]})`;if(a.targetModel==="hardwareCategories")return`${t} (${Ue[a.targetInfo.type]})`;if(a.targetModel==="hardwareDevices"){const{type:u}=a.targetInfo||{};return`${t} - ${u||"未知類型"}`}if(a.targetModel==="designRequests"){const u=a.targetInfo||{},f=((ue=a.changes)==null?void 0:ue.after)||{};return u.name||f.designRequestNumber||"-"}if(a.targetModel==="notificationEmails"){const u=a.targetInfo||{},f=((Me=a.changes)==null?void 0:Me.after)||{},I=u.name||f.user&&f.user.name||"(無)",A=u.userId||f.user&&(f.user.userId||f.user.adminId)||"";return`${I}${A?` (${A})`:""}`}if(a.targetModel==="carousels"){const u=a.targetInfo||{},f=((De=a.changes)==null?void 0:De.after)||{};return u.name||f.title||"(無標題)"}if(a.targetModel==="announcements"){const u=a.targetInfo||{},f=((Ce=a.changes)==null?void 0:Ce.after)||{},I=u.name||f.title||"(無標題)",A=(u.isPinned!==void 0?u.isPinned:f.isPinned)?"置頂":"未置頂",Ze=(u.isActive!==void 0?u.isActive:f.isActive!==void 0?f.isActive:!0)?"啟用":"停用";return`${I} (${A}, ${Ze})`}if(a.targetModel==="sharedResources"){const u=a.targetInfo||{},f=((Ne=a.changes)==null?void 0:Ne.after)||{},I=u.name||f.name||"(未命名)",A=u.type||f.type||"(類型不明)",te=u.order||f.order||0,it=(u.isActive!==void 0?u.isActive:f.isActive!==void 0?f.isActive:!0)?"啟用":"停用";return`${I} [${A}] (排序: ${te}, ${it})`}if(a.targetModel==="manufacturers"){const u=a.targetInfo||{},f=((s=a.changes)==null?void 0:s.after)||{},I=((n=a.changes)==null?void 0:n.before)||{};return u.name||f.name||I.name||"(無)"}if(a.targetModel==="warehouses"){const u=a.targetInfo||{},f=((e=a.changes)==null?void 0:e.after)||{},I=((o=a.changes)==null?void 0:o.before)||{},A=u.name||f.name||I.name||"(無)",te=u.company||((l=f.company)==null?void 0:l.name)||((i=I.company)==null?void 0:i.name)||"";return te?`${A} (${te})`:A}if(a.targetModel==="spareParts"){const u=a.targetInfo||{},f=(($=a.changes)==null?void 0:$.after)||{},I=((P=a.changes)==null?void 0:P.before)||{},A=u.name||f.name||I.name||"(無)",te=u.manufacturer||((j=f.manufacturer)==null?void 0:j.name)||((H=I.manufacturer)==null?void 0:H.name)||"";return te?`${A} (${te})`:A}if(a.targetModel==="sparePartInventories"){const u=a.targetInfo||{};if(u.name)return u.name;const f=((k=a.changes)==null?void 0:k.after)||{},I=((ee=a.changes)==null?void 0:ee.before)||{},A=u.sparePartName||((re=f.sparePart)==null?void 0:re.name)||((Se=I.sparePart)==null?void 0:Se.name)||"(無)",te=u.warehouseName||((de=f.warehouse)==null?void 0:de.name)||((X=I.warehouse)==null?void 0:X.name)||"(無)";return`${A} - ${te}`}return`${t}${d?` (${d})`:""}`},O=a=>typeof a=="boolean"?a?"是":"否":a,Je=a=>{var t,d,g,h;return a!=null&&a.changes?a.action==="創建"?((g=(d=(t=a.changes)==null?void 0:t.after)==null?void 0:d.items)==null?void 0:g.length)>0:(h=a==null?void 0:a.changes)!=null&&h.changedFields?a.changes.changedFields.some(C=>C.startsWith("items")):!1:!1},tt=a=>{var C,w,ne,be,ve,ye,Ie,m,oe,K,ue,Me,De,Ce,Ne;if(!(a!=null&&a.changes))return[];if(a.action==="刪除")return["資料已刪除"];const t=[];if(a.targetModel==="companies"&&a.changes.changedFields.includes("locations")){const s=a.changes.before.locations||[],n=a.changes.after.locations||[],e=s.filter($=>!n.some(P=>P.locationName===$.locationName));e.length>0&&(t.push("刪除的地點:"),e.forEach($=>{t.push(` - ${$.locationName}`)}));const o=n.filter($=>!s.some(P=>P.locationName===$.locationName));o.length>0&&(t.push("新增的地點:"),o.forEach($=>{t.push(` - ${$.locationName}`)}));const i=n.filter($=>s.some(P=>P.locationName===$.locationName)).filter($=>s.find(j=>j.locationName===$.locationName).order!==$.order);return i.length>0&&(t.push("順序變更:"),i.forEach($=>{const P=s.find(H=>H.locationName===$.locationName).order+1,j=$.order+1;t.push(` - ${$.locationName}: ${P} → ${j}`)})),t.length===0&&t.push("地點資料已更新"),t}if(a.targetModel==="marketingBudgets"){const{changedFields:s=[],before:n={},after:e={}}=a.changes,o=s.some(l=>l.startsWith("items"));if(a.action==="創建"&&((C=e.items)==null?void 0:C.length)>0)return["( 請查看詳細異動內容 )"];if(s.includes("year")&&t.push(`年度: ${n.year||"(無)"} → ${e.year||"(無)"}`),s.includes("theme")){const l=((w=n.theme)==null?void 0:w.name)||"(無)",i=((ne=e.theme)==null?void 0:ne.name)||"(無)";t.push(`行銷主題: ${l} → ${i}`)}if(s.includes("annualTotalBudget")){const l=((be=n.annualTotalBudget)==null?void 0:be.toLocaleString())||"0",i=((ve=e.annualTotalBudget)==null?void 0:ve.toLocaleString())||"0";t.push(`年度總預算: ${l} → ${i}`)}if(s.includes("note")){const l=n.note||"(無)",i=e.note||"(無)";t.push(`備註: ${l} → ${i}`)}return o&&t.push("( 表格異動請查看詳細異動內容 )"),t}if(a.targetModel==="marketingExpenses"){if(a.action==="創建"){const s=a.changes.after;return t.push(`發票日期: ${F(s.invoiceDate)}`),t.push(`行銷主題: ${((ye=s.theme)==null?void 0:ye.name)||"(無)"}`),t.push(`廣告渠道: ${((Ie=s.channel)==null?void 0:Ie.name)||"(無)"}`),t.push(`平台: ${((m=s.platform)==null?void 0:m.name)||"(無)"}`),t.push(`總金額: ${((oe=s.totalExpense)==null?void 0:oe.toLocaleString())||0}`),s.note&&t.push(`備註: ${s.note}`),s.details&&s.details.length>0&&(t.push("線別資訊:"),s.details.forEach(n=>{var e;t.push(` - ${n.detail.name} : ${((e=n.amount)==null?void 0:e.toLocaleString())||0}`)})),t}else if(a.action==="修改"){const{before:s,after:n,changedFields:e}=a.changes,o={},l={};return s.details&&s.details.forEach(i=>{o[i.detail.name]=i.amount}),n.details&&n.details.forEach(i=>{l[i.detail.name]=i.amount}),e.forEach(i=>{var $,P,j,H,k,ee,re,Se;switch(i){case"invoiceDate":t.push(`發票日期: ${F(s.invoiceDate)} → ${F(n.invoiceDate)}`);break;case"theme":t.push(`行銷主題: ${(($=s.theme)==null?void 0:$.name)||"(無)"} → ${((P=n.theme)==null?void 0:P.name)||"(無)"}`);break;case"channel":t.push(`廣告渠道: ${((j=s.channel)==null?void 0:j.name)||"(無)"} → ${((H=n.channel)==null?void 0:H.name)||"(無)"}`);break;case"platform":t.push(`平台: ${((k=s.platform)==null?void 0:k.name)||"(無)"} → ${((ee=n.platform)==null?void 0:ee.name)||"(無)"}`);break;case"totalExpense":t.push(`總金額: ${((re=s.totalExpense)==null?void 0:re.toLocaleString())||0} → ${((Se=n.totalExpense)==null?void 0:Se.toLocaleString())||0}`);break;case"note":t.push(`備註: ${s.note||"(無)"} → ${n.note||"(無)"}`);break;case"details":{const de=[];Object.keys(o).forEach(X=>{var u,f;o[X]!==l[X]&&de.push(`- ${X}: ${((u=o[X])==null?void 0:u.toLocaleString())||0} → ${((f=l[X])==null?void 0:f.toLocaleString())||0}`)}),Object.keys(l).forEach(X=>{var u;o[X]||de.push(`-${X}: 0 → ${((u=l[X])==null?void 0:u.toLocaleString())||0}`)}),de.length>0&&(t.push("線別資訊:"),t.push(...de));break}}}),t}}if(a.action==="創建"){const s=a.changes.after||{},n=["_id","createdAt","updatedAt","password","tokens","__v"];if(a.targetModel==="hardwareDevices")return Object.entries(s).forEach(([e,o])=>{!n.includes(e)&&r[e]&&(e==="purchaseDate"||e==="office2021InstallDate"||e==="expenseDate"?t.push(`${r[e]}: ${F(o)}`):e==="type"?t.push(`${r[e]}: ${(o==null?void 0:o.name)||"(無)"}`):e==="user"?t.push(`${r[e]}: ${(o==null?void 0:o.name)||"(無)"}`):e==="company"?t.push(`${r[e]}: ${(o==null?void 0:o.name)||"(無)"}`):e==="location"?t.push(`${r[e]}: ${(o==null?void 0:o.locationName)||"(無)"}`):e==="expenseObject"?t.push(`${r[e]}: ${(o==null?void 0:o.name)||"(無)"}`):typeof o=="boolean"?t.push(`${r[e]}: ${O(o)}`):t.push(`${r[e]}: ${o||"(無)"}`))}),t;if(a.targetModel==="hardwareMaintenanceRecords")return Object.entries(s).forEach(([e,o])=>{if(!n.includes(e)&&r[e])if(e==="maintenanceDate")t.push(`${r[e]}: ${F(o)}`);else if(e==="hardwareCategory")t.push(`${r[e]}: ${(o==null?void 0:o.name)||"(無)"}`);else if(e==="reportUserId"){let l="(無)";o&&(typeof o=="object"&&o.name?l=o.name:typeof o=="string"&&o.length===24?l="(無)":typeof o=="string"&&(l=o)),t.push(`${r[e]}: ${l}`)}else(e==="maintenanceContent"||e==="maintenanceResult"||e==="note")&&t.push(`${r[e]}: ${o||"(無)"}`)}),t;if(a.targetModel==="designRequests"){const e=s;if(t.push(`申請編號: ${e.designRequestNumber}`),t.push(`申請類型: ${Ae(e.productType)}`),t.push(`申請人: ${((K=e.applicant)==null?void 0:K.name)||(typeof e.applicant=="string"?e.applicant:"(無)")}`),t.push(`申請日期: ${F(e.applicationDate)}`),t.push(`狀態: ${Ye(e.status)}`),e.assignedDesigner&&t.push(`處理人員: ${e.assignedDesigner.name||(typeof e.assignedDesigner=="string"?e.assignedDesigner:"(無)")}`),e.productType==="printing"&&e.printingTypes){const l=Object.entries(e.printingTypes).filter(([,i])=>i).map(([i])=>Ae(i));l.length>0&&t.push(`選擇的印刷類型: ${l.join("、")}`),e.infoBookletCover&&e.printingTypes.infoBookletCover&&(t.push("說資封面資料:"),e.infoBookletCover.title&&t.push(` - 標題: ${e.infoBookletCover.title}`),e.infoBookletCover.style&&t.push(` - 風格: ${e.infoBookletCover.style}`),e.infoBookletCover.imageSubject&&t.push(` - 圖片主題: ${e.infoBookletCover.imageSubject}`),e.infoBookletCover.content&&t.push(` - 內容: ${e.infoBookletCover.content}`),e.infoBookletCover.requestedByDate&&t.push(` - 希望交付日: ${F(e.infoBookletCover.requestedByDate)}`)),e.banner&&e.printingTypes.banner&&(t.push("布條資料:"),e.banner.title&&t.push(` - 標題: ${e.banner.title}`),e.banner.style&&t.push(` - 風格: ${e.banner.style}`),e.banner.imageSubject&&t.push(` - 圖片主題: ${e.banner.imageSubject}`),e.banner.content&&t.push(` - 內容: ${e.banner.content}`),e.banner.quantity&&t.push(` - 數量: ${e.banner.quantity}`),e.banner.requestedByDate&&t.push(` - 希望交付日: ${F(e.banner.requestedByDate)}`)),e.coachSign&&e.printingTypes.coachSign&&(t.push("車頭牌資料:"),e.coachSign.content&&t.push(` - 內容: ${e.coachSign.content}`),e.coachSign.quantity&&t.push(` - 數量: ${e.coachSign.quantity}`),typeof e.coachSign.useInfoBookletCover<"u"&&t.push(` - 使用說資封面: ${O(e.coachSign.useInfoBookletCover)}`)),e.otherNote&&e.printingTypes.other&&t.push(`其他備註: ${e.otherNote}`)}return e.productType==="newDMSingle"&&(e.useQuickTemplate&&t.push(`使用快速版型: ${O(e.useQuickTemplate)}`),e.quickTemplateNumber&&t.push(`快速版型編號: ${e.quickTemplateNumber}`),e.title&&t.push(`標題: ${e.title}`),e.subtitle&&t.push(`副標: ${e.subtitle}`),e.departureDate&&t.push(`出發日期: ${e.departureDate}`),e.tripHighlights&&t.push(`行程特色: ${e.tripHighlights}`),e.attractionImage&&t.push(`指定景點圖片: ${e.attractionImage}`),e.agentPrice&&t.push(`同業價: ${e.agentPrice.toLocaleString()}`),e.retailPrice&&t.push(`直客價: ${e.retailPrice.toLocaleString()}`),e.promotions&&t.push(`優惠: ${e.promotions}`),e.airlineHighlightNote&&t.push(`航空公司特色備註: ${e.airlineHighlightNote}`),e.useLogo&&t.push(`使用Logo: ${e.useLogo}`),e.note&&t.push(`備註: ${e.note}`)),e.productType==="newDMMultiple"&&(e.useQuickTemplate&&t.push(`使用快速版型: ${O(e.useQuickTemplate)}`),e.quickTemplateNumber&&t.push(`快速版型編號: ${e.quickTemplateNumber}`),e.title&&t.push(`標題: ${e.title}`),e.subtitleAndHighlights&&t.push(`副標/特色: ${e.subtitleAndHighlights}`),e.attractionImage&&t.push(`指定景點圖片: ${e.attractionImage}`),e.itinerary&&e.itinerary.length>0&&(t.push(`行程數量: ${e.itinerary.length} 筆`),e.itinerary.forEach((l,i)=>{t.push(`行程 ${i+1}:`),l.groupName&&t.push(` - 團體名稱: ${l.groupName}`),l.tripHighlights&&t.push(` - 行程特色: ${l.tripHighlights}`),l.departureDate&&t.push(` - 出發日期: ${l.departureDate}`),l.agentPrice&&t.push(` - 同業價: ${l.agentPrice.toLocaleString()}`),l.retailPrice&&t.push(` - 直客價: ${l.retailPrice.toLocaleString()}`)})),e.promotions&&t.push(`優惠: ${e.promotions}`),e.airlineHighlightNote&&t.push(`航空公司特色備註: ${e.airlineHighlightNote}`),e.useLogo&&t.push(`使用Logo: ${e.useLogo}`),e.note&&t.push(`備註: ${e.note}`)),(e.productType==="seriesMap"||e.productType==="SPMap")&&(e.groupId&&t.push(`團號: ${e.groupId}`),e.requestedByDate&&t.push(`希望交付日: ${F(e.requestedByDate)}`),e.note&&t.push(`備註: ${e.note}`)),["files","referenceImage","images"].forEach(l=>{if(e[l]&&Array.isArray(e[l])&&e[l].length>0){const i=e[l].map($=>typeof $=="string"?$.split("/").pop():"").filter(Boolean);t.push(`${r[l]}: ${i.join("、")}`)}}),t}if(a.targetModel==="notificationEmails"){const e=s;if(t.push(`使用者: ${((ue=e.user)==null?void 0:ue.name)||(typeof e.user=="string"?e.user:"(無)")}`),((Me=e.user)!=null&&Me.userId||(De=e.user)!=null&&De.adminId)&&t.push(`使用者編號: ${e.user.userId||e.user.adminId}`),e.categories&&Array.isArray(e.categories)&&e.categories.length>0){const o=e.categories.map(l=>({printing:"印刷相關",map:"地圖",dm:"DM",electronic:"電子說資"})[l]||l);t.push(`大分類: ${o.join("、")}`)}return e.note&&t.push(`備註: ${e.note}`),t}if(a.targetModel==="manufacturers")return Object.entries(s).forEach(([e,o])=>{!n.includes(e)&&r[e]&&(typeof o=="boolean"?t.push(`${r[e]}: ${O(o)}`):t.push(`${r[e]}: ${o||"(無)"}`))}),t;if(a.targetModel==="warehouses")return Object.entries(s).forEach(([e,o])=>{!n.includes(e)&&r[e]&&(e==="company"?t.push(`${r[e]}: ${(o==null?void 0:o.name)||"(無)"}`):typeof o=="boolean"?t.push(`${r[e]}: ${O(o)}`):t.push(`${r[e]}: ${o||"(無)"}`))}),t;if(a.targetModel==="spareParts")return Object.entries(s).forEach(([e,o])=>{if(!n.includes(e)&&r[e])if(e==="manufacturer")t.push(`${r[e]}: ${(o==null?void 0:o.name)||"(無)"}`);else if(e==="warehouses")if(Array.isArray(o)&&o.length>0){const l=o.map(i=>(i==null?void 0:i.name)||i||"(無)").filter(Boolean);t.push(`${r[e]}: ${l.join("、")||"(無)"}`)}else t.push(`${r[e]}: (無)`);else e==="cost"||e==="price"?t.push(`${r[e]}: ${(o==null?void 0:o.toLocaleString())||0}`):typeof o=="boolean"?t.push(`${r[e]}: ${O(o)}`):t.push(`${r[e]}: ${o||"(無)"}`)}),t;if(a.targetModel==="sparePartInventories"){const e=s;if((Ce=e.sparePart)!=null&&Ce.name&&t.push(`備品: ${e.sparePart.name}`),(Ne=e.warehouse)!=null&&Ne.name&&t.push(`倉庫: ${e.warehouse.name}`),e.quantity!==void 0&&t.push(`數量: ${e.quantity.toLocaleString()||0}`),e.quantityChange!==void 0){const o=e.quantityChange>0?`+${e.quantityChange.toLocaleString()}`:e.quantityChange.toLocaleString();t.push(`數量變更: ${o}`)}return e.note&&t.push(`備註: ${e.note}`),t}return Object.entries(s).forEach(([e,o])=>{if(!n.includes(e)&&r[e])if(e==="role"){const l=Ve(o);t.push(`${r[e]}: ${l}`)}else if(e==="roles"){const l=Ke(o);t.push(`${r[e]}: ${l}`)}else if(e==="salesPerson"){const l=(o==null?void 0:o.name)||(o==null?void 0:o.nickname)||"(無)";t.push(`${r[e]}: ${l}`)}else if(typeof o=="boolean")t.push(`${r[e]}: ${O(o)}`);else if(e==="type")a.targetModel==="marketingCategories"?t.push(`${r[e]}: ${Pe[o]||"(無)"}`):a.targetModel==="hardwareCategories"&&t.push(`${r[e]}: ${Ue[o]||"(無)"}`);else if(e==="progressNotes")if(Array.isArray(o)&&o.length>0){const l=o[o.length-1];t.push(`${r[e]}: ${l.content||"(無)"}`)}else t.push(`${r[e]}: 無`);else e==="inquiryDate"||e==="maintenanceDate"||e==="hireDate"||e==="resignationDate"||e==="unpaidLeaveStartDate"||e==="reinstatementDate"||e==="purchaseDate"||e==="office2021InstallDate"||e==="expenseDate"?t.push(`${r[e]}: ${F(o)}`):e==="company"&&(a.targetModel==="employees"||a.targetModel==="departments"||a.targetModel==="customerInquiries")?t.push(`${r[e]}: ${(o==null?void 0:o.name)||"(無)"}`):e==="department"?t.push(`${r[e]}: ${(o==null?void 0:o.name)||"(無)"}`):t.push(`${r[e]}: ${o||"(無)"}`)}),t}const{before:d={},after:g={},changedFields:h=[]}=a.changes;return a.targetModel==="hardwareDevices"?(h.forEach(s=>{if(r[s]){const n=d[s],e=g[s];if(s==="purchaseDate"||s==="office2021InstallDate"||s==="expenseDate")t.push(`${r[s]}: ${F(n)} → ${F(e)}`);else if(s==="type")t.push(`${r[s]}: ${(n==null?void 0:n.name)||"(無)"} → ${(e==null?void 0:e.name)||"(無)"}`);else if(s==="user")t.push(`${r[s]}: ${(n==null?void 0:n.name)||"(無)"} → ${(e==null?void 0:e.name)||"(無)"}`);else if(s==="company")t.push(`${r[s]}: ${(n==null?void 0:n.name)||"(無)"} → ${(e==null?void 0:e.name)||"(無)"}`);else if(s==="location"){const o=n===null?"(無)":(n==null?void 0:n.locationName)||"2F",l=e===null?"(無)":(e==null?void 0:e.locationName)||"2F";t.push(`${r[s]}: ${o} → ${l}`)}else s==="expenseObject"?t.push(`${r[s]}: ${(n==null?void 0:n.name)||"(無)"} → ${(e==null?void 0:e.name)||"(無)"}`):typeof n=="boolean"||typeof e=="boolean"?t.push(`${r[s]}: ${O(n)} → ${O(e)}`):t.push(`${r[s]}: ${n||"(無)"} → ${e||"(無)"}`)}}),t):a.targetModel==="designRequests"&&a.action==="修改"?(h.forEach(s=>{if(r[s]){const n=d[s],e=g[s];if(s==="status")t.push(`${r[s]}: ${Ye(n)} → ${Ye(e)}`);else if(s==="productType")t.push(`${r[s]}: ${Ae(n)} → ${Ae(e)}`);else if(s==="applicationDate"||s==="requestedByDate")t.push(`${r[s]}: ${F(n)} → ${F(e)}`);else if(s==="applicant"||s==="assignedDesigner"){let o="(無)",l="(無)";n&&(typeof n=="object"&&n.name?o=n.name:typeof n=="string"&&n.length===24?o="(無)":typeof n=="string"&&(o=n)),e&&(typeof e=="object"&&e.name?l=e.name:typeof e=="string"&&e.length===24?l="(無)":typeof e=="string"&&(l=e)),t.push(`${r[s]}: ${o} → ${l}`)}else if(typeof n=="boolean"||typeof e=="boolean")t.push(`${r[s]}: ${O(n)} → ${O(e)}`);else if(s==="agentPrice"||s==="retailPrice"||s==="quantity")t.push(`${r[s]}: ${(n==null?void 0:n.toLocaleString())||"(無)"} → ${(e==null?void 0:e.toLocaleString())||"(無)"}`);else if(s==="printingTypes"){const o=n?Object.entries(n).filter(([,i])=>i).map(([i])=>Ae(i)):[],l=e?Object.entries(e).filter(([,i])=>i).map(([i])=>Ae(i)):[];t.push(`${r[s]}: ${o.join("、")||"(無)"} → ${l.join("、")||"(無)"}`)}else if(s==="files"||s==="referenceImage"||s==="images"){const o=Array.isArray(n)?n.map(i=>typeof i=="string"?i.split("/").pop():"").filter(Boolean):[],l=Array.isArray(e)?e.map(i=>typeof i=="string"?i.split("/").pop():"").filter(Boolean):[];t.push(`${r[s]}: ${o.join("、")||"(無)"} → ${l.join("、")||"(無)"}`)}else if(s==="itinerary")if(Array.isArray(n)&&Array.isArray(e)){const o=Math.max(n.length,e.length);for(let l=0;l<o;l++){const i=n[l]||{},$=e[l]||{};if(Object.keys({...i,...$}).some(j=>j==="_id"?!1:i[j]!==$[j])){const j=[];Object.keys({...i,...$}).forEach(H=>{if(H==="_id")return;const k=i[H],ee=$[H];if(k!==ee){const re=r[H]||H;H==="agentPrice"||H==="retailPrice"?j.push(`${re}: ${(k==null?void 0:k.toLocaleString())||"(無)"} → ${(ee==null?void 0:ee.toLocaleString())||"(無)"}`):j.push(`${re}: ${k||"(無)"} → ${ee||"(無)"}`)}}),j.length>0&&t.push(`行程-${l+1}: ${j.join(", ")}`)}}}else{const o=Array.isArray(n)?`${n.length} 筆行程`:"(無)",l=Array.isArray(e)?`${e.length} 筆行程`:"(無)";t.push(`${r[s]}: ${o} → ${l}`)}else if(typeof n=="object"&&typeof e=="object"&&n&&e){const o=Object.keys({...n,...e});let l=!1;if(o.forEach(i=>{const $=n[i],P=e[i];if($!==P){l=!0;const j=r[i]||i,H=r[s]||s;i==="requestedByDate"?t.push(`${H}-${j}: ${F($)} → ${F(P)}`):i==="quantity"||i==="agentPrice"||i==="retailPrice"?t.push(`${H}-${j}: ${($==null?void 0:$.toLocaleString())||"(無)"} → ${(P==null?void 0:P.toLocaleString())||"(無)"}`):typeof $=="boolean"||typeof P=="boolean"?t.push(`${H}-${j}: ${O($)} → ${O(P)}`):t.push(`${H}-${j}: ${$||"(無)"} → ${P||"(無)"}`)}}),!l&&JSON.stringify(n)!==JSON.stringify(e)){const i=r[s]||s,$=Object.keys(n).length>0?"有資料":"(無)",P=Object.keys(e).length>0?"有資料":"(無)";t.push(`${i}: ${$} → ${P}`)}}else if(n&&typeof n=="object"||e&&typeof e=="object"){const o=r[s]||s,l=n&&typeof n=="object"?"有資料":n||"(無)",i=e&&typeof e=="object"?"有資料":e||"(無)";t.push(`${o}: ${l} → ${i}`)}else t.push(`${r[s]}: ${n||"(無)"} → ${e||"(無)"}`)}}),t):a.targetModel==="notificationEmails"&&a.action==="修改"?(h.forEach(s=>{if(r[s]){const n=d[s],e=g[s];if(s==="user"){const o=(n==null?void 0:n.name)||"(無)",l=(e==null?void 0:e.name)||"(無)";t.push(`${r[s]}: ${o} → ${l}`)}else if(s==="categories"){const o={printing:"印刷相關",map:"地圖",dm:"DM",electronic:"電子說資"},l=Array.isArray(n)?n.map($=>o[$]||$):[],i=Array.isArray(e)?e.map($=>o[$]||$):[];t.push(`${r[s]}: ${l.join("、")||"(無)"} → ${i.join("、")||"(無)"}`)}else typeof n=="boolean"||typeof e=="boolean"?t.push(`${r[s]}: ${O(n)} → ${O(e)}`):t.push(`${r[s]}: ${n||"(無)"} → ${e||"(無)"}`)}}),t):a.targetModel==="customerInquiries"&&a.action==="修改"?(h.forEach(s=>{if(r[s]){const n=d[s],e=g[s];if(s==="updatedAt")return;const o=n||"(無)",l=e||"(無)";if(o==="(無)"&&l==="(無)"||o===""&&l==="")return;if(s==="customerTitle")t.push(`${r[s]}: ${o} → ${l}`);else if(s==="inquiryResult")t.push(`${r[s]}: ${o} → ${l}`);else if(s==="inquiryDate")t.push(`${r[s]}: ${F(n)} → ${F(e)}`);else if(s==="salesPerson"){const i=(n==null?void 0:n.name)||(n==null?void 0:n.nickname)||"(無)",$=(e==null?void 0:e.name)||(e==null?void 0:e.nickname)||"(無)";t.push(`${r[s]}: ${i} → ${$}`)}else if(s==="company")t.push(`${r[s]}: ${(n==null?void 0:n.name)||"(無)"} → ${(e==null?void 0:e.name)||"(無)"}`);else if(s==="progressNotes")if(Array.isArray(e)){const i=e[e.length-1];t.push(`${r[s]}: ${i?i.content:"無"}`)}else t.push(`${r[s]}: ${e||"(無)"}`);else typeof n=="boolean"||typeof e=="boolean"?t.push(`${r[s]}: ${O(n)} → ${O(e)}`):t.push(`${r[s]}: ${o} → ${l}`)}}),t):a.targetModel==="manufacturers"?(h.forEach(s=>{if(r[s]){const n=d[s],e=g[s];typeof n=="boolean"||typeof e=="boolean"?t.push(`${r[s]}: ${O(n)} → ${O(e)}`):t.push(`${r[s]}: ${n||"(無)"} → ${e||"(無)"}`)}}),t):a.targetModel==="warehouses"?(h.forEach(s=>{if(r[s]){const n=d[s],e=g[s];s==="company"?t.push(`${r[s]}: ${(n==null?void 0:n.name)||"(無)"} → ${(e==null?void 0:e.name)||"(無)"}`):typeof n=="boolean"||typeof e=="boolean"?t.push(`${r[s]}: ${O(n)} → ${O(e)}`):t.push(`${r[s]}: ${n||"(無)"} → ${e||"(無)"}`)}}),t):a.targetModel==="spareParts"?(h.forEach(s=>{if(r[s]){const n=d[s],e=g[s];if(s==="manufacturer")t.push(`${r[s]}: ${(n==null?void 0:n.name)||"(無)"} → ${(e==null?void 0:e.name)||"(無)"}`);else if(s==="warehouses"){const o=Array.isArray(n)?n.map(i=>(i==null?void 0:i.name)||i||"(無)").filter(Boolean).join("、"):"(無)",l=Array.isArray(e)?e.map(i=>(i==null?void 0:i.name)||i||"(無)").filter(Boolean).join("、"):"(無)";t.push(`${r[s]}: ${o} → ${l}`)}else s==="cost"||s==="price"?t.push(`${r[s]}: ${(n==null?void 0:n.toLocaleString())||0} → ${(e==null?void 0:e.toLocaleString())||0}`):typeof n=="boolean"||typeof e=="boolean"?t.push(`${r[s]}: ${O(n)} → ${O(e)}`):t.push(`${r[s]}: ${n||"(無)"} → ${e||"(無)"}`)}}),t):a.targetModel==="sparePartInventories"?(h.forEach(s=>{var n,e,o,l;if(s==="quantity"){const i=d[s]||0,$=g[s]||0,P=$-i;if(t.push(`數量: ${i.toLocaleString()} → ${$.toLocaleString()}`),P!==0){const j=P>0?`+${P.toLocaleString()}`:P.toLocaleString();t.push(`數量變更: ${j}`)}}else if(s==="sparePart"){const i=((n=d[s])==null?void 0:n.name)||"(無)",$=((e=g[s])==null?void 0:e.name)||"(無)";t.push(`備品: ${i} → ${$}`)}else if(s==="warehouse"){const i=((o=d[s])==null?void 0:o.name)||"(無)",$=((l=g[s])==null?void 0:l.name)||"(無)";t.push(`倉庫: ${i} → ${$}`)}else s==="note"&&t.push(`備註: ${d[s]||"(無)"} → ${g[s]||"(無)"}`)}),t):(h.forEach(s=>{if(r[s]){const n=d[s],e=g[s];if(s==="reportUserId"){let o="(無)";n&&(typeof n=="object"&&n.name?o=n.name:typeof n=="string"&&n.length===24?o="(無)":typeof n=="string"&&(o=n));let l="(無)";e&&(typeof e=="object"&&e.name?l=e.name:typeof e=="string"&&e.length===24?l="(無)":typeof e=="string"&&(l=e)),t.push(`${r[s]}: ${o} → ${l}`);return}if(s==="progressNotes"){if(Array.isArray(e)){const o=e[e.length-1];t.push(`${r[s]}: ${o?o.content:"無"}`)}else t.push(`${r[s]}: ${e||"(無)"}`);return}if(s==="role"){const o=Ve(n),l=Ve(e);t.push(`${r[s]}: ${o} → ${l}`)}else if(s==="roles"){const o=Ke(n),l=Ke(e);t.push(`${r[s]}: ${o} → ${l}`)}else if(s==="permissions")t.push("權限變更");else if(s==="salesPerson"){const o=(n==null?void 0:n.name)||(n==null?void 0:n.nickname)||"(無)",l=(e==null?void 0:e.name)||(e==null?void 0:e.nickname)||"(無)";t.push(`${r[s]}: ${o} → ${l}`)}else s==="inquiryDate"||s==="maintenanceDate"||s==="hireDate"||s==="resignationDate"||s==="unpaidLeaveStartDate"||s==="reinstatementDate"||s==="purchaseDate"||s==="office2021InstallDate"||s==="expenseDate"||s==="lineBoundAt"?t.push(`${r[s]}: ${F(n)} → ${F(e)}`):s==="company"&&(a.targetModel==="employees"||a.targetModel==="departments"||a.targetModel==="customerInquiries")?t.push(`${r[s]}: ${(n==null?void 0:n.name)||"(無)"} → ${(e==null?void 0:e.name)||"(無)"}`):typeof n=="boolean"||typeof e=="boolean"?t.push(`${r[s]}: ${O(n)} → ${O(e)}`):s==="type"?a.targetModel==="marketingCategories"?t.push(`${r[s]}: ${Pe[n]||"(無)"} → ${Pe[e]||"(無)"}`):a.targetModel==="hardwareCategories"&&t.push(`${r[s]}: ${Ue[n]||"(無)"} → ${Ue[e]||"(無)"}`):s==="department"?t.push(`${r[s]}: ${(n==null?void 0:n.name)||"(無)"} → ${(e==null?void 0:e.name)||"(無)"}`):["hireDate","resignationDate","unpaidLeaveStartDate","reinstatementDate"].includes(s)?t.push(`${r[s]}: ${F(n)} → ${F(e)}`):t.push(`${r[s]}: ${n||"(無)"} → ${e||"(無)"}`)}}),a.targetModel==="forms"&&(a.action==="創建"||a.action==="修改")?["( 請查看詳細異動內容 )"]:t)},Qe=async()=>{var a,t;V.value=!0;try{const[d,g]=await Promise.all([G.get("/users/suggestions",{params:{search:"",itemsPerPage:9999}}),G.get("/employees/suggestions",{params:{search:"",itemsPerPage:9999}})]),h=[];h.push({_id:"000000000000000000000000",name:"SYSTEM",userId:"SYSTEM",type:"system"}),d.data.success&&d.data.result.forEach(C=>{h.push({...C,type:"system"})}),g.data.success&&g.data.result.forEach(C=>{h.push({_id:C.employeeCode,name:C.name,employeeCode:C.employeeCode,type:"employee"})}),E.value=h}catch(d){console.error("載入操作人員失敗:",d),J({text:((t=(a=d==null?void 0:d.response)==null?void 0:a.data)==null?void 0:t.message)||"載入操作人員失敗",snackbarProps:{color:"red-lighten-1"}}),E.value=[]}finally{V.value=!1}},xt=ct.debounce(async a=>{var t,d;if(!a){await Qe();return}V.value=!0;try{const[g,h]=await Promise.all([G.get("/users/suggestions",{params:{search:a,itemsPerPage:9999}}),G.get("/employees/suggestions",{params:{search:a,itemsPerPage:9999}})]),C=[];(!a||a.toUpperCase().split("").some(w=>"SYSTEM".includes(w)))&&C.push({_id:"000000000000000000000000",name:"SYSTEM",userId:"SYSTEM",type:"system"}),g.data.success&&g.data.result.forEach(w=>{C.push({...w,type:"system"})}),h.data.success&&h.data.result.forEach(w=>{C.push({_id:w.employeeCode,name:w.name,employeeCode:w.employeeCode,type:"employee"})}),E.value=C}catch(g){console.error("搜尋操作人員失敗:",g),J({text:((d=(t=g==null?void 0:g.response)==null?void 0:t.data)==null?void 0:d.message)||"搜尋操作人員失敗",snackbarProps:{color:"red-lighten-1"}}),E.value=[]}finally{V.value=!1}},300),$t=()=>{M.value="",Qe(),b.value.operatorId=null},bt=()=>{U.value="",L.value=[],b.value.targetId=null},Pt=async()=>{b.value={operatorId:null,targetId:null,action:"",targetModel:"",dateRange:[]},$t(),bt(),je.value="",D.value=[],_.value=0,st.value=!1,await Le()},je=R(""),at=R(!1),vt=ct.debounce(()=>{Le()},300);ze(je,()=>{at.value=!0,vt()});const Le=async()=>{var a,t,d,g;q.value=!0;try{const h={itemsPerPage:9999999999};if((a=b.value.operatorId)!=null&&a._id&&(h.operatorId=b.value.operatorId._id),b.value.action&&(h.action=b.value.action),b.value.dateRange&&b.value.dateRange.length>0){const w=new Date(b.value.dateRange[0]);w.setHours(0,0,0,0),h.startDate=w.toISOString();const ne=b.value.dateRange.length>1?new Date(b.value.dateRange[b.value.dateRange.length-1]):new Date(b.value.dateRange[0]);ne.setHours(23,59,59,999),h.endDate=ne.toISOString()}je.value&&(h.quickSearch=je.value),b.value.targetModel&&b.value.targetModel!==""&&(h.targetModel=b.value.targetModel),b.value.targetId&&(b.value.targetModel,h.targetId=b.value.targetId._id);const{data:C}=await G.get("/auditLogs",{params:h});C.success&&(D.value=C.result.data,_.value=C.result.totalItems,st.value=!0)}catch(h){console.error("搜尋失敗:",h),console.error("錯誤詳情:",{message:h==null?void 0:h.message,response:(t=h==null?void 0:h.response)==null?void 0:t.data}),J({text:((g=(d=h==null?void 0:h.response)==null?void 0:d.data)==null?void 0:g.message)||"搜尋失敗",snackbarProps:{color:"red-lighten-1"}}),D.value=[],_.value=0}finally{q.value=!1,at.value=!1}},At=a=>{if(a.isTargetDeleted&&a.action!=="創建"&&a.action!=="刪除"){J({text:"此資資料已被刪除，無法查看詳細內容",snackbarProps:{color:"warning"}});return}v.value=a,B.value=!0},Lt=me(()=>{var a,t,d;return!v.value||v.value.targetModel!=="marketingBudgets"||v.value.action==="刪除"?!1:v.value.action==="創建"?((d=(t=(a=v.value.changes)==null?void 0:a.after)==null?void 0:t.items)==null?void 0:d.length)>0:v.value.isTargetDeleted?!1:Je(v.value)});Ht(async()=>{await Qe(),await Le()});const We=a=>a?a.type==="employee"||a.employeeCode?`${a.name} (${a.employeeCode}) 【員工】`:a.adminId?`${a.name} (${a.adminId}) 【系統】`:`${a.name} (${a.userId||""}) 【系統】`:"";ze(()=>b.value.targetModel,()=>{bt()}),ze([()=>b.value.dateRange],([a])=>{if(a&&a.length>0){const t=new Date(a[0]),d=new Date(a[a.length-1]);t>d&&(J({text:"結束日期不能早於開始日期",snackbarProps:{color:"warning"}}),b.value.dateRange=[])}});const Fe=R("all"),st=R(!1),qe=R(!1),nt=R(!1),Z=R(null),ot=R([]),He=R(!1),$e=R(""),Oe=R(""),yt=async()=>{var a,t;He.value=!0;try{const[d,g]=await Promise.all([G.get("/users/suggestions",{params:{search:"",itemsPerPage:9999}}),G.get("/employees/suggestions",{params:{search:"",itemsPerPage:9999}})]),h=[];h.push({_id:"000000000000000000000000",name:"SYSTEM",userId:"SYSTEM",type:"system"}),d.data.success&&d.data.result.forEach(C=>{h.push({...C,type:"system"})}),g.data.success&&g.data.result.forEach(C=>{h.push({_id:C.employeeCode,name:C.name,employeeCode:C.employeeCode,type:"employee"})}),ot.value=h}catch(d){console.error("載入操作人員失敗:",d),J({text:((t=(a=d==null?void 0:d.response)==null?void 0:a.data)==null?void 0:t.message)||"載入操作人員失敗",snackbarProps:{color:"red-lighten-1"}})}finally{He.value=!1}},wt=ct.debounce(async a=>{var t,d;He.value=!0;try{const[g,h]=await Promise.all([G.get("/users/suggestions",{params:{search:a,itemsPerPage:9999}}),G.get("/employees/suggestions",{params:{search:a,itemsPerPage:9999}})]),C=[];(!a||a.toUpperCase().split("").some(w=>"SYSTEM".includes(w)))&&C.push({_id:"000000000000000000000000",name:"SYSTEM",userId:"SYSTEM",type:"system"}),g.data.success&&g.data.result.forEach(w=>{C.push({...w,type:"system"})}),h.data.success&&h.data.result.forEach(w=>{C.push({_id:w.employeeCode,name:w.name,employeeCode:w.employeeCode,type:"employee"})}),ot.value=C}catch(g){console.error("搜尋操作人員失敗:",g),J({text:((d=(t=g==null?void 0:g.response)==null?void 0:t.data)==null?void 0:d.message)||"搜尋操作人員失敗",snackbarProps:{color:"red-lighten-1"}})}finally{He.value=!1}},300);ze(qe,async a=>{a?await yt():(Z.value=null,$e.value="")});const _t=async()=>{Z.value=null,$e.value="",await yt()},Et=async()=>{var a,t,d;if(!((a=Z.value)!=null&&a._id)){J({text:"請選擇要刪除的操作人員",snackbarProps:{color:"red-lighten-1"}});return}nt.value=!0;try{const{data:g}=await G.delete("/auditLogs/my-logs",{params:{operatorId:Z.value._id}});g.success&&(J({text:g.message,snackbarProps:{color:"teal-lighten-1"}}),qe.value=!1,Z.value=null,await Le())}catch(g){console.error("刪除異動紀錄失敗:",g),J({text:((d=(t=g==null?void 0:g.response)==null?void 0:t.data)==null?void 0:d.message)||"刪除異動紀錄失敗",snackbarProps:{color:"red-lighten-1"}})}finally{nt.value=!1}},Bt=()=>{qe.value=!0},rt=R(!1),Ge=()=>{qe.value=!1,$e.value=""},jt=a=>{if(!Z.value){Oe.value="";return}if(!a){Oe.value="請輸入操作人員名稱";return}if(a!==Z.value.name){Oe.value="請輸入完全相符的操作人員名稱";return}Oe.value=""};ze(Z,a=>{$e.value="",Oe.value="",a||($e.value="")});const we=R({open:!1,item:null}),qt=a=>{we.value={open:!0,item:a}},Ot=async()=>{var a,t;try{const{data:d}=await G.delete(`/auditLogs/${we.value.item._id}`);d.success&&(await Le(),J({text:"刪除異動紀錄成功",snackbarProps:{color:"teal-lighten-1"}}))}catch(d){console.error("刪除異動紀錄失敗:",d),J({text:((t=(a=d==null?void 0:d.response)==null?void 0:a.data)==null?void 0:t.message)||"刪除失敗",snackbarProps:{color:"red-lighten-1"}})}},Rt=()=>{st.value&&Le()},Ut=me(()=>Fe.value==="all"?D.value:D.value.filter(a=>{var t,d,g,h,C,w;return Fe.value==="employee"?((t=a.operatorInfo)==null?void 0:t.employeeCode)||((d=a.operatorInfo)==null?void 0:d.type)==="employee"||a.operatorInfo&&!a.operatorInfo.adminId&&!a.operatorInfo.userId:Fe.value==="system"?((g=a.operatorInfo)==null?void 0:g.adminId)||((h=a.operatorInfo)==null?void 0:h.userId)||((C=a.operatorInfo)==null?void 0:C.type)==="system"||((w=a.operatorInfo)==null?void 0:w.name)==="SYSTEM":!0})),lt=R(null);return(a,t)=>{var g,h,C,w,ne,be,ve,ye,Ie;const d=Vt("v-date-input");return N(),S(ae,null,[c(Xt,{"max-width":"2500"},{default:p(()=>[c(pe,{class:"pt-md-5"},{default:p(()=>[c(W,{cols:"12",lg:"2"},{default:p(()=>[c(pe,null,{default:p(()=>[c(W,{cols:"12",class:"mt-1 ps-lg-6 pe-lg-0"},{default:p(()=>[c(ut,{class:"elevation-4 rounded-lg py-6 px-4 px-sm-4 px-xl-4"},{default:p(()=>[c(Kt,{class:"font-weight-bold d-flex align-center"},{default:p(()=>t[16]||(t[16]=[z(" 搜尋條件 ")])),_:1}),c(dt,{class:"pa-2"},{default:p(()=>[c(pe,null,{default:p(()=>[c(W,{cols:"12",sm:"6",lg:"12"},{default:p(()=>[c(Dt,{modelValue:b.value.operatorId,"onUpdate:modelValue":t[0]||(t[0]=m=>b.value.operatorId=m),"search-input":M.value,"onUpdate:searchInput":t[1]||(t[1]=m=>M.value=m),items:E.value,loading:V.value,label:"操作人員","return-object":"","item-props":m=>({key:m._id,title:We(m),value:m}),variant:"outlined",density:"compact","hide-details":"",clearable:"","onUpdate:search":Te(xt),"onClick:clear":$t,"onClick:input":Qe},Yt({selection:p(({item:m})=>[z(x(We(m.raw)),1)]),_:2},[Te(T)?{name:"append-inner",fn:p(()=>[c(kt,{location:"top","close-delay":"200"},{activator:p(({props:m})=>[c(le,Jt(m,{icon:"mdi-information",size:"18"}),null,16)]),default:p(()=>[t[17]||(t[17]=z(" 輸入使用者編號、管理者編號、員工編號或姓名查詢 "))]),_:1})]),key:"0"}:void 0]),1032,["modelValue","search-input","items","loading","item-props","onUpdate:search"])]),_:1}),c(W,{cols:"12",sm:"6",lg:"12"},{default:p(()=>[c(Ct,{modelValue:b.value.targetModel,"onUpdate:modelValue":t[2]||(t[2]=m=>b.value.targetModel=m),items:ce,label:"資料類型","item-title":"title","item-value":"value",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),c(W,{cols:"12",sm:"6",lg:"12"},{default:p(()=>[c(Ct,{modelValue:b.value.action,"onUpdate:modelValue":t[3]||(t[3]=m=>b.value.action=m),items:ie,label:"操作類型","item-title":"title","item-value":"value",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),c(W,{cols:"12",sm:"6",lg:"12"},{default:p(()=>[c(d,{modelValue:b.value.dateRange,"onUpdate:modelValue":t[4]||(t[4]=m=>b.value.dateRange=m),label:"日期區間",variant:"outlined",density:"compact","hide-details":"",multiple:"range","prepend-icon":"",clearable:"","cancel-text":"取消","ok-text":"確認"},null,8,["modelValue"])]),_:1})]),_:1}),c(pe,null,{default:p(()=>[c(W,{cols:"12",class:"d-flex justify-end gap-2"},{default:p(()=>[c(pe,{class:"d-flex justify-space-between"},{default:p(()=>[c(W,{cols:"3"},{default:p(()=>[c(ge,{color:"grey",width:"40",block:"",onClick:Pt},{default:p(()=>[c(le,null,{default:p(()=>t[18]||(t[18]=[z("mdi-refresh")])),_:1})]),_:1})]),_:1}),c(W,{cols:"9",class:"ps-0"},{default:p(()=>[c(ge,{color:"cyan-darken-2","prepend-icon":"mdi-magnify",loading:q.value,block:"",onClick:Le},{default:p(()=>t[19]||(t[19]=[z(" 搜尋 ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),c(W,{cols:"12",lg:"10",class:"px-6 ps-lg-4 mb-6"},{default:p(()=>[c(pe,{class:"elevation-4 rounded-lg py-4 py-sm-8 px-1 px-sm-10 mt-1 mx-0 mx-sm-4 ms-md-4 me-md-0 mb-4 bg-white"},{default:p(()=>[c(W,{cols:"12",class:"ps-4 pb-sm-6"},{default:p(()=>[c(pe,null,{default:p(()=>[c(W,null,{default:p(()=>t[20]||(t[20]=[y("h3",null,"異動紀錄",-1)])),_:1}),c(W,{cols:"3",class:"ms-auto d-flex align-center"},{default:p(()=>[It(c(le,{icon:"mdi-information",size:"small",color:"blue-grey-darken-2",class:"me-2"},null,512),[[Tt,"可搜尋操作對象","start"]]),c(Nt,{modelValue:je.value,"onUpdate:modelValue":t[5]||(t[5]=m=>je.value=m),label:"快速搜尋","append-inner-icon":"mdi-magnify",loading:at.value,variant:"outlined",density:"compact","hide-details":"",clearable:"",onInput:Te(vt)},null,8,["modelValue","loading","onInput"]),It(c(ge,{icon:"mdi-delete-clock-outline",color:rt.value?"red-lighten-1":"grey",variant:"plain",size:"36",class:"mx-2",onMouseenter:t[6]||(t[6]=m=>rt.value=!0),onMouseleave:t[7]||(t[7]=m=>rt.value=!1),onClick:Bt},null,8,["color"]),[[Tt,"刪除異動紀錄","top"]])]),_:1})]),_:1}),c(pe,{class:"mt-4"},{default:p(()=>[c(W,{cols:"12"},{default:p(()=>[c(ea,{modelValue:Fe.value,"onUpdate:modelValue":[t[8]||(t[8]=m=>Fe.value=m),Rt],grow:"",color:"blue-grey-darken-1"},{default:p(()=>[c(ft,{value:"all"},{default:p(()=>[c(le,{class:"me-2"},{default:p(()=>t[21]||(t[21]=[z(" mdi-format-list-bulleted ")])),_:1}),t[22]||(t[22]=z(" 全部 "))]),_:1}),c(ft,{value:"employee"},{default:p(()=>[c(le,{class:"me-2"},{default:p(()=>t[23]||(t[23]=[z(" mdi-account-tie ")])),_:1}),t[24]||(t[24]=z(" 員工 "))]),_:1}),c(ft,{value:"system"},{default:p(()=>[c(le,{class:"me-2"},{default:p(()=>t[25]||(t[25]=[z(" mdi-desktop-classic ")])),_:1}),t[26]||(t[26]=z(" 系統 "))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),c(W,{cols:"12"},{default:p(()=>[c(ta,{items:Ut.value,headers:Be.value,loading:q.value,"items-per-page-options":[10,20,50,100],hover:"",density:"compact",class:"rounded-ts-lg rounded-te-lg"},{item:p(({item:m,index:oe})=>[y("tr",{class:_e({"odd-row":oe%2===0,"even-row":oe%2!==0})},[y("td",null,x(Xe(m.createdAt)),1),Te(T)?(N(),S("td",Ia,x(et(m)),1)):se("",!0),y("td",null,x(ke(m.targetModel)),1),Te(T)?(N(),S("td",Ma,x(m.action),1)):se("",!0),Te(xe)?(N(),S("td",Da,x(mt(m)),1)):se("",!0),Te(Ee)?(N(),S("td",Ca,[(N(!0),S(ae,null,he(tt(m),(K,ue)=>(N(),S("div",{key:ue},x(K),1))),128))])):se("",!0),y("td",Na,[y("div",Sa,[c(ge,{icon:"",class:"me-2",color:"light-blue-darken-4",variant:"plain",size:"24",ripple:!1,onClick:K=>At(m)},{default:p(()=>[c(le,null,{default:p(()=>t[27]||(t[27]=[z("mdi-book-open-variant-outline")])),_:1})]),_:2},1032,["onClick"]),c(ge,{icon:"",color:lt.value===m._id?"red-lighten-1":"grey",variant:"plain",size:"24",ripple:!1,onMouseenter:K=>lt.value=m._id,onMouseleave:t[9]||(t[9]=K=>lt.value=null),onClick:K=>qt(m)},{default:p(()=>[c(le,null,{default:p(()=>t[28]||(t[28]=[z("mdi-delete")])),_:1})]),_:2},1032,["color","onMouseenter","onClick"])])])],2)]),_:1},8,["items","headers","loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),c(Mt,{modelValue:B.value,"onUpdate:modelValue":t[11]||(t[11]=m=>B.value=m),class:_e({"budget-detail":((g=v.value)==null?void 0:g.targetModel)==="marketingBudgets"&&((h=v.value)==null?void 0:h.action)!=="刪除"&&Je(v.value)}),width:((C=v.value)==null?void 0:C.targetModel)==="marketingBudgets"&&((w=v.value)==null?void 0:w.action)==="創建"?1300:((ne=v.value)==null?void 0:ne.targetModel)==="marketingBudgets"&&((be=v.value)==null?void 0:be.action)!=="刪除"&&Je(v.value)?void 0:600,"data-action":(ve=v.value)==null?void 0:ve.action},{default:p(()=>[c(ut,{class:"pa-4 rounded-lg"},{default:p(()=>[t[38]||(t[38]=y("div",{class:"ps-6 pt-4 pb-1 pb-sm-3 card-title"}," 詳細異動內容 ",-1)),c(dt,null,{default:p(()=>[c(pe,null,{default:p(()=>[c(W,{cols:"12"},{default:p(()=>{var m,oe,K,ue,Me,De,Ce,Ne,s,n,e,o,l,i,$,P,j,H,k,ee,re,Se,de,X,u,f;return[y("div",Ta,[y("div",null,[t[29]||(t[29]=y("div",{class:"text-grey-darken-1 list-title"}," 操作時間 ",-1)),y("div",xa,x(Xe((m=v.value)==null?void 0:m.createdAt)),1)]),c(Re,{class:"my-2"}),y("div",null,[t[30]||(t[30]=y("div",{class:"text-grey-darken-1 list-title"}," 操作人員 ",-1)),y("div",Pa,x(et(v.value)),1)]),c(Re,{class:"my-2"}),y("div",null,[t[31]||(t[31]=y("div",{class:"text-grey-darken-1 list-title"}," 資料類型 ",-1)),y("div",Aa,x(ke((oe=v.value)==null?void 0:oe.targetModel)),1)]),c(Re,{class:"my-2"}),y("div",null,[t[32]||(t[32]=y("div",{class:"text-grey-darken-1 list-title"}," 操作類型 ",-1)),y("div",La,x((K=v.value)==null?void 0:K.action),1)]),c(Re,{class:"my-2"}),y("div",null,[t[33]||(t[33]=y("div",{class:"text-grey-darken-1 list-title"}," 操作對象 ",-1)),y("div",wa,x(mt(v.value)),1)]),c(Re,{class:"my-2"}),y("div",null,[t[36]||(t[36]=y("div",{class:"text-grey-darken-1 list-title"}," 異動內容 ",-1)),((ue=v.value)==null?void 0:ue.targetModel)==="marketingBudgets"&&Lt.value&&Je(v.value)?(N(),S("div",_a,[c(ya,{action:v.value.action,changes:v.value.changes},null,8,["action","changes"])])):((Me=v.value)==null?void 0:Me.targetModel)==="forms"&&((De=v.value)==null?void 0:De.action)==="創建"?(N(),S("div",Ea,[y("ul",Ba,[y("li",null,x((s=(Ne=(Ce=v.value)==null?void 0:Ce.changes)==null?void 0:Ne.after)==null?void 0:s.formNumber),1),(N(!0),S(ae,null,he((o=(e=(n=v.value)==null?void 0:n.changes)==null?void 0:e.after)==null?void 0:o.formData,(I,A)=>(N(),S("li",{key:A},x(A)+": "+x(typeof I=="object"?JSON.stringify(I):I),1))),128))])])):((l=v.value)==null?void 0:l.targetModel)==="forms"&&((i=v.value)==null?void 0:i.action)==="修改"?(N(),S("div",ja,[t[34]||(t[34]=y("span",{class:"text-grey-darken-2"},"( 修改前 )",-1)),y("ul",qa,[y("li",null,x((j=(P=($=v.value)==null?void 0:$.changes)==null?void 0:P.before)==null?void 0:j.formNumber),1),(N(!0),S(ae,null,he((ee=(k=(H=v.value)==null?void 0:H.changes)==null?void 0:k.before)==null?void 0:ee.formData,(I,A)=>(N(),S("li",{key:A},x(A)+": "+x(typeof I=="object"?JSON.stringify(I):I),1))),128))]),c(Re,{class:"my-2"}),t[35]||(t[35]=y("span",{class:"text-grey-darken-2"},"( 修改後 )",-1)),y("ul",Oa,[y("li",null,x((de=(Se=(re=v.value)==null?void 0:re.changes)==null?void 0:Se.after)==null?void 0:de.formNumber),1),(N(!0),S(ae,null,he((f=(u=(X=v.value)==null?void 0:X.changes)==null?void 0:u.after)==null?void 0:f.formData,(I,A)=>(N(),S("li",{key:A},x(A)+": "+x(typeof I=="object"?JSON.stringify(I):I),1))),128))])])):tt(v.value).length>0?(N(),S("div",Ra,[y("ul",Ua,[(N(!0),S(ae,null,he(tt(v.value),(I,A)=>(N(),S("li",{key:A,class:"py-2"},x(I),1))),128))])])):(N(),S("div",Fa," 無異動內容 "))])])]}),_:1})]),_:1})]),_:1}),c(St,{class:"px-4"},{default:p(()=>[c(pt),c(ge,{color:"grey-darken-1",variant:"outlined",size:Q.value,onClick:t[10]||(t[10]=m=>B.value=!1)},{default:p(()=>t[37]||(t[37]=[z(" 關閉 ")])),_:1},8,["size"])]),_:1})]),_:1})]),_:1},8,["modelValue","class","width","data-action"]),c(Mt,{modelValue:qe.value,"onUpdate:modelValue":t[14]||(t[14]=m=>qe.value=m),"max-width":"400","onClick:outside":Ge,onKeydown:zt(Ge,["esc"])},{default:p(()=>[c(ut,{class:"rounded-lg"},{default:p(()=>[y("div",Ha,[c(le,{size:"20",color:"white",class:"me-2"},{default:p(()=>t[39]||(t[39]=[z(" mdi-delete-alert ")])),_:1}),t[41]||(t[41]=z(" 刪除異動紀錄 ")),c(pt),c(ge,{icon:"",color:"white",variant:"plain",class:"opacity-100",ripple:!1,size:"20",onClick:Ge},{default:p(()=>[c(le,{size:"20"},{default:p(()=>t[40]||(t[40]=[z(" mdi-close ")])),_:1})]),_:1})]),c(dt,{class:"px-6 pt-6 pb-3"},{default:p(()=>[c(Dt,{modelValue:Z.value,"onUpdate:modelValue":t[12]||(t[12]=m=>Z.value=m),items:ot.value,loading:He.value,label:"選擇操作人員","return-object":"","item-props":m=>({key:m._id,title:We(m),value:m}),variant:"outlined",density:"compact",clearable:"","onUpdate:search":Te(wt),"onClick:clear":_t},{selection:p(({item:m})=>[z(x(We(m.raw)),1)]),_:1},8,["modelValue","items","loading","item-props","onUpdate:search"]),c(Nt,{modelValue:$e.value,"onUpdate:modelValue":[t[13]||(t[13]=m=>$e.value=m),jt],label:"請輸入操作人員名稱進行確認","error-messages":Oe.value,disabled:!Z.value,variant:"outlined",density:"compact",class:"mt-4",clearable:"","persistent-hint":"",hint:Z.value?`請輸入: ${Z.value.name}`:"請先選擇操作人員"},null,8,["modelValue","error-messages","disabled","hint"]),c(aa,{type:"warning",color:"red-lighten-1",variant:"tonal",density:"compact",class:"mt-4"},{default:p(()=>t[42]||(t[42]=[z(" 注意：此操作將刪除該操作人員的所有異動紀錄，且不可恢復。 ")])),_:1})]),_:1}),c(St,{class:"px-6 pb-5"},{default:p(()=>[c(pt),c(ge,{size:Q.value,color:"grey-darken-1",variant:"outlined",class:"me-1",onClick:Ge},{default:p(()=>t[43]||(t[43]=[z(" 取消 ")])),_:1},8,["size"]),c(ge,{size:Q.value,color:"red-lighten-1",variant:"outlined",loading:nt.value,disabled:!Z.value||$e.value!==Z.value.name,onClick:Et},{default:p(()=>t[44]||(t[44]=[z(" 確認 ")])),_:1},8,["size","loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),c(sa,{modelValue:we.value.open,"onUpdate:modelValue":t[15]||(t[15]=m=>we.value.open=m),title:"確認刪除異動紀錄",message:`確定要刪除此筆異動紀錄嗎？此操作無法復原。<br><br>操作時間：${Xe((ye=we.value.item)==null?void 0:ye.createdAt)}<br>操作人員：${et(we.value.item)}<br>資料類型：${ke((Ie=we.value.item)==null?void 0:Ie.targetModel)}`,"confirm-button-size":"default","cancel-button-size":"default",onConfirm:Ot},null,8,["modelValue","message"])],64)}}},ds=ht(za,[["__scopeId","data-v-70e73f64"]]);export{ds as default};

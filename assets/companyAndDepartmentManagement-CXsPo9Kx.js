import{f as se,r as m,w as L,k as na,aV as c,Z as y,bH as l,b3 as sa,a8 as a,a0 as r,u as $,bJ as B,_ as A,a7 as u,bf as D,$ as j,aH as Pe,b0 as de,aG as da,F as ie,bM as Q}from"./@vue-Cr_z6yfx.js";import{l as ia}from"./lodash-CiJWSuVn.js";import{_ as ra,u as ua,b as ma}from"./index-n6mFz3XI.js";import{i as pa}from"./vuetify-use-dialog-C5oZ13xz.js";import{u as ca}from"./vue-router-BFBClpR6.js";import{C as Ne}from"./ConfirmDeleteDialogWithTextField-DbFFuYhr.js";import{q as va,Q as fa,w as g,r as x,v as T,g as p,P as fe,d as S,R as ya,a as H,c as W,F as Ee,C as ga,D as ba,x as Te,f as G,U as X,e as ee,V as Y,Z as ka,T as re}from"./vuetify-CbddcmEc.js";import"./perfect-debounce-Cp2ysxOb.js";import"./hookable-B8xFkYCm.js";import"./core-js-D2hAHviU.js";/* empty css             */import"./pinia-DBRIaiZ_.js";import"./vue-demi-Dq6ymT-8.js";import"./pinia-plugin-persistedstate-RV7uh3T-.js";import"./jspdf-DsdNZwtm.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./unplugin-vue-router-B1N3mqWX.js";import"./axios-upsvKRUO.js";import"./vue3-google-login-Dx7TV_Hx.js";import"./vue-easy-lightbox-D952uME8.js";const Ca={key:0},Va={class:"d-flex justify-center h-25"},xa={class:"card-title pb-2 d-flex justify-space-between align-center"},_a={class:"mb-8"},Ia={class:"text-pink-lighten-2"},Da={class:"card-title ps-6 py-3"},wa={class:"card-title ps-6 pe-3 pb-2 d-flex justify-space-between align-center"},za={style:{"min-width":"100px"}},Pa={class:"pt-2"},Na={class:"text-center"},Ea={class:"card-title px-4 pb-2 d-flex align-center justify-space-between"},Ta={class:"d-flex align-center item-container"},Ua={class:"order-number"},ha={class:"d-flex align-center justify-space-between w-100 pe-1"},La={class:"d-flex flex-column"},$a={__name:"companyAndDepartmentManagement",setup(Ba){const{smAndUp:Z,mdAndUp:ue}=va(),{apiAuth:I}=ma(),b=pa(),Ue=ca(),me=ua(),P=se(()=>Z.value?"default":"small"),he=m(0),pe=m(!1),J=m(10),q=m([{key:"departmentId",order:"asc"}]),ae=m(1),ye=m(0),le=m(""),te=m(""),Le={class:"header-bg"},ge=[{title:"部門編號",key:"departmentId",align:"start",minWidth:"68px",sortable:!0},{title:"公司",key:"company.name",align:"start",minWidth:"68px",sortable:!0},{title:"部門",key:"name",align:"start",minWidth:"68px",sortable:!0},{title:"人數",key:"employeeCount",align:"start",sortable:!0},{title:"操作",key:"actions",align:"center",sortable:!1}],$e=se(()=>Z.value?ge:ge.filter(t=>["departmentId","name","employeeCount","actions"].includes(t.key))),w=m([]),oe=m({open:!1}),C=m({open:!1,_id:"",companyId:"",name:""}),U=m({open:!1,_id:"",name:""}),M=m({name:""}),R=m([]),ce=m([]),be=m([]),_=m({open:!1,id:null}),h=m({open:!1,id:"",name:"",companyName:""}),d=m({company:"",name:"",departmentId:"",departmentCode:"",originalData:null}),k=m({company:[],departmentId:[],departmentCode:[],name:[]}),V=m(!1),ke=se(()=>[...w.value].sort((t,e)=>t.companyId.localeCompare(e.companyId))),Ce=[{code:"IT",name:"IT (IT部)"},{code:"OP",name:"OP (OP部)"},{code:"TO",name:"TO (線控部)"},{code:"AT",name:"AT (機控部)"},{code:"BC",name:"BC (直售部)"},{code:"BB",name:"BB (同業部)"},{code:"BD",name:"BD (商務部)"},{code:"MD",name:"MD (行銷美編部)"},{code:"FM",name:"FM (財務管理部)"},{code:"CI",name:"CI (企業獎勵部)"},{code:"GB",name:"GB (高爾夫球事業部)"}],Ve=async()=>{var t,e;try{const{data:n}=await I.get("/companies/all");n.success&&(w.value=n.result.data)}catch(n){console.error("載入公司列表失敗:",n),b({text:((e=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:e.message)||"載入公司列表失敗",snackbarProps:{color:"red-lighten-1"}})}},N=async(t=!1)=>{var e,n,o,s;t&&(ae.value=1),pe.value=!0;try{const i={page:ae.value,itemsPerPage:J.value,sortBy:((e=q.value[0])==null?void 0:e.key)||"departmentId",sortOrder:((n=q.value[0])==null?void 0:n.order)||"asc",quickSearch:le.value,company:te.value},{data:E}=await I.get("/departments/all",{params:i});E.success&&(be.value=E.result.data,ye.value=E.result.totalItems)}catch(i){console.error("載入部門列表失敗:",i),b({text:((s=(o=i==null?void 0:i.response)==null?void 0:o.data)==null?void 0:s.message)||"載入部門列表失敗",snackbarProps:{color:"red-lighten-1"}})}finally{pe.value=!1}},xe=()=>{oe.value.open=!0,M.value.name="",R.value=[]},Be=()=>{oe.value.open=!1,M.value.name="",R.value=[]},Ae=async()=>{var t,e;if(!M.value.name){R.value=["請輸入公司名稱"];return}V.value=!0;try{const{data:n}=await I.post("/companies",{name:M.value.name});n.success&&(w.value.push(n.result),M.value.name="",R.value=[],b({text:"新增公司成功",snackbarProps:{color:"teal-lighten-1"}}))}catch(n){R.value=[((e=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:e.message)||"新增失敗"]}finally{V.value=!1}},Se=t=>{C.value={open:!0,_id:t._id,companyId:t.companyId,name:t.name}},_e=()=>{C.value={open:!1,_id:"",companyId:"",name:""},ce.value=[]},Me=async()=>{var t,e;if(!C.value.name){ce.value=["請輸入公司名稱"];return}V.value=!0;try{const{data:n}=await I.patch(`/companies/${C.value._id}`,{name:C.value.name,companyId:C.value.companyId});if(n.success){const o=w.value.findIndex(s=>s._id===C.value._id);o!==-1&&(w.value[o]=n.result),_e(),b({text:"修改公司成功",snackbarProps:{color:"teal-lighten-1"}})}}catch(n){b({text:((e=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:e.message)||"修改失敗",snackbarProps:{color:"red-lighten-1"}})}finally{V.value=!1}},Fe=t=>{U.value={open:!0,_id:t._id,name:t.name}},Oe=async()=>{var t,e;try{await I.delete(`/companies/${U.value._id}`),w.value=w.value.filter(n=>n._id!==U.value._id),U.value.open=!1,b({text:"刪除公司成功",snackbarProps:{color:"teal-lighten-1"}})}catch(n){b({text:((e=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:e.message)||"刪除失敗",snackbarProps:{color:"red-lighten-1"}})}},qe=async t=>{const{page:e,itemsPerPage:n,sortBy:o}=t;ae.value=e,J.value=n,q.value=o,await N(!1)},Re=ia.debounce(()=>{N(!0)},300);L(le,()=>{Re()}),L([J,q],()=>{N(!0)}),L(te,()=>{N(!0)}),na(async()=>{await Promise.all([Ve(),N()])});const Ie=()=>{_.value={open:!0,id:null},d.value={company:"",name:"",departmentId:"",departmentCode:"",originalData:null},k.value={company:[],departmentId:[],departmentCode:[],name:[]}},ve=()=>{_.value={open:!1,id:null},d.value={company:"",name:"",departmentId:"",departmentCode:"",originalData:null},k.value={company:[],departmentId:[],departmentCode:[],name:[]}},je=t=>{var e;h.value={open:!0,id:t._id,name:t.name,companyName:((e=t.company)==null?void 0:e.name)||"未知公司"}},He=async()=>{var t,e;try{await I.delete(`/departments/${h.value.id}`),await N(),h.value.open=!1,b({text:"刪除部門成功",snackbarProps:{color:"teal-lighten-1"}})}catch(n){b({text:((e=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:e.message)||"刪除失敗",snackbarProps:{color:"red-lighten-1"}})}},We=async()=>{var e,n,o;k.value={company:[],departmentId:[],departmentCode:[],name:[]};let t=!1;if(d.value.company||(k.value.company=["請選擇公司"],t=!0),d.value.departmentId||(k.value.departmentId=["請輸入部門編號"],t=!0),(e=d.value.name)!=null&&e.trim()||(k.value.name=["請輸入部門名稱"],t=!0),!t){V.value=!0;try{const s={company:d.value.company,departmentId:d.value.departmentId,name:d.value.name,departmentCode:d.value.departmentCode};if(_.value.id){const{data:i}=await I.patch(`/departments/${_.value.id}`,s);i.success&&(await N(),ve(),b({text:"修改部門成功",snackbarProps:{color:"teal-lighten-1"}}))}else{const{data:i}=await I.post("/departments",s);i.success&&(await N(),ve(),b({text:"新增部門成功",snackbarProps:{color:"teal-lighten-1"}}))}}catch(s){const i=(o=(n=s==null?void 0:s.response)==null?void 0:n.data)==null?void 0:o.message;i!=null&&i.includes("部門編號")?k.value.departmentId=[i]:i!=null&&i.includes("部門名稱")?k.value.name=[i]:b({text:i||"操作失敗",snackbarProps:{color:"red-lighten-1"}})}finally{V.value=!1}}},Ge=t=>{_.value={open:!0,id:t._id},d.value={company:t.company._id,name:t.name,departmentId:t.departmentId,departmentCode:t.departmentCode,originalData:{...t}}};L(()=>d.value.departmentCode,(t,e)=>{if(t){const n=Ce.find(o=>o.code===t);if(n){const o=n.name.match(/\((.*?)\)/);o&&o[1]&&(!_.value.id||t!==e)&&(d.value.name=o[1])}}else _.value.id||(d.value.name="")}),L([()=>d.value.company,()=>d.value.departmentCode],()=>{if(d.value.company&&d.value.departmentCode){const t=w.value.find(e=>e._id===d.value.company);t&&(d.value.departmentId=`${t.companyId}${d.value.departmentCode}`)}else _.value.id||(d.value.departmentId="")},{immediate:!0}),L(()=>d.value.company,()=>{d.value.company&&(k.value.company=[])}),L(()=>d.value.departmentId,()=>{d.value.departmentId&&(k.value.departmentId=[])}),L(()=>d.value.name,()=>{var t;(t=d.value.name)!=null&&t.trim()&&(k.value.name=[])});const ne=m({open:!1}),F=m({open:!1,companyId:"",companyName:""}),v=m([]),K=m([]),Ye=se(()=>v.value.length!==K.value.length?!0:v.value.some((t,e)=>{var n;return t.locationName!==((n=K.value[e])==null?void 0:n.locationName)})),Ze=()=>{ne.value.open=!0},Je=()=>{ne.value.open=!1},Ke=t=>{F.value={open:!0,companyId:t._id,companyName:t.name};const e=[...t.locations].sort((n,o)=>n.order-o.order);v.value=e.map((n,o)=>({...n,order:o,error:""})),K.value=e.map(n=>({...n}))},De=()=>{F.value={open:!1,companyId:"",companyName:""},v.value=[],K.value=[]},Qe=()=>{const t=v.value.length;v.value.push({_id:null,locationName:"",order:t,error:""})},Xe=t=>{v.value.splice(t,1)},ea=t=>{let e=!1;return t.forEach(n=>{var o;n.error="",(o=n.locationName)!=null&&o.trim()||(n.error="請輸入地點名稱",e=!0)}),!e},aa=async()=>{if(!V.value)try{if(V.value=!0,!ea(v.value))return;const t=v.value.map(f=>f.locationName.trim()),e=new Set(t);if(t.length!==e.size){b({text:"同一公司內不能有重複的地點名稱",snackbarProps:{color:"red-lighten-1"}});return}const n=K.value,o=v.value,s=n.filter(f=>!o.some(O=>O._id===f._id)),i=o.filter(f=>!f._id||!n.some(O=>O._id===f._id)),E=o.filter(f=>f._id&&n.some(O=>O._id===f._id&&(O.locationName!==f.locationName.trim()||O.order!==f.order)));for(const f of s)await I.delete(`/companies/${F.value.companyId}/locations/${f._id}`);for(const f of i)await I.post(`/companies/${F.value.companyId}/locations`,{locationName:f.locationName.trim(),order:f.order});for(const f of E)await I.patch(`/companies/${F.value.companyId}/locations/${f._id}`,{locationName:f.locationName.trim(),order:f.order});b({text:"地點更新成功",snackbarProps:{color:"teal-lighten-1"}}),await Ve(),De()}catch(t){console.error("更新地點時發生錯誤:",t),la(t)}finally{V.value=!1}},la=t=>{var n,o,s;console.error("Error:",t);const e=((o=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:o.message)||"操作失敗";((s=t==null?void 0:t.response)==null?void 0:s.status)===401?(me.logout(),Ue.push("/login"),b({text:"登入已過期，請重新登入",snackbarProps:{color:"red-lighten-1"}})):b({text:e,snackbarProps:{color:"red-lighten-1"}})},z=m({open:!1,count:"",error:""}),ta=()=>{z.value={open:!0,count:"",error:""}},we=()=>{z.value={open:!1,count:"",error:""}},oa=()=>{const t=parseInt(z.value.count);if(!t||t<1||t>10){z.value.error="請輸入1-10之間的數字";return}z.value.error="";const e=v.value.length,n=Array(t).fill(null).map((o,s)=>({_id:null,locationName:"",order:e+s,error:""}));v.value.push(...n),we()},ze=(t,e)=>{if(e==="up"&&t===0||e==="down"&&t===v.value.length-1)return;const n=e==="up"?t-1:t+1,o={...v.value[t]};v.value[t]={...v.value[n],order:o.order},v.value[n]={...o,order:v.value[t].order}};return(t,e)=>{const n=sa("permission");return c(),y(fa,{"max-width":"1400"},{default:l(()=>[a(T,{class:"elevation-4 rounded-lg py-4 py-sm-8 px-1 px-sm-10 mt-2 mt-sm-6 mx-0 mx-sm-4 mx-md-10 mb-4 bg-white"},{default:l(()=>[a(g,{cols:"12",class:"ps-3 pb-6 d-flex align-center"},{default:l(()=>[e[21]||(e[21]=r("h3",null,"公司部門管理",-1)),$(Z)?B((c(),y(x,{key:0,icon:"mdi-information",size:"small",color:"blue-grey-darken-2",class:"ms-4"},null,512)),[[re,"人數為「在職」人數"]]):A("",!0)]),_:1}),a(g,{cols:"12"},{default:l(()=>[a(T,null,{default:l(()=>[a(g,null,{default:l(()=>[a(T,null,{default:l(()=>[$(ue)?A("",!0):(c(),y(g,{key:0,cols:"6"},{default:l(()=>[B((c(),y(p,{"prepend-icon":"mdi-domain",variant:"outlined",color:"blue-grey-darken-1",class:"me-2",block:"",onClick:xe},{default:l(()=>e[22]||(e[22]=[u(" 公司管理 ")])),_:1})),[[n,"COMPANY_CREATE"]])]),_:1})),$(ue)?A("",!0):(c(),y(g,{key:1,cols:"6"},{default:l(()=>[B((c(),y(p,{"prepend-icon":"mdi-account-multiple-plus",variant:"outlined",color:"blue-grey-darken-1",block:"",onClick:Ie},{default:l(()=>e[23]||(e[23]=[u(" 新增部門 ")])),_:1})),[[n,"DEPARTMENT_CREATE"]])]),_:1})),$(ue)?(c(),y(g,{key:2},{default:l(()=>[B((c(),y(p,{"prepend-icon":"mdi-domain",variant:"outlined",color:"blue-grey-darken-1",class:"me-4",onClick:xe},{default:l(()=>e[24]||(e[24]=[u(" 公司管理 ")])),_:1})),[[n,"COMPANY_CREATE"]]),a(p,{"prepend-icon":"mdi-office-building-marker",variant:"outlined",color:"blue-grey-darken-2",class:"me-4",onClick:Ze},{default:l(()=>e[25]||(e[25]=[u(" 公司地點 ")])),_:1}),B((c(),y(p,{"prepend-icon":"mdi-account-multiple-plus",variant:"outlined",color:"blue-grey-darken-2",onClick:Ie},{default:l(()=>e[26]||(e[26]=[u(" 新增部門 ")])),_:1})),[[n,"DEPARTMENT_CREATE"]])]),_:1})):A("",!0),a(g,{cols:"6",md:"3",lg:"2"},{default:l(()=>[a(fe,{modelValue:te.value,"onUpdate:modelValue":[e[0]||(e[0]=o=>te.value=o),e[1]||(e[1]=o=>N(!0))],items:[{name:"全部",_id:""},...ke.value],label:"選擇公司","item-title":"name","item-value":"_id",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue","items"])]),_:1}),a(g,{cols:"6",md:"3",lg:"2",class:"d-flex justify-end align-center ps-0"},{default:l(()=>[$(Z)?B((c(),y(x,{key:0,icon:"mdi-information",size:"small",color:"blue-grey-darken-2",class:"me-3"},null,512)),[[re,"可搜尋部門編號、部門名稱","top"]]):A("",!0),a(S,{modelValue:le.value,"onUpdate:modelValue":e[2]||(e[2]=o=>le.value=o),label:"快速搜尋","append-inner-icon":"mdi-magnify",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(g,{cols:"12"},{default:l(()=>[(c(),y(ya,{key:he.value,"items-per-page":J.value,"onUpdate:itemsPerPage":e[3]||(e[3]=o=>J.value=o),"sort-by":q.value,"onUpdate:sortBy":e[4]||(e[4]=o=>q.value=o),items:be.value,"items-length":ye.value,loading:pe.value,page:ae.value,headers:$e.value,"header-props":Le,"items-per-page-options":[10,20,50],density:"compact",hover:"",class:"rounded-ts-lg rounded-te-lg","onUpdate:options":qe},{item:l(({item:o,index:s})=>{var i;return[r("tr",{class:Pe({"odd-row":s%2===0,"even-row":s%2!==0})},[r("td",null,D(o.departmentId||"尚未設定"),1),$(Z)?(c(),j("td",Ca,D(((i=o.company)==null?void 0:i.name)||"未設定"),1)):A("",!0),r("td",null,D(o.name),1),r("td",null,D(o.employeeCount)+" 人",1),r("td",Va,[a(p,{icon:"",color:"light-blue-darken-4",variant:"plain",size:P.value,ripple:!1,disabled:$(me).isIT,onClick:E=>Ge(o)},{default:l(()=>[a(x,null,{default:l(()=>e[27]||(e[27]=[u("mdi-pencil")])),_:1})]),_:2},1032,["size","disabled","onClick"]),a(p,{icon:"",color:"red-lighten-1",variant:"plain",size:P.value,ripple:!1,disabled:$(me).isIT,onClick:E=>je(o)},{default:l(()=>[a(x,null,{default:l(()=>e[28]||(e[28]=[u("mdi-delete")])),_:1})]),_:2},1032,["size","disabled","onClick"])])],2)]}),_:1},8,["items-per-page","sort-by","items","items-length","loading","page","headers"]))]),_:1})]),_:1})]),_:1})]),_:1}),a(Y,{modelValue:oe.value.open,"onUpdate:modelValue":e[6]||(e[6]=o=>oe.value.open=o),persistent:"","max-width":"940"},{default:l(()=>[a(H,{class:"rounded-lg ps-8 pe-4 py-4"},{default:l(()=>[r("div",xa,[e[29]||(e[29]=u(" 公司管理 ")),a(p,{icon:"mdi-close",color:"red-lighten-1",variant:"plain",size:P.value,onClick:Be},null,8,["size"])]),a(W,{class:"ps-2"},{default:l(()=>[a(T,null,{default:l(()=>[a(g,{cols:"7",class:"px-5 border rounded-lg"},{default:l(()=>[a(T,null,{default:l(()=>[a(g,{class:"card-subtitle text-blue-grey-darken-2 pt-3 mb-4"},{default:l(()=>e[30]||(e[30]=[u(" 現有公司列表 ")])),_:1})]),_:1}),r("div",_a,[(c(!0),j(ie,null,de(ke.value,o=>(c(),y(Ee,{key:o._id,color:"blue-grey-darken-2",label:"",class:"me-4 mb-2 pa-4 pe-1"},{default:l(()=>[r("span",Ia,D(o.companyId)+" ",1),u(" "+D(o.name)+" ",1),a(ga,null,{activator:l(({props:s})=>[a(p,da({icon:"",size:"x-small",variant:"text",class:"ms-2",ripple:!1,color:"white",ref_for:!0},s),{default:l(()=>[a(x,{color:"cyan-darken-3"},{default:l(()=>e[31]||(e[31]=[u(" mdi-dots-vertical ")])),_:1})]),_:2},1040)]),default:l(()=>[a(ba,{density:"compact"},{default:l(()=>[a(Te,{density:"compact",class:"ps-2 pe-3 py-0",onClick:s=>Se(o)},{default:l(()=>[a(x,{icon:"mdi-pencil",size:"16",color:"light-blue-darken-4"}),e[32]||(e[32]=r("span",{class:"ps-2 text-blue-grey-darken-2",style:{"font-size":"14px"}},"編輯",-1))]),_:2},1032,["onClick"]),a(Te,{density:"compact",class:"ps-2 pe-3 py-0",color:"red-lighten-1",onClick:s=>Fe(o)},{default:l(()=>[a(x,{icon:"mdi-delete",size:"16",color:"red-lighten-1"}),e[33]||(e[33]=r("span",{class:"ps-2 text-blue-grey-darken-2",style:{"font-size":"14px"}},"刪除",-1))]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))])]),_:1}),a(G),a(g,{cols:"4",class:"border rounded-lg px-4 pt-4"},{default:l(()=>[a(T,null,{default:l(()=>[a(g,{cols:"12",class:"card-subtitle text-blue-grey-darken-2 mb-4"},{default:l(()=>e[34]||(e[34]=[u(" 新增公司 ")])),_:1})]),_:1}),a(X,{onSubmit:Q(Ae,["prevent"])},{default:l(()=>[a(S,{modelValue:M.value.name,"onUpdate:modelValue":e[5]||(e[5]=o=>M.value.name=o),"error-messages":R.value,label:"新增公司",required:"",variant:"outlined",density:"compact"},null,8,["modelValue","error-messages"]),a(ee,{class:"pa-0 mt-2"},{default:l(()=>[a(G),a(p,{color:"teal-darken-1",variant:"outlined",type:"submit",size:"small",loading:V.value},{default:l(()=>e[35]||(e[35]=[u(" 新增 ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(Y,{modelValue:C.value.open,"onUpdate:modelValue":e[9]||(e[9]=o=>C.value.open=o),persistent:"",width:"320"},{default:l(()=>[a(H,{class:"rounded-lg pa-4"},{default:l(()=>[e[38]||(e[38]=r("div",{class:"card-title px-4 py-3"}," 編輯公司 ",-1)),a(W,{class:"pb-1 px-4"},{default:l(()=>[a(X,{onSubmit:Q(Me,["prevent"])},{default:l(()=>[a(S,{modelValue:C.value.companyId,"onUpdate:modelValue":e[7]||(e[7]=o=>C.value.companyId=o),label:"公司編號",variant:"outlined",density:"compact",class:"mb-4"},null,8,["modelValue"]),a(S,{modelValue:C.value.name,"onUpdate:modelValue":e[8]||(e[8]=o=>C.value.name=o),"error-messages":ce.value,label:"公司名稱",required:"",variant:"outlined",density:"compact"},null,8,["modelValue","error-messages"]),a(ee,{class:"pa-0 mt-2"},{default:l(()=>[a(G),a(p,{color:"grey-darken-1",variant:"outlined",onClick:_e},{default:l(()=>e[36]||(e[36]=[u(" 取消 ")])),_:1}),a(p,{color:"teal-darken-1",variant:"outlined",type:"submit",loading:V.value,class:"ms-2"},{default:l(()=>e[37]||(e[37]=[u(" 修改 ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(Ne,{modelValue:U.value.open,"onUpdate:modelValue":e[10]||(e[10]=o=>U.value.open=o),title:"確認刪除公司",message:`確定要刪除公司「<span class='text-pink-lighten-1' style='font-weight: 800;'>${U.value.name}</span>」嗎？此操作無法復原。`,"expected-name":U.value.name,"input-label":"公司名稱",onConfirm:Oe},null,8,["modelValue","message","expected-name"]),a(Ne,{modelValue:h.value.open,"onUpdate:modelValue":e[11]||(e[11]=o=>h.value.open=o),title:"確認刪除部門",message:`確定要刪除「<span class='text-teal-darken-2' style='font-weight: 800;'>${h.value.companyName}</span>」的「<span class='text-pink-lighten-1' style='font-weight: 800;'>${h.value.name}</span>」嗎？此操作無法復原。`,"expected-name":h.value.name,"input-label":"部門名稱",onConfirm:He},null,8,["modelValue","message","expected-name"]),a(Y,{modelValue:_.value.open,"onUpdate:modelValue":e[16]||(e[16]=o=>_.value.open=o),persistent:"",width:"320"},{default:l(()=>[a(H,{class:"rounded-lg px-2 pt-4"},{default:l(()=>[r("div",Da,D(_.value.id?"編輯部門":"新增部門"),1),a(W,null,{default:l(()=>[a(X,{onSubmit:Q(We,["prevent"])},{default:l(()=>{var o;return[a(fe,{modelValue:d.value.company,"onUpdate:modelValue":e[12]||(e[12]=s=>d.value.company=s),items:w.value,"item-title":s=>s?`${s.name} (${s.companyId})`:"","item-value":"_id",label:"*選擇公司",required:"",variant:"outlined",density:"compact",class:"mb-3","error-messages":k.value.company},null,8,["modelValue","items","item-title","error-messages"]),a(fe,{modelValue:d.value.departmentCode,"onUpdate:modelValue":e[13]||(e[13]=s=>d.value.departmentCode=s),items:Ce,"item-title":"name","item-value":"code",label:"參考部門代碼 ( 可不選 )",required:"",clearable:"",hint:"選擇後，會自動帶入部門編號及部門名稱","persistent-hint":"",variant:"outlined",density:"compact",class:"mb-3","error-messages":k.value.departmentCode,disabled:!d.value.company},null,8,["modelValue","error-messages","disabled"]),a(S,{modelValue:d.value.departmentId,"onUpdate:modelValue":e[14]||(e[14]=s=>d.value.departmentId=s),label:"*部門編號",required:"",variant:"outlined",density:"compact",class:"mb-3",clearable:"","error-messages":k.value.departmentId,hint:d.value.company?"建議輸入「公司編號 + 部門代碼」":"請先選擇公司","persistent-hint":"",disabled:!d.value.company},null,8,["modelValue","error-messages","hint","disabled"]),a(S,{modelValue:d.value.name,"onUpdate:modelValue":e[15]||(e[15]=s=>d.value.name=s),label:"*部門名稱",required:"",variant:"outlined",density:"compact",clearable:"","error-messages":(o=k.value)==null?void 0:o.name,hint:"請輸入部門名稱","persistent-hint":"",disabled:!d.value.company},null,8,["modelValue","error-messages","disabled"]),a(ee,{class:"pa-0 mt-2"},{default:l(()=>[a(G),a(p,{color:"grey-darken-1",variant:"outlined",size:P.value,onClick:ve},{default:l(()=>e[39]||(e[39]=[u(" 取消 ")])),_:1},8,["size"]),a(p,{color:"teal-darken-1",variant:"outlined",type:"submit",size:P.value,loading:V.value,class:"ms-2"},{default:l(()=>[u(D(_.value.id?"修改":"新增"),1)]),_:1},8,["size","loading"])]),_:1})]}),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(Y,{modelValue:ne.value.open,"onUpdate:modelValue":e[17]||(e[17]=o=>ne.value.open=o),"max-width":"1200"},{default:l(()=>[a(H,{class:"rounded-lg px-2 py-4"},{default:l(()=>[r("div",wa,[e[40]||(e[40]=u(" 公司地點管理 ")),a(p,{icon:"mdi-close",color:"red-lighten-1",variant:"plain",size:P.value,onClick:Je},null,8,["size"])]),a(W,null,{default:l(()=>[a(T,null,{default:l(()=>[a(g,{cols:"12"},{default:l(()=>[a(ka,{density:"compact",class:"rounded-ts-lg rounded-te-lg"},{default:l(()=>[e[42]||(e[42]=r("thead",null,[r("tr",null,[r("th",null,"公司"),r("th",null,"地點"),r("th",{class:"text-center"}," 操作 ")])],-1)),r("tbody",null,[(c(!0),j(ie,null,de(w.value,(o,s)=>(c(),j("tr",{key:o._id,class:Pe({"odd-row":s%2===0,"even-row":s%2!==0})},[r("td",za,D(o.name),1),r("td",Pa,[(c(!0),j(ie,null,de([...o.locations].sort((i,E)=>i.order-E.order),i=>(c(),y(Ee,{key:i._id,class:"me-2 mb-2",variant:"outlined",color:"blue-grey-darken-2",label:""},{default:l(()=>[u(D(i.locationName),1)]),_:2},1024))),128))]),r("td",Na,[a(p,{icon:"",color:"light-blue-darken-4",variant:"plain",size:P.value,ripple:!1,onClick:i=>Ke(o)},{default:l(()=>[a(x,null,{default:l(()=>e[41]||(e[41]=[u("mdi-pencil")])),_:1})]),_:2},1032,["size","onClick"])])],2))),128))])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(Y,{modelValue:F.value.open,"onUpdate:modelValue":e[18]||(e[18]=o=>F.value.open=o),persistent:"",width:"400"},{default:l(()=>[a(H,{class:"rounded-lg px-4 pt-7 pb-6"},{default:l(()=>[a(X,{onSubmit:Q(aa,["prevent"])},{default:l(()=>[r("div",Ea,[e[45]||(e[45]=r("span",null,"新增 / 編輯公司地點",-1)),r("div",null,[B((c(),y(p,{icon:"",color:"grey-darken-1",size:"22",class:"me-2",onClick:ta},{default:l(()=>[a(x,{size:"14"},{default:l(()=>e[43]||(e[43]=[u(" mdi-plus-box-multiple-outline ")])),_:1})]),_:1})),[[re,"批量新增地點","start"]]),B((c(),y(p,{icon:"",color:"grey-darken-1",size:"22",onClick:Qe},{default:l(()=>[a(x,{size:"14"},{default:l(()=>e[44]||(e[44]=[u(" mdi-plus ")])),_:1})]),_:1})),[[re,"新增地點","start"]])])]),a(W,{class:"mt-3 pa-3"},{default:l(()=>[a(T,null,{default:l(()=>[(c(!0),j(ie,null,de(v.value,(o,s)=>(c(),y(g,{key:s,cols:"12",class:"mt-4"},{default:l(()=>[r("div",Ta,[a(T,null,{default:l(()=>[a(g,{cols:"9",class:"d-flex align-center pe-0"},{default:l(()=>[r("div",Ua,D(s+1),1),a(S,{modelValue:o.locationName,"onUpdate:modelValue":i=>o.locationName=i,"error-messages":o.error,label:"*地點名稱",type:"text",variant:"outlined",density:"compact",clearable:"","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue","error-messages"])]),_:2},1024),a(g,{cols:"3",class:"d-flex align-center"},{default:l(()=>[r("div",ha,[r("div",La,[s>0?(c(),y(p,{key:0,icon:"",variant:"text",color:"grey-darken-1",size:"18",ripple:!1,class:"me-1",onClick:i=>ze(s,"up")},{default:l(()=>[a(x,{size:"18"},{default:l(()=>e[46]||(e[46]=[u(" mdi-chevron-up ")])),_:1})]),_:2},1032,["onClick"])):A("",!0),s<v.value.length-1?(c(),y(p,{key:1,icon:"",variant:"text",color:"grey-darken-1",size:"18",ripple:!1,class:"me-1",onClick:i=>ze(s,"down")},{default:l(()=>[a(x,{size:"18"},{default:l(()=>e[47]||(e[47]=[u(" mdi-chevron-down ")])),_:1})]),_:2},1032,["onClick"])):A("",!0)]),a(p,{icon:"",variant:"text",color:"red-lighten-1",size:"20",onClick:i=>Xe(s)},{default:l(()=>[a(x,{size:"18"},{default:l(()=>e[48]||(e[48]=[u(" mdi-delete ")])),_:1})]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024)])]),_:2},1024))),128))]),_:1})]),_:1}),a(ee,{class:"px-3 pt-4"},{default:l(()=>[a(G),a(p,{color:"grey-darken-1",variant:"outlined",size:P.value,onClick:De},{default:l(()=>e[49]||(e[49]=[u(" 取消 ")])),_:1},8,["size"]),a(p,{color:"teal-darken-1",variant:"outlined",type:"submit",class:"ms-2",size:P.value,loading:V.value,disabled:!Ye.value},{default:l(()=>e[50]||(e[50]=[u(" 確定 ")])),_:1},8,["size","loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(Y,{modelValue:z.value.open,"onUpdate:modelValue":e[20]||(e[20]=o=>z.value.open=o),persistent:"",width:"300"},{default:l(()=>[a(H,{class:"rounded-lg px-4 pt-7 pb-6"},{default:l(()=>[a(X,{onSubmit:Q(oa,["prevent"])},{default:l(()=>[e[53]||(e[53]=r("div",{class:"card-title px-4 pb-2"}," 批量新增地點 ",-1)),a(W,{class:"mt-3 pa-3"},{default:l(()=>[a(S,{modelValue:z.value.count,"onUpdate:modelValue":e[19]||(e[19]=o=>z.value.count=o),label:"請輸入要新增的地點數量",type:"number",min:"1",max:"10",variant:"outlined",density:"compact","error-messages":z.value.error,"hide-details":"auto"},null,8,["modelValue","error-messages"])]),_:1}),a(ee,{class:"px-3 pt-4"},{default:l(()=>[a(G),a(p,{color:"grey-darken-1",variant:"outlined",size:"small",onClick:we},{default:l(()=>e[51]||(e[51]=[u(" 取消 ")])),_:1}),a(p,{color:"teal-darken-1",variant:"outlined",class:"ms-1",size:"small",type:"submit"},{default:l(()=>e[52]||(e[52]=[u(" 確定 ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}},ol=ra($a,[["__scopeId","data-v-cde9ddb3"]]);export{ol as default};

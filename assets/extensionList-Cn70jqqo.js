import{_ as J,b as M}from"./index-mGnb0KKF.js";import{i as Q}from"./vuetify-use-dialog-C5oZ13xz.js";import{l as R}from"./lodash-CiJWSuVn.js";import{Q as Z,w as V,a as k,f as $,A as L,c as A,v as T,P as z,d as G,g as K,r as y,J as W,b as B}from"./vuetify-CbddcmEc.js";import{r as f,a as X,f as j,w as Y,k as ee,aV as r,Z as I,bH as n,a8 as s,a0 as l,a7 as C,$ as c,F as P,b0 as S,bf as _}from"./@vue-Cr_z6yfx.js";/* empty css             */import"./pinia-DBRIaiZ_.js";import"./vue-demi-Dq6ymT-8.js";import"./pinia-plugin-persistedstate-RV7uh3T-.js";import"./vue-router-CS4OewbW.js";import"./jspdf-DacfHTdZ.js";import"./core-js-D2hAHviU.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./unplugin-vue-router-B1N3mqWX.js";import"./axios-upsvKRUO.js";import"./vue3-google-login-Dx7TV_Hx.js";import"./vue-easy-lightbox-D952uME8.js";import"./perfect-debounce-Cp2ysxOb.js";import"./hookable-B8xFkYCm.js";const ae={class:"d-flex align-center px-4 px-sm-6"},te={class:"d-flex flex-column"},se={class:"d-flex flex-column"},le={class:"d-flex flex-column"},ne={class:"d-flex align-end pt-3 pb-2 ms-auto ms-sm-1 me-1"},oe={key:0,class:"text-center py-8"},ie={key:1,class:"text-center py-8"},re={key:2,class:"extension-list"},de={class:"company-title-section"},ce={class:"departments-grid"},me={class:"employees-grid px-1"},pe={class:"employee-info"},ue={class:"employee-name"},fe={class:"employee-details"},ve={class:"employee-job-title"},ye={class:"employee-extension pe-4"},_e={__name:"extensionList",setup(xe){const{apiAuth:w}=M(),x=Q(),v=f(!1),g=f(!1),m=f([]),p=f([]),b=f([]),o=X({company:null,department:null}),u=f(""),N=j(()=>{let t=m.value;if(o.company&&(t=t.filter(a=>a.company._id===o.company)),o.department&&(t=t.filter(a=>a.department._id===o.department)),u.value){const a=u.value.toLowerCase();t=t.filter(e=>e.name.toLowerCase().includes(a)||e.extNumber.includes(a)||e.employeeCode.toLowerCase().includes(a))}return t}),F=j(()=>{const t={};return N.value.forEach(e=>{if(!e.company||!e.department)return;const i=e.company._id,d=e.company.name,h=e.department._id,H=e.department.name;t[i]||(t[i]={_id:i,name:d,departments:{}}),t[i].departments[h]||(t[i].departments[h]={_id:h,name:H,employees:[]}),t[i].departments[h].employees.push(e)}),Object.values(t).map(e=>({...e,departments:Object.values(e.departments).sort((i,d)=>i.employees.length-d.employees.length)}))}),U=()=>{o.company=null,o.department=null,u.value="",E()},D=async()=>{var t,a;if(o.department=null,!o.company){b.value=[];return}try{const{data:e}=await w.get("/departments/suggestions",{params:{company:o.company}});e.success&&(b.value=e.result)}catch(e){console.error("載入部門列表失敗:",e),x({text:((a=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:a.message)||"載入部門列表失敗",snackbarProps:{color:"red-lighten-1"}}),b.value=[]}},E=async()=>{var t,a;if(!v.value){v.value=!0;try{const{data:e}=await w.get("/employees/all",{params:{status:"在職",itemsPerPage:-1}});e.success?Array.isArray(e.result)?m.value=e.result:e.result&&Array.isArray(e.result.data)?m.value=e.result.data:m.value=[]:m.value=[]}catch(e){console.error("取得員工資料失敗:",e),x({text:((a=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:a.message)||"取得員工資料失敗",snackbarProps:{color:"red-lighten-1"}}),m.value=[]}finally{v.value=!1,g.value=!1}}},O=async()=>{var t,a;try{const{data:e}=await w.get("/companies/all");e.success?Array.isArray(e.result)?p.value=e.result:e.result&&Array.isArray(e.result.data)?p.value=e.result.data:p.value=[]:p.value=[]}catch(e){console.error("取得公司列表失敗:",e),x({text:((a=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:a.message)||"取得公司列表失敗",snackbarProps:{color:"red-lighten-1"}}),p.value=[]}},q=R.debounce(()=>{g.value=!1},300);return Y(u,t=>{t!==void 0&&(g.value=!0,q())}),ee(async()=>{try{await O(),await E()}catch(t){console.error("初始化失敗:",t),x({text:"初始化失敗",snackbarProps:{color:"red-lighten-1"}})}finally{v.value=!1}}),(t,a)=>(r(),I(Z,{"max-width":"2400"},{default:n(()=>[s(T,{class:"pt-md-6 px-0 px-md-4"},{default:n(()=>[s(V,{cols:"12"},{default:n(()=>[s(k,{class:"elevation-4 rounded-lg pt-6 py-md-7 px-0"},{default:n(()=>[l("div",ae,[a[3]||(a[3]=l("h3",null," 分機表 ",-1)),s($)]),s(L,{class:"mt-5 mb-1 mb-sm-3"}),s(A,{class:"pt-4 px-6 ps-sm-8 pe-sm-7 px-md-9 pb-2"},{default:n(()=>[s(T,{class:"mb-2"},{default:n(()=>[s(V,{cols:"12",sm:"6",md:"3",lg:"2",class:"px-1 pe-sm-2 py-1"},{default:n(()=>[l("div",te,[a[4]||(a[4]=l("span",{class:"text-label"},"公司 :",-1)),s(z,{modelValue:o.company,"onUpdate:modelValue":[a[0]||(a[0]=e=>o.company=e),D],items:p.value,"item-title":e=>e&&e.name?e.name:"","item-value":"_id",variant:"outlined",density:"compact",clearable:"",placeholder:"請選擇公司","hide-details":"",disabled:!1},null,8,["modelValue","items","item-title"])])]),_:1}),s(V,{cols:"12",sm:"6",md:"3",lg:"2",class:"px-1 pe-sm-2 py-1"},{default:n(()=>[l("div",se,[a[5]||(a[5]=l("span",{class:"text-label"},"部門 :",-1)),s(z,{modelValue:o.department,"onUpdate:modelValue":a[1]||(a[1]=e=>o.department=e),items:b.value,"item-title":e=>e&&e.name?e.name:"","item-value":"_id",variant:"outlined",density:"compact",clearable:"",placeholder:o.company?"請選擇部門":"請先選擇公司","hide-details":"",disabled:!o.company},null,8,["modelValue","items","item-title","placeholder","disabled"])])]),_:1}),s(V,{cols:"12",sm:"6",md:"3",lg:"2",class:"px-1 pe-sm-2 py-1"},{default:n(()=>[l("div",le,[a[6]||(a[6]=l("span",{class:"text-label"},"快速搜尋 :",-1)),s(G,{modelValue:u.value,"onUpdate:modelValue":a[2]||(a[2]=e=>u.value=e),loading:g.value,density:"compact",variant:"outlined",label:"搜尋姓名、分機號碼","append-inner-icon":"mdi-magnify","hide-details":"",clearable:"",disabled:!1},null,8,["modelValue","loading"])])]),_:1}),l("div",ne,[s(K,{color:"grey",elevation:"1",disabled:!1,onClick:U},{default:n(()=>[s(y,null,{default:n(()=>a[7]||(a[7]=[C(" mdi-refresh ")])),_:1})]),_:1})])]),_:1})]),_:1}),s(L,{class:"my-0"}),s(A,{class:"px-sm-6 px-md-7"},{default:n(()=>[v.value?(r(),c("div",oe,[s(W,{indeterminate:"",color:"blue-grey-darken-1",size:"64",width:"6"}),a[8]||(a[8]=l("div",{class:"mt-4 text-grey-darken-1"}," 載入中... ",-1))])):N.value.length===0?(r(),c("div",ie,[s(y,{icon:"mdi-phone-off",size:"64",color:"grey-lighten-1",class:"mb-4"}),a[9]||(a[9]=l("div",{class:"text-grey-lighten-1"}," 找不到符合條件的員工 ",-1))])):(r(),c("div",re,[(r(!0),c(P,null,S(F.value,e=>(r(),c("div",{key:e._id,class:"company-section mb-8"},[l("div",de,[s(B,{class:"company-title"},{default:n(()=>[s(y,{icon:"mdi-domain",size:"20",class:"me-2"}),C(" "+_(e.name),1)]),_:2},1024)]),s(k,{class:"company-content-card elevation-0 px-4 py-5"},{default:n(()=>[l("div",ce,[(r(!0),c(P,null,S(e.departments,i=>(r(),c("div",{key:i._id,class:"department-section"},[s(k,{class:"department-content-card elevation-0 pa-3",variant:"outlined"},{default:n(()=>[s(B,{class:"department-title ps-1 pt-1 pb-3"},{default:n(()=>[s(y,{icon:"mdi-office-building",size:"18",class:"me-2"}),C(" "+_(i.name),1)]),_:2},1024),l("div",me,[(r(!0),c(P,null,S(i.employees,d=>(r(),I(k,{key:d._id,class:"employee-card elevation-1",variant:"outlined",elevation:"0"},{default:n(()=>[s(A,{class:"employee-content"},{default:n(()=>[l("div",pe,[l("div",ue,_(d.name),1),l("div",fe,[l("div",ve,_(d.jobTitle),1)]),l("div",ye,[s(y,{icon:"mdi-phone",size:"14",class:"me-1"}),C(" "+_(d.extNumber),1)])])]),_:2},1024)]),_:2},1024))),128))])]),_:2},1024)]))),128))])]),_:2},1024)]))),128))]))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}},De=J(_e,[["__scopeId","data-v-c3f9a1cb"]]);export{De as default};

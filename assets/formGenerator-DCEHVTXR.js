const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-DfhK04sP.js","./index-mGnb0KKF.js","./vuetify-CbddcmEc.js","./@vue-Cr_z6yfx.js","./perfect-debounce-Cp2ysxOb.js","./hookable-B8xFkYCm.js","./vuetify-D3A1gk-Q.css","./pinia-DBRIaiZ_.js","./vue-demi-Dq6ymT-8.js","./pinia-plugin-persistedstate-RV7uh3T-.js","./vue-router-CS4OewbW.js","./jspdf-DacfHTdZ.js","./core-js-D2hAHviU.js","./@babel-BsCcpEdk.js","./fflate-EnPhvkmS.js","./unplugin-vue-router-B1N3mqWX.js","./axios-upsvKRUO.js","./vuetify-use-dialog-C5oZ13xz.js","./vue3-google-login-Dx7TV_Hx.js","./vue-easy-lightbox-D952uME8.js","./index-BNzbzbxs.css","./@mdi-f3sFGprf.css","./index-DZjk5X9s.css","./RayHuangQuotationFormFields-BSMJDykW.js","./index-tr1HQ6FB.js","./index-YoGXTnCy.css","./YstravelQuotationFormFields-ZNRyapvk.js","./html2pdf.js-CvqxwkGD.js","./html2canvas-CqpzYDn4.js"])))=>i.map(i=>d[i]);
import{_ as h}from"./jspdf-DacfHTdZ.js";import{r as s,f as oa,x as wt,w as $,k as kt,aV as w,Z as C,bH as o,b2 as _t,b3 as Dt,a8 as l,bJ as fe,bB as Vt,u as Pe,a0 as d,_ as U,a7 as v,bf as R,$ as ge,F as ra,b4 as Pt,b0 as Ia,aG as Tt,bM as na,aa as He,n as z}from"./@vue-Cr_z6yfx.js";import{i as Et}from"./vuetify-use-dialog-C5oZ13xz.js";import{_ as ht,u as Nt,a as Ct,b as Rt}from"./index-mGnb0KKF.js";import{l as It}from"./lodash-CiJWSuVn.js";import{C as St}from"./ConfirmDeleteDialogWithTextField-C3L40kcN.js";import{_ as At}from"./ConfirmDeleteDialog-CuZPFffe.js";import{_ as $t}from"./ConfirmDialog-CJtUY0XN.js";import{q as Ft,Q as Ot,w as p,v as D,r as S,T as Me,g as x,P as Z,a as M,c as q,J as sa,A as Ut,F as zt,C as Lt,D as jt,x as Sa,f as ne,U as ua,d as Te,e as qe,V as Ee,b as ia,Z as Ht,ab as Mt,ac as qt,a3 as Qt,a4 as da}from"./vuetify-CbddcmEc.js";import"./core-js-D2hAHviU.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./perfect-debounce-Cp2ysxOb.js";import"./hookable-B8xFkYCm.js";/* empty css             */import"./pinia-DBRIaiZ_.js";import"./vue-demi-Dq6ymT-8.js";import"./pinia-plugin-persistedstate-RV7uh3T-.js";import"./vue-router-CS4OewbW.js";import"./unplugin-vue-router-B1N3mqWX.js";import"./axios-upsvKRUO.js";import"./vue3-google-login-Dx7TV_Hx.js";import"./vue-easy-lightbox-D952uME8.js";const Yt={class:"d-flex align-center justify-space-between mb-4 px-4 pt-4"},Bt={class:"d-flex flex-column align-center justify-center",style:{"min-height":"121px"}},Gt={class:"card-title px-6 pt-6 text-grey-darken-3 d-flex justify-space-between"},Wt={class:"text-grey font-weight-medium"},Jt={key:0,class:"d-flex flex-column align-center justify-center",style:{"min-height":"200px"}},Zt={class:"card-title pb-2 d-flex justify-space-between align-center"},Xt={class:"mb-8"},Kt={class:"border rounded-lg px-4 py-4"},el={class:"text-center"},al={key:0},tl={class:"d-flex justify-center mt-4"},ll={class:"text-center mb-6"},ol={style:{"font-size":"14px"}},rl={__name:"formGenerator",setup(nl){const Aa=He(()=>h(()=>import("./index-DfhK04sP.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]),import.meta.url)),ma=He(()=>h(()=>import("./RayHuangQuotationFormFields-BSMJDykW.js"),__vite__mapDeps([23,2,3,4,5,6]),import.meta.url)),$a=He(()=>h(()=>import("./index-tr1HQ6FB.js"),__vite__mapDeps([24,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,25]),import.meta.url)),ca=He(()=>h(()=>import("./YstravelQuotationFormFields-ZNRyapvk.js"),__vite__mapDeps([26,2,3,4,5,6]),import.meta.url)),pa=s(null),va=s(null),he=s(null),Qe=s(null),Ye=s(null),Ne=async()=>{try{const t=await h(()=>import("./schema-Z4XoiBve.js"),[],import.meta.url),e=await h(()=>import("./schema-CraYRe9n.js"),[],import.meta.url);pa.value=t.quotationSchema,va.value=e.quotationSchema;const r=await h(()=>import("./html2pdf.js-CvqxwkGD.js").then(i=>i.h),__vite__mapDeps([27,12,11,13,14,28]),import.meta.url),n=await h(()=>import("./jspdf-DacfHTdZ.js").then(i=>i.j),__vite__mapDeps([11,12,13,14]),import.meta.url),a=await h(()=>import("./html2canvas-CqpzYDn4.js").then(i=>i.a),__vite__mapDeps([28,12]),import.meta.url);he.value=r.default,Qe.value=n.jsPDF,Ye.value=a.default}catch(t){console.error("載入相依套件失敗:",t),c({text:"載入相依套件失敗",snackbarProps:{color:"red-lighten-1"}})}},{smAndUp:fa,lgAndUp:ga}=Ft(),{apiAuth:_}=Rt(),c=Et(),X=Nt(),ba=Ct(),se=oa(()=>fa.value?"default":"small"),Fa=t=>{var n,a,i;if(ba.hasPermission("FORM_UPDATE"))return!0;const e=X.isAdmin?X.adminId:X.userId;return(((n=t==null?void 0:t.creator)==null?void 0:n.role)===2?(a=t==null?void 0:t.creator)==null?void 0:a.adminId:(i=t==null?void 0:t.creator)==null?void 0:i.userId)===e},Oa=t=>{var n,a,i;if(ba.hasPermission("FORM_DELETE"))return!0;const e=X.isAdmin?X.adminId:X.userId;return(((n=t==null?void 0:t.creator)==null?void 0:n.role)===2?(a=t==null?void 0:t.creator)==null?void 0:a.adminId:(i=t==null?void 0:t.creator)==null?void 0:i.userId)===e},be=s(!1),Ua=()=>{be.value=!be.value},N=s(null),L=s(null),j=s([]),ya=s(null),ye=s(null),Ce=s(""),F=wt(null),H=s(!1),Re=s(!1),ee=s(!1),Be={RayHuangQuotationTemplate:{preview:Aa,fields:ma,schema:pa},YstravelQuotationTemplate:{preview:$a,fields:ca,schema:va}},ue=[{title:"報價單",value:"quotation"}],g=s({}),ie=t=>{switch(t){case"RayHuangQuotationTemplate":g.value={date:new Date,customerName:"",customerAddress:"",customerTaxId:"",customerContact:"",customerDepartment:"",customerPhone:"",customerEmail:"",customerMobile:"",projectType:"",projectName:"",workDays:"",specialNote:"",validityDays:"",delayDays:"",includeContract:!1,currentPage:"quotation",items:[{name:"",description:"",workDays:"",quantity:1,unit:"份",price:""}],contract:{page1:{partyA:"",partyB:"銳皇國際股份有限公司",projectName:"",totalAmount:"",estimatedWorkDays:"X",contractYear:"",contractMonth:"",contractDay:"",depositAmount:"",paymentMethod:{singlePayment:!1,singlePaymentDate:{year:"",month:"",day:""},deposit:!1,depositAmount:"",depositDate:{year:"",month:"",day:""},finalPaymentAmount:"",finalPaymentDate:{year:"",month:"",day:""}},paymentType:{cash:!1,transfer:!1,check:!1,checkDate:{year:"",month:"",day:""}}},page2:{designProposalCount:"",responseDay:"",designRevisionCount:"",printRevisionCount:"",providedItems:""},page3:{otherAgreements:"",partyA:{companyName:"",representative:"",address:"",phone:"",taxId:""},partyB:{companyName:"銳皇國際股份有限公司",representative:"陳淑貞",address:"10467 台北市中山區松江路 220 號 4 樓之 5",phone:"02-25623385",taxId:"83213438"}}}};break;case"YstravelQuotationTemplate":g.value={date:new Date,customerName:"",customerAddress:"",customerTaxId:"",contactPerson:"",position:"",officePhone:"",fax:"",mobile:"",projectName:"",destination:"",departureDate:new Date,returnDate:new Date,items:[{category:"",description:"",unitPrice:0,quantity:1,unit:"人",remark:""}],cancellationPolicy:"",validityPeriod:7,includeContract:!1,currentPage:"quotation",contract:null};break;default:g.value={includeContract:!1,currentPage:"quotation",contract:null}}},Ie=s({open:!1}),V=s({open:!1,id:"",name:"",type:"",componentName:""}),Q=s({open:!1,id:"",name:""}),P=s({name:"",type:"",componentName:""}),T=s({type:"",name:"",componentName:""}),ae=s({name:"",type:"",componentName:""}),de=s(!1),I=s([]),xe=s(null),za=oa(()=>xe.value?I.value.filter(t=>t.type===xe.value):I.value),xa=async t=>{if(!t){F.value=null,H.value=!1,ie();return}try{Re.value=!0,H.value=!1,F.value=null,ee.value=!1;const{data:e}=await _.get(`/formTemplates/${t}`);if(e.success){const r=e.result,n=Be[r.componentName];if(n)try{let a=null;switch(r.componentName){case"RayHuangQuotationTemplate":{const i=await _.get("/forms/ray-huang-quotation/next-number",{params:{templateId:t}});i.data.success&&(a=i.data.result);break}case"YstravelQuotationTemplate":{const i=await _.get("/forms/ystravel-quotation/next-number",{params:{templateId:t}});i.data.success&&(a=i.data.result);break}default:throw new Error("未知的模板類型")}if(!a)throw new Error("無法取得單號");ie(r.componentName),g.value={...g.value,formNumber:a},await z(),F.value=n.preview,await z(),ee.value=!0,H.value=!0}catch(a){throw console.error("取得單號失敗:",a),c({text:"取得單號失敗",snackbarProps:{color:"red-lighten-1"}}),a}else throw new Error("找不到對應的組件")}}catch(e){console.error("載入失敗:",e),F.value=null,ie(),H.value=!1,c({text:e.message||"載入失敗",snackbarProps:{color:"red-lighten-1"}})}finally{Re.value=!1}},we=s(!1),Y=s(1),Ge=s(10),We=s(0),wa=oa(()=>Math.ceil(We.value/Ge.value)),te=s(""),La=t=>{Y.value=t,me()},me=async()=>{var t;if(!we.value){we.value=!0;try{const e={page:Y.value,itemsPerPage:Ge.value,sort:"createdAt",order:"desc"};if(te.value&&(e.quickSearch=te.value),b.value.type&&(e.type=b.value.type),b.value.formTemplate&&(e.formTemplate=b.value.formTemplate),(t=b.value.date)!=null&&t.length){const n=new Date(b.value.date[0]);n.setHours(0,0,0,0),e.startDate=n.toISOString();const a=b.value.date.length>1?new Date(b.value.date[b.value.date.length-1]):new Date(b.value.date[0]);a.setHours(23,59,59,999),e.endDate=a.toISOString()}const{data:r}=await _.get("/forms",{params:e});r.success&&(Fe.value=r.result.data,We.value=r.result.totalItems,Y.value=r.result.currentPage)}catch(e){console.error("搜尋失敗:",e),c({text:"載入歷史紀錄失敗",snackbarProps:{color:"red-lighten-1"}})}finally{we.value=!1}}},ja=It.debounce(()=>{Y.value=1,me()},300);$(te,()=>{ja()});const ka=async()=>{b.value={type:"",formTemplate:"",date:[]},te.value="",ce.value=[],Y.value=1,await me()},Je=s(!1),Se=s(!1),Ha=async()=>{var t,e,r;try{if(Je.value=!0,ee.value=!0,!await((t=ye.value)==null?void 0:t.validate())){c({text:"請填寫必填欄位",snackbarProps:{color:"red-lighten-1"}});return}const{data:a}=await _.patch(`/forms/${De.value}`,{formNumber:g.value.formNumber,formData:{...g.value,formNumber:void 0},lastEditor:X.userId});if(!a.success)throw new Error(a.message||"更新表單失敗");await nt(),c({text:"表單更新成功",snackbarProps:{color:"teal-lighten-1"}})}catch(n){console.error("更新表單失敗:",n);const a=((r=(e=n.response)==null?void 0:e.data)==null?void 0:r.message)||"更新表單失敗";c({text:a,snackbarProps:{color:"red-lighten-1"}})}finally{Je.value=!1}},ke=s(!1),Ze=s("quotation"),Ma=async()=>{g.value.includeContract?ke.value=!0:await _a("quotation")},qa=async()=>{await _a(Ze.value),ke.value=!1},_a=async t=>{var e,r;if(!Se.value)try{if(Se.value=!0,ze.value=!0,Le.value=0,ee.value=!0,await z(),!await((e=ye.value)==null?void 0:e.validate())){c({text:"請填寫必填欄位",snackbarProps:{color:"red-lighten-1"}});return}const a=I.value.find(E=>E._id===N.value);if(!a)throw new Error("找不到表單模板");const i=a.name,m=(r=ya.value)==null?void 0:r.$el;if(!m)throw new Error("找不到要轉換的元素");const f=await ut(m,i,t,E=>{Le.value=E}),y=document.createElement("a");y.href=URL.createObjectURL(f),y.download=`${i}_${g.value.formNumber}.pdf`,document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(y.href),c({text:"PDF 下載成功",snackbarProps:{color:"teal-lighten-1"}})}catch(n){console.error("PDF 下載失敗:",n),c({text:n.message||"PDF 下載失敗",snackbarProps:{color:"red-lighten-1"}})}finally{Se.value=!1,ze.value=!1}},Qa=async()=>{try{const{data:t}=await _.get("/formTemplates/all");t.success&&(I.value=t.result.data,j.value=t.result.data.map(e=>({title:e.name,value:e._id})),j.value.length===0&&c({text:"目前沒有任何表單模板",snackbarProps:{color:"warning"}}))}catch(t){console.error("載入表單模板失敗:",t),c({text:"載入表單模板失敗",snackbarProps:{color:"red-lighten-1"}})}finally{j.value=j.value||[]}},_e=async()=>{if(!L.value){j.value=[],N.value=null;return}try{const t={type:L.value},{data:e}=await _.get("/formTemplates/search",{params:t});e.success&&(j.value=e.result.map(r=>({title:r.name,value:r._id})))}catch(t){console.error("載入模板選項失敗:",t),c({text:"載入模板選項失敗",snackbarProps:{color:"red-lighten-1"}})}},Ya=async()=>{try{Ie.value.open=!0,Xe.value=1,xe.value=null,P.value={name:"",type:"",componentName:""},T.value={type:"",name:"",componentName:""},await Ae()}catch(t){console.error("開啟模板管理對話框失敗:",t),c({text:"載入模板資料失敗",snackbarProps:{color:"red-lighten-1"}})}},Ba=()=>{Ie.value.open=!1,P.value={name:"",type:"",componentName:""},T.value={type:"",name:"",componentName:""}},Ga=t=>{V.value={open:!0,id:t._id,name:t.name,type:t.type,componentName:t.componentName},ae.value={name:"",type:"",componentName:""}},Da=()=>{V.value={open:!1,id:"",name:"",type:"",componentName:""},ae.value={name:"",type:"",componentName:""}},Wa=t=>{Q.value={open:!0,id:t._id,name:t.name}},Ja=async()=>{var e,r,n,a,i;T.value={type:"",name:"",componentName:""};let t=!1;if(P.value.type||(T.value.type="請選擇表單類型",t=!0),P.value.name||(T.value.name="請輸入表單名稱",t=!0),P.value.componentName||(T.value.componentName="請輸入組件名稱",t=!0),!t){de.value=!0;try{const{data:m}=await _.post("/formTemplates",P.value);m.success&&(c({text:"新增表單模板成功",snackbarProps:{color:"teal-lighten-1"}}),P.value={name:"",type:"",componentName:""},T.value={type:"",name:"",componentName:""},await Ae())}catch(m){if(console.error("新增失敗:",(e=m.response)==null?void 0:e.data),(n=(r=m.response)==null?void 0:r.data)!=null&&n.validationError){const f=m.response.data.validationError;Object.keys(f).forEach(y=>{T.value[y]=f[y].message})}else c({text:((i=(a=m.response)==null?void 0:a.data)==null?void 0:i.message)||"新增失敗",snackbarProps:{color:"red-lighten-1"}})}finally{de.value=!1}}},Za=async()=>{var e,r;const t={name:"",type:"",componentName:""};if(V.value.name||(t.name="請輸入表單名稱"),V.value.type||(t.type="請選擇表單類型"),V.value.componentName||(t.componentName="請輸入組件名稱"),Object.values(t).some(n=>n)){ae.value=t;return}de.value=!0;try{const{data:n}=await _.patch(`/formTemplates/${V.value.id}`,{name:V.value.name,type:V.value.type,componentName:V.value.componentName});n.success&&(c({text:"修改表單模板成功",snackbarProps:{color:"teal-lighten-1"}}),Da(),await Ae())}catch(n){ae.value={name:((r=(e=n.response)==null?void 0:e.data)==null?void 0:r.message)||"修改失敗",type:"",componentName:""}}finally{de.value=!1}},Xa=async()=>{var t,e,r;try{const{data:n}=await _.delete(`/formTemplates/${Q.value.id}`);n.success&&(c({text:"刪除表單模板成功",snackbarProps:{color:"teal-lighten-1"}}),I.value=I.value.filter(a=>a._id!==Q.value.id),N.value===Q.value.id&&(N.value=null),Q.value={open:!1,id:"",name:""},await Ae())}catch(n){let a="刪除失敗";((t=n.response)==null?void 0:t.status)===409?a="此表單模板有表單使用中，無法刪除":a=((r=(e=n.response)==null?void 0:e.data)==null?void 0:r.message)||"刪除失敗",c({text:a,snackbarProps:{color:"red-lighten-1"}})}},Xe=s(1),Ka=s(10),et=s(0),Ae=async()=>{try{const t={page:Xe.value,itemsPerPage:Ka.value},{data:e}=await _.get("/formTemplates/all",{params:t});e.success&&(I.value=e.result.data,et.value=e.result.totalItems,Xe.value=e.result.currentPage)}catch(t){console.error("載入表單模板失敗:",t),c({text:"載入表單模板失敗",snackbarProps:{color:"red-lighten-1"}}),I.value=[]}};$(N,async t=>{if(t){await Ne();const e=I.value.find(r=>r._id===t);e&&(ie(e.componentName),await xa(t))}else ie(),F.value=null,H.value=!1}),$(L,t=>{N.value=null,F.value=null,H.value=!1,g.value={},t?_e():j.value=[]}),$(()=>P.value.type,t=>{t&&(T.value.type="")}),$(()=>P.value.name,t=>{t&&(T.value.name="")}),$(()=>P.value.componentName,t=>{t&&(T.value.componentName="")}),$(P,t=>{t.type&&(T.value.type=""),t.name&&(T.value.name=""),t.componentName&&(T.value.componentName="")},{deep:!0}),kt(async()=>{try{await Qa(),await Promise.all([h(()=>import("./index-DfhK04sP.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]),import.meta.url),h(()=>import("./RayHuangQuotationFormFields-BSMJDykW.js"),__vite__mapDeps([23,2,3,4,5,6]),import.meta.url),h(()=>import("./index-tr1HQ6FB.js"),__vite__mapDeps([24,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,25]),import.meta.url),h(()=>import("./YstravelQuotationFormFields-ZNRyapvk.js"),__vite__mapDeps([26,2,3,4,5,6]),import.meta.url)]),N.value&&await Ne()}catch(t){console.error("初始化失敗:",t),c({text:"載入初始資料失敗",snackbarProps:{color:"red-lighten-1"}})}});const $e=s({open:!1}),b=s({type:"",formTemplate:"",date:[]}),Fe=s([]),ce=s([]),at=async()=>{try{if(ce.value=[],b.value.formTemplate="",b.value.type){const t={type:b.value.type},{data:e}=await _.get("/formTemplates/search",{params:t});e.success&&(ce.value=e.result.map(r=>({title:r.name,value:r._id})))}}catch(t){console.error("載入模板選項失敗:",t),c({text:"載入模板選項失敗",snackbarProps:{color:"red-lighten-1"}})}},Ke=()=>{$e.value.open=!1,ka()},tt=async()=>{try{$e.value.open=!0,b.value={type:"",formTemplate:"",date:[]},ce.value=[],Y.value=1,await me()}catch(t){console.error("開啟歷史紀錄對話框失敗:",t),c({text:"載入歷史紀錄失敗",snackbarProps:{color:"red-lighten-1"}})}},Oe=s(null),pe=s({open:!1,templateName:"",formNumber:""}),lt=async t=>{var e;Oe.value=t,pe.value={open:!0,templateName:((e=t.formTemplate)==null?void 0:e.name)||"未知模板",formNumber:t.formNumber||""}},ot=async()=>{var t,e;try{Ce.value=Oe.value._id;const{data:r}=await _.delete(`/forms/${Oe.value._id}`);r.success&&(c({text:"刪除歷史紀錄成功",snackbarProps:{color:"teal-lighten-1"}}),await me())}catch(r){c({text:((e=(t=r.response)==null?void 0:t.data)==null?void 0:e.message)||"刪除失敗",snackbarProps:{color:"red-lighten-1"}})}finally{Ce.value="",Oe.value=null,pe.value.open=!1}},Ue=t=>new Date(t).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit"});$(()=>b.value.type,()=>{b.value.formTemplate="",ce.value=[]}),$(L,t=>{N.value=null,t?_e():j.value=[]});const ea=s(!1),aa=s(!1),rt=async t=>{var e,r;try{if(ea.value=!0,!t)throw new Error("歷史記錄資料不存在");await Promise.all([h(()=>import("./index-DfhK04sP.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]),import.meta.url),h(()=>import("./RayHuangQuotationFormFields-BSMJDykW.js"),__vite__mapDeps([23,2,3,4,5,6]),import.meta.url),h(()=>import("./index-tr1HQ6FB.js"),__vite__mapDeps([24,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,25]),import.meta.url),h(()=>import("./YstravelQuotationFormFields-ZNRyapvk.js"),__vite__mapDeps([26,2,3,4,5,6]),import.meta.url)]),B.value=!0,K.value=!1,le.value=!1,De.value=t._id;const{data:n}=await _.get(`/forms/${t._id}`);if(!n.success)throw new Error(n.message||"獲取表單資料失敗");const a=n.result;L.value=(e=a.formTemplate)==null?void 0:e.type,await z(),await _e(),N.value=(r=a.formTemplate)==null?void 0:r._id,await z();const i=I.value.find(m=>{var f;return m._id===((f=a.formTemplate)==null?void 0:f._id)});if(!i)throw new Error("找不到對應的模板");await new Promise(m=>setTimeout(m,500)),await new Promise(m=>{setTimeout(async()=>{var f,y,E,G,W,k,O,A,J,oe,ve,re,Pa,Ta,Ea,ha,Na,Ca,Ra;switch(i.componentName){case"RayHuangQuotationTemplate":{g.value={formNumber:a.formNumber,date:(f=a.formData)!=null&&f.date?new Date(a.formData.date):new Date(a.createdAt),customerName:((y=a.formData)==null?void 0:y.customerName)||"",customerAddress:((E=a.formData)==null?void 0:E.customerAddress)||"",customerTaxId:((G=a.formData)==null?void 0:G.customerTaxId)||"",customerContact:((W=a.formData)==null?void 0:W.customerContact)||"",customerDepartment:((k=a.formData)==null?void 0:k.customerDepartment)||"",customerPhone:((O=a.formData)==null?void 0:O.customerPhone)||"",customerEmail:((A=a.formData)==null?void 0:A.customerEmail)||"",customerMobile:((J=a.formData)==null?void 0:J.customerMobile)||"",projectType:((oe=a.formData)==null?void 0:oe.projectType)||"",projectName:((ve=a.formData)==null?void 0:ve.projectName)||"",workDays:((re=a.formData)==null?void 0:re.workDays)||"",specialNote:((Pa=a.formData)==null?void 0:Pa.specialNote)||"",validityDays:((Ta=a.formData)==null?void 0:Ta.validityDays)||"",delayDays:((Ea=a.formData)==null?void 0:Ea.delayDays)||"",items:Array.isArray((ha=a.formData)==null?void 0:ha.items)&&a.formData.items.length>0?a.formData.items:[{name:"",description:"",workDays:"",quantity:1,unit:"份",price:""}],costs:Array.isArray((Na=a.formData)==null?void 0:Na.costs)&&a.formData.costs.length>0?a.formData.costs:[{costName:"",costAmount:0,remark:""}],includeContract:((Ca=a.formData)==null?void 0:Ca.includeContract)||!1,contract:((Ra=a.formData)==null?void 0:Ra.contract)||{page1:{},page2:{},page3:{}}};break}case"YstravelQuotationTemplate":break}await z(),m()},500)}),c({text:"已載入表單歷史資料",snackbarProps:{color:"teal-lighten-1"}}),Ke()}catch(n){console.error("載入歷史資料失敗:",n),c({text:n.message||"載入歷史資料失敗",snackbarProps:{color:"red-lighten-1"}})}finally{ea.value=!1}},Va=s(!1),B=s(!1),De=s(null),nt=async()=>{try{Va.value=!0;const t={page:Y.value,itemsPerPage:Ge.value,quickSearch:te.value},{data:e}=await _.get("/forms",{params:t});if(!e.success)throw new Error(e.message||"載入歷史記錄失敗");Fe.value=e.result.data,We.value=e.result.totalItems,wa.value=e.result.totalPages}catch(t){console.error("載入歷史記錄失敗:",t),c({text:t.message||"載入歷史記錄失敗",snackbarProps:{color:"red-lighten-1"}})}finally{Va.value=!1}},st=async()=>{var t;try{if(ee.value=!0,!await((t=ye.value)==null?void 0:t.validate())){c({text:"請填寫必填欄位",snackbarProps:{color:"red-lighten-1"}});return}ta.value=!0}catch(e){console.error("新增表單失敗:",e),c({text:e.message||"新增表單失敗",snackbarProps:{color:"red-lighten-1"}})}},ut=async(t,e,r,n)=>{(!he.value||!Qe.value||!Ye.value)&&await Ne();const a=document.createElement("style");a.textContent=`
    @page {
      size: A4;
      margin: 0;
    }
  `,document.head.appendChild(a);const i={margin:0,filename:`${e}_${g.value.formNumber}.pdf`,image:{type:"jpeg",quality:1},html2canvas:{scale:4,useCORS:!0,letterRendering:!0,width:795,height:1123,windowWidth:795,windowHeight:1123},jsPDF:{unit:"mm",format:"a4",orientation:"portrait",compress:!0}};try{const m=[];(r==="quotation"||r==="both")&&m.push("quotation"),(r==="contract"||r==="both")&&m.push("contract1","contract2","contract3");const f=new Qe.value(i.jsPDF),y=g.value.currentPage;for(let E=0;E<m.length;E++){g.value.currentPage=m[E],await z(),await new Promise(k=>setTimeout(k,100));const W=(await Ye.value(t,{...i.html2canvas,logging:!1,backgroundColor:"#ffffff"})).toDataURL("image/jpeg",1);E>0&&f.addPage(),f.addImage(W,"JPEG",0,0,210,297),n&&n((E+1)/m.length*100)}return g.value.currentPage=y,await z(),f.output("blob")}catch(m){throw console.error("PDF 生成失敗:",m),m}finally{document.head.removeChild(a)}},it=()=>{le.value=!0,B.value=!1,K.value=!1,De.value=null,ie(),L.value=null,N.value=null},le=s(!0),dt=async t=>{var e,r;try{if(aa.value=!0,!t)throw new Error("表單資料不存在");K.value=!0,B.value=!1,le.value=!1,De.value=t._id;const{data:n}=await _.get(`/forms/${t._id}`);if(!n.success)throw new Error(n.message||"獲取表單資料失敗");const a=n.result;L.value=(e=a.formTemplate)==null?void 0:e.type,await z(),await _e(),N.value=(r=a.formTemplate)==null?void 0:r._id,await z();const i=I.value.find(m=>{var f;return m._id===((f=a.formTemplate)==null?void 0:f._id)});if(!i)throw new Error("找不到對應的模板");await new Promise(m=>{setTimeout(async()=>{switch(i.componentName){case"RayHuangQuotationTemplate":{g.value={...a.formData,formNumber:a.formNumber};break}case"YstravelQuotationTemplate":{g.value={...a.formData,formNumber:a.formNumber};break}}await z(),m()},500)}),c({text:"已載入表單資料",snackbarProps:{color:"teal-lighten-1",timeout:3e3}}),Ke()}catch(n){console.error("載入表單資料失敗:",n),c({text:n.message||"載入表單資料失敗",snackbarProps:{color:"red-lighten-1"}})}finally{aa.value=!1}},K=s(!1),ta=s(!1),mt=s("確認新增表單"),ct=s("是否確定資料皆已填寫完成且正確?"),pt=s("確認"),vt=s("取消"),ft=async()=>{var t,e;try{const{data:r}=await _.post("/forms",{formTemplate:N.value,formNumber:g.value.formNumber,formData:g.value,lastEditor:X.userId});if(!r.success)throw new Error(r.message||"新增表單失敗");B.value=!0,De.value=r.result._id,le.value=!1,c({text:"表單新增成功",snackbarProps:{color:"teal-lighten-1"}})}catch(r){console.error("新增表單失敗:",r);const n=((e=(t=r.response)==null?void 0:t.data)==null?void 0:e.message)||"新增表單失敗";c({text:n,snackbarProps:{color:"red-lighten-1"}})}},ze=s(!1),Le=s(0),je=s(!1),u=s({open:!1,type:"",template:"",dateRange:[],typeError:"",templateError:"",dateError:""}),Ve=s([]),gt=()=>{u.value={open:!0,type:"",template:"",dateRange:[],typeError:"",templateError:"",dateError:""},Ve.value=[]},la=()=>{u.value.open=!1,Ve.value=[]},bt=async()=>{if(u.value.template="",Ve.value=[],u.value.typeError="",!!u.value.type)try{const t={type:u.value.type},{data:e}=await _.get("/formTemplates/search",{params:t});e.success&&(Ve.value=e.result.map(r=>({title:r.name,value:r._id})))}catch(t){console.error("載入模板選項失敗:",t),c({text:"載入模板選項失敗",snackbarProps:{color:"red-lighten-1"}})}},yt=async()=>{var t,e,r,n;try{let a=!1;if(u.value.typeError="",u.value.templateError="",u.value.dateError="",u.value.type||(u.value.typeError="請選擇表單類型",a=!0),u.value.template||(u.value.templateError="請選擇表單模板",a=!0),(!u.value.dateRange||u.value.dateRange.length===0)&&(u.value.dateError="請選擇日期區間",a=!0),a)return;je.value=!0,he.value||await Ne();const i={formTemplate:u.value.template};if(u.value.dateRange&&u.value.dateRange.length>0){const f=new Date(u.value.dateRange[0]);f.setHours(0,0,0,0);const y=new Date(u.value.dateRange[u.value.dateRange.length-1]);y.setHours(23,59,59,999),i.startDate=f.toISOString(),i.endDate=y.toISOString()}const{data:m}=await _.get("/forms/report",{params:i});if(m.success){const f=m.result.reduce((k,O)=>{const A=O.formData.items.reduce((J,oe)=>J+(Number(oe.quantity)||0)*(Number(oe.price)||0),0);return k+Math.round(A*1.05)},0),y=m.result.reduce((k,O)=>k+(O.formData.costs||[]).reduce((A,J)=>A+(Number(J.costAmount)||0),0),0),E=f-y,G=document.createElement("div");G.innerHTML=`
        <div style="padding: 20px;">
          <div style="text-align: center; margin-bottom: 20px; font-size: 16px; font-weight: bold;">
            ${((t=I.value.find(k=>k._id===u.value.template))==null?void 0:t.name)||""} - 統計報表
          </div>
          <p style="margin-bottom: 16px; font-size: 12px;">
            統計期間：${Ue(u.value.dateRange[0])} ~ ${Ue(u.value.dateRange[u.value.dateRange.length-1])}
          </p>
          <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
            <thead>
              <tr>
                <th style="border: 1px solid #ddd; border-bottom: none; border-right: none; padding: 4px; background-color: #f5f5f5; text-align: center;">單號</th>
                <th style="border: 1px solid #ddd; border-bottom: none; border-right: none; padding: 4px; background-color: #f5f5f5; text-align: center;">報價日期</th>
                <th style="border: 1px solid #ddd; border-bottom: none; border-right: none; padding: 4px; background-color: #f5f5f5; text-align: center;">客戶</th>
                <th style="border: 1px solid #ddd; border-bottom: none; border-right: none; padding: 4px; background-color: #f5f5f5; text-align: center;">總金額 (含稅)</th>
                <th style="border: 1px solid #ddd; border-bottom: none; border-right: none; padding: 4px; background-color: #f5f5f5; text-align: center;">成本</th>
                <th style="border: 1px solid #ddd; border-bottom: none; padding: 4px; background-color: #f5f5f5; text-align: center;">實際收入</th>
              </tr>
            </thead>
            <tbody>
              ${m.result.map(k=>{const O=k.formData.items.reduce((ve,re)=>ve+(Number(re.quantity)||0)*(Number(re.price)||0),0),A=Math.round(O*1.05),J=(k.formData.costs||[]).reduce((ve,re)=>ve+(Number(re.costAmount)||0),0),oe=A-J;return`
                  <tr>
                    <td style="border: 1px solid #ddd; border-bottom: none; border-right: none; padding: 4px; text-align: center;">${k.formNumber}</td>
                    <td style="border: 1px solid #ddd; border-bottom: none; border-right: none; padding: 4px; text-align: center;">${Ue(k.formData.date)}</td>
                    <td style="border: 1px solid #ddd; border-bottom: none; border-right: none; padding: 4px; text-align: center;">${k.formData.customerName||"-"}</td>
                    <td style="border: 1px solid #ddd; border-bottom: none; border-right: none; padding: 4px; text-align: center;">$ ${A.toLocaleString()}</td>
                    <td style="border: 1px solid #ddd; border-bottom: none; border-right: none; padding: 4px; text-align: center;">$ ${J.toLocaleString()}</td>
                    <td style="border: 1px solid #ddd; border-bottom: none; padding: 4px; text-align: center;">$ ${oe.toLocaleString()}</td>
                  </tr>
                `}).join("")}
            </tbody>
            <tfoot>
              <tr>
                <td colspan="3" style="border: 1px solid #ddd; border-right: none; padding: 4px; font-weight: bold; background-color: #f5f5f5; text-align: center;">總計</td>
                <td style="border: 1px solid #ddd; border-right: none; padding: 4px; text-align: center; font-weight: bold; background-color: #f5f5f5;">$ ${f.toLocaleString()}</td>
                <td style="border: 1px solid #ddd; border-right: none; padding: 4px; text-align: center; font-weight: bold; background-color: #f5f5f5;">$ ${y.toLocaleString()}</td>
                <td style="border: 1px solid #ddd; padding: 4px; text-align: center; font-weight: bold; background-color: #f5f5f5;">$ ${E.toLocaleString()}</td>
              </tr>
            </tfoot>
          </table>
        </div>
      `;const W={margin:10,filename:`${(e=I.value.find(k=>k._id===u.value.template))==null?void 0:e.name} - 統計報表.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:6,logging:!1,useCORS:!0,allowTaint:!0,removeContainer:!0},jsPDF:{unit:"mm",format:"a4",orientation:"landscape",compress:!0}};await he.value().from(G).set(W).save(),la(),c({text:"PDF 匯出成功",snackbarProps:{color:"teal-lighten-1"}})}}catch(a){console.error("匯出報表失敗:",a),c({text:((n=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:n.message)||"匯出報表失敗",snackbarProps:{color:"red-lighten-1"}})}finally{je.value=!1}};$(()=>u.value.type,t=>{t&&(u.value.typeError="")}),$(()=>u.value.template,t=>{t&&(u.value.templateError="")}),$(()=>u.value.dateRange,t=>{t&&t.length>0&&(u.value.dateError="")},{deep:!0});const xt=t=>{if(!t)return"-";const e=new Date(t),r=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0"),i=String(e.getHours()).padStart(2,"0"),m=String(e.getMinutes()).padStart(2,"0"),f=String(e.getSeconds()).padStart(2,"0");return`${r}-${n}-${a} ${i}:${m}:${f}`};return(t,e)=>{const r=_t("v-date-input"),n=Dt("permission");return w(),C(Ot,{"max-width":"1920","min-width":"1700",height:"100%",class:"overflow-x-scroll"},{default:o(()=>[l(D,null,{default:o(()=>[fe(l(p,{cols:"12",md:"5",class:"pe-7 pe-md-2"},{default:o(()=>[l(D,{class:"elevation-4 rounded-lg py-4 py-sm-6 px-1 px-sm-6 mt-2 mt-sm-6 mx-0 ms-sm-4 mb-4 bg-white"},{default:o(()=>[l(p,{cols:"12",class:"pa-0 mb-4"},{default:o(()=>[d("div",Yt,[l(D,null,{default:o(()=>[l(p,{cols:"6",class:"d-flex align-center"},{default:o(()=>[e[31]||(e[31]=d("h3",{class:"d-inline me-2"}," 表單產生器 ",-1)),Pe(fa)?fe((w(),C(S,{key:0,icon:"mdi-information",size:"small",class:"me-3",color:"blue-grey-darken-2"},null,512)),[[Me,"選擇表單模板後，將出現該表單資料欄位","top"]]):U("",!0)]),_:1}),l(p,{cols:"6",class:"d-flex align-center justify-end gap-2"},{default:o(()=>[fe((w(),C(x,{color:"blue-grey-darken-1",variant:"outlined","prepend-icon":"mdi-file-cog",size:se.value,onClick:Ya},{default:o(()=>e[32]||(e[32]=[v(" 模板管理 ")])),_:1},8,["size"])),[[n,"FORM_TEMPLATE_MANAGE"]]),l(x,{color:"red-darken-1",variant:"outlined","prepend-icon":"mdi-swap-horizontal",size:se.value,class:"ms-2",disabled:le.value,onClick:it},{default:o(()=>e[33]||(e[33]=[v(" 新增模式 ")])),_:1},8,["size","disabled"]),l(x,{color:"blue-grey-darken-1",variant:"outlined","prepend-icon":"mdi-history",size:se.value,class:"ms-2",onClick:tt},{default:o(()=>e[34]||(e[34]=[v(" 表單紀錄 ")])),_:1},8,["size"])]),_:1}),l(p,{cols:"12"},{default:o(()=>[l(D,{class:"mt-2"},{default:o(()=>[l(p,{cols:"6",class:"d-flex align-center ps-3"},{default:o(()=>[l(Z,{modelValue:L.value,"onUpdate:modelValue":[e[0]||(e[0]=a=>L.value=a),_e],items:ue,label:"選擇表單類型","item-title":"title","item-value":"value",variant:"outlined",density:"compact",clearable:"","hide-details":"",disabled:!le.value||B.value},null,8,["modelValue","disabled"])]),_:1}),l(p,{cols:"6",class:"d-flex align-center ps-3"},{default:o(()=>[l(Z,{modelValue:N.value,"onUpdate:modelValue":[e[1]||(e[1]=a=>N.value=a),xa],items:j.value,label:"選擇表單模板","item-title":"title","item-value":"value",variant:"outlined",density:"compact",clearable:"","hide-details":"",disabled:!le.value||!L.value||B.value,hint:j.value.length===0?"無可用的表單模板":"","persistent-hint":""},null,8,["modelValue","items","disabled","hint"])]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1}),F.value&&N.value&&F.value===Be.RayHuangQuotationTemplate.preview?(w(),C(p,{key:0,cols:"12"},{default:o(()=>[l(D,null,{default:o(()=>[l(p,{cols:"12"},{default:o(()=>[l(M,{elevation:"0"},{default:o(()=>[l(q,{class:"px-0 pt-0 pb-2"},{default:o(()=>[l(Pe(ma),{ref_key:"formFieldsRef",ref:ye,modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=a=>g.value=a),validate:ee.value,"is-viewing":K.value,disabled:K.value},null,8,["modelValue","validate","is-viewing","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):U("",!0),F.value&&N.value&&F.value===Be.YstravelQuotationTemplate.preview?(w(),C(p,{key:1,cols:"12"},{default:o(()=>[l(D,null,{default:o(()=>[l(p,{cols:"12"},{default:o(()=>[l(M,{elevation:"0"},{default:o(()=>[l(q,null,{default:o(()=>[l(Pe(ca),{ref_key:"formFieldsRef",ref:ye,modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=a=>g.value=a),validate:ee.value,"is-viewing":K.value},null,8,["modelValue","validate","is-viewing"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):U("",!0),Re.value?(w(),C(p,{key:2,cols:"12"},{default:o(()=>[l(D,null,{default:o(()=>[l(p,{cols:"12"},{default:o(()=>[l(M,{elevation:"0"},{default:o(()=>[l(q,null,{default:o(()=>[d("div",Bt,[l(sa,{indeterminate:"",color:"deep-purple-darken-2",size:"32"}),e[35]||(e[35]=d("div",{class:"mt-4 text-grey font-weight-medium"}," 載入表單欄位中... ",-1))])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):U("",!0)]),_:1})]),_:1},512),[[Vt,Pe(ga)||!be.value]]),l(p,{cols:"12",md:"7",class:"ps-md-4"},{default:o(()=>[l(D,{class:"elevation-4 rounded-lg pt-4 pb-3 px-1 px-sm-10 mt-2 mt-sm-6 mx-0 mx-sm-3 mb-4 bg-white",style:{"min-width":"900px","min-height":"216px"}},{default:o(()=>[l(p,{cols:"12",class:"flex-shrink-0"},{default:o(()=>[d("div",Gt,[d("div",null,[e[36]||(e[36]=v(" 《 預覽及匯出 》 ")),d("span",Wt," (  "+R(K.value?"查閱模式":B.value?"編輯模式":"新增模式")+"  ) ",1)]),d("div",null,[K.value?U("",!0):(w(),C(x,{key:0,class:"me-4",color:"teal-darken-1",disabled:!H.value,loading:Je.value,onClick:e[4]||(e[4]=a=>B.value?Ha():st())},{default:o(()=>[v(R(B.value?"儲存":"新增"),1)]),_:1},8,["disabled","loading"])),l(x,{color:"red-darken-1","prepend-icon":"mdi-file-pdf-box",disabled:!H.value,loading:Se.value,class:"me-4",onClick:Ma},{default:o(()=>e[37]||(e[37]=[v(" 匯出 ")])),_:1},8,["disabled","loading"]),l(x,{color:"deep-orange-darken-1",loading:je.value,"prepend-icon":"mdi-file-export",onClick:gt},{default:o(()=>e[38]||(e[38]=[v(" 匯出報表 ")])),_:1},8,["loading"])])]),l(Ut,{class:"mt-8 mx-6"}),l(M,{elevation:"0","min-width":"681"},{default:o(()=>[H.value?U("",!0):(w(),C(q,{key:0,style:{"font-size":"15px","font-weight":"600"},class:"text-center text-grey font-weight-medium pa-0 pt-9 pb-3"},{default:o(()=>[Re.value?(w(),ge("div",Jt,[l(sa,{indeterminate:"",color:"deep-purple-darken-2",size:"32"}),e[39]||(e[39]=d("div",{class:"mt-4"}," 載入表單預覽畫面中... ",-1))])):(w(),ge(ra,{key:1},[v(" ( 請 先 選 擇 表 單 模 版 ) ")],64))]),_:1})),H.value?(w(),C(q,{key:1},{default:o(()=>[(w(),C(Pt(F.value),{ref_key:"templateRef",ref:ya,"form-data":g.value},null,8,["form-data"]))]),_:1})):U("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(Ee,{modelValue:Ie.value.open,"onUpdate:modelValue":e[9]||(e[9]=a=>Ie.value.open=a),persistent:"","max-width":"880"},{default:o(()=>[l(M,{class:"rounded-lg ps-8 pe-4 py-4"},{default:o(()=>[d("div",Zt,[e[40]||(e[40]=v(" 表單模板管理 ")),l(x,{icon:"mdi-close",color:"red-lighten-1",variant:"plain",size:se.value,onClick:Ba},null,8,["size"])]),l(q,{class:"ps-2"},{default:o(()=>[l(D,{class:""},{default:o(()=>[l(p,{cols:"7",class:"px-5 border rounded-lg"},{default:o(()=>[l(D,null,{default:o(()=>[l(p,{class:"card-subtitle text-blue-grey-darken-2 pt-3"},{default:o(()=>e[41]||(e[41]=[v(" 現有表單模板 ")])),_:1})]),_:1}),l(D,null,{default:o(()=>[l(p,{cols:"6"},{default:o(()=>[l(Z,{modelValue:xe.value,"onUpdate:modelValue":e[5]||(e[5]=a=>xe.value=a),items:ue,label:"表單類型","item-title":"title","item-value":"value",variant:"outlined",density:"compact",clearable:"",class:"mb-1"},null,8,["modelValue"])]),_:1})]),_:1}),d("div",Xt,[(w(!0),ge(ra,null,Ia(za.value,a=>(w(),C(zt,{key:a._id,class:"me-4 mb-2 pa-4 pe-1",color:"blue-grey-darken-2",label:""},{default:o(()=>[v(R(a.name)+" ",1),l(Lt,null,{activator:o(({props:i})=>[l(x,Tt({icon:"",size:"x-small",variant:"text",class:"ms-2",ripple:!1,color:"white",ref_for:!0},i),{default:o(()=>[l(S,{color:"cyan-darken-3"},{default:o(()=>e[42]||(e[42]=[v(" mdi-dots-vertical ")])),_:1})]),_:2},1040)]),default:o(()=>[l(jt,{density:"compact"},{default:o(()=>[l(Sa,{density:"compact",class:"ps-2 pe-3 py-0",onClick:i=>Ga(a)},{default:o(()=>[l(S,{icon:"mdi-pencil",size:"16",color:"light-blue-darken-4"}),e[43]||(e[43]=d("span",{style:{"font-size":"14px"},class:"ps-2 text-blue-grey-darken-2"},"編輯",-1))]),_:2},1032,["onClick"]),l(Sa,{density:"compact",class:"ps-2 pe-3 py-0",color:"red-lighten-1",onClick:i=>Wa(a)},{default:o(()=>[l(S,{icon:"mdi-delete",size:"16",color:"red-lighten-1"}),e[44]||(e[44]=d("span",{style:{"font-size":"14px"},class:"ps-2 text-blue-grey-darken-2"},"刪除",-1))]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))])]),_:1}),l(ne),l(p,{cols:"4",class:"border rounded-lg px-4 pt-4"},{default:o(()=>[l(D,null,{default:o(()=>[l(p,{cols:"12",class:"card-subtitle text-blue-grey-darken-2 mb-4"},{default:o(()=>e[45]||(e[45]=[v(" 新增表單模板 ")])),_:1})]),_:1}),l(ua,{onSubmit:na(Ja,["prevent"])},{default:o(()=>[l(D,null,{default:o(()=>[l(p,{cols:"12",class:"pb-2"},{default:o(()=>[l(Z,{modelValue:P.value.type,"onUpdate:modelValue":e[6]||(e[6]=a=>P.value.type=a),items:ue,label:"表單類型*","item-title":"title","item-value":"value","error-messages":T.value.type,variant:"outlined",clearable:"",density:"compact"},null,8,["modelValue","error-messages"])]),_:1}),l(p,{cols:"12"},{default:o(()=>[l(Te,{modelValue:P.value.name,"onUpdate:modelValue":e[7]||(e[7]=a=>P.value.name=a),"error-messages":T.value.name,label:"表單名稱*",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","error-messages"])]),_:1}),l(p,{cols:"12"},{default:o(()=>[l(Te,{modelValue:P.value.componentName,"onUpdate:modelValue":e[8]||(e[8]=a=>P.value.componentName=a),"error-messages":T.value.componentName,label:"組件名稱*",placeholder:"例如: RayHuangQuotationTemplate",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),l(qe,{class:"pa-0 mt-2"},{default:o(()=>[l(ne),l(x,{color:"teal-darken-1",variant:"outlined",type:"submit",size:"small",loading:de.value,class:"ms-2"},{default:o(()=>e[46]||(e[46]=[v(" 新增 ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(Ee,{modelValue:V.value.open,"onUpdate:modelValue":e[13]||(e[13]=a=>V.value.open=a),persistent:"",width:"360"},{default:o(()=>[l(M,{class:"rounded-lg pa-4"},{default:o(()=>[e[49]||(e[49]=d("div",{class:"card-title ps-5 py-3"}," 編輯表單模板 ",-1)),l(q,{class:"px-5 pb-2"},{default:o(()=>[l(ua,{onSubmit:na(Za,["prevent"])},{default:o(()=>[l(Z,{modelValue:V.value.type,"onUpdate:modelValue":e[10]||(e[10]=a=>V.value.type=a),items:ue,label:"表單類型*","item-title":"title","item-value":"value","error-messages":ae.value.type,variant:"outlined",density:"compact",class:"mb-4",clearable:""},null,8,["modelValue","error-messages"]),l(Te,{modelValue:V.value.name,"onUpdate:modelValue":e[11]||(e[11]=a=>V.value.name=a),"error-messages":ae.value.name,label:"表單名稱*",required:"",variant:"outlined",density:"compact",class:"mb-4"},null,8,["modelValue","error-messages"]),l(Te,{modelValue:V.value.componentName,"onUpdate:modelValue":e[12]||(e[12]=a=>V.value.componentName=a),"error-messages":ae.value.componentName,label:"組件名稱*",required:"",variant:"outlined",density:"compact",class:"mb-4"},null,8,["modelValue","error-messages"]),l(qe,{class:"pa-0 mt-4"},{default:o(()=>[l(ne),l(x,{color:"grey",variant:"outlined",onClick:Da},{default:o(()=>e[47]||(e[47]=[v(" 取消 ")])),_:1}),l(x,{color:"teal-darken-1",variant:"outlined",type:"submit",loading:de.value,class:"ms-2"},{default:o(()=>e[48]||(e[48]=[v(" 修改 ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(St,{modelValue:Q.value.open,"onUpdate:modelValue":e[14]||(e[14]=a=>Q.value.open=a),title:"確認刪除表單模板",message:`確定要刪除表單模板「<span class='text-pink-lighten-1' style='font-weight: 800;'>${Q.value.name}</span>」嗎？此操作無法復原`,"expected-name":Q.value.name,"input-label":"表單模板名稱",onConfirm:Xa},null,8,["modelValue","message","expected-name"]),l(Ee,{modelValue:$e.value.open,"onUpdate:modelValue":e[20]||(e[20]=a=>$e.value.open=a),"max-width":"1600"},{default:o(()=>[l(M,{class:"rounded-lg pb-2","min-height":"920"},{default:o(()=>[l(ia,{class:"d-flex align-center px-6 py-1 bg-blue-grey-darken-2"},{default:o(()=>[l(S,{icon:"mdi-history",size:"18",color:"white",class:"me-2"}),e[51]||(e[51]=d("span",{class:"card-title text-white"},"表單歷史紀錄",-1)),l(ne),l(x,{icon:"",variant:"text",color:"white",onClick:Ke},{default:o(()=>[l(S,null,{default:o(()=>e[50]||(e[50]=[v("mdi-close")])),_:1})]),_:1})]),_:1}),l(q,{class:"px-6 pt-6"},{default:o(()=>[d("div",Kt,[l(D,null,{default:o(()=>[l(p,{cols:"12"},{default:o(()=>[l(D,null,{default:o(()=>[l(p,{cols:"3"},{default:o(()=>[l(Z,{modelValue:b.value.type,"onUpdate:modelValue":[e[15]||(e[15]=a=>b.value.type=a),at],items:ue,label:"表單類型","item-title":"title","item-value":"value",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),l(p,{cols:"3",class:"pb-0"},{default:o(()=>[l(Z,{modelValue:b.value.formTemplate,"onUpdate:modelValue":e[16]||(e[16]=a=>b.value.formTemplate=a),items:ce.value,label:"表單模板","item-title":"title","item-value":"value",variant:"outlined",density:"compact",clearable:"",disabled:!b.value.type},null,8,["modelValue","items","disabled"])]),_:1}),l(p,{cols:"3",class:"pb-0"},{default:o(()=>[l(r,{modelValue:b.value.date,"onUpdate:modelValue":e[17]||(e[17]=a=>b.value.date=a),label:"創建日期區間",variant:"outlined",density:"compact","prepend-icon":"",clearable:"",multiple:"range","ok-text":"確認","cancel-text":"取消"},null,8,["modelValue"])]),_:1}),l(p,{cols:"3",class:"pb-0"},{default:o(()=>[l(D,null,{default:o(()=>[l(p,{cols:"6"},{default:o(()=>[l(x,{color:"blue-grey-darken-1",block:"",class:"me-3",onClick:ka},{default:o(()=>[l(S,null,{default:o(()=>e[52]||(e[52]=[v("mdi-refresh")])),_:1})]),_:1})]),_:1}),l(p,{cos:"6"},{default:o(()=>[l(x,{color:"cyan-darken-2",block:"",loading:we.value,disabled:we.value,onClick:me},{default:o(()=>e[53]||(e[53]=[v(" 搜尋 ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(D,{class:"mt-0"})]),l(D,null,{default:o(()=>[l(p,{cols:"12",sm:"4",lg:"3",class:"ms-auto mt-6 ps-0 d-flex align-center"},{default:o(()=>[fe((w(),C(S,{size:"20",color:"blue-grey-darken-2",class:"me-2"},{default:o(()=>e[54]||(e[54]=[v(" mdi-information ")])),_:1})),[[Me,"可搜尋單號、客戶名稱、專案名稱、項目","start"]]),l(Te,{modelValue:te.value,"onUpdate:modelValue":e[18]||(e[18]=a=>te.value=a),label:"快速搜尋","append-inner-icon":"mdi-magnify",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(Ht,{class:"rounded-lg mt-6"},{default:o(()=>[e[59]||(e[59]=d("thead",{class:"bg-blue-grey-darken-2"},[d("tr",null,[d("th",{style:{height:"36px"}}," 表單模板名稱 "),d("th",{style:{height:"36px"}}," 單號 "),d("th",{style:{height:"36px"}}," 客戶名稱 "),d("th",{style:{height:"36px"}}," 專案名稱 "),d("th",{style:{height:"36px"}}," 創建日期 "),d("th",{style:{height:"36px"}}," 創建者 "),d("th",{style:{height:"36px"}}," 最後編輯者 "),d("th",{style:{height:"36px"}}," 最後編輯時間 "),d("th",{class:"text-center",style:{height:"36px"}}," 操作 ")])],-1)),d("tbody",null,[(w(!0),ge(ra,null,Ia(Fe.value,a=>{var i,m,f,y,E,G,W,k,O;return w(),ge("tr",{key:a._id},[d("td",null,R(((i=a==null?void 0:a.formTemplate)==null?void 0:i.name)||"未知模板"),1),d("td",null,R((a==null?void 0:a.formNumber)||"-"),1),d("td",null,R((a==null?void 0:a.clientName)||"-"),1),d("td",null,R((a==null?void 0:a.projectName)||"-"),1),d("td",null,R(Ue(a==null?void 0:a.createdAt)),1),d("td",null,R(((m=a==null?void 0:a.creator)==null?void 0:m.name)||"未知")+" "+R(((f=a==null?void 0:a.creator)==null?void 0:f.role)===2?`(${(y=a==null?void 0:a.creator)==null?void 0:y.adminId})`:`(${(E=a==null?void 0:a.creator)==null?void 0:E.userId})`),1),d("td",null,R(((G=a==null?void 0:a.lastEditor)==null?void 0:G.name)||"未知")+" "+R(((W=a==null?void 0:a.lastEditor)==null?void 0:W.role)===2?`(${(k=a==null?void 0:a.lastEditor)==null?void 0:k.adminId})`:`(${(O=a==null?void 0:a.lastEditor)==null?void 0:O.userId})`),1),d("td",null,R(xt(a==null?void 0:a.updatedAt)),1),d("td",el,[Fa(a)?fe((w(),C(x,{key:0,icon:"",variant:"plain",color:"light-blue-darken-2",loading:ea.value,onClick:A=>rt(a)},{default:o(()=>[l(S,null,{default:o(()=>e[55]||(e[55]=[v("mdi-pencil")])),_:1})]),_:2},1032,["loading","onClick"])),[[Me,"編輯表單"]]):U("",!0),fe((w(),C(x,{icon:"",variant:"plain",color:"teal-lighten-1",loading:aa.value,onClick:A=>dt(a)},{default:o(()=>[l(S,null,{default:o(()=>e[56]||(e[56]=[v("mdi-book-open-variant-outline")])),_:1})]),_:2},1032,["loading","onClick"])),[[Me,"查閱表單"]]),Oa(a)?(w(),C(x,{key:1,icon:"",variant:"plain",color:"red-lighten-1",loading:Ce.value===a._id,disabled:Ce.value===a._id,onClick:A=>lt(a)},{default:o(()=>[l(S,null,{default:o(()=>e[57]||(e[57]=[v("mdi-delete")])),_:1})]),_:2},1032,["loading","disabled","onClick"])):U("",!0)])])}),128)),Fe.value.length?U("",!0):(w(),ge("tr",al,e[58]||(e[58]=[d("td",{colspan:"7",class:"text-center"}," 沒有資料 ",-1)])))])]),_:1}),d("div",tl,[l(Mt,{modelValue:Y.value,"onUpdate:modelValue":[e[19]||(e[19]=a=>Y.value=a),La],length:wa.value,"total-visible":7,size:"32",rounded:"circle"},null,8,["modelValue","length"])])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(At,{modelValue:pe.value.open,"onUpdate:modelValue":e[21]||(e[21]=a=>pe.value.open=a),"dialog-width":"330",title:"確認刪除表單",message:`確定要刪除表單「${pe.value.templateName} ${pe.value.formNumber}」嗎？此操作無法恢復。`,onConfirm:ot},null,8,["modelValue","message"]),l($t,{modelValue:ta.value,"onUpdate:modelValue":e[22]||(e[22]=a=>ta.value=a),"dialog-width":"310",title:mt.value,message:ct.value,"confirm-button-text":pt.value,"cancel-button-text":vt.value,"confirm-button-color":"teal-darken-1","header-color":"bg-teal-darken-1","header-icon":"mdi-check-circle",onConfirm:ft},null,8,["modelValue","title","message","confirm-button-text","cancel-button-text"]),l(qt,{modelValue:ze.value,"onUpdate:modelValue":e[23]||(e[23]=a=>ze.value=a),class:"align-center justify-center",persistent:"",opacity:"1",scrim:"#fff"},{default:o(()=>[l(M,{color:"white",width:"300",class:"px-6 py-8",elevation:"0"},{default:o(()=>[d("div",ll,[l(sa,{"model-value":Le.value,color:"deep-purple-darken-2",size:"120",width:"14"},{default:o(()=>[v(R(Math.round(Le.value))+" % ",1)]),_:1},8,["model-value"])]),e[60]||(e[60]=d("div",{class:"text-center sub-title font-weight-medium mt-6"}," 正在匯出 PDF... ",-1))]),_:1})]),_:1},8,["modelValue"]),l(Ee,{modelValue:ke.value,"onUpdate:modelValue":e[26]||(e[26]=a=>ke.value=a),"max-width":"300"},{default:o(()=>[l(M,{class:"px-4 py-4 rounded-lg"},{default:o(()=>[l(ia,{class:"card-title"},{default:o(()=>e[61]||(e[61]=[v(" 選擇匯出內容 ")])),_:1}),l(q,{class:"pb-0 px-3"},{default:o(()=>[l(Qt,{modelValue:Ze.value,"onUpdate:modelValue":e[24]||(e[24]=a=>Ze.value=a)},{default:o(()=>[l(da,{label:"報價單",value:"quotation",color:"deep-purple-darken-2"}),l(da,{label:"合約書",value:"contract",color:"deep-purple-darken-2"}),l(da,{label:"報價單 + 合約書",value:"both",color:"deep-purple-darken-2","hide-details":""})]),_:1},8,["modelValue"])]),_:1}),l(qe,null,{default:o(()=>[l(ne),l(x,{color:"grey-darken-1",text:"",variant:"outlined",size:"small",onClick:e[25]||(e[25]=a=>ke.value=!1)},{default:o(()=>e[62]||(e[62]=[v(" 取消 ")])),_:1}),l(x,{color:"teal-darken-1",text:"",variant:"outlined",size:"small",onClick:qa},{default:o(()=>e[63]||(e[63]=[v(" 確認 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(Ee,{modelValue:u.value.open,"onUpdate:modelValue":e[30]||(e[30]=a=>u.value.open=a),persistent:"","max-width":"320"},{default:o(()=>[l(M,{class:"rounded-lg"},{default:o(()=>[l(ia,{class:"d-flex align-center px-6 py-1 bg-deep-orange-darken-2"},{default:o(()=>[l(S,{icon:"mdi-file-export",size:"18",color:"white",class:"me-2"}),e[65]||(e[65]=d("span",{class:"card-title text-white"},"匯出報表",-1)),l(ne),l(x,{icon:"",variant:"text",color:"white",onClick:la},{default:o(()=>[l(S,null,{default:o(()=>e[64]||(e[64]=[v("mdi-close")])),_:1})]),_:1})]),_:1}),l(q,{class:"px-6 pt-8 pb-4"},{default:o(()=>[l(ua,{onSubmit:na(yt,["prevent"])},{default:o(()=>[l(Z,{modelValue:u.value.type,"onUpdate:modelValue":[e[27]||(e[27]=a=>u.value.type=a),bt],items:ue,label:"表單類型","item-title":"title","item-value":"value",variant:"outlined",density:"compact",class:"mb-4","error-messages":u.value.typeError,clearable:""},null,8,["modelValue","error-messages"]),l(Z,{modelValue:u.value.template,"onUpdate:modelValue":e[28]||(e[28]=a=>u.value.template=a),items:Ve.value,label:"表單模板","item-title":"title","item-value":"value",variant:"outlined",density:"compact",class:"mb-4","error-messages":u.value.templateError,disabled:!u.value.type,clearable:""},null,8,["modelValue","items","error-messages","disabled"]),l(r,{modelValue:u.value.dateRange,"onUpdate:modelValue":e[29]||(e[29]=a=>u.value.dateRange=a),label:"報價日期區間",variant:"outlined",density:"compact",multiple:"range","prepend-icon":"",clearable:"",class:"mb-4","cancel-text":"取消","ok-text":"確認","error-messages":u.value.dateError},null,8,["modelValue","error-messages"]),l(qe,{class:"px-0"},{default:o(()=>[l(ne),l(x,{color:"grey-darken-1",variant:"outlined",size:se.value,onClick:la},{default:o(()=>e[66]||(e[66]=[v(" 取消 ")])),_:1},8,["size"]),l(x,{color:"deep-orange-darken-2",variant:"outlined",type:"submit",loading:je.value,size:se.value,class:"ms-2"},{default:o(()=>e[67]||(e[67]=[v(" 匯出 ")])),_:1},8,["loading","size"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),Pe(ga)?U("",!0):(w(),C(x,{key:0,icon:"",color:be.value?"light-blue-darken-2":"grey-darken-1",size:"48",class:"floating-toggle-btn rounded-xl",onClick:Ua},{default:o(()=>[d("span",ol,R(be.value?"展開":"收合"),1)]),_:1},8,["color"]))]),_:1})}}},Cl=ht(rl,[["__scopeId","data-v-4102fd28"]]);export{Cl as default};

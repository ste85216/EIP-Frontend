import{_ as ta}from"./jspdf-DacfHTdZ.js";import{f as ce,r as d,w as z,k as la,aV as C,Z as me,bH as n,b2 as na,a8 as t,a0 as f,$ as P,b0 as ra,bf as h,aH as $e,F as oa,a7 as u,u as m,bJ as sa,_ as Fe,bM as pe}from"./@vue-Cr_z6yfx.js";import{l as ia}from"./lodash-CiJWSuVn.js";import{_ as da,b as ua}from"./index-wwmbXvRV.js";import{i as ca}from"./vuetify-use-dialog-C5oZ13xz.js";import{_ as ma}from"./ConfirmDeleteDialog-CuZPFffe.js";import{b as pa,c as $,e as ga}from"./yup-WHNMwcW8.js";import{u as va,a as F}from"./vee-validate-BXV9nMa7.js";import{a as fa}from"./html2pdf.js-CvqxwkGD.js";import{q as ya,Q as ba,w as p,v as O,a as B,c as L,J as Oe,g as y,P as ge,r as V,d as xa,R as wa,f as T,U as ve,_ as ha,a1 as fe,e as ye,V as be,x as ka,A as Da,T as Ca}from"./vuetify-CbddcmEc.js";import"./core-js-D2hAHviU.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./perfect-debounce-Cp2ysxOb.js";import"./hookable-B8xFkYCm.js";/* empty css             */import"./pinia-DBRIaiZ_.js";import"./vue-demi-Dq6ymT-8.js";import"./pinia-plugin-persistedstate-RV7uh3T-.js";import"./vue-router-CS4OewbW.js";import"./unplugin-vue-router-B1N3mqWX.js";import"./axios-upsvKRUO.js";import"./vue3-google-login-Dx7TV_Hx.js";import"./vue-easy-lightbox-D952uME8.js";import"./property-expr-DEi1ZLzV.js";import"./tiny-case-BJ7jYKNY.js";import"./toposort-DzadwsAs.js";import"./html2canvas-CqpzYDn4.js";const Va={class:"sub-title mb-2"},Ra={key:1,class:"d-flex justify-center align-center",style:{"min-height":"21.38px"}},Sa={key:1,class:"d-flex justify-center align-center",style:{"min-height":"21.38px"}},_a={class:"text-center"},Ea={class:"card-title px-6 py-3 bg-blue-grey-darken-2 d-flex align-center"},Ua={class:"card-title px-6 py-3 bg-red-lighten-1 d-flex align-center"},za={class:"card-title px-6 py-3 bg-teal-darken-1 d-flex align-center"},Pa={key:0},Ia={key:1},$a={__name:"hardwareMaintenanceRecord",setup(Fa){const{apiAuth:R}=ua(),v=ca(),{smAndUp:xe,mdAndUp:we}=ya(),b=ce(()=>xe.value?"default":"small"),Te=ce(()=>we.value?"900":xe.value?"600":"100%"),Me=pa({hardwareCategory:$().required("請選擇硬體類型"),maintenanceDate:ga().required("請選擇維修日期"),maintenanceContent:$().required("請輸入問題內容"),maintenanceResult:$().required("請輸入處理結果"),reportUser:$().nullable(),reportUserId:$().nullable(),note:$().nullable()}),{handleSubmit:He,resetForm:Z}=va({validationSchema:Me,initialValues:{hardwareCategory:"",maintenanceDate:new Date().toISOString().split("T")[0],maintenanceContent:"",maintenanceResult:"",reportUser:"",reportUserId:"",note:""},validateOnMount:!1}),G=F("hardwareCategory"),K=F("maintenanceDate",void 0,{format:a=>a?a instanceof Date?a.toISOString().split("T")[0]:a:"",parse:a=>a?new Date(a):null}),ee=F("maintenanceContent"),ae=F("maintenanceResult"),te=F("reportUserId"),le=F("note"),he=d([]),je=async()=>{var a,e;try{const{data:r}=await R.get("/employees/active");r.success&&(he.value=r.result.map(l=>({label:`${l.name} (${l.employeeId})`,value:l._id})))}catch(r){console.error("取得員工列表失敗:",r),v({text:((e=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:e.message)||"取得員工列表失敗",snackbarProps:{color:"red-lighten-1"}})}},Ae=[{title:"維修單號",align:"start",sortable:!0,key:"maintenanceRecordId"},{title:"維修日期",align:"start",sortable:!0,key:"maintenanceDate"},{title:"硬體類型",align:"start",sortable:!0,key:"hardwareCategory"},{title:"問題內容",align:"start",sortable:!0,width:"300",key:"maintenanceContent"},{title:"處理結果",align:"start",sortable:!0,width:"300",key:"maintenanceResult"},{title:"報修人",align:"start",sortable:!0,key:"reportUser"},{title:"備註",align:"start",sortable:!0,key:"note"},{title:"操作",align:"center",sortable:!1,key:"actions"}],q=d(10),N=d([{key:"maintenanceRecordId",order:"desc"}]),M=d(1),ke=d([]),ne=d(!0),re=d(0),c=d({maintenanceDateRange:[],hardwareCategory:null}),H=d(""),S=d({open:!1,id:""}),_=d({open:!1,item:null}),k=d([]),oe=d({}),se=d({name:"",order:""}),J=d({name:"",order:""}),I=d(!1),Q=d(!0),De=async()=>{Q.value=!0;try{const a={};if(c.value.maintenanceDateRange&&c.value.maintenanceDateRange.length>0){const r=new Date(c.value.maintenanceDateRange[0]);r.setHours(0,0,0,0);const l=new Date(c.value.maintenanceDateRange[c.value.maintenanceDateRange.length-1]);l.setHours(23,59,59,999),a.maintenanceDateStart=r.toISOString(),a.maintenanceDateEnd=l.toISOString()}c.value.hardwareCategory&&(a.hardwareCategory=c.value.hardwareCategory);const{data:e}=await R.get("/hardware/maintenance-records/stats",{params:a});if(e.success){const r={};e.result.forEach(l=>{r[l._id]=l.count}),oe.value=r}}catch(a){console.error("載入統計資料失敗:",a),v({text:"載入統計資料失敗",snackbarProps:{color:"red-lighten-1"}})}finally{Q.value=!1}},Ce=a=>oe.value[a]||0,j=async(a=!0)=>{var e,r;a&&(ne.value=!0);try{const l={page:M.value,itemsPerPage:q.value,sortBy:((e=N.value[0])==null?void 0:e.key)||"maintenanceDate",sortOrder:((r=N.value[0])==null?void 0:r.order)||"desc",search:H.value};if(c.value.maintenanceDateRange&&c.value.maintenanceDateRange.length>0){const g=new Date(c.value.maintenanceDateRange[0]);g.setHours(0,0,0,0);const w=new Date(c.value.maintenanceDateRange[c.value.maintenanceDateRange.length-1]);w.setHours(23,59,59,999),l.maintenanceDateStart=g.toISOString(),l.maintenanceDateEnd=w.toISOString()}c.value.hardwareCategory&&(l.hardwareCategory=c.value.hardwareCategory);const{data:i}=await R.get("/hardware/maintenance-records",{params:l});i.success&&(k.value.length===0&&await Ve(),ke.value=i.result.data,re.value=i.result.totalItems)}catch(l){console.error("載入資料失敗:",l),v({text:"載入資料失敗",snackbarProps:{color:"red-lighten-1"}})}finally{ne.value=!1}},E=async()=>{try{x.value=!0,await Promise.all([j(!0),De()])}catch(a){console.error("刷新資料失敗:",a)}finally{x.value=!1}},Ve=async()=>{try{const{data:a}=await R.get("/hardware/categories/search",{params:{type:1}});a.success&&(k.value=a.result)}catch(a){console.error("載入硬體類型失敗:",a),v({text:"載入硬體類型失敗",snackbarProps:{color:"red-lighten-1"}})}},Be=ia.debounce(async()=>{try{x.value=!0,M.value=1,await E()}catch(a){console.error("快速搜尋失敗:",a),v({text:"搜尋失敗",snackbarProps:{color:"red-lighten-1"}})}finally{x.value=!1}},300),Re=()=>{x.value=!0,Be()};z(H,()=>{Re()}),z(()=>se.value.name,a=>{a&&(J.value.name="")}),z(()=>se.value.order,a=>{a&&(J.value.order="")}),z(se,a=>{a.name&&(J.value.name=""),a.order&&(J.value.order="")},{deep:!0}),la(async()=>{try{await Ve(),await Promise.all([De(),j(!0),je()])}catch(a){console.error("初始化資料載入失敗:",a)}});const A=a=>{if(!a)return"";const e=new Date(a),r=e.getFullYear(),l=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return`${r}-${l}-${i}`},Le=a=>{if(typeof a=="object"&&a!==null)return a.name||"未知";const e=k.value.find(r=>r._id===a);return e?e.name:"未知"},qe=()=>{c.value.maintenanceDateRange=[],E()},Se=a=>{var e;S.value.open=!0,a?(S.value.id=a._id,Z({values:{hardwareCategory:typeof a.hardwareCategory=="object"?a.hardwareCategory._id:a.hardwareCategory,maintenanceDate:new Date(a.maintenanceDate),maintenanceContent:a.maintenanceContent,maintenanceResult:a.maintenanceResult,reportUser:a.reportUser||"",reportUserId:((e=a.reportUserEmployee)==null?void 0:e._id)||"",note:a.note||""}})):(S.value.id="",Z({values:{hardwareCategory:"",maintenanceDate:new Date,maintenanceContent:"",maintenanceResult:"",reportUser:"",reportUserId:"",note:""}}))},W=()=>{S.value.open=!1,Z()},Ne=He(async a=>{var e,r,l;try{I.value=!0;const i={...a,maintenanceDate:a.maintenanceDate instanceof Date?A(a.maintenanceDate):a.maintenanceDate};if(S.value.id){const{data:g}=await R.patch(`/hardware/maintenance-records/${S.value.id}`,i);g.success&&(v({text:"維修記錄更新成功",snackbarProps:{color:"teal-lighten-1"}}),W(),E())}else{const{data:g}=await R.post("/hardware/maintenance-records",i);g.success&&(v({text:"維修記錄新增成功",snackbarProps:{color:"teal-lighten-1"}}),W(),E())}}catch(i){console.error("儲存維修記錄失敗:",((e=i.response)==null?void 0:e.data)||i),v({text:((l=(r=i.response)==null?void 0:r.data)==null?void 0:l.message)||"儲存失敗",snackbarProps:{color:"red-lighten-1"}})}finally{I.value=!1}}),Je=a=>{_.value={open:!0,item:a}},Qe=async()=>{var a,e;if(_.value.item)try{await R.delete(`/hardware/maintenance-records/${_.value.item._id}`),v({text:"維修記錄刪除成功",snackbarProps:{color:"teal-lighten-1"}}),E()}catch(r){console.error("刪除維修記錄失敗:",r),v({text:((e=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:e.message)||"刪除失敗",snackbarProps:{color:"red-lighten-1"}})}finally{_.value.open=!1,_.value.item=null}},We=a=>{a<1&&(a=1);const e=Math.ceil(re.value/q.value);a>e&&(a=e),M.value!==a&&(M.value=a,j(!1))},Xe=d(null),Ye=async()=>{try{x.value=!0,await E()}catch(a){console.error("搜尋時發生錯誤:",a),v({text:"搜尋失敗",snackbarProps:{color:"red-lighten-1"}})}finally{x.value=!1}},Ze=async()=>{c.value.maintenanceDateRange=[],c.value.hardwareCategory=null,H.value="";try{x.value=!0,await E()}catch(a){console.error("重置搜尋失敗:",a),v({text:"重置搜尋失敗",snackbarProps:{color:"red-lighten-1"}})}finally{x.value=!1}},x=d(!1),s=d({open:!1,dateRange:[],error:""}),o=d({open:!1,dateRange:[],hardwareCategories:[],dateError:"",categoryError:""}),X=d(!1),Y=d(!1);z(()=>s.value.dateRange,a=>{a&&a.length>0&&(s.value.error="")}),z(()=>o.value.dateRange,a=>{a&&a.length>0&&(o.value.dateError="")}),z(()=>o.value.hardwareCategories,a=>{a&&a.length>0&&(o.value.categoryError="")});const _e=async()=>{if(!s.value.dateRange||s.value.dateRange.length===0){s.value.error="請選擇日期區間";return}try{X.value=!0;const a={};if(s.value.dateRange&&s.value.dateRange.length>0){const r=new Date(s.value.dateRange[0]);r.setHours(0,0,0,0);const l=new Date(s.value.dateRange[s.value.dateRange.length-1]);l.setHours(23,59,59,999),a.maintenanceDateStart=r.toISOString(),a.maintenanceDateEnd=l.toISOString()}const{data:e}=await R.get("/hardware/maintenance-records/export-stats",{params:a});if(e.success){const r=e.result.reduce((w,U)=>w+U.count,0),l=document.createElement("div");l.innerHTML=`
        <div style="padding: 20px;">
          <div style="text-align: center; margin-bottom: 20px; font-size: 17px; font-weight: bold;">硬體維修記錄統計報表</div>
          <p style="margin-bottom: 16px; font-size: 14px;">統計期間：${A(s.value.dateRange[0])} ~ ${A(s.value.dateRange[s.value.dateRange.length-1])}</p>
          <table style="width: 100%; border-collapse: collapse; font-size: 14px; text-align: center;">
            <thead>
              <tr>
                <th style="border: 1px solid #ddd; border-bottom: none; border-right: none; padding: 8px; background-color: #f5f5f5;">硬體類型</th>
                <th style="border: 1px solid #ddd; border-bottom: none; padding: 8px; background-color: #f5f5f5;">維修次數</th>
              </tr>
            </thead>
            <tbody>
              ${k.value.map(w=>{const U=e.result.find(ue=>ue.name===w.name);return`
                  <tr>
                    <td style="border: 1px solid #ddd; border-bottom: none; border-right: none; padding: 8px;">${w.name}</td>
                    <td style="border: 1px solid #ddd; border-bottom: none; padding: 8px; text-align: center;">${U?U.count:0}</td>
                  </tr>
                `}).join("")}
              <tr>
                <td style="border: 1px solid #ddd; border-right: none; padding: 8px; font-weight: bold; background-color: #f5f5f5;">Total</td>
                <td style="border: 1px solid #ddd; padding: 8px; text-align: center; font-weight: bold; background-color: #f5f5f5;">${r}</td>
              </tr>
            </tbody>
          </table>
        </div>
      `;const i={margin:10,filename:"硬體維修記錄統計報表.pdf",image:{type:"jpeg",quality:.98},html2canvas:{scale:6,logging:!1,useCORS:!0,allowTaint:!0,removeContainer:!0},jsPDF:{unit:"mm",format:"a4",orientation:"portrait",compress:!0}};await fa().set(i).from(l).save(),ie(),v({text:"PDF 匯出成功",snackbarProps:{color:"teal-lighten-1"}})}}catch(a){console.error("匯出 PDF 失敗:",a),v({text:"匯出 PDF 失敗",snackbarProps:{color:"red-lighten-1"}})}finally{X.value=!1}},Ee=ce(()=>Object.values(oe.value).reduce((a,e)=>a+e,0)),Ue=async()=>{var a,e;try{let r=!1;if(o.value.dateError="",o.value.categoryError="",(!o.value.dateRange||o.value.dateRange.length===0)&&(o.value.dateError="請選擇日期區間",r=!0),(!o.value.hardwareCategories||o.value.hardwareCategories.length===0)&&(o.value.categoryError="請選擇至少一個硬體類型",r=!0),r)return;Y.value=!0;const l={sortBy:"maintenanceDate",sortOrder:"desc"};if(o.value.dateRange&&o.value.dateRange.length>0){const g=new Date(o.value.dateRange[0]);g.setHours(0,0,0,0);const w=o.value.dateRange.length>1?new Date(o.value.dateRange[o.value.dateRange.length-1]):new Date(o.value.dateRange[0]);w.setHours(23,59,59,999),l.maintenanceDateStart=g.toISOString(),l.maintenanceDateEnd=w.toISOString()}o.value.hardwareCategories&&o.value.hardwareCategories.length>0&&(l.hardwareCategories=o.value.hardwareCategories);const{data:i}=await R.get("/hardware/maintenance-records/export-excel",{params:l});if(i.success){const g=await ta(()=>import("./xlsx-B6sNpj_1.js"),[],import.meta.url),w=i.result.map(D=>{var Pe,Ie;return{維修單號:D.maintenanceRecordId||"",維修日期:A(D.maintenanceDate),硬體類型:((Pe=D.hardwareCategory)==null?void 0:Pe.name)||"",問題內容:D.maintenanceContent||"",處理結果:D.maintenanceResult||"",報修人:((Ie=D.reportUserEmployee)==null?void 0:Ie.name)||D.reportUser||"",備註:D.note||""}}),U=g.utils.json_to_sheet(w),ue={維修單號:15,維修日期:15,硬體類型:15,問題內容:40,處理結果:40,報修人:15,備註:30};U["!cols"]=Object.values(ue).map(D=>({wch:D}));const ze=g.utils.book_new();g.utils.book_append_sheet(ze,U,"硬體維修記錄");const aa=`硬體維修記錄_${new Date().toISOString().split("T")[0]}.xlsx`;g.writeFile(ze,aa),de(),v({text:"Excel 匯出成功",snackbarProps:{color:"teal-lighten-1"}})}}catch(r){console.error("匯出Excel失敗:",r),v({text:((e=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:e.message)||"匯出Excel失敗",snackbarProps:{color:"red-lighten-1"}})}finally{Y.value=!1}},ie=()=>{s.value.open=!1,s.value.dateRange=[],s.value.error=""},de=()=>{o.value.open=!1,o.value.dateRange=[],o.value.hardwareCategories=[],o.value.dateError="",o.value.categoryError=""},Ge=()=>{s.value.open=!0,s.value.dateRange=[],s.value.error=""},Ke=()=>{o.value.open=!0,o.value.dateRange=[],o.value.hardwareCategories=[],o.value.dateError="",o.value.categoryError=""},ea=()=>{o.value.hardwareCategories.length===k.value.length?o.value.hardwareCategories=[]:o.value.hardwareCategories=k.value.map(a=>a._id),o.value.categoryError=""};return(a,e)=>{const r=na("v-date-input");return C(),me(ba,{"max-width":"1920"},{default:n(()=>[t(O,{class:"elevation-4 rounded-lg py-4 py-sm-8 px-1 px-sm-10 mt-2 mt-sm-6 mx-0 mx-sm-4 mx-md-4 mb-4 bg-white"},{default:n(()=>[t(p,{cols:"12",class:"ps-3 pb-6"},{default:n(()=>e[21]||(e[21]=[f("div",{class:"d-flex justify-space-between align-center"},[f("h3",null,"硬體維修記錄")],-1)])),_:1}),t(p,{cols:"12",class:"mb-4"},{default:n(()=>[t(O,null,{default:n(()=>[(C(!0),P(oa,null,ra(k.value,l=>(C(),me(p,{key:l._id,cols:"12",sm:"3",lg:"1",class:"px-3"},{default:n(()=>[t(B,{class:"rounded-lg border",elevation:"0","min-height":"80"},{default:n(()=>[t(L,{class:"text-center pb-3 px-2"},{default:n(()=>[f("div",Va,h(l.name),1),Q.value?(C(),P("div",Ra,[t(Oe,{indeterminate:"",size:"20",width:"2",color:"deep-purple-darken-2"})])):(C(),P("div",{key:0,class:$e(["sub-title",Ce(l._id)>0?"text-red-darken-3":"text-grey"])},h(Ce(l._id)),3))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),t(p,{cols:"12",sm:"3",lg:"1",class:"px-3"},{default:n(()=>[t(B,{class:"rounded-lg border border-error border-opacity-50",elevation:"0","min-height":"80"},{default:n(()=>[t(L,{class:"text-center pb-3 px-2"},{default:n(()=>[e[22]||(e[22]=f("div",{class:"sub-title mb-2"}," Total ",-1)),Q.value?(C(),P("div",Sa,[t(Oe,{indeterminate:"",size:"20",width:"2",color:"deep-purple-darken-2"})])):(C(),P("div",{key:0,class:$e(["sub-title",Ee.value>0?"text-red-darken-3":"text-grey"])},h(Ee.value),3))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(p,{cols:"12"},{default:n(()=>[t(O,null,{default:n(()=>[t(p,null,{default:n(()=>[t(O,null,{default:n(()=>[t(p,{cols:"2"},{default:n(()=>[t(y,{"prepend-icon":"mdi-plus",variant:"outlined",color:"blue-grey-darken-1",onClick:e[0]||(e[0]=l=>Se(null))},{default:n(()=>e[23]||(e[23]=[u(" 新增維修記錄 ")])),_:1})]),_:1}),t(p,{cols:"8",class:"pe-16"},{default:n(()=>[t(O,null,{default:n(()=>[t(p,{cols:"4"},{default:n(()=>[t(r,{modelValue:c.value.maintenanceDateRange,"onUpdate:modelValue":e[1]||(e[1]=l=>c.value.maintenanceDateRange=l),label:"維修日期區間",variant:"outlined",density:"compact","hide-details":"",multiple:"range","prepend-icon":"",clearable:"","cancel-text":"取消","ok-text":"確認","onClick:clear":qe},null,8,["modelValue"])]),_:1}),t(p,{cols:"4"},{default:n(()=>[t(ge,{modelValue:c.value.hardwareCategory,"onUpdate:modelValue":e[2]||(e[2]=l=>c.value.hardwareCategory=l),items:k.value,"item-title":"name","item-value":"_id",variant:"outlined","hide-details":"",label:"硬體類型",clearable:"",density:"compact"},null,8,["modelValue","items"])]),_:1}),t(p,{cols:"4",class:"d-flex align-center"},{default:n(()=>[t(y,{color:"grey",size:b.value,loading:x.value,class:"me-4",onClick:Ze},{default:n(()=>[t(V,null,{default:n(()=>e[24]||(e[24]=[u("mdi-refresh")])),_:1})]),_:1},8,["size","loading"]),t(y,{color:"cyan-darken-2",size:b.value,loading:x.value,"prepend-icon":"mdi-magnify",class:"me-4",onClick:Ye},{default:n(()=>e[25]||(e[25]=[u(" 搜尋 ")])),_:1},8,["size","loading"]),t(y,{"prepend-icon":"mdi-file-pdf-box",color:"red-lighten-1",class:"me-4",size:b.value,onClick:Ge},{default:n(()=>e[26]||(e[26]=[u(" 匯出 ")])),_:1},8,["size"]),t(y,{"prepend-icon":"mdi-file-excel",color:"teal-darken-1",size:b.value,onClick:Ke},{default:n(()=>e[27]||(e[27]=[u(" 匯出 ")])),_:1},8,["size"])]),_:1})]),_:1})]),_:1}),t(p,{cols:"12",md:"2",class:"d-flex align-center"},{default:n(()=>[m(we)?sa((C(),me(V,{key:0,icon:"mdi-information",size:"small",color:"blue-grey-darken-2",class:"me-4"},null,512)),[[Ca,"可搜尋維修單號、問題內容、處理結果、報修人、備註","top"]]):Fe("",!0),t(xa,{modelValue:H.value,"onUpdate:modelValue":[e[3]||(e[3]=l=>H.value=l),Re],label:"快速搜尋","append-inner-icon":"mdi-magnify",loading:x.value,"base-color":"#666",color:"blue-grey-darken-3",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue","loading"])]),_:1})]),_:1})]),_:1}),t(p,{cols:"12"},{default:n(()=>[t(wa,{"items-per-page":q.value,"onUpdate:itemsPerPage":[e[4]||(e[4]=l=>q.value=l),e[6]||(e[6]=l=>j(!1))],"sort-by":N.value,"onUpdate:sortBy":[e[5]||(e[5]=l=>N.value=l),e[7]||(e[7]=l=>j(!1))],page:M.value,density:"compact",class:"rounded-ts-lg rounded-te-lg py-3","items-per-page-options":[10,20,50],items:ke.value,headers:Ae,loading:ne.value,"items-length":re.value,hover:"","onUpdate:page":We},{item:n(({item:l})=>{var i;return[f("tr",null,[f("td",null,h(l.maintenanceRecordId),1),f("td",null,h(A(l.maintenanceDate)),1),f("td",null,h(Le(l.hardwareCategory)),1),f("td",null,h(l.maintenanceContent),1),f("td",null,h(l.maintenanceResult),1),f("td",null,h(((i=l.reportUserEmployee)==null?void 0:i.name)||l.reportUser),1),f("td",null,h(l.note),1),f("td",_a,[t(y,{icon:"",color:"light-blue-darken-4",variant:"plain",width:"28",size:b.value,ripple:!1,class:"me-2",onClick:g=>Se(l)},{default:n(()=>[t(V,null,{default:n(()=>e[28]||(e[28]=[u("mdi-pencil")])),_:1})]),_:2},1032,["size","onClick"]),t(y,{icon:"",color:"red-lighten-1",variant:"plain",width:"28",size:b.value,ripple:!1,onClick:g=>Je(l)},{default:n(()=>[t(V,null,{default:n(()=>e[29]||(e[29]=[u("mdi-delete")])),_:1})]),_:2},1032,["size","onClick"])])])]}),_:1},8,["items-per-page","sort-by","page","items","loading","items-length"])]),_:1})]),_:1})]),_:1})]),_:1}),t(be,{modelValue:S.value.open,"onUpdate:modelValue":e[14]||(e[14]=l=>S.value.open=l),persistent:"",width:Te.value,"no-click-animation":I.value},{default:n(()=>[t(B,{class:"rounded-lg"},{default:n(()=>[f("div",Ea,[t(V,{size:"20",color:"white",class:"me-2"},{default:n(()=>e[30]||(e[30]=[u(" mdi-wrench ")])),_:1}),u(" "+h(S.value.id?"編輯維修記錄":"新增維修記錄")+" ",1),t(T),t(y,{icon:"",color:"white",variant:"plain",class:"opacity-100",ripple:!1,size:"20",onClick:W},{default:n(()=>[t(V,null,{default:n(()=>e[31]||(e[31]=[u("mdi-close")])),_:1})]),_:1})]),t(L,{class:"mt-6 mb-0 px-6 pb-4"},{default:n(()=>[t(ve,{ref_key:"maintenanceFormRef",ref:Xe,disabled:I.value,onSubmit:pe(m(Ne),["prevent"])},{default:n(()=>[t(O,null,{default:n(()=>[t(p,{cols:"12",sm:"4"},{default:n(()=>[t(ge,{modelValue:m(G).value.value,"onUpdate:modelValue":e[8]||(e[8]=l=>m(G).value.value=l),"error-messages":m(G).errorMessage.value,items:k.value,"item-title":"name","item-value":"_id",label:"*硬體類型",variant:"outlined",density:"compact",required:""},null,8,["modelValue","error-messages","items"])]),_:1}),t(p,{cols:"12",sm:"4"},{default:n(()=>[t(r,{modelValue:m(K).value.value,"onUpdate:modelValue":e[9]||(e[9]=l=>m(K).value.value=l),"error-messages":m(K).errorMessage.value,label:"*維修日期",variant:"outlined",density:"compact",clearable:"","prepend-icon":"","cancel-text":"取消","ok-text":"確認"},null,8,["modelValue","error-messages"])]),_:1}),t(p,{cols:"12",sm:"4"},{default:n(()=>[t(ha,{modelValue:m(te).value.value,"onUpdate:modelValue":e[10]||(e[10]=l=>m(te).value.value=l),items:he.value,"item-title":"label","item-value":"value",label:"報修人",variant:"outlined",density:"compact",clearable:"","error-messages":m(te).errorMessage.value},null,8,["modelValue","items","error-messages"])]),_:1}),t(p,{cols:"12"},{default:n(()=>[t(fe,{modelValue:m(ee).value.value,"onUpdate:modelValue":e[11]||(e[11]=l=>m(ee).value.value=l),"error-messages":m(ee).errorMessage.value,label:"*問題內容",variant:"outlined",density:"compact",rows:"4"},null,8,["modelValue","error-messages"])]),_:1}),t(p,{cols:"12"},{default:n(()=>[t(fe,{modelValue:m(ae).value.value,"onUpdate:modelValue":e[12]||(e[12]=l=>m(ae).value.value=l),"error-messages":m(ae).errorMessage.value,label:"*處理結果",variant:"outlined",density:"compact",rows:"4"},null,8,["modelValue","error-messages"])]),_:1}),t(p,{cols:"12"},{default:n(()=>[t(fe,{modelValue:m(le).value.value,"onUpdate:modelValue":e[13]||(e[13]=l=>m(le).value.value=l),"error-messages":m(le).errorMessage.value,label:"備註",variant:"outlined",density:"compact","hide-details":"",rows:"4"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),t(ye,{class:"px-0 mt-4"},{default:n(()=>[t(T),t(y,{color:"grey-darken-1",variant:"outlined",size:b.value,loading:I.value,onClick:W},{default:n(()=>e[32]||(e[32]=[u(" 取消 ")])),_:1},8,["size","loading"]),t(y,{color:"teal-darken-1",variant:"outlined",type:"submit",class:"ms-1",size:b.value,loading:I.value},{default:n(()=>e[33]||(e[33]=[u(" 送出 ")])),_:1},8,["size","loading"])]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue","width","no-click-animation"]),t(ma,{modelValue:_.value.open,"onUpdate:modelValue":e[15]||(e[15]=l=>_.value.open=l),"dialog-width":"320",title:"確認刪除維修記錄",message:"確定要刪除此維修記錄嗎？此操作無法復原。",onConfirm:Qe},null,8,["modelValue"]),t(be,{modelValue:s.value.open,"onUpdate:modelValue":e[17]||(e[17]=l=>s.value.open=l),persistent:"","max-width":"320","no-click-animation":X.value},{default:n(()=>[t(B,{class:"rounded-lg"},{default:n(()=>[f("div",Ua,[t(V,{size:"20",color:"white",class:"me-2"},{default:n(()=>e[34]||(e[34]=[u(" mdi-file-pdf-box ")])),_:1}),e[36]||(e[36]=u(" 匯出 PDF 報表 ")),t(T),t(y,{icon:"",color:"white",variant:"plain",class:"opacity-100",ripple:!1,size:"20",onClick:ie},{default:n(()=>[t(V,null,{default:n(()=>e[35]||(e[35]=[u("mdi-close")])),_:1})]),_:1})]),t(L,{class:"px-6 pt-7 pb-0"},{default:n(()=>[t(ve,{onSubmit:pe(_e,["prevent"])},{default:n(()=>[t(r,{modelValue:s.value.dateRange,"onUpdate:modelValue":e[16]||(e[16]=l=>s.value.dateRange=l),label:"維修日期區間",variant:"outlined",density:"compact",multiple:"range","prepend-icon":"",clearable:"",class:"mb-4","cancel-text":"取消","ok-text":"確認","error-messages":s.value.error},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),t(ye,{class:"px-6 pb-5"},{default:n(()=>[t(T),t(y,{color:"grey",variant:"outlined",class:"me-1",size:b.value,onClick:ie},{default:n(()=>e[37]||(e[37]=[u(" 取消 ")])),_:1},8,["size"]),t(y,{color:"red-lighten-1",variant:"outlined",size:b.value,loading:X.value,onClick:_e},{default:n(()=>e[38]||(e[38]=[u(" 匯出 ")])),_:1},8,["size","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue","no-click-animation"]),t(be,{modelValue:o.value.open,"onUpdate:modelValue":e[20]||(e[20]=l=>o.value.open=l),persistent:"","max-width":"360","no-click-animation":Y.value},{default:n(()=>[t(B,{class:"rounded-lg"},{default:n(()=>[f("div",za,[t(V,{size:"20",color:"white",class:"me-2"},{default:n(()=>e[39]||(e[39]=[u(" mdi-file-excel ")])),_:1}),e[41]||(e[41]=u(" 匯出 Excel 報表 ")),t(T),t(y,{icon:"",color:"white",variant:"plain",class:"opacity-100",ripple:!1,size:"20",onClick:de},{default:n(()=>[t(V,null,{default:n(()=>e[40]||(e[40]=[u("mdi-close")])),_:1})]),_:1})]),t(L,{class:"px-6 pt-7 pb-0"},{default:n(()=>[t(ve,{onSubmit:pe(Ue,["prevent"])},{default:n(()=>[t(r,{modelValue:o.value.dateRange,"onUpdate:modelValue":e[18]||(e[18]=l=>o.value.dateRange=l),label:"*維修日期區間",variant:"outlined",density:"compact",multiple:"range","prepend-icon":"",clearable:"",class:"mb-4","cancel-text":"取消","ok-text":"確認","error-messages":o.value.dateError},null,8,["modelValue","error-messages"]),t(ge,{modelValue:o.value.hardwareCategories,"onUpdate:modelValue":e[19]||(e[19]=l=>o.value.hardwareCategories=l),items:k.value,"item-title":"name","item-value":"_id",variant:"outlined",density:"compact",label:"*硬體類型",clearable:"",multiple:"",class:"mb-4","error-messages":o.value.categoryError},{selection:n(({item:l,index:i})=>[i===0?(C(),P("span",Pa,h(l.raw.name),1)):i===1?(C(),P("span",Ia,"...")):Fe("",!0)]),"prepend-item":n(()=>[t(ka,{title:"全選",color:"teal-darken-1","prepend-icon":"mdi-checkbox-multiple-marked",active:o.value.hardwareCategories.length===k.value.length,onClick:ea},null,8,["active"]),t(Da,{class:"mt-2"})]),_:1},8,["modelValue","items","error-messages"])]),_:1})]),_:1}),t(ye,{class:"px-6 pb-5"},{default:n(()=>[t(T),t(y,{color:"grey",variant:"outlined",class:"me-1",size:b.value,onClick:de},{default:n(()=>e[42]||(e[42]=[u(" 取消 ")])),_:1},8,["size"]),t(y,{color:"teal-darken-1",variant:"outlined",size:b.value,loading:Y.value,onClick:Ue},{default:n(()=>e[43]||(e[43]=[u(" 匯出 ")])),_:1},8,["size","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue","no-click-animation"])]),_:1})}}},ut=da($a,[["__scopeId","data-v-d6aaa9e2"]]);export{ut as default};

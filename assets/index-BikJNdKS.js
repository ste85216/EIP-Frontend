import{_ as W,u as Z,b as E}from"./index-mGnb0KKF.js";import{i as G}from"./vuetify-use-dialog-C5oZ13xz.js";import{u as K}from"./project-C-PnggKy.js";import{C as X}from"./CreateProjectDialog-D7JZCG5y.js";import{H as Y}from"./HistoryProjectsDialog-cgPL-jQH.js";import{u as ee}from"./team-_bHli350.js";import{b as w}from"./route-block-B_A1xBdJ.js";import{q as te,Q as oe,w as D,g as x,r as b,d as ae,v as z,a as se,c as re,O as le,F as T,T as ne}from"./vuetify-CbddcmEc.js";import{r as i,f as V,w as ie,k as ce,aV as S,Z as A,bH as s,b2 as de,a8 as a,a0 as l,bJ as ue,u as p,a7 as c,_ as me,bf as f}from"./@vue-Cr_z6yfx.js";/* empty css             */import"./pinia-DBRIaiZ_.js";import"./vue-demi-Dq6ymT-8.js";import"./pinia-plugin-persistedstate-RV7uh3T-.js";import"./vue-router-CS4OewbW.js";import"./jspdf-DacfHTdZ.js";import"./core-js-D2hAHviU.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./unplugin-vue-router-B1N3mqWX.js";import"./axios-upsvKRUO.js";import"./vue3-google-login-Dx7TV_Hx.js";import"./vue-easy-lightbox-D952uME8.js";import"./perfect-debounce-Cp2ysxOb.js";import"./hookable-B8xFkYCm.js";const pe={class:"d-flex align-center justify-space-between"},fe={class:"d-flex align-center"},ge={class:"d-flex align-center"},ve={class:"d-flex align-center"},_e={class:"d-flex align-center"},I={__name:"index",setup(ke){const{apiAuth:h}=E(),g=G(),v=Z(),_=K(),U=ee(),d=i([]),k=i(!1),y=i(!1),C=i(!1),u=i(""),{smAndUp:m}=te(),q=V(()=>(U.teams||[]).some(e=>{var r;return(r=e==null?void 0:e.managers)==null?void 0:r.some(t=>t._id===v._id)})),B=V(()=>d.value.map(o=>{const e=_.projects.find(r=>r._id===o._id);return e?{...o,...e,iconColor:e.iconColor!==void 0?e.iconColor:o.iconColor,favorites:e.favorites||o.favorites}:o})),F=V(()=>{const o=B.value.filter(r=>r.status!=="completed");if(!u.value.trim())return o;const e=u.value.toLowerCase().trim();return o.filter(r=>r.name.toLowerCase().includes(e))}),H=[{title:"專案名稱",key:"name",sortable:!0},{title:"所屬團隊",key:"team",sortable:!0},{title:"狀態",key:"status",sortable:!0},{title:"收藏",key:"favorite",sortable:!1},{title:"建立日期",key:"createdAt",sortable:!0}],j=async()=>{try{k.value=!0;const{data:o}=await h.get("/projects/my-projects");o.success&&(d.value=o.data)}catch(o){console.error("載入專案列表失敗:",o),g({text:"載入專案列表失敗",snackbarProps:{color:"red-lighten-1"}})}finally{k.value=!1}},N=()=>{y.value=!0},L=()=>{C.value=!0},$=o=>{console.log("專案建立成功:",o),j()},M=o=>o?new Date(o).toLocaleDateString("zh-TW"):"-",Q=o=>({"on-track":"green","at-risk":"orange","off-track":"red","on-hold":"grey-darken-2",completed:"blue"})[o]||"grey-darken-1",J=o=>({"on-track":"進度正常","at-risk":"存在風險","off-track":"偏離進度","on-hold":"擱置中",completed:"完成"})[o]||"尚未設定",P=o=>!o.favorites||!v._id?!1:o.favorites.some(e=>(typeof e.user=="string"?e.user:e.user._id)===v._id),O=async o=>{var e,r;try{const{data:t}=await h.post(`/projects/${o._id}/favorite`);if(t.success){const n=d.value.findIndex(R=>R._id===o._id);n!==-1&&(d.value[n]=t.data),_.updateProject(o._id,t.data),g({text:t.message,snackbarProps:{color:"teal-lighten-1"}})}}catch(t){console.error("切換收藏狀態失敗:",t),g({text:((r=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:r.message)||"切換收藏狀態失敗",snackbarProps:{color:"red-lighten-1"}})}};return ie(()=>_.projects,()=>{},{deep:!0}),ce(()=>{j()}),(o,e)=>{const r=de("router-link");return S(),A(oe,{"max-width":"1280",class:"pt-0 pt-sm-4"},{default:s(()=>[a(z,{class:"mt-2 mx-0 py-2 px-0 px-sm-2 rounded-lg bg-white"},{default:s(()=>[a(D,{cols:"12",class:"pa-0"},{default:s(()=>[l("div",pe,[l("div",fe,[e[4]||(e[4]=l("span",{class:"page-title"}," 我的專案 ",-1)),q.value?ue((S(),A(x,{key:0,icon:"",size:p(m)?"32":"24",color:"grey-darken-3",class:"ms-2",variant:"plain",onClick:N},{default:s(()=>[a(b,{size:p(m)?"24":"16"},{default:s(()=>e[3]||(e[3]=[c(" mdi-plus ")])),_:1},8,["size"])]),_:1},8,["size"])),[[ne,"新增專案","end"]]):me("",!0)]),l("div",ge,[a(x,{icon:"",size:p(m)?"32":"24",color:"grey-darken-3",class:"me-3",variant:"plain",onClick:L},{default:s(()=>[a(b,{size:p(m)?"24":"16"},{default:s(()=>e[5]||(e[5]=[c(" mdi-history ")])),_:1},8,["size"])]),_:1},8,["size"]),a(ae,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=t=>u.value=t),placeholder:"搜尋專案名稱...","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"","hide-details":"",class:"search-field"},null,8,["modelValue"])])])]),_:1})]),_:1}),a(z,null,{default:s(()=>[a(D,{cols:"12"},{default:s(()=>[a(se,{elevation:"0"},{default:s(()=>[a(re,{class:"px-2 pt-2"},{default:s(()=>[a(le,{headers:H,items:F.value,loading:k.value,hover:"",density:"compact","item-key":"_id","items-per-page":25,"items-per-page-options":[10,25,50,100,-1]},{item:s(({item:t})=>[l("tr",null,[l("td",null,[l("div",ve,[a(b,{icon:t.iconColor&&t.iconColor!=="white"?"mdi-square-rounded":"mdi-square-rounded-outline",class:"me-2",color:t.iconColor&&t.iconColor!=="white"?t.iconColor:"grey-darken-1"},null,8,["icon","color"]),a(r,{to:`/projectAndTaskManagement/projects/${t._id}`,class:"text-decoration-none text-blue-darken-2 font-weight-medium project-name-link"},{default:s(()=>[c(f(t.name),1)]),_:2},1032,["to"])])]),l("td",null,[l("div",_e,[a(T,{size:"small",color:"blue-darken-2"},{default:s(()=>{var n;return[c(f(((n=t.team)==null?void 0:n.name)||"未分配團隊"),1)]}),_:2},1024)])]),l("td",null,[a(T,{color:Q(t.status),size:"small"},{default:s(()=>[c(f(J(t.status)),1)]),_:2},1032,["color"])]),l("td",null,[a(x,{icon:P(t)?"mdi-star":"mdi-star-outline",size:"small",variant:"text",color:P(t)?"amber":"grey",onClick:n=>O(t)},null,8,["icon","color","onClick"])]),l("td",null,f(M(t.createdAt)),1)])]),_:1},8,["items","loading"])]),_:1})]),_:1})]),_:1})]),_:1}),a(X,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=t=>y.value=t),onProjectCreated:$},null,8,["modelValue"]),a(Y,{modelValue:C.value,"onUpdate:modelValue":e[2]||(e[2]=t=>C.value=t)},null,8,["modelValue"])]),_:1})}}};typeof w=="function"&&w(I);const Qe=W(I,[["__scopeId","data-v-16696fed"]]);export{Qe as default};

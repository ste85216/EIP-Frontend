import{u as G}from"./vue-router-CS4OewbW.js";import{i as K}from"./vuetify-use-dialog-C5oZ13xz.js";import{l as X}from"./lodash-CiJWSuVn.js";import{_ as ee,b as te}from"./index-ZcDhEpUM.js";import{q as ae,Q as ne,w as p,v as w,f as se,P as le,r as h,d as re,R as oe,J as T,F as U,T as ie}from"./vuetify-CbddcmEc.js";import{r as g,f as ce,w as $,k as ue,aV as i,Z as S,bH as s,a8 as n,a0 as l,u as d,bJ as de,_ as P,$ as y,a7 as C,bf as x,aH as me}from"./@vue-Cr_z6yfx.js";import"./core-js-D2hAHviU.js";/* empty css             */import"./pinia-DBRIaiZ_.js";import"./vue-demi-Dq6ymT-8.js";import"./pinia-plugin-persistedstate-RV7uh3T-.js";import"./jspdf-DacfHTdZ.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./unplugin-vue-router-B1N3mqWX.js";import"./axios-upsvKRUO.js";import"./vue3-google-login-Dx7TV_Hx.js";import"./vue-easy-lightbox-D952uME8.js";import"./perfect-debounce-Cp2ysxOb.js";import"./hookable-B8xFkYCm.js";const pe={class:"text-center py-8"},ve={key:0,class:"text-center py-8"},ge={key:1,class:"text-center py-8 text-grey-darken-1"},ye=["onClick"],fe={class:"d-flex align-center justify-center"},he={class:"text-truncate text-center d-flex align-center justify-center"},xe={key:0,class:"me-3"},be={key:0,class:"pinned-badge"},_e={key:0,class:"text-center"},ke={class:"text-center"},we={key:1,class:"text-center pe-9"},Pe={__name:"index",setup(Ve){const I=G(),B=K(),{apiAuth:N}=te(),{smAndUp:b,mdAndUp:_,lgAndUp:z}=ae(),A=g([]),c=g(!1),m=g(20),u=g(1),f=g(0),r=g({type:null,search:""}),O=[{title:"全部",value:null},{title:"系統公告",value:"system"},{title:"更新公告",value:"update"},{title:"一般公告",value:"announcement"},{title:"維護公告",value:"maintenance"},{title:"活動公告",value:"event"}],W=[10,20,50,100,{value:-1,title:"全部"}],F=ce(()=>[{title:"類型",key:"type",sortable:!1,align:"center",width:"145px"},{title:"標題",key:"title",sortable:!1,align:"center"},{title:"建立者",key:"creator",sortable:!1,align:"center",minWidth:"120px"},{title:"發布時間",key:"createdAt",sortable:!0,align:"center",minWidth:"120px"},{title:"瀏覽次數",key:"viewCount",sortable:!0,align:"center",minWidth:"120px"}].filter(e=>!(e.key==="creator"&&!_.value||e.key==="viewCount"&&!z.value))),k=async()=>{var a,e;try{c.value=!0;const t={page:u.value,itemsPerPage:m.value===-1?f.value>0?f.value:999999:m.value,sortBy:"createdAt",sortOrder:"desc"};r.value.type&&(t.type=r.value.type),r.value.search&&(t.search=r.value.search),t.isActive=!0;const o=await N.get("/announcements",{params:t}),v=o.data.result.data;A.value=v.sort((V,M)=>V.isPinned&&!M.isPinned?-1:!V.isPinned&&M.isPinned?1:0),f.value=o.data.result.totalItems}catch(t){console.error("載入公告錯誤:",t),B({text:((e=(a=t.response)==null?void 0:a.data)==null?void 0:e.message)||t.message||"載入公告失敗",snackbarProps:{color:"red-lighten-1"}})}finally{c.value=!1}},D=async()=>{u.value=1,await k()},R=X.debounce(()=>{u.value=1,c.value=!0,D().finally(()=>{c.value=!1})},300),j=()=>{m.value===-1&&(u.value=1),k()},E=a=>{if(m.value===-1)return;a<1&&(a=1);const e=Math.ceil(f.value/m.value);a>e&&(a=e),u.value!==a&&(u.value=a,k())},H=a=>{I.push(`/announcement/${a._id}`)},J=a=>({system:"系統",update:"更新",announcement:"一般",maintenance:"維護",event:"活動"})[a]||"一般",L=a=>({system:"blue-darken-2",update:"cyan-darken-3",announcement:"grey-darken-2",maintenance:"red-darken-1",event:"indigo-darken-1"})[a]||"grey",q=a=>({system:"mdi-cog-outline",update:"mdi-refresh",announcement:"mdi-bullhorn-outline",maintenance:"mdi-wrench-outline",event:"mdi-calendar-star"})[a]||"mdi-file-document-outline",Q=a=>a?new Date(a).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}):"-",Y=a=>{if(!a)return"-";const e=new Date(a),t=e.getFullYear(),o=(e.getMonth()+1).toString().padStart(2,"0"),v=e.getDate().toString().padStart(2,"0");return`${t}/${o}/${v}`},Z=a=>{if(!a)return"-";const e=new Date(a),t=(e.getMonth()+1).toString().padStart(2,"0"),o=e.getDate().toString().padStart(2,"0");return`${t}/${o}`};return $(()=>r.value.search,()=>{R()}),$(()=>r.value.type,()=>{u.value=1,c.value=!0,D().finally(()=>{c.value=!1})}),ue(()=>{k()}),(a,e)=>(i(),S(ne,{"max-width":"1400"},{default:s(()=>[n(w,{class:"elevation-4 rounded-lg py-4 pt-sm-6 pb-sm-4 px-1 px-sm-6 mt-2 mt-sm-6 mx-0 mx-sm-4 mx-md-4 mb-4 bg-white"},{default:s(()=>[n(p,{cols:"12"},{default:s(()=>[n(w,null,{default:s(()=>[n(p,{class:"mb-sm-3"},{default:s(()=>[n(w,{class:"d-flex align-center"},{default:s(()=>[n(p,{cols:"12",sm:"3",class:"ps-3"},{default:s(()=>e[3]||(e[3]=[l("h3",null,"所有公告",-1)])),_:1}),n(se),n(p,{sm:"4",md:"3",lg:"2",class:"pe-1"},{default:s(()=>[n(le,{modelValue:r.value.type,"onUpdate:modelValue":e[0]||(e[0]=t=>r.value.type=t),items:O,"item-title":"title","item-value":"value",label:"類型篩選",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),n(p,{sm:"4",lg:"3"},{default:s(()=>[n(w,{class:"d-flex align-center"},{default:s(()=>[n(p,{class:"d-flex align-center"},{default:s(()=>[d(_)?de((i(),S(h,{key:0,icon:"mdi-information",size:"small",color:"blue-grey-darken-2",class:"me-4"},null,512)),[[ie,"可搜尋標題或內容","top"]]):P("",!0),n(re,{modelValue:r.value.search,"onUpdate:modelValue":e[1]||(e[1]=t=>r.value.search=t),label:"快速搜尋","append-inner-icon":"mdi-magnify","base-color":"#666",color:"blue-grey-darken-3",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),n(p,{cols:"12"},{default:s(()=>[n(oe,{"items-per-page":m.value,"onUpdate:itemsPerPage":[e[2]||(e[2]=t=>m.value=t),j],headers:F.value,items:A.value,loading:c.value,"items-per-page-options":W,page:u.value,"items-length":f.value,class:"elevation-0 rounded",density:"compact","onUpdate:page":E},{loading:s(()=>[l("div",pe,[n(T,{indeterminate:"",color:"blue-grey-darken-2",size:"48",width:"6"}),e[4]||(e[4]=l("div",{class:"mt-4 text-grey-darken-1"}," 載入中... ",-1))])]),"no-data":s(()=>[c.value?(i(),y("div",ve,[n(T,{indeterminate:"",color:"blue-grey-darken-2",size:"48",width:"6"}),e[5]||(e[5]=l("div",{class:"mt-4 text-grey-darken-1"}," 載入中... ",-1))])):(i(),y("div",ge," 沒有找到符合條件的公告 "))]),item:s(({item:t,index:o})=>{var v;return[l("tr",{class:me([{"odd-row":o%2===0,"even-row":o%2!==0},"announcement-table"]),onClick:V=>H(t)},[l("td",null,[l("div",fe,[n(U,{label:"",color:L(t.type),size:d(b)?"small":"x-small"},{default:s(()=>[n(h,{icon:q(t.type),size:d(b)?"16":"12",class:"me-1"},null,8,["icon","size"]),C(" "+x(J(t.type)),1)]),_:2},1032,["color","size"])])]),l("td",null,[l("div",he,[t.isPinned?(i(),y("span",xe,[d(b)?(i(),y("div",be,[n(h,{icon:"mdi-arrow-up-bold",size:"10",color:"white",style:{"margin-right":"1px"}}),e[6]||(e[6]=C(" 置頂 "))])):(i(),S(h,{key:1,icon:"mdi-arrow-up-bold-box",size:"15",color:"blue-grey-darken-1"}))])):P("",!0),l("span",null,x(t.title),1)])]),d(_)?(i(),y("td",_e,x(((v=t.creator)==null?void 0:v.name)||"未知"),1)):P("",!0),l("td",ke,x(d(_)?Q(t.createdAt):d(b)?Y(t.createdAt):Z(t.createdAt)),1),d(z)?(i(),y("td",we,[n(U,{size:"small",color:"blue-grey-lighten-1"},{default:s(()=>[n(h,{icon:"mdi-eye",size:"14",class:"me-1"}),C(" "+x(t.viewCount||0),1)]),_:2},1024)])):P("",!0)],10,ye)]}),_:1},8,["items-per-page","headers","items","loading","page","items-length"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}},Le=ee(Pe,[["__scopeId","data-v-32144952"]]);export{Le as default};

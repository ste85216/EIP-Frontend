import{_ as M,a as O,b as Q}from"./index-mGnb0KKF.js";import{i as R}from"./vuetify-use-dialog-C5oZ13xz.js";import{u as H}from"./team-_bHli350.js";import{_ as W}from"./CreateTeamDialog-CD3s2nYk.js";import{_ as Z}from"./UserAvatar-CwvpGxzs.js";import{b as k}from"./route-block-B_A1xBdJ.js";import{q as X,Q as Y,w as b,g as ee,r as te,d as ae,v as T,a as se,c as oe,O as le,K as V,F as w,T as re}from"./vuetify-CbddcmEc.js";import{r as g,f as x,k as ne,aV as n,Z as c,bH as s,b2 as ie,a8 as o,a0 as a,bJ as ce,u as C,a7 as p,_ as y,bf as i,$ as d,b0 as A,aG as D,F as z}from"./@vue-Cr_z6yfx.js";/* empty css             */import"./pinia-DBRIaiZ_.js";import"./vue-demi-Dq6ymT-8.js";import"./pinia-plugin-persistedstate-RV7uh3T-.js";import"./vue-router-CS4OewbW.js";import"./jspdf-DacfHTdZ.js";import"./core-js-D2hAHviU.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./unplugin-vue-router-B1N3mqWX.js";import"./axios-upsvKRUO.js";import"./vue3-google-login-Dx7TV_Hx.js";import"./vue-easy-lightbox-D952uME8.js";import"./perfect-debounce-Cp2ysxOb.js";import"./hookable-B8xFkYCm.js";const de={class:"d-flex align-center justify-space-between"},me={class:"d-flex align-center"},pe={class:"d-flex align-center"},ue={class:"d-flex align-center"},fe={class:"d-flex align-center"},_e={class:"text-caption text-grey ms-2"},ge={class:"d-flex align-center"},xe={key:0,class:"text-caption text-grey"},ye={style:{"max-width":"200px"}},he=["title"],ve={key:1,class:"text-grey"},S={__name:"index",setup(ke){const{apiAuth:N}=Q(),{createSnackbar:j}=R(),u=H(),B=O(),f=g(!1),_=g(!1),m=g(""),{smAndUp:h}=X(),P=x(()=>B.hasPermission("PROJECT_AND_TASK_MANAGE")),v=x(()=>u.teams),E=x(()=>{if(!m.value.trim())return v.value;const t=m.value.toLowerCase().trim();return v.value.filter(l=>l.name.toLowerCase().includes(t))}),F=[{title:"團隊名稱",key:"name",sortable:!0},{title:"成員",key:"members",sortable:!1},{title:"管理者",key:"managers",sortable:!1},{title:"專案數量",key:"projects",sortable:!0},{title:"描述",key:"description",sortable:!1},{title:"建立日期",key:"createdAt",sortable:!0}],L=async()=>{try{f.value=!0;const{data:t}=await N.get("/teams/my-teams");t.success&&u.setTeams(t.data)}catch(t){console.error("載入團隊列表失敗:",t),j({text:"載入團隊列表失敗",snackbarProps:{color:"red-lighten-1"}})}finally{f.value=!1}},$=()=>{_.value=!0},I=t=>{console.log("團隊建立成功:",t),u.addTeam(t)},U=t=>t?new Date(t).toLocaleDateString("zh-TW"):"-",q=t=>!t||t.length===0?"":t.map(l=>l.name).join("、");return ne(()=>{L()}),(t,l)=>{const G=ie("router-link");return n(),c(Y,{"max-width":"1280",class:"pt-0 pt-sm-4"},{default:s(()=>[o(T,{class:"mt-2 mx-0 py-2 px-0 px-sm-2 rounded-lg bg-white"},{default:s(()=>[o(b,{cols:"12",class:"pa-0"},{default:s(()=>[a("div",de,[a("div",me,[l[3]||(l[3]=a("span",{class:"page-title"}," 我的團隊 ",-1)),P.value?ce((n(),c(ee,{key:0,icon:"",size:C(h)?"32":"24",color:"grey-darken-3",class:"ms-2",variant:"plain",onClick:$},{default:s(()=>[o(te,{size:C(h)?"24":"16"},{default:s(()=>l[2]||(l[2]=[p(" mdi-plus ")])),_:1},8,["size"])]),_:1},8,["size"])),[[re,"新增團隊","end"]]):y("",!0)]),a("div",pe,[o(ae,{modelValue:m.value,"onUpdate:modelValue":l[0]||(l[0]=e=>m.value=e),placeholder:"搜尋團隊名稱...","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"","hide-details":"",class:"search-field"},null,8,["modelValue"])])])]),_:1})]),_:1}),o(T,null,{default:s(()=>[o(b,{cols:"12"},{default:s(()=>[o(se,{elevation:"0"},{default:s(()=>[o(oe,{class:"px-2 pt-2"},{default:s(()=>[o(le,{headers:F,items:E.value,loading:f.value,hover:"",density:"compact","item-key":"_id","items-per-page":25,"items-per-page-options":[10,25,50,100,-1]},{item:s(({item:e})=>[a("tr",null,[a("td",null,[a("div",ue,[o(G,{to:`/projectAndTaskManagement/teams/${e._id}`,class:"text-decoration-none text-blue-darken-2 font-weight-medium team-name-link"},{default:s(()=>[p(i(e.name),1)]),_:2},1032,["to"])])]),a("td",null,[a("div",fe,[(n(!0),d(z,null,A(e.members.slice(0,3),(r,J)=>(n(),c(V,{key:r._id,text:r.name,location:"top"},{activator:s(({props:K})=>[o(Z,D({ref_for:!0},K,{user:r,size:"24","avatar-class":"me-n2",style:{zIndex:3-J}}),null,16,["user","style"])]),_:2},1032,["text"]))),128)),e.members.length>3?(n(),c(V,{key:0,text:q(e.members.slice(3)),location:"top"},{activator:s(({props:r})=>[a("span",D(r,{class:"text-caption text-grey ms-2"})," +"+i(e.members.length-3),17)]),_:2},1032,["text"])):y("",!0),a("span",_e," ("+i(e.members.length)+" 人) ",1)])]),a("td",null,[a("div",ge,[(n(!0),d(z,null,A(e.managers.slice(0,2),r=>(n(),c(w,{key:r._id,size:"small",color:"teal-darken-1",class:"me-1"},{default:s(()=>[p(i(r.name),1)]),_:2},1024))),128)),e.managers.length>2?(n(),d("span",xe," +"+i(e.managers.length-2),1)):y("",!0)])]),a("td",null,[o(w,{size:"small",color:"blue-darken-2"},{default:s(()=>{var r;return[p(i(((r=e.projects)==null?void 0:r.length)||0)+" 個專案 ",1)]}),_:2},1024)]),a("td",ye,[e.description?(n(),d("span",{key:0,class:"text-truncate",style:{display:"block","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","max-width":"200px"},title:e.description},i(e.description),9,he)):(n(),d("span",ve,"無描述"))]),a("td",null,i(U(e.createdAt)),1)])]),_:1},8,["items","loading"])]),_:1})]),_:1})]),_:1})]),_:1}),o(W,{modelValue:_.value,"onUpdate:modelValue":l[1]||(l[1]=e=>_.value=e),onTeamCreated:I},null,8,["modelValue"])]),_:1})}}};typeof k=="function"&&k(S);const Me=M(S,[["__scopeId","data-v-d83d01d9"]]);export{Me as default};

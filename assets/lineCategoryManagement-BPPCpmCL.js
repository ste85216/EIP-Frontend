import{f as de,r as k,w as ve,k as je,aV as r,Z as m,bH as a,a8 as t,a0 as h,u as q,a7 as p,_ as b,$ as S,bJ as C,b0 as te,bf as se,F as B,bM as we,b as qe,aG as Ke,bK as Re}from"./@vue-Cr_z6yfx.js";import{u as We}from"./vue-router-CS4OewbW.js";import{u as He,a as Ge}from"./vee-validate-BXV9nMa7.js";import{_ as Qe,u as Ze,b as Xe}from"./index-wwmbXvRV.js";import{i as Ye}from"./vuetify-use-dialog-C5oZ13xz.js";import{C as Le}from"./ConfirmDeleteDialogWithTextField-Dbb5flU2.js";import{b as el,c as ll}from"./yup-WHNMwcW8.js";import{l as al}from"./lodash-CiJWSuVn.js";import{q as tl,Q as sl,w as I,v as Q,g as v,r as J,d as ne,a as ce,D as Ce,x as ie,y as Ve,L as nl,U as _e,f as me,c as ze,P as $e,e as he,W as il,V as Se,T as V}from"./vuetify-CbddcmEc.js";import"./perfect-debounce-Cp2ysxOb.js";import"./hookable-B8xFkYCm.js";/* empty css             */import"./pinia-DBRIaiZ_.js";import"./vue-demi-Dq6ymT-8.js";import"./pinia-plugin-persistedstate-RV7uh3T-.js";import"./jspdf-DacfHTdZ.js";import"./core-js-D2hAHviU.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./unplugin-vue-router-B1N3mqWX.js";import"./axios-upsvKRUO.js";import"./vue3-google-login-Dx7TV_Hx.js";import"./vue-easy-lightbox-D952uME8.js";import"./property-expr-DEi1ZLzV.js";import"./tiny-case-BJ7jYKNY.js";import"./toposort-DzadwsAs.js";const ol={key:2},rl={key:2},ul={class:"ms-sm-auto d-flex align-center"},dl={class:"card-title-main mt-2 d-flex align-center justify-space-between"},vl={class:"main-category-name ps-5"},cl={class:"px-4"},ml={class:"card-title px-6 py-4 bg-blue-grey-darken-2 d-flex align-center"},pl={key:0,class:"d-flex align-center me-4"},fl={class:"d-flex align-center item-container"},gl={class:"card-title px-6 py-2 mb-2 d-flex justify-space-between align-center bg-grey-darken-3"},yl={__name:"lineCategoryManagement",setup(kl){const{apiAuth:T}=Xe(),Ie=Ze(),O=Ye(),De=We(),{smAndUp:pe,lgAndUp:R}=tl(),_=de(()=>pe.value?"default":"small"),Z=k(!1),A=k(null),U=k(!1),oe=k(null),$=k([{name:"",error:""}]),j=k(!1),F=k([]),E=k([]),y=k(null),x=k(null),i=k({open:!1,id:"",type:""}),Ee=de(()=>pe.value?"360":"100%"),N=k({open:!1,count:"",error:""}),Ne=el({name:ll().required("請輸入名稱")}),{handleSubmit:Me}=He({validationSchema:Ne,initialValues:{name:""}}),{value:X,errorMessage:Oe,resetField:fe}=Ge("name"),W=k(""),ge=de(()=>{const l=z.value||[];if(!W.value)return l;const e=W.value.toLowerCase();return l.filter(o=>{var n,u;return!!(o.大分類.toLowerCase().includes(e)||(n=o.第一層分類)!=null&&n.some(c=>c.name.toLowerCase().includes(e))||(u=o.第一層分類)!=null&&u.some(c=>{var s;return(s=c.第二層分類)==null?void 0:s.some(f=>f.name.toLowerCase().includes(e))}))})}),Ue=al.debounce(()=>{j.value=!1},300);ve(W,()=>{j.value=!0,Ue()});const Y=async()=>{try{j.value=!0;const{data:l}=await T.get("/lineCategories/all");l.success&&(F.value=l.result,P.value||(z.value=JSON.parse(JSON.stringify(l.result))))}catch(l){G(l)}finally{j.value=!1}},L=async(l,e,o)=>{i.value={open:!0,id:"",type:l},$.value=[{name:"",error:""}],fe(),oe.value&&oe.value.resetValidation(),l==="第一層分類"?(y.value=e,x.value=null):l==="第二層分類"?(y.value=e,e&&(await ee(e),x.value=o)):(y.value=null,x.value=null),console.log("打開對話框時的狀態:",{type:l,mainCategory:e,firstLevel:o,selectedMainCategory:y.value,selectedFirstLevelCategory:x.value,firstLevelCategories:E.value})},ee=async l=>{if(!l){E.value=[];return}try{const e=F.value.find(o=>o.大分類===l);if(e&&e.第一層分類)E.value=e.第一層分類;else{const{data:o}=await T.get("/lineCategories/first-level",{params:{大分類:l}});o.success?E.value=o.result||[]:E.value=[]}}catch(e){G(e),E.value=[]}},re=async(l,e)=>{var o;if(i.value={open:!0,id:l._id,type:e},X.value=e==="大分類"?l.大分類:l.name,A.value={...l},$.value=[{name:"",error:""}],e==="第一層分類"){const n=F.value.find(u=>{var c;return(c=u.第一層分類)==null?void 0:c.some(s=>s._id===l._id)});y.value=(n==null?void 0:n.大分類)||null,x.value=null,y.value&&await ee(y.value)}else if(e==="第二層分類"){let n=!1;for(const u of F.value){if(n)break;for(const c of u.第一層分類||[])if((o=c.第二層分類)!=null&&o.some(s=>s._id===l._id)){y.value=u.大分類,x.value=c.name,await ee(u.大分類),n=!0;break}}n||(y.value=null,x.value=null)}else y.value=null,x.value=null},H=()=>{i.value.open=!1,A.value=null,$.value=[{name:"",error:""}],fe(),setTimeout(()=>{y.value=null,x.value=null,E.value=[]},100)},Fe=()=>{let l=!1;return $.value.forEach(e=>{e.error="",e.name.trim()||(e.error="請輸入名稱",l=!0)}),!l},Pe=async l=>{var e,o;if(l.preventDefault(),!U.value)try{if(U.value=!0,console.log("提交時的狀態:",{type:i.value.type,mainCategory:y.value,firstLevelCategory:x.value,dialog:i.value}),i.value.id)await Me(async n=>{const u={name:n.name,type:i.value.type},{data:c}=await T.patch(`/lineCategories/${i.value.id}`,u);if(!c.success)throw new Error(c.message||"更新失敗");O({text:"分類更新成功",snackbarProps:{color:"teal-lighten-1"}}),H(),await Y()})();else{if(!Fe()){U.value=!1;return}const n=$.value.filter(f=>f.name.trim());if(n.length===0){O({text:"請至少輸入一個有效的分類名稱",snackbarProps:{color:"red-lighten-1"}}),U.value=!1;return}if(i.value.type==="第一層分類"&&!y.value)throw new Error("請選擇大分類");if(i.value.type==="第二層分類"){if(!y.value)throw new Error("請選擇大分類");if(!x.value)throw console.error("第一層分類未選擇:",{selectedFirstLevelCategory:x.value,firstLevelCategories:E.value}),new Error("請選擇第一層分類")}let u=0;const c=n.length,s=[];for(const f of n){let d={};i.value.type==="大分類"?d={大分類:f.name.trim()}:i.value.type==="第一層分類"?d={大分類:y.value,第一層分類名稱:f.name.trim()}:i.value.type==="第二層分類"&&(d={大分類:y.value,第一層分類名稱:x.value,第二層分類名稱:f.name.trim()});try{const{data:g}=await T.post("/lineCategories",d);g.success?u++:s.push(`${f.name}: ${g.message||"新增失敗"}`)}catch(g){s.push(`${f.name}: ${((o=(e=g==null?void 0:g.response)==null?void 0:e.data)==null?void 0:o.message)||"請求失敗"}`)}}O(u===c?{text:`成功新增 ${u} 個分類`,snackbarProps:{color:"teal-lighten-1"}}:{text:`新增完成：成功 ${u} 個，失敗 ${c-u} 個。錯誤：${s.join("; ")}`,snackbarProps:{color:"orange-darken-2",timeout:6e3}}),H(),await Y()}}catch(n){console.error("提交失敗:",n),G(n)}finally{U.value=!1}},Je=async()=>{if(!A.value)return;const l=A.value._id,e=i.value.type;if(l)try{const{data:o}=await T.delete(`/lineCategories/${l}`,{params:{type:e}});if(!o.success)throw new Error(o.message||"刪除失敗");O({text:"分類刪除成功",snackbarProps:{color:"teal-lighten-1"}}),H(),Y()}catch(o){G(o)}finally{Z.value=!1}},G=l=>{var o,n,u;console.error("Error:",l);const e=((n=(o=l==null?void 0:l.response)==null?void 0:o.data)==null?void 0:n.message)||"操作失敗";((u=l==null?void 0:l.response)==null?void 0:u.status)===401?(Ie.logout(),De.push("/login"),O({text:"登入已過期，請重新登入",snackbarProps:{color:"red-lighten-1"}})):O({text:e,snackbarProps:{color:"red-lighten-1"}})},Te=()=>{N.value={open:!0,count:"",error:""}},ue=()=>{N.value.open=!1},ye=()=>{const l=parseInt(N.value.count);if(!l||l<1||l>10){N.value.error="請輸入1-10之間的數字";return}N.value.error="",$.value=Array(l).fill(null).map(()=>({name:"",error:""})),ue()},Ae=()=>{$.value.length<10?$.value.push({name:"",error:""}):O({text:"一次最多新增10個項目",snackbarProps:{color:"orange-darken-2"}})},Be=l=>{$.value.splice(l,1)};ve($,l=>{l.forEach(e=>{e.name.trim()&&(e.error="")})},{deep:!0}),je(async()=>{await Y(),z.value=JSON.parse(JSON.stringify(F.value))}),ve(y,async l=>{E.value=[],i.value.type==="第二層分類"&&!i.value.id&&(x.value=null),l&&i.value.type==="第二層分類"&&await ee(l)});const le=(l,e)=>e?e.findIndex(n=>n._id===l._id)>0:z.value.findIndex(n=>n._id===l._id)>0,ae=(l,e)=>e?e.findIndex(n=>n._id===l._id)<e.length-1:z.value.findIndex(n=>n._id===l._id)<z.value.length-1,K=(l,e,o)=>{let n,u,c;if(e==="大分類")n=z.value,u=n.findIndex(d=>d._id===l._id);else if(e==="第一層分類"){if(c=z.value.find(d=>d.第一層分類.some(g=>g._id===l._id)),!c)return;n=c.第一層分類,u=n.findIndex(d=>d._id===l._id)}else if(e==="第二層分類")for(const d of z.value){for(const g of d.第一層分類)if(g.第二層分類.some(D=>D._id===l._id)){c=g,n=g.第二層分類,u=n.findIndex(D=>D._id===l._id);break}if(c)break}if(!n||u===-1||o==="up"&&!le(l,n)||o==="down"&&!ae(l,n))return;const s=o==="up"?u-1:u+1,f=n[u];n[u]=n[s],n[s]=f,n.forEach((d,g)=>{d.order=g}),P.value=!0},P=k(!1),z=k([]),M=k(!1),ke=async()=>{if(!(!P.value||M.value))try{M.value=!0,j.value=!0;const l=[];z.value.forEach((e,o)=>{l.push(T.patch(`/lineCategories/${e._id}/order`,{type:"大分類",newOrder:o})),e.第一層分類.forEach((n,u)=>{l.push(T.patch(`/lineCategories/${n._id}/order`,{type:"第一層分類",newOrder:u})),n.第二層分類.forEach((c,s)=>{l.push(T.patch(`/lineCategories/${c._id}/order`,{type:"第二層分類",newOrder:s}))})})}),await Promise.all(l),F.value=JSON.parse(JSON.stringify(z.value)),P.value=!1,w.value=!1,O({text:"排序更新成功",snackbarProps:{color:"teal-lighten-1"}})}catch(l){G(l),z.value=JSON.parse(JSON.stringify(F.value)),P.value=!1}finally{M.value=!1,j.value=!1}},be=()=>{M.value||(w.value=!1,P.value&&(z.value=JSON.parse(JSON.stringify(F.value)),P.value=!1))},w=k(!1);return(l,e)=>(r(),m(sl,{fluid:""},{default:a(()=>{var o,n,u,c;return[t(Q,{class:"elevation-4 rounded-lg py-4 py-sm-6 px-1 px-sm-10 mt-2 mt-sm-6 mx-0 mx-sm-4 mx-md-4 mb-4 bg-white"},{default:a(()=>[t(I,{cols:"12",class:"ps-3 pb-3"},{default:a(()=>[t(Q,null,{default:a(()=>[t(I,{cols:"12",lg:"9",xl:"10"},{default:a(()=>[t(Q,null,{default:a(()=>[t(I,{cols:"12",sm:"4",lg:"12",class:"d-flex align-center"},{default:a(()=>[e[17]||(e[17]=h("h3",null," 線別分類管理 ",-1)),!w.value&&q(R)?(r(),m(v,{key:0,color:"blue-grey-darken-2",variant:"outlined","prepend-icon":"mdi-plus",class:"ms-6",size:_.value,onClick:e[0]||(e[0]=s=>L("大分類"))},{default:a(()=>e[13]||(e[13]=[p(" 新增大分類 ")])),_:1},8,["size"])):b("",!0),!w.value&&q(R)?(r(),m(v,{key:1,color:"red-lighten-1",variant:"outlined",class:"ms-4","prepend-icon":"mdi-sort",size:_.value,onClick:e[1]||(e[1]=s=>w.value=!0)},{default:a(()=>e[14]||(e[14]=[p(" 變更順序 ")])),_:1},8,["size"])):b("",!0),w.value&&q(R)?(r(),S("div",ol,[t(v,{color:"red-darken-2",variant:"outlined",class:"ms-6",size:_.value,"prepend-icon":"mdi-close",disabled:M.value,onClick:be},{default:a(()=>e[15]||(e[15]=[p(" 取消 ")])),_:1},8,["size","disabled"]),P.value&&q(R)?(r(),m(v,{key:0,color:"teal-darken-1",variant:"outlined",size:_.value,"prepend-icon":"mdi-content-save",class:"ms-4",loading:M.value,disabled:M.value,onClick:ke},{default:a(()=>e[16]||(e[16]=[p(" 保存變更 ")])),_:1},8,["size","loading","disabled"])):b("",!0)])):b("",!0)]),_:1}),q(R)?b("",!0):(r(),m(I,{key:0,cols:"12",sm:"8",lg:"10",class:"d-flex justify-sm-end justify-lg-start"},{default:a(()=>[w.value?b("",!0):(r(),m(v,{key:0,color:"blue-grey-darken-2",variant:"outlined","prepend-icon":"mdi-plus",size:_.value,onClick:e[2]||(e[2]=s=>L("大分類"))},{default:a(()=>e[18]||(e[18]=[p(" 新增大分類 ")])),_:1},8,["size"])),w.value?b("",!0):(r(),m(v,{key:1,color:"red-lighten-1",variant:"outlined",class:"ms-4","prepend-icon":"mdi-sort",size:_.value,onClick:e[3]||(e[3]=s=>w.value=!0)},{default:a(()=>e[19]||(e[19]=[p(" 變更順序 ")])),_:1},8,["size"])),w.value?(r(),S("div",rl,[t(v,{color:"red-darken-2",variant:"outlined",class:"me-2",size:_.value,"prepend-icon":"mdi-close",disabled:M.value,onClick:be},{default:a(()=>e[20]||(e[20]=[p(" 取消 ")])),_:1},8,["size","disabled"]),P.value?(r(),m(v,{key:0,color:"teal-darken-1",variant:"outlined",size:_.value,"prepend-icon":"mdi-content-save",loading:M.value,disabled:M.value,onClick:ke},{default:a(()=>e[21]||(e[21]=[p(" 保存變更 ")])),_:1},8,["size","loading","disabled"])):b("",!0)])):b("",!0)]),_:1}))]),_:1})]),_:1}),t(I,{cols:"12",lg:"3",xl:"2",class:"pb-0 pb-sm-4"},{default:a(()=>[h("div",ul,[C(t(J,{icon:"mdi-information",size:"small",color:"blue-grey-darken-2",class:"me-2"},null,512),[[V,"可搜尋各分類名稱","start"]]),t(ne,{modelValue:W.value,"onUpdate:modelValue":e[4]||(e[4]=s=>W.value=s),label:"快速搜尋","append-inner-icon":"mdi-magnify",loading:j.value,"base-color":"#666",color:"blue-grey-darken-3",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue","loading"])])]),_:1})]),_:1})]),_:1}),t(I,{cols:"12",class:"mt-4"},{default:a(()=>[ge.value.length>0?(r(),m(Q,{key:0},{default:a(()=>[(r(!0),S(B,null,te(ge.value,s=>(r(),m(I,{key:s._id,cols:"12",md:"6",lg:"3",xxl:"2",class:"mb-4"},{default:a(()=>[t(ce,{class:"category-display-card",elevation:"0"},{default:a(()=>[h("div",dl,[h("span",vl,se(s.大分類),1),h("div",cl,[w.value?(r(),S(B,{key:0},[C(t(v,{icon:"mdi-arrow-up",variant:"text",color:"blue-darken-1",disabled:!le(s),onClick:f=>K(s,"大分類","up")},null,8,["disabled","onClick"]),[[V,"上移","start"]]),C(t(v,{icon:"mdi-arrow-down",variant:"text",color:"blue-darken-1",class:"me-1",disabled:!ae(s),onClick:f=>K(s,"大分類","down")},null,8,["disabled","onClick"]),[[V,"下移","start"]])],64)):b("",!0),w.value?b("",!0):C((r(),m(v,{key:1,icon:"mdi-plus",variant:"text",color:"teal-darken-1",onClick:f=>L("第一層分類",s.大分類)},null,8,["onClick"])),[[V,"新增第一層分類","start"]]),w.value?b("",!0):C((r(),m(v,{key:2,icon:"mdi-pencil",variant:"plain",color:"light-blue-darken-4",onClick:f=>re(s,"大分類")},null,8,["onClick"])),[[V,"編輯大分類","start"]])])]),t(Ce,{dense:"",class:"category-list"},{default:a(()=>{var f;return[((f=s.第一層分類)==null?void 0:f.length)>0?(r(!0),S(B,{key:0},te(s.第一層分類,d=>(r(),S("div",{key:d._id,class:"first-level-group"},[t(ie,{class:"first-level-item"},{prepend:a(()=>[t(J,{size:"x-small",color:"red-darken-2"},{default:a(()=>e[22]||(e[22]=[p(" mdi-circle-medium ")])),_:1})]),append:a(()=>[w.value?(r(),S(B,{key:0},[C(t(v,{icon:"mdi-arrow-up",size:"x-small",variant:"text",color:"red-lighten-1",class:"me-1",disabled:!le(d,s.第一層分類),onClick:g=>K(d,"第一層分類","up")},null,8,["disabled","onClick"]),[[V,"上移","start"]]),C(t(v,{icon:"mdi-arrow-down",size:"x-small",variant:"text",color:"red-lighten-1",class:"me-1",disabled:!ae(d,s.第一層分類),onClick:g=>K(d,"第一層分類","down")},null,8,["disabled","onClick"]),[[V,"下移","start"]])],64)):(r(),S(B,{key:1},[C(t(v,{icon:"mdi-plus",size:"x-small",variant:"text",color:"teal-darken-1",class:"me-1",onClick:g=>L("第二層分類",s.大分類,d.name)},null,8,["onClick"]),[[V,"新增第二層分類","start"]]),C(t(v,{icon:"mdi-pencil",size:"x-small",variant:"plain",color:"light-blue-darken-4",onClick:g=>re(d,"第一層分類")},null,8,["onClick"]),[[V,"編輯第一層分類","start"]])],64))]),default:a(()=>[t(Ve,{class:"first-level-title"},{default:a(()=>[p(se(d.name),1)]),_:2},1024)]),_:2},1024),t(Ce,{dense:"",class:"second-level-list py-0"},{default:a(()=>{var g;return[((g=d.第二層分類)==null?void 0:g.length)>0?(r(!0),S(B,{key:0},te(d.第二層分類,D=>(r(),m(ie,{key:D._id,class:"second-level-item",density:"compact"},{prepend:a(()=>[t(J,{size:"large",color:"teal-darken-1",class:"ms-8"},{default:a(()=>e[23]||(e[23]=[p(" mdi-circle-medium ")])),_:1})]),append:a(()=>[w.value?(r(),S(B,{key:0},[C(t(v,{icon:"mdi-arrow-up",size:"x-small",variant:"text",color:"teal-lighten-1",class:"me-1",disabled:!le(D,d.第二層分類),onClick:xe=>K(D,"第二層分類","up")},null,8,["disabled","onClick"]),[[V,"上移","start"]]),C(t(v,{icon:"mdi-arrow-down",size:"x-small",variant:"text",color:"teal-lighten-1",class:"me-1",disabled:!ae(D,d.第二層分類),onClick:xe=>K(D,"第二層分類","down")},null,8,["disabled","onClick"]),[[V,"下移","start"]])],64)):C((r(),m(v,{key:1,icon:"mdi-pencil",size:"x-small",variant:"plain",color:"light-blue-darken-4",onClick:xe=>re(D,"第二層分類")},null,8,["onClick"])),[[V,"編輯第二層分類","start"]])]),default:a(()=>[t(Ve,{class:"second-level-title"},{default:a(()=>[p(se(D.name),1)]),_:2},1024)]),_:2},1024))),128)):(r(),m(ie,{key:1,density:"compact",class:"no-data-item"},{default:a(()=>e[24]||(e[24]=[h("span",{class:"no-data-text"},"尚無第二層分類",-1)])),_:1}))]}),_:2},1024)]))),128)):(r(),m(ie,{key:1,class:"no-data-item"},{default:a(()=>e[25]||(e[25]=[h("span",{class:"no-data-text"},"尚無第一層分類",-1)])),_:1}))]}),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(r(),m(I,{key:1,cols:"12",class:"pa-0"},{default:a(()=>[t(nl,{type:"info",color:"grey",variant:"outlined",text:"尚無任何分類資料或找不到符合搜尋的結果"})]),_:1}))]),_:1})]),_:1}),t(Se,{modelValue:i.value.open,"onUpdate:modelValue":e[9]||(e[9]=s=>i.value.open=s),persistent:"",width:Ee.value},{default:a(()=>[t(ce,{class:"rounded-lg"},{default:a(()=>[t(_e,{ref_key:"form",ref:oe,disabled:U.value,onSubmit:we(Pe,["prevent"])},{default:a(()=>[h("div",ml,[t(J,{size:"20",color:"white",class:"me-2"},{default:a(()=>e[26]||(e[26]=[p(" mdi-folder-multiple-outline ")])),_:1}),p(" "+se(i.value.id?"編輯分類":`新增${i.value.type}`)+" ",1),t(me),i.value.id?b("",!0):(r(),S("div",pl,[C((r(),m(v,{icon:"",color:"white",variant:"plain",size:"20",class:"me-2 opacity-100",ripple:!1,onClick:Te},{default:a(()=>[t(J,{size:"16"},{default:a(()=>e[27]||(e[27]=[p(" mdi-plus-box-multiple-outline ")])),_:1})]),_:1})),[[V,"批量新增項目","start"]]),C((r(),m(v,{icon:"",color:"white",variant:"plain",size:"20",class:"opacity-100",ripple:!1,onClick:Ae},{default:a(()=>[t(J,{size:"16"},{default:a(()=>e[28]||(e[28]=[p(" mdi-plus ")])),_:1})]),_:1})),[[V,"新增項目","start"]])])),t(v,{icon:"",color:"white",variant:"plain",class:"opacity-100",ripple:!1,size:"20",onClick:H},{default:a(()=>[t(J,null,{default:a(()=>e[29]||(e[29]=[p("mdi-close")])),_:1})]),_:1})]),t(ze,{class:"mt-6 mb-4 px-6"},{default:a(()=>[t(Q,null,{default:a(()=>[i.value.type==="第一層分類"||i.value.type==="第二層分類"?(r(),m(I,{key:0,cols:"12"},{default:a(()=>[t($e,{modelValue:y.value,"onUpdate:modelValue":e[5]||(e[5]=s=>y.value=s),items:F.value,"item-title":"大分類","item-value":"大分類",label:"*所屬大分類",variant:"outlined",density:"compact","hide-details":"auto",disabled:!!i.value.id||i.value.type==="第一層分類"||i.value.type==="第二層分類",readonly:!!i.value.id||i.value.type==="第一層分類"||i.value.type==="第二層分類",rules:[s=>!!s||"請選擇大分類"]},null,8,["modelValue","items","disabled","readonly","rules"])]),_:1})):b("",!0),i.value.type==="第二層分類"?(r(),m(I,{key:1,cols:"12"},{default:a(()=>[t($e,{modelValue:x.value,"onUpdate:modelValue":e[6]||(e[6]=s=>x.value=s),items:E.value,"item-title":"name","item-value":"name",label:"*所屬第一層分類",variant:"outlined",density:"compact","hide-details":"auto",disabled:!!i.value.id||i.value.type==="第二層分類"||!y.value,readonly:!!i.value.id||i.value.type==="第二層分類",rules:[s=>!!s||"請選擇第一層分類"]},null,8,["modelValue","items","disabled","readonly","rules"])]),_:1})):b("",!0),i.value.id?(r(),m(I,{key:3,cols:"12"},{default:a(()=>[t(ne,{modelValue:q(X),"onUpdate:modelValue":e[7]||(e[7]=s=>qe(X)?X.value=s:null),"error-messages":q(Oe),label:`*${i.value.type}名稱`,type:"text",variant:"outlined",density:"compact",clearable:"","hide-details":"auto"},null,8,["modelValue","error-messages","label"])]),_:1})):(r(!0),S(B,{key:2},te($.value,(s,f)=>(r(),m(I,{key:f,cols:"12"},{default:a(()=>[h("div",fl,[t(ne,{modelValue:s.name,"onUpdate:modelValue":d=>s.name=d,"error-messages":s.error,label:`*${i.value.type}名稱`,type:"text",variant:"outlined",density:"compact",clearable:"","hide-details":"auto"},null,8,["modelValue","onUpdate:modelValue","error-messages","label"]),$.value.length>1?(r(),m(v,{key:0,icon:"mdi-delete",variant:"text",color:"red-lighten-1",size:"small",class:"ms-2",onClick:d=>Be(f)},null,8,["onClick"])):b("",!0)])]),_:2},1024))),128))]),_:1})]),_:1}),t(he,{class:"px-6 mb-4"},{default:a(()=>[t(il,null,{default:a(({isHovering:s,props:f})=>[i.value.id?(r(),m(v,Ke({key:0},f,{color:s?"red-lighten-1":"grey",variant:"outlined",size:_.value,"prepend-icon":"mdi-delete",onClick:e[8]||(e[8]=d=>Z.value=!0)}),{default:a(()=>e[30]||(e[30]=[p(" 刪除 ")])),_:2},1040,["color","size"])):b("",!0)]),_:1}),t(me),t(v,{color:"grey-darken-1",variant:"outlined",class:"me-1",size:_.value,loading:U.value,onClick:H},{default:a(()=>e[31]||(e[31]=[p(" 取消 ")])),_:1},8,["size","loading"]),t(v,{color:"teal-darken-1",variant:"outlined",type:"submit",class:"ms-1",size:_.value,loading:U.value,disabled:U.value},{default:a(()=>e[32]||(e[32]=[p(" 送出 ")])),_:1},8,["size","loading","disabled"])]),_:1})]),_:1},8,["disabled"])]),_:1})]),_:1},8,["modelValue","width"]),t(Le,{modelValue:Z.value,"onUpdate:modelValue":e[10]||(e[10]=s=>Z.value=s),title:"確認刪除分類",message:`確定要刪除「<span class='text-pink-lighten-1' style='font-weight: 800;'>${((o=A.value)==null?void 0:o.name)||((n=A.value)==null?void 0:n.大分類)||""}</span>」嗎？ 此操作無法復原。`,"expected-name":((u=A.value)==null?void 0:u.name)||((c=A.value)==null?void 0:c.大分類)||"","input-label":"分類名稱",onConfirm:Je},null,8,["modelValue","message","expected-name"]),t(Se,{modelValue:N.value.open,"onUpdate:modelValue":e[12]||(e[12]=s=>N.value.open=s),persistent:"","max-width":"340"},{default:a(()=>[t(ce,{class:"rounded-lg"},{default:a(()=>[h("div",gl,[h("div",null,[t(J,{size:"20",class:"me-2"},{default:a(()=>e[33]||(e[33]=[p(" mdi-plus-box-multiple-outline ")])),_:1}),e[34]||(e[34]=p("批量新增項目 "))]),t(v,{icon:"",variant:"plain",size:"36",class:"opacity-100",ripple:!1,onClick:ue},{default:a(()=>[t(J,{size:"20"},{default:a(()=>e[35]||(e[35]=[p(" mdi-close ")])),_:1})]),_:1})]),t(_e,{onSubmit:we(ye,["prevent"])},{default:a(()=>[t(ze,{class:"px-6 py-3"},{default:a(()=>[e[36]||(e[36]=h("div",{class:"text-grey-darken-2 mb-4"}," 請輸入要總共需要多少項目，系統會自動新增指定數量的空白項目。 ",-1)),t(ne,{modelValue:N.value.count,"onUpdate:modelValue":e[11]||(e[11]=s=>N.value.count=s),label:"項目數量",type:"number",min:"1",max:"10",variant:"outlined",density:"compact","error-messages":N.value.error,"hide-details":"auto",onKeyup:Re(ye,["enter"])},null,8,["modelValue","error-messages"])]),_:1}),t(he,{class:"px-6 py-4 mb-2"},{default:a(()=>[t(me),t(v,{color:"grey",variant:"outlined",class:"me-1",size:_.value,onClick:ue},{default:a(()=>e[37]||(e[37]=[p(" 取消 ")])),_:1},8,["size"]),t(v,{color:"teal-darken-1",variant:"outlined",size:_.value,type:"submit"},{default:a(()=>e[38]||(e[38]=[p(" 確定 ")])),_:1},8,["size"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]}),_:1}))}},Rl=Qe(yl,[["__scopeId","data-v-99192c28"]]);export{Rl as default};

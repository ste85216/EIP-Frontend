import{r as k,k as F,n as G,aV as y,$ as N,a8 as a,bH as o,Z as R,_ as w,b2 as q,u as t,bM as T,a0 as A,a7 as g}from"./@vue-Cr_z6yfx.js";import{u as D}from"./vue-router-CS4OewbW.js";import{C as H}from"./vue3-google-login-Dx7TV_Hx.js";import{b as J,c as V}from"./yup-WHNMwcW8.js";import{_ as Q,u as X}from"./index-wwmbXvRV.js";import{i as Y}from"./vuetify-use-dialog-C5oZ13xz.js";import{u as Z,a as _}from"./vee-validate-BXV9nMa7.js";import{b as h}from"./route-block-B_A1xBdJ.js";import{Q as K,U as O,v as C,w as l,p as W,d as P,ad as ee,g as S,A as I,r as ae,J as oe}from"./vuetify-CbddcmEc.js";import"./perfect-debounce-Cp2ysxOb.js";import"./hookable-B8xFkYCm.js";import"./property-expr-DEi1ZLzV.js";import"./tiny-case-BJ7jYKNY.js";import"./toposort-DzadwsAs.js";import"./core-js-D2hAHviU.js";/* empty css             */import"./pinia-DBRIaiZ_.js";import"./vue-demi-Dq6ymT-8.js";import"./pinia-plugin-persistedstate-RV7uh3T-.js";import"./jspdf-DacfHTdZ.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./unplugin-vue-router-B1N3mqWX.js";import"./axios-upsvKRUO.js";import"./vue-easy-lightbox-D952uME8.js";const te=""+new URL("Ys_favicon_nobg-y4epX-59.png",import.meta.url).href,se={key:0,id:"background",class:"d-flex justify-center align-center"},le="276416380558-pgfrsn7bb9fot96r8s3kbeu9cqghind3.apps.googleusercontent.com",E={__name:"login",setup(re){const f=D(),b=X(),n=Y(),c=k(!0),d=k(!1),u=k(!1),M=J({email:V().required("請輸入email").email("請輸入正確email格式"),password:V().required("請輸入密碼")}),{handleSubmit:U,isSubmitting:i}=Z({validationSchema:M}),m=_("email"),v=_("password"),B=async s=>{try{if(i.value=!0,!s.code)throw new Error("未收到 Google 授權碼");const e=await b.googleLogin(s.code);e==="登入成功"?(n({text:"登入成功",snackbarProps:{color:"teal-lighten-1"}}),f.push("/")):n({text:e,snackbarProps:{color:"red-lighten-1"}})}catch(e){console.error("Google 登入錯誤:",e),n({text:"Google 登入失敗，請稍後再試",snackbarProps:{color:"red-lighten-1"}})}finally{i.value=!1}},L=U(async s=>{u.value?localStorage.setItem("savedEmail",s.email):localStorage.removeItem("savedEmail");const e=await b.login(s);e==="登入成功"?(n({text:e,snackbarProps:{color:"teal-lighten-1"}}),f.push("/")):n({text:e,snackbarProps:{color:"red-lighten-1"}})});return F(async()=>{try{const s=localStorage.getItem("savedEmail");s&&(m.value.value=s,u.value=!0);const e=new URLSearchParams(window.location.search),p=e.get("token"),r=e.get("email"),$=e.get("avatar"),j=e.get("name"),z=parseInt(e.get("role"),10),x=e.get("message");if(x){n({text:x,snackbarProps:{color:"red-lighten-1"}}),c.value=!1;return}if(p){b.$patch({token:p,email:r,avatar:$,name:j,role:z}),await G(),n({text:"登入成功",snackbarProps:{color:"teal-lighten-1"}}),f.push("/");return}}catch(s){console.error("登入頁面初始化錯誤:",s)}finally{c.value=!1}}),(s,e)=>{const p=q("router-link");return c.value?w("",!0):(y(),N("div",se,[a(K,{width:"380",height:"510",class:"login-wrapper mx-2 mx-sm-0"},{default:o(()=>[a(O,{disabled:t(i),onSubmit:T(t(L),["prevent"])},{default:o(()=>[a(C,{class:"px-4"},{default:o(()=>[a(l,{cols:"12",class:"pt-10 pb-6 pe-8 ps-6 d-flex justify-center align-center"},{default:o(()=>[a(W,{src:te,height:"32","max-width":"64"}),e[4]||(e[4]=A("span",{style:{"font-size":"24px","font-weight":"600","letter-spacing":"1.5px"},class:"text-decoration-none text-grey-darken-3"},"永信生活旅遊事業",-1))]),_:1}),a(l,{cols:"12"},{default:o(()=>[a(P,{modelValue:t(m).value.value,"onUpdate:modelValue":e[0]||(e[0]=r=>t(m).value.value=r),"error-messages":t(m).errorMessage.value,label:"email",density:"compact",variant:"underlined",clearable:"",autocomplete:"username"},null,8,["modelValue","error-messages"])]),_:1}),a(l,{cols:"12",class:"pb-1"},{default:o(()=>[a(P,{modelValue:t(v).value.value,"onUpdate:modelValue":e[1]||(e[1]=r=>t(v).value.value=r),"error-messages":t(v).errorMessage.value,type:d.value?"text":"password","append-inner-icon":d.value?"mdi-eye-off":"mdi-eye",label:"password",density:"compact",variant:"underlined",autocomplete:"current-password","onClick:appendInner":e[2]||(e[2]=r=>d.value=!d.value)},null,8,["modelValue","error-messages","type","append-inner-icon"])]),_:1}),a(l,{cols:"12",class:"ps-2 pe-4 py-0 d-flex justify-space-between align-center"},{default:o(()=>[a(ee,{modelValue:u.value,"onUpdate:modelValue":e[3]||(e[3]=r=>u.value=r),label:"記住我","hide-details":"",density:"compact",color:"grey-darken-2",class:"text-caption"},null,8,["modelValue"]),a(p,{class:"text-caption text-blue-grey-darken-2",to:"/forgotPassword"},{default:o(()=>e[5]||(e[5]=[g(" 忘記密碼？ ")])),_:1})]),_:1}),a(l,{cols:"12",class:"text-center"},{default:o(()=>[a(S,{block:"",elevation:"2",color:"orange-darken-2",type:"submit",loading:t(i),disabled:t(i)},{default:o(()=>e[6]||(e[6]=[g(" Login ")])),_:1},8,["loading","disabled"])]),_:1}),a(l,{cols:"12",class:"py-0 ps-2"}),a(l,null,{default:o(()=>[a(C,null,{default:o(()=>[a(l,{cols:"5"},{default:o(()=>[a(I,{class:"my-4"})]),_:1}),a(l,{cols:"2",class:"d-flex align-center justify-center pa-0",style:{"letter-spacing":"2px","font-size":"15px",opacity:"60%"}},{default:o(()=>e[7]||(e[7]=[g(" 或使用 ")])),_:1}),a(l,{cols:"5"},{default:o(()=>[a(I,{class:"my-4"})]),_:1})]),_:1})]),_:1}),a(l,{cols:"12",class:"text-center"},{default:o(()=>[a(t(H),{callback:B,"client-id":le,"auto-login":!1,ux_mode:"popup",class:"w-100"},{default:o(({signIn:r})=>[a(S,{block:"",elevation:"2",color:"blue-grey-darken-1",loading:t(i),disabled:t(i),onClick:r},{default:o(()=>[a(ae,{icon:"mdi-google-plus",size:"24",class:"me-2"}),e[8]||(e[8]=g("Google 登入 "))]),_:2},1032,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1}),c.value?(y(),R(oe,{key:0,indeterminate:"",size:"64",color:"deep-purple-darken-2",class:"center-screen"})):w("",!0)]))}}};typeof h=="function"&&h(E);const Be=Q(E,[["__scopeId","data-v-7cd62dbf"]]);export{Be as default};

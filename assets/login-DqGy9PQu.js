import{r as k,k as G,n as L,aV as y,$ as N,a8 as a,bH as o,Z as q,_ as w,b2 as R,u as t,bM as T,a0 as A,a7 as g}from"./@vue-Cr_z6yfx.js";import{u as D}from"./vue-router-CS4OewbW.js";import{C as H}from"./vue3-google-login-Dx7TV_Hx.js";import{b as J,c as V}from"./yup-WHNMwcW8.js";import{_ as Q,u as Z}from"./index-ZcDhEpUM.js";import{i as K}from"./vuetify-use-dialog-C5oZ13xz.js";import{u as O,a as _}from"./vee-validate-BXV9nMa7.js";import{b as h}from"./route-block-B_A1xBdJ.js";import{Q as W,U as X,v as C,w as s,d as P,ad as Y,g as S,A as I,r as ee,J as ae}from"./vuetify-CbddcmEc.js";import"./perfect-debounce-Cp2ysxOb.js";import"./hookable-B8xFkYCm.js";import"./property-expr-DEi1ZLzV.js";import"./tiny-case-BJ7jYKNY.js";import"./toposort-DzadwsAs.js";import"./core-js-D2hAHviU.js";/* empty css             */import"./pinia-DBRIaiZ_.js";import"./vue-demi-Dq6ymT-8.js";import"./pinia-plugin-persistedstate-RV7uh3T-.js";import"./jspdf-DacfHTdZ.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./unplugin-vue-router-B1N3mqWX.js";import"./axios-upsvKRUO.js";import"./vue-easy-lightbox-D952uME8.js";const oe={key:0,id:"background",class:"d-flex justify-center align-center"},te="276416380558-pgfrsn7bb9fot96r8s3kbeu9cqghind3.apps.googleusercontent.com",E={__name:"login",setup(le){const f=D(),b=Z(),n=K(),c=k(!0),d=k(!1),u=k(!1),M=J({email:V().required("請輸入email").email("請輸入正確email格式"),password:V().required("請輸入密碼")}),{handleSubmit:U,isSubmitting:i}=O({validationSchema:M}),m=_("email"),v=_("password"),B=async l=>{try{if(i.value=!0,!l.code)throw new Error("未收到 Google 授權碼");const e=await b.googleLogin(l.code);e==="登入成功"?(n({text:"登入成功",snackbarProps:{color:"teal-lighten-1"}}),f.push("/")):n({text:e,snackbarProps:{color:"red-lighten-1"}})}catch(e){console.error("Google 登入錯誤:",e),n({text:"Google 登入失敗，請稍後再試",snackbarProps:{color:"red-lighten-1"}})}finally{i.value=!1}},$=U(async l=>{u.value?localStorage.setItem("savedEmail",l.email):localStorage.removeItem("savedEmail");const e=await b.login(l);e==="登入成功"?(n({text:e,snackbarProps:{color:"teal-lighten-1"}}),f.push("/")):n({text:e,snackbarProps:{color:"red-lighten-1"}})});return G(async()=>{try{const l=localStorage.getItem("savedEmail");l&&(m.value.value=l,u.value=!0);const e=new URLSearchParams(window.location.search),p=e.get("token"),r=e.get("email"),j=e.get("avatar"),z=e.get("name"),F=parseInt(e.get("role"),10),x=e.get("message");if(x){n({text:x,snackbarProps:{color:"red-lighten-1"}}),c.value=!1;return}if(p){b.$patch({token:p,email:r,avatar:j,name:z,role:F}),await L(),n({text:"登入成功",snackbarProps:{color:"teal-lighten-1"}}),f.push("/");return}}catch(l){console.error("登入頁面初始化錯誤:",l)}finally{c.value=!1}}),(l,e)=>{const p=R("router-link");return c.value?w("",!0):(y(),N("div",oe,[a(W,{width:"380",height:"510",class:"login-wrapper mx-2 mx-sm-0"},{default:o(()=>[a(X,{disabled:t(i),onSubmit:T(t($),["prevent"])},{default:o(()=>[a(C,{class:"px-4"},{default:o(()=>[a(s,{cols:"12",class:"pt-10 pb-6 d-flex justify-center align-center"},{default:o(()=>e[4]||(e[4]=[A("span",{style:{"font-size":"24px","font-weight":"600","letter-spacing":"1.5px"},class:"text-decoration-none text-grey-darken-3"},"測試 EIP",-1)])),_:1}),a(s,{cols:"12"},{default:o(()=>[a(P,{modelValue:t(m).value.value,"onUpdate:modelValue":e[0]||(e[0]=r=>t(m).value.value=r),"error-messages":t(m).errorMessage.value,label:"email",density:"compact",variant:"underlined",clearable:"",autocomplete:"username"},null,8,["modelValue","error-messages"])]),_:1}),a(s,{cols:"12",class:"pb-1"},{default:o(()=>[a(P,{modelValue:t(v).value.value,"onUpdate:modelValue":e[1]||(e[1]=r=>t(v).value.value=r),"error-messages":t(v).errorMessage.value,type:d.value?"text":"password","append-inner-icon":d.value?"mdi-eye-off":"mdi-eye",label:"password",density:"compact",variant:"underlined",autocomplete:"current-password","onClick:appendInner":e[2]||(e[2]=r=>d.value=!d.value)},null,8,["modelValue","error-messages","type","append-inner-icon"])]),_:1}),a(s,{cols:"12",class:"ps-2 pe-4 py-0 d-flex justify-space-between align-center"},{default:o(()=>[a(Y,{modelValue:u.value,"onUpdate:modelValue":e[3]||(e[3]=r=>u.value=r),label:"記住我","hide-details":"",density:"compact",color:"grey-darken-2",class:"text-caption"},null,8,["modelValue"]),a(p,{class:"text-caption text-blue-grey-darken-2",to:"/forgotPassword"},{default:o(()=>e[5]||(e[5]=[g(" 忘記密碼？ ")])),_:1})]),_:1}),a(s,{cols:"12",class:"text-center"},{default:o(()=>[a(S,{block:"",elevation:"2",color:"orange-darken-2",type:"submit",loading:t(i),disabled:t(i)},{default:o(()=>e[6]||(e[6]=[g(" Login ")])),_:1},8,["loading","disabled"])]),_:1}),a(s,{cols:"12",class:"py-0 ps-2"}),a(s,null,{default:o(()=>[a(C,null,{default:o(()=>[a(s,{cols:"5"},{default:o(()=>[a(I,{class:"my-4"})]),_:1}),a(s,{cols:"2",class:"d-flex align-center justify-center pa-0",style:{"letter-spacing":"2px","font-size":"15px",opacity:"60%"}},{default:o(()=>e[7]||(e[7]=[g(" 或使用 ")])),_:1}),a(s,{cols:"5"},{default:o(()=>[a(I,{class:"my-4"})]),_:1})]),_:1})]),_:1}),a(s,{cols:"12",class:"text-center"},{default:o(()=>[a(t(H),{callback:B,"client-id":te,"auto-login":!1,ux_mode:"popup",class:"w-100"},{default:o(({signIn:r})=>[a(S,{block:"",elevation:"2",color:"blue-grey-darken-1",loading:t(i),disabled:t(i),onClick:r},{default:o(()=>[a(ee,{icon:"mdi-google-plus",size:"24",class:"me-2"}),e[8]||(e[8]=g("Google 登入 "))]),_:2},1032,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1}),c.value?(y(),q(ae,{key:0,indeterminate:"",size:"64",color:"deep-purple-darken-2",class:"center-screen"})):w("",!0)]))}}};typeof h=="function"&&h(E);const Me=Q(E,[["__scopeId","data-v-368df717"]]);export{Me as default};

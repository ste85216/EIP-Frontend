import{_ as bs,u as ys,b as fs}from"./index-ZcDhEpUM.js";import{i as xs}from"./vuetify-use-dialog-C5oZ13xz.js";import{u as _s}from"./vue-router-CS4OewbW.js";import{a as As}from"./html2pdf.js-CvqxwkGD.js";import{i as wt}from"./echarts-DIb6E6fz.js";import{E as Es}from"./vue-echarts-Ce-_ylzI.js";import{E as Lt}from"./jspdf-DacfHTdZ.js";import{h as Ct}from"./html2canvas-CqpzYDn4.js";import{J as ws}from"./jszip-LXpuTjqP.js";import{q as Cs,Q as Ts,a as Bt,J as Ns,ac as ks,v as Z,w as S,_ as kt,P as gt,x as $t,A as Ge,g as we,r as Ut,F as Dt,f as qt,c as Us,ad as Ee,e as Rs,V as Ps,T as Ss}from"./vuetify-CbddcmEc.js";import{f as Rt,r as V,k as Pt,w as Ce,aS as Js,n as Se,aV as A,Z as Ve,bH as b,a8 as m,a0 as e,a7 as L,bf as l,_ as D,$ as C,F as ee,b0 as de,aH as U,u as Ft,bJ as Os}from"./@vue-Cr_z6yfx.js";/* empty css             */import"./pinia-DBRIaiZ_.js";import"./vue-demi-Dq6ymT-8.js";import"./pinia-plugin-persistedstate-RV7uh3T-.js";import"./unplugin-vue-router-B1N3mqWX.js";import"./axios-upsvKRUO.js";import"./vue3-google-login-Dx7TV_Hx.js";import"./vue-easy-lightbox-D952uME8.js";import"./core-js-D2hAHviU.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./perfect-debounce-Cp2ysxOb.js";import"./hookable-B8xFkYCm.js";import"./zrender-D2NPROy7.js";const Ms={class:"text-center mb-6"},Vs={class:"text-center sub-title text-grey"},Ls={key:0},Bs={key:1},$s={class:"d-flex justify-end align-center mb-4 sticky-buttons"},Ds={key:0,class:"budget-table-title"},qs={class:"text-orange-darken-2"},Fs={class:"text-pink-darken-1"},zs={key:1,class:"budget-table-title"},Ys={class:"text-orange-darken-2"},Gs={class:"text-pink-darken-1"},Qs={key:2,class:"budget-table-title"},js={class:"text-orange-darken-2"},Ws={class:"text-pink-darken-1"},Hs={class:"text-light-blue-darken-2"},Xs={key:3,class:"budget-table-title"},Is={class:"text-orange-darken-2"},Zs={class:"text-pink-darken-1"},Ks={key:4,class:"budget-table-title"},el={class:"text-orange-darken-2"},tl={class:"text-pink-darken-1"},sl={key:5,class:"table-container"},ll={key:0,class:"budget-table"},al=["rowspan"],ol={class:"platform-col"},nl={class:"month-col"},rl={class:"month-col"},cl={class:"month-col"},dl={class:"quarter-col"},ul={class:"month-col"},il={class:"month-col"},hl={class:"month-col"},pl={class:"quarter-col"},vl={class:"month-col"},ml={class:"month-col"},gl={class:"month-col"},bl={class:"quarter-col"},yl={class:"month-col"},fl={class:"month-col"},xl={class:"month-col"},_l={class:"quarter-col"},Al={class:"total-col",style:{width:"180px"}},El={class:"monthly-total-row"},wl={class:"month-col"},Cl={class:"month-col"},Tl={class:"month-col"},Nl={class:"quarter-col"},kl={class:"month-col"},Ul={class:"month-col"},Rl={class:"month-col"},Pl={class:"quarter-col"},Sl={class:"month-col"},Jl={class:"month-col"},Ol={class:"month-col"},Ml={class:"quarter-col"},Vl={class:"month-col"},Ll={class:"month-col"},Bl={class:"month-col"},$l={class:"quarter-col"},Dl={class:"total-col highlight-total",style:{width:"180px"}},ql={key:1,class:"budget-table"},Fl=["rowspan"],zl={class:"platform-col"},Yl={class:"month-col"},Gl={class:"month-col"},Ql={class:"month-col"},jl={class:"quarter-col"},Wl={class:"month-col"},Hl={class:"month-col"},Xl={class:"month-col"},Il={class:"quarter-col"},Zl={class:"month-col"},Kl={class:"month-col"},ea={class:"month-col"},ta={class:"quarter-col"},sa={class:"month-col"},la={class:"month-col"},aa={class:"month-col"},oa={class:"quarter-col"},na={class:"total-col"},ra={class:"monthly-total-row"},ca={class:"month-col"},da={class:"month-col"},ua={class:"month-col"},ia={class:"quarter-col"},ha={class:"month-col"},pa={class:"month-col"},va={class:"month-col"},ma={class:"quarter-col"},ga={class:"month-col"},ba={class:"month-col"},ya={class:"month-col"},fa={class:"quarter-col"},xa={class:"month-col"},_a={class:"month-col"},Aa={class:"month-col"},Ea={class:"quarter-col"},wa={class:"total-col highlight-total"},Ca={key:2,class:"budget-table comparison-table"},Ta=["rowspan"],Na={class:"platform-col"},ka={class:"month-col"},Ua={class:"month-col"},Ra={class:"month-col"},Pa={class:"month-col"},Sa={class:"month-col"},Ja={class:"month-col"},Oa={class:"quarter-col"},Ma={class:"quarter-col"},Va={class:"month-col"},La={class:"month-col"},Ba={class:"month-col"},$a={class:"month-col"},Da={class:"month-col"},qa={class:"month-col"},Fa={class:"quarter-col"},za={class:"quarter-col"},Ya={class:"month-col"},Ga={class:"month-col"},Qa={class:"month-col"},ja={class:"month-col"},Wa={class:"month-col"},Ha={class:"month-col"},Xa={class:"quarter-col"},Ia={class:"quarter-col"},Za={class:"month-col"},Ka={class:"month-col"},eo={class:"month-col"},to={class:"month-col"},so={class:"month-col"},lo={class:"month-col"},ao={class:"quarter-col"},oo={class:"quarter-col"},no={class:"total-col"},ro={class:"total-col"},co={class:"monthly-total-row"},uo={class:"month-col"},io={class:"month-col"},ho={class:"month-col"},po={class:"month-col"},vo={class:"month-col"},mo={class:"month-col"},go={class:"quarter-col"},bo={class:"quarter-col"},yo={class:"month-col"},fo={class:"month-col"},xo={class:"month-col"},_o={class:"month-col"},Ao={class:"month-col"},Eo={class:"month-col"},wo={class:"quarter-col"},Co={class:"quarter-col"},To={class:"month-col"},No={class:"month-col"},ko={class:"month-col"},Uo={class:"month-col"},Ro={class:"month-col"},Po={class:"month-col"},So={class:"quarter-col"},Jo={class:"quarter-col"},Oo={class:"month-col"},Mo={class:"month-col"},Vo={class:"month-col"},Lo={class:"month-col"},Bo={class:"month-col"},$o={class:"month-col"},Do={class:"quarter-col"},qo={class:"quarter-col"},Fo={class:"total-col highlight-total"},zo={class:"total-col highlight-total"},Yo={key:6,class:"table-container"},Go={class:"budget-table"},Qo={class:"header-row"},jo={class:"platform-col sticky-col",style:{width:"180px",left:"0","z-index":"1"}},Wo={class:"total-col sticky-col",style:{width:"180px",right:"0","z-index":"1"}},Ho={class:"monthly-total-row"},Xo={class:"total-col highlight-total sticky-col",style:{width:"180px",right:"0","z-index":"1"}},Io={key:7,class:"table-container"},Zo={class:"budget-table line-expense-total-table"},Ko={class:"channel-col"},en={class:"month-col"},tn={class:"month-col"},sn={class:"month-col"},ln={class:"quarter-col"},an={class:"month-col"},on={class:"month-col"},nn={class:"month-col"},rn={class:"quarter-col"},cn={class:"month-col"},dn={class:"month-col"},un={class:"month-col"},hn={class:"quarter-col"},pn={class:"month-col"},vn={class:"month-col"},mn={class:"month-col"},gn={class:"quarter-col"},bn={class:"total-col"},yn={class:"monthly-total-row"},fn={class:"month-col"},xn={class:"month-col"},_n={class:"month-col"},An={class:"quarter-col"},En={class:"month-col"},wn={class:"month-col"},Cn={class:"month-col"},Tn={class:"quarter-col"},Nn={class:"month-col"},kn={class:"month-col"},Un={class:"month-col"},Rn={class:"quarter-col"},Pn={class:"month-col"},Sn={class:"month-col"},Jn={class:"month-col"},On={class:"quarter-col"},Mn={class:"total-col highlight-total"},Vn={key:8,class:"d-flex justify-end align-center mt-4 px-2"},Ln={class:"d-flex justify-end mb-4 pe-lg-4"},Bn={class:"charts-container mt-8"},$n={class:"chart-box rounded-lg py-4 px-0 bg-white"},Dn={class:"chart-box rounded-lg py-4 px-0 bg-white"},qn={class:"card-title px-8 py-4 bg-deep-orange-darken-2 d-flex align-center"},Fn={__name:"marketingAnalysis",setup(zn){const{mdAndUp:zt}=Cs(),bt=Rt(()=>zt.value?"default":"small"),St=Es,{apiAuth:B}=fs(),Y=xs(),Yt=ys(),Gt=_s(),ue=V(!1),le=V(!1),Q=V(!1),n=V({year:null,theme:null,reportType:null,line:[],month:null}),Le=V(""),Qe=V(""),Je=V(""),Oe=V(""),Be=V(""),Me=V([]),je=V([]),K=V([{title:"行銷廣告預算表",value:"budget"},{title:"行銷實際支出表",value:"expense"},{title:"行銷預算與實際支出比較表",value:"comparison"},{title:"行銷各線實際支出表",value:"lineExpense"},{title:"行銷各線實際支出總表",value:"lineExpenseTotal"}]),ae=V([]),We=V(Array.from({length:12},(o,s)=>({name:`${s+1}月`,value:s+1}))),f=V([]),yt=V(null),Qt=async()=>{try{const{data:o}=await B.get("/marketing/categories/options",{params:{type:0}});o.success&&(je.value=o.result)}catch(o){F(o)}},jt=async o=>{if(o)try{ue.value=!0;const[s,a]=await Promise.all([B.get(`/marketing/budgets/years/${o}`),B.get(`/marketing/expenses/years/${o}`)]),r=new Set(s.data.success?s.data.result:[]),u=new Set(a.data.success?a.data.result:[]),g=[...new Set([...r,...u])].sort((h,y)=>y-h);return g.length===0?(Me.value=[],!1):(Me.value=g,!0)}catch(s){return F(s),!1}finally{ue.value=!1}},Wt=async()=>{try{ue.value=!0;const{data:o}=await B.get("/marketing/categories/options",{params:{type:3}});o.success&&(ae.value=o.result)}catch(o){F(o)}finally{ue.value=!1}},Ht=()=>{n.value.year=null,n.value.reportType=null,Le.value="",Qe.value="",Je.value="",Q.value=!1,n.value.theme||(Me.value=[])},Xt=async()=>{Je.value="",Q.value=!1,n.value.reportType==="lineExpense"?(ae.value.length===0&&await Wt(),Y({text:"請記得選擇「月份」及「線別」",snackbarProps:{color:"info"}})):(n.value.line=[],n.value.month=null,Oe.value="",Be.value="")};Pt(async()=>{await Qt()});const It=async()=>{try{const[o,s,a]=await Promise.all([B.get("/marketing/budgets/years"),B.get("/marketing/categories/options",{params:{type:0}}),B.get("/marketing/categories/options",{params:{type:3}})]);o.data.success&&(Me.value=o.data.result),s.data.success&&(je.value=s.data.result),a.data.success&&(ae.value=a.data.result),We.value=Array.from({length:12},(r,u)=>({name:`${u+1}月`,value:u+1}))}catch(o){F(o)}};Ce([()=>n.value.theme,()=>n.value.reportType],async([o,s])=>{var a;try{if(ue.value=!0,!o){Me.value=[],n.value.year=null;return}if(!await jt(o)){Y({text:`「${J(o)}」尚未有任何「預算」或是「實際支出」資料`,snackbarProps:{color:"warning"}});return}if(s&&n.value.year){const[u,g]=await Promise.all([B.get(`/marketing/budgets/years/${o}`),B.get(`/marketing/expenses/years/${o}`)]),h=new Set(u.data.success?u.data.result:[]),y=new Set(g.data.success?g.data.result:[]);let c=!0;switch(s){case"budget":c=h.has(n.value.year);break;case"expense":case"lineExpense":case"lineExpenseTotal":c=y.has(n.value.year);break;case"comparison":c=h.has(n.value.year)&&y.has(n.value.year);break}if(!c){const E=((a=K.value.find(v=>v.value===s))==null?void 0:a.title)||"";Y({text:`「${J(o)}」${n.value.year}年度尚無「${E}」相關資料`,snackbarProps:{color:"warning"}}),n.value.reportType=null}}}catch(r){F(r)}finally{ue.value=!1}},{immediate:!0});const Zt=async()=>{try{if(Le.value="",Je.value="",Q.value=!1,!n.value.year){n.value.reportType=null,K.value=[];return}ue.value=!0;const[o,s]=await Promise.all([B.get(`/marketing/budgets/check/${n.value.year}/${n.value.theme}`),B.get(`/marketing/expenses/check/${n.value.year}/${n.value.theme}`)]),a=o.data.success&&o.data.result,r=s.data.success&&s.data.result;let u=[];a&&!r?(u=[{title:"行銷廣告預算表",value:"budget"}],Y({text:`「${J(n.value.theme)}」「${n.value.year}」年度只有「預算」資料`,snackbarProps:{color:"info"}})):!a&&r?(u=[{title:"行銷實際支出表",value:"expense"},{title:"行銷各線實際支出表",value:"lineExpense"},{title:"行銷各線實際支出總表",value:"lineExpenseTotal"}],Y({text:`「${J(n.value.theme)}」「${n.value.year}」年度只有「實際支出」資料`,snackbarProps:{color:"info"}})):a&&r?u=[{title:"行銷廣告預算表",value:"budget"},{title:"行銷實際支出表",value:"expense"},{title:"行銷預算與實際支出比較表",value:"comparison"},{title:"行銷各線實際支出表",value:"lineExpense"},{title:"行銷各線實際支出總表",value:"lineExpenseTotal"}]:(u=[],Y({text:`「${J(n.value.theme)}」「${n.value.year}」年度尚未有任何資料`,snackbarProps:{color:"warning"}})),n.value.reportType&&(u.some(h=>h.value===n.value.reportType)||(n.value.reportType=null)),K.value=u}catch(o){F(o)}finally{ue.value=!1}},Kt=()=>{Oe.value="",Q.value=!1},es=()=>{Be.value="",Q.value=!1},ts=()=>{n.value={year:null,theme:null,reportType:null,line:[],month:null},Q.value=!1,f.value=[],Le.value="",Qe.value="",Je.value="",Oe.value="",Be.value=""},ft=async()=>{var o;try{let s=!1;if(Je.value="",Qe.value="",Le.value="",Oe.value="",Be.value="",n.value.reportType||(Je.value="請選擇報表類型",s=!0),n.value.theme||(Qe.value="請選擇行銷主題",s=!0),n.value.year||(Le.value="請選擇年度",s=!0),n.value.reportType==="lineExpense"&&((o=n.value.line)!=null&&o.length||(Oe.value="請選擇線別",s=!0),n.value.month||(Be.value="請選擇月份",s=!0)),s)return;ue.value=!0;let a,r;switch(n.value.reportType){case"budget":r=await B.get(`/marketing/budgets/${n.value.year}/${n.value.theme}`),r.data.success&&(a=Ot(r.data.result),yt.value={annualTotalBudget:r.data.result.annualTotalBudget});break;case"expense":try{const{data:u}=await B.get("/marketing/expenses/monthly-stats",{params:{year:n.value.year,theme:n.value.theme}});u.success&&Array.isArray(u.result)&&(a=Jt(u.result))}catch(u){console.error("Error fetching expense data:",u),F(u)}break;case"comparison":try{const u=await B.get(`/marketing/budgets/${n.value.year}/${n.value.theme}`),g=await B.get("/marketing/expenses/monthly-stats",{params:{year:n.value.year,theme:n.value.theme}});if(u.data.success&&g.data.success){const h=Ot(u.data.result),y=Jt(g.data.result);a=as(h,y)}}catch(u){console.error("Error fetching comparison data:",u),F(u)}break;case"lineExpense":try{const u=n.value.line.filter(ns),{data:g}=await B.get("/marketing/expenses/line-expenses",{params:{year:n.value.year,theme:n.value.theme,lines:u.join(","),month:n.value.month}});g.success&&Array.isArray(g.result)&&(a=os(g.result))}catch(u){console.error("Error fetching line expense data:",u),F(u)}break;case"lineExpenseTotal":try{const{data:u}=await B.get("/marketing/expenses/line-expenses-total",{params:{year:n.value.year,theme:n.value.theme}});u.success&&(a=u.result)}catch(u){console.error("Error fetching line expense total data:",u),F(u)}break}a&&(f.value=a,Q.value=!0)}catch(s){F(s)}finally{ue.value=!1}},Jt=o=>{const s=new Map;return o.forEach(a=>{const r=a.channel._id,u=a.platform._id,g=new Date(a.invoiceDate).getMonth(),h=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"][g];s.has(r)||s.set(r,{channelName:a.channel.name,platforms:new Map});const y=s.get(r);y.platforms.has(u)||y.platforms.set(u,{platformName:a.platform.name,expense:{JAN:0,FEB:0,MAR:0,APR:0,MAY:0,JUN:0,JUL:0,AUG:0,SEP:0,OCT:0,NOV:0,DEC:0}});const c=a.details.reduce((E,v)=>E+v.amount,0);y.platforms.get(u).expense[h]+=c}),Array.from(s.values()).map(a=>({channelName:a.channelName,platforms:Array.from(a.platforms.values())}))},t=o=>o==null||o===""||o===0?"":o.toLocaleString("en-US"),i=o=>o==null||o===""||o===0?"-":o.toLocaleString("en-US"),q=(o,s)=>{const r={1:["JAN","FEB","MAR"],2:["APR","MAY","JUN"],3:["JUL","AUG","SEP"],4:["OCT","NOV","DEC"]}[s].reduce((u,g)=>u+(o[g]||0),0);return i(r)},$e=o=>Object.values(o).reduce((s,a)=>s+(a||0),0),x=o=>{if(n.value.reportType==="lineExpenseTotal")return t(te(o));let s=0;return n.value.reportType==="expense"?s=f.value.reduce((a,r)=>a+r.platforms.reduce((u,g)=>u+(g.expense[o]||0),0),0):s=f.value.reduce((a,r)=>a+r.platforms.reduce((u,g)=>u+(g.budget[o]||0),0),0),t(s)},j=o=>{if(n.value.reportType==="lineExpenseTotal")return i(Ie(o));const a={1:["JAN","FEB","MAR"],2:["APR","MAY","JUN"],3:["JUL","AUG","SEP"],4:["OCT","NOV","DEC"]}[o].reduce((r,u)=>{const g=x(u);return r+(g===""?0:parseFloat(g.replace(/,/g,"")))},0);return i(a)},De=()=>n.value.reportType==="lineExpenseTotal"?t(Mt()):n.value.reportType==="expense"?f.value.reduce((o,s)=>o+s.platforms.reduce((a,r)=>a+Object.values(r.expense).reduce((u,g)=>u+g,0),0),0):f.value.reduce((o,s)=>o+s.platforms.reduce((a,r)=>a+$e(r.budget),0),0),ss=async()=>(window.XLSX||await new Promise((o,s)=>{const a=document.createElement("script");a.src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js",a.onload=o,a.onerror=s,document.head.appendChild(a)}),window.XLSX),Tt=async()=>{var o;try{le.value=!0;const s=await ss(),a=`${n.value.year}年度 ${J(n.value.theme)} ${((o=K.value.find(y=>y.value===n.value.reportType))==null?void 0:o.title)||""}${n.value.reportType==="lineExpense"?` (${n.value.month}月)`:""}`,r=s.utils.aoa_to_sheet([[a],[]]);if(n.value.reportType==="comparison"){s.utils.sheet_add_aoa(r,[["廣告渠道","平台","JAN","","","FEB","","","MAR","","","Q1","","","APR","","","MAY","","","JUN","","","Q2","","","JUL","","","AUG","","","SEP","","","Q3","","","OCT","","","NOV","","","DEC","","","Q4","","","Total","",""],["","","預算","實際","差異","預算","實際","差異","預算","實際","差異","預算","實際","差異","預算","實際","差異","預算","實際","差異","預算","實際","差異","預算","實際","差異","預算","實際","差異","預算","實際","差異","預算","實際","差異","預算","實際","差異","預算","實際","差異","預算","實際","差異","預算","實際","差異","預算","實際","差異","預算","實際","差異"]],{origin:"A3"}),r["!cols"]=[{wch:15},{wch:15},...Array(48).fill({wch:12})],r["!merges"]=[{s:{r:0,c:0},e:{r:0,c:52}},{s:{r:2,c:0},e:{r:3,c:0}},{s:{r:2,c:1},e:{r:3,c:1}},{s:{r:2,c:2},e:{r:2,c:4}},{s:{r:2,c:5},e:{r:2,c:7}},{s:{r:2,c:8},e:{r:2,c:10}},{s:{r:2,c:11},e:{r:2,c:13}},{s:{r:2,c:14},e:{r:2,c:16}},{s:{r:2,c:17},e:{r:2,c:19}},{s:{r:2,c:20},e:{r:2,c:22}},{s:{r:2,c:23},e:{r:2,c:25}},{s:{r:2,c:26},e:{r:2,c:28}},{s:{r:2,c:29},e:{r:2,c:31}},{s:{r:2,c:32},e:{r:2,c:34}},{s:{r:2,c:35},e:{r:2,c:37}},{s:{r:2,c:38},e:{r:2,c:40}},{s:{r:2,c:41},e:{r:2,c:43}},{s:{r:2,c:44},e:{r:2,c:46}},{s:{r:2,c:47},e:{r:2,c:49}},{s:{r:2,c:50},e:{r:2,c:52}}];let y=4;f.value.forEach(E=>{const v=E.platforms.length;E.platforms.forEach((d,T)=>{var O,se,M,I,$,G,ie,he,pe,ve,me,ge,be,ye,fe,Ne,ke,Ue,Re,Pe,et,tt,st,lt,at,ot,nt,rt,ct,dt,ut,it,ht,pt,vt,mt;const R=[T===0?E.channelName:"",d.platformName,t(((O=d.budget)==null?void 0:O.JAN)||0),t(((se=d.expense)==null?void 0:se.JAN)||0),t(((M=d.difference)==null?void 0:M.JAN)||0),t(((I=d.budget)==null?void 0:I.FEB)||0),t((($=d.expense)==null?void 0:$.FEB)||0),t(((G=d.difference)==null?void 0:G.FEB)||0),t(((ie=d.budget)==null?void 0:ie.MAR)||0),t(((he=d.expense)==null?void 0:he.MAR)||0),t(((pe=d.difference)==null?void 0:pe.MAR)||0),i(re(d,1)),i(ce(d,1)),i(H(d,1)),t(((ve=d.budget)==null?void 0:ve.APR)||0),t(((me=d.expense)==null?void 0:me.APR)||0),t(((ge=d.difference)==null?void 0:ge.APR)||0),t(((be=d.budget)==null?void 0:be.MAY)||0),t(((ye=d.expense)==null?void 0:ye.MAY)||0),t(((fe=d.difference)==null?void 0:fe.MAY)||0),t(((Ne=d.budget)==null?void 0:Ne.JUN)||0),t(((ke=d.expense)==null?void 0:ke.JUN)||0),t(((Ue=d.difference)==null?void 0:Ue.JUN)||0),i(re(d,2)),i(ce(d,2)),i(H(d,2)),t(((Re=d.budget)==null?void 0:Re.JUL)||0),t(((Pe=d.expense)==null?void 0:Pe.JUL)||0),t(((et=d.difference)==null?void 0:et.JUL)||0),t(((tt=d.budget)==null?void 0:tt.AUG)||0),t(((st=d.expense)==null?void 0:st.AUG)||0),t(((lt=d.difference)==null?void 0:lt.AUG)||0),t(((at=d.budget)==null?void 0:at.SEP)||0),t(((ot=d.expense)==null?void 0:ot.SEP)||0),t(((nt=d.difference)==null?void 0:nt.SEP)||0),i(re(d,3)),i(ce(d,3)),i(H(d,3)),t(((rt=d.budget)==null?void 0:rt.OCT)||0),t(((ct=d.expense)==null?void 0:ct.OCT)||0),t(((dt=d.difference)==null?void 0:dt.OCT)||0),t(((ut=d.budget)==null?void 0:ut.NOV)||0),t(((it=d.expense)==null?void 0:it.NOV)||0),t(((ht=d.difference)==null?void 0:ht.NOV)||0),t(((pt=d.budget)==null?void 0:pt.DEC)||0),t(((vt=d.expense)==null?void 0:vt.DEC)||0),t(((mt=d.difference)==null?void 0:mt.DEC)||0),i(re(d,4)),i(ce(d,4)),i(H(d,4)),t(He(d.budget)),t(Xe(d.expense)),t(xt(d))];s.utils.sheet_add_aoa(r,[R],{origin:-1}),T===0&&v>1&&r["!merges"].push({s:{r:y,c:0},e:{r:y+v-1,c:0}}),y++})});const c=["月度總計","",t(N("JAN")),t(k("JAN")),t(_("JAN")),t(N("FEB")),t(k("FEB")),t(_("FEB")),t(N("MAR")),t(k("MAR")),t(_("MAR")),i(oe(1)),i(ne(1)),i(W(1)),t(N("APR")),t(k("APR")),t(_("APR")),t(N("MAY")),t(k("MAY")),t(_("MAY")),t(N("JUN")),t(k("JUN")),t(_("JUN")),i(oe(2)),i(ne(2)),i(W(2)),t(N("JUL")),t(k("JUL")),t(_("JUL")),t(N("AUG")),t(k("AUG")),t(_("AUG")),t(N("SEP")),t(k("SEP")),t(_("SEP")),i(oe(3)),i(ne(3)),i(W(3)),t(N("OCT")),t(k("OCT")),t(_("OCT")),t(N("NOV")),t(k("NOV")),t(_("NOV")),t(N("DEC")),t(k("DEC")),t(_("DEC")),i(oe(4)),i(ne(4)),i(W(4)),t(_t()),t(At()),t(Et())];s.utils.sheet_add_aoa(r,[c],{origin:-1}),r["!merges"].push({s:{r:y,c:0},e:{r:y,c:1}})}else if(n.value.reportType==="budget"||n.value.reportType==="expense"){s.utils.sheet_add_aoa(r,[["廣告渠道","平台","JAN","FEB","MAR","Q1","APR","MAY","JUN","Q2","JUL","AUG","SEP","Q3","OCT","NOV","DEC","Q4","Total"]],{origin:"A3"}),r["!cols"]=[{wch:15},{wch:15},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12},{wch:15}],r["!merges"]=[{s:{r:0,c:0},e:{r:0,c:18}}];let y=3;f.value.forEach(E=>{const v=E.platforms.length;E.platforms.forEach((d,T)=>{var O,se,M,I,$,G,ie,he,pe,ve,me,ge,be,ye,fe,Ne,ke,Ue,Re,Pe,et,tt,st,lt,at,ot,nt,rt,ct,dt,ut,it,ht,pt,vt,mt;let R;if(n.value.reportType==="comparison")R=[T===0?E.channelName:"",d.platformName,t(((O=d.budget)==null?void 0:O.JAN)||0),t(((se=d.expense)==null?void 0:se.JAN)||0),t(((M=d.difference)==null?void 0:M.JAN)||0),t(((I=d.budget)==null?void 0:I.FEB)||0),t((($=d.expense)==null?void 0:$.FEB)||0),t(((G=d.difference)==null?void 0:G.FEB)||0),t(((ie=d.budget)==null?void 0:ie.MAR)||0),t(((he=d.expense)==null?void 0:he.MAR)||0),t(((pe=d.difference)==null?void 0:pe.MAR)||0),i(re(d,1)),i(ce(d,1)),i(H(d,1)),t(((ve=d.budget)==null?void 0:ve.APR)||0),t(((me=d.expense)==null?void 0:me.APR)||0),t(((ge=d.difference)==null?void 0:ge.APR)||0),t(((be=d.budget)==null?void 0:be.MAY)||0),t(((ye=d.expense)==null?void 0:ye.MAY)||0),t(((fe=d.difference)==null?void 0:fe.MAY)||0),t(((Ne=d.budget)==null?void 0:Ne.JUN)||0),t(((ke=d.expense)==null?void 0:ke.JUN)||0),t(((Ue=d.difference)==null?void 0:Ue.JUN)||0),i(re(d,2)),i(ce(d,2)),i(H(d,2)),t(((Re=d.budget)==null?void 0:Re.JUL)||0),t(((Pe=d.expense)==null?void 0:Pe.JUL)||0),t(((et=d.difference)==null?void 0:et.JUL)||0),t(((tt=d.budget)==null?void 0:tt.AUG)||0),t(((st=d.expense)==null?void 0:st.AUG)||0),t(((lt=d.difference)==null?void 0:lt.AUG)||0),t(((at=d.budget)==null?void 0:at.SEP)||0),t(((ot=d.expense)==null?void 0:ot.SEP)||0),t(((nt=d.difference)==null?void 0:nt.SEP)||0),i(re(d,3)),i(ce(d,3)),i(H(d,3)),t(((rt=d.budget)==null?void 0:rt.OCT)||0),t(((ct=d.expense)==null?void 0:ct.OCT)||0),t(((dt=d.difference)==null?void 0:dt.OCT)||0),t(((ut=d.budget)==null?void 0:ut.NOV)||0),t(((it=d.expense)==null?void 0:it.NOV)||0),t(((ht=d.difference)==null?void 0:ht.NOV)||0),t(((pt=d.budget)==null?void 0:pt.DEC)||0),t(((vt=d.expense)==null?void 0:vt.DEC)||0),t(((mt=d.difference)==null?void 0:mt.DEC)||0),i(re(d,4)),i(ce(d,4)),i(H(d,4)),t(He(d.budget)),t(Xe(d.expense)),t(xt(d))];else{const w=n.value.reportType==="expense"?d.expense:d.budget;R=[T===0?E.channelName:"",d.platformName,t((w==null?void 0:w.JAN)||0),t((w==null?void 0:w.FEB)||0),t((w==null?void 0:w.MAR)||0),i(q(w,1)),t((w==null?void 0:w.APR)||0),t((w==null?void 0:w.MAY)||0),t((w==null?void 0:w.JUN)||0),i(q(w,2)),t((w==null?void 0:w.JUL)||0),t((w==null?void 0:w.AUG)||0),t((w==null?void 0:w.SEP)||0),i(q(w,3)),t((w==null?void 0:w.OCT)||0),t((w==null?void 0:w.NOV)||0),t((w==null?void 0:w.DEC)||0),i(q(w,4)),t($e(w))]}s.utils.sheet_add_aoa(r,[R],{origin:-1}),T===0&&v>1&&r["!merges"].push({s:{r:y,c:0},e:{r:y+v-1,c:0}}),y++})});const c=n.value.reportType==="comparison"?["月度總計","",t(N("JAN")),t(k("JAN")),t(_("JAN")),t(N("FEB")),t(k("FEB")),t(_("FEB")),t(N("MAR")),t(k("MAR")),t(_("MAR")),i(oe(1)),i(ne(1)),i(W(1)),t(N("APR")),t(k("APR")),t(_("APR")),t(N("MAY")),t(k("MAY")),t(_("MAY")),t(N("JUN")),t(k("JUN")),t(_("JUN")),i(oe(2)),i(ne(2)),i(W(2)),t(N("JUL")),t(k("JUL")),t(_("JUL")),t(N("AUG")),t(k("AUG")),t(_("AUG")),t(N("SEP")),t(k("SEP")),t(_("SEP")),i(oe(3)),i(ne(3)),i(W(3)),t(N("OCT")),t(k("OCT")),t(_("OCT")),t(N("NOV")),t(k("NOV")),t(_("NOV")),t(N("DEC")),t(k("DEC")),t(_("DEC")),i(oe(4)),i(ne(4)),i(W(4)),t(_t()),t(At()),t(Et())]:["月度總計","",t(x("JAN")),t(x("FEB")),t(x("MAR")),i(j(1)),t(x("APR")),t(x("MAY")),t(x("JUN")),i(j(2)),t(x("JUL")),t(x("AUG")),t(x("SEP")),i(j(3)),t(x("OCT")),t(x("NOV")),t(x("DEC")),i(j(4)),t(De())];s.utils.sheet_add_aoa(r,[c],{origin:-1}),r["!merges"].push({s:{r:y,c:0},e:{r:y,c:1}})}else if(n.value.reportType==="lineExpenseTotal"){if(s.utils.sheet_add_aoa(r,[["線別","JAN","FEB","MAR","Q1","APR","MAY","JUN","Q2","JUL","AUG","SEP","Q3","OCT","NOV","DEC","Q4","Total"]],{origin:"A3"}),r["!cols"]=[{wch:15},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12},{wch:15}],r["!merges"]=[{s:{r:0,c:0},e:{r:0,c:17}}],f.value&&Array.isArray(f.value)){f.value.forEach(c=>{if(c&&c.expenses){const E=[c.lineName||"",t(c.expenses.JAN||0),t(c.expenses.FEB||0),t(c.expenses.MAR||0),i(q(c.expenses,1)),t(c.expenses.APR||0),t(c.expenses.MAY||0),t(c.expenses.JUN||0),i(q(c.expenses,2)),t(c.expenses.JUL||0),t(c.expenses.AUG||0),t(c.expenses.SEP||0),i(q(c.expenses,3)),t(c.expenses.OCT||0),t(c.expenses.NOV||0),t(c.expenses.DEC||0),i(q(c.expenses,4)),t($e(c.expenses))];s.utils.sheet_add_aoa(r,[E],{origin:-1})}});const y=["月度總計",t(te("JAN")),t(te("FEB")),t(te("MAR")),i(Ie(1)),t(te("APR")),t(te("MAY")),t(te("JUN")),i(Ie(2)),t(te("JUL")),t(te("AUG")),t(te("SEP")),i(Ie(3)),t(te("OCT")),t(te("NOV")),t(te("DEC")),i(Ie(4)),t(Mt())];s.utils.sheet_add_aoa(r,[y],{origin:-1})}}else if(n.value.reportType==="lineExpense"){const y=["平台 / 線別"];n.value.line.forEach(v=>{y.push(qe(v))}),y.push("Total"),s.utils.sheet_add_aoa(r,[y],{origin:"A3"}),r["!cols"]=[{wch:20},...Array(n.value.line.length).fill({wch:15}),{wch:15}],r["!merges"]=[{s:{r:0,c:0},e:{r:0,c:y.length-1}}],f.value.forEach(v=>{const d=[v.platformName];n.value.line.forEach(T=>{const R=v.expenses[qe(T)]||0;d.push(R===0?"":t(R))}),d.push(v.total>0?t(v.total):""),s.utils.sheet_add_aoa(r,[d],{origin:-1})});const c=["總計"];n.value.line.forEach(v=>{const d=f.value.reduce((T,R)=>T+(R.expenses[qe(v)]||0),0);c.push(d===0?"":t(d))});const E=f.value.reduce((v,d)=>v+(Number(d.total)||0),0);c.push(E===0?"":t(E)),s.utils.sheet_add_aoa(r,[c],{origin:-1})}r.A1.s={alignment:{horizontal:"center"},font:{bold:!0,sz:14}};const u=s.utils.book_new();s.utils.book_append_sheet(u,r,"Report");const g=s.write(u,{bookType:"xlsx",type:"array"});return new Blob([g],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})}catch(s){return F(s),null}finally{le.value=!1}},ls=()=>{if(n.value.reportType==="comparison")return"5200px";if(n.value.reportType==="lineExpense"){const a=364+n.value.line.length*182;return`${Math.max(2200,a)}px`}else return"2200px"},Nt=async()=>{var o;try{le.value=!0;const s=document.querySelector(".budget-table");if(!s)throw new Error("找不到表格元素");const a=document.createElement("div");a.style.width=ls(),a.style.backgroundColor="white",a.style.padding="20px",a.style.boxSizing="border-box";const r=document.createElement("div");r.style.fontSize="24px",r.style.fontWeight="900",r.style.marginBottom="24px",r.style.textAlign="center",r.style.color="#000",r.innerHTML=`
      <div style="margin-bottom: 10px;">
        <span style="color: #F57C00;">${n.value.year}</span>年度
        <span style="color: #D81B60;">${J(n.value.theme)}</span>
        ${((o=K.value.find(v=>v.value===n.value.reportType))==null?void 0:o.title)||""}${n.value.reportType==="lineExpense"?` <span style="color: #0288D1;">(${n.value.month}月)</span>`:""}
      </div>
    `,a.appendChild(r);const u=s.cloneNode(!0);if(u.style.width="100%",u.style.fontSize="14px",u.style.borderCollapse="collapse",u.style.fontFamily="Arial, sans-serif",u.style.border="1px solid #666",u.style.tableLayout="fixed",n.value.reportType==="comparison"){const v=u.querySelector("thead"),d=v.querySelector("tr:first-child"),T=v.querySelector("tr:last-child"),R=d.querySelector("th:first-child"),O=d.querySelector("th:nth-child(2)");R&&O&&(R.setAttribute("rowspan","2"),O.setAttribute("rowspan","2"),R.style.backgroundColor="#607D8B",O.style.backgroundColor="#607D8B",R.style.position="relative",O.style.position="relative",R.style.zIndex="2",O.style.zIndex="2",R.style.verticalAlign="middle",O.style.verticalAlign="middle",R.style.height="86px",O.style.height="86px"),T.querySelectorAll(".sub-header-cell, .sub-header-cell-quarter").forEach(M=>{M.style.backgroundColor=M.classList.contains("sub-header-cell-quarter")?"#00ACC1":"#607D8B",M.style.color="white",M.style.padding="8px",M.style.fontSize="12px",M.style.fontWeight="600",M.style.whiteSpace="nowrap",M.style.borderRight="1px solid rgba(255, 255, 255, 0.3)",M.style.borderBottom="1px solid #666",M.style.minWidth="80px"})}u.querySelectorAll("thead th").forEach(v=>{v.style.backgroundColor="#607D8B",v.style.color="white",v.style.padding="12px 8px",v.style.fontSize="16px",v.style.fontWeight="bold",v.style.borderRight="1px solid rgba(255, 255, 255, 0.3)",v.style.borderBottom="1px solid #666",v.style.whiteSpace="nowrap",v.style.overflow="hidden",v.style.textOverflow="ellipsis",v.classList.contains("header-cell-quarter")&&(v.style.backgroundColor="#00ACC1")}),u.querySelectorAll("td[rowspan]").forEach(v=>{v.style.backgroundColor="#f8f9fa",v.style.verticalAlign="middle",v.style.fontWeight="bold",v.style.borderRight="1px solid #666",v.style.position="relative"}),u.querySelectorAll(".platform-col").forEach(v=>{v.style.backgroundColor="#f8f9fa",v.style.verticalAlign="middle",v.style.borderRight="1px solid #666"}),u.querySelectorAll("tbody td:not([rowspan])").forEach(v=>{v.style.padding="10px 8px",v.style.fontSize="14px",v.style.borderRight="1px solid #666",v.style.borderBottom="1px solid #666",v.style.textAlign="center",v.style.whiteSpace="nowrap",v.style.overflow="hidden",v.style.textOverflow="ellipsis",v.classList.contains("quarter-col")?(v.style.backgroundColor="#FFE0B2",v.style.fontWeight="bold",v.style.minWidth="100px"):v.classList.contains("total-col")?(v.style.backgroundColor="#e2e2e2",v.style.fontWeight="bold",v.style.minWidth="140px"):v.classList.contains("month-col")&&(v.style.width="100px",v.style.backgroundColor="white"),v.parentElement.classList.contains("monthly-total-row")&&(v.style.backgroundColor="#e9ecef",v.style.fontWeight="bold",v.classList.contains("quarter-col")&&(v.style.backgroundColor="#FFE0B2")),v.classList.contains("highlight-total")&&(v.style.backgroundColor="#ffd700")}),a.appendChild(u),document.body.appendChild(a);const E={margin:5,image:{type:"jpeg",quality:.9},html2canvas:{scale:4,useCORS:!0,letterRendering:!0,backgroundColor:"#ffffff",logging:!1,width:a.offsetWidth,height:a.offsetHeight,onclone:function(v){const d=v.querySelector(".budget-table");d&&d.querySelectorAll("td[rowspan]").forEach(R=>{const O=R.getAttribute("rowspan");O&&(R.style.height=`${parseInt(O)*43}px`)})}},jsPDF:{unit:"mm",format:"a4",orientation:"landscape",compress:!0,precision:16,putOnlyUsedFonts:!0}};try{return await As().from(a).set(E).outputPdf("blob")}catch(v){throw console.error("PDF 生成失敗:",v),v}finally{document.body.removeChild(a)}}catch(s){return F(s),null}finally{le.value=!1}},F=o=>{var a,r,u;console.error("Error:",o);const s=((r=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:r.message)||"操作失敗";((u=o==null?void 0:o.response)==null?void 0:u.status)===401?(Yt.logout(),Gt.push("/login"),Y({text:"登入已過期，請重新登入",snackbarProps:{color:"red-lighten-1"}})):Y({text:s,snackbarProps:{color:"red-lighten-1"}})};Pt(async()=>{await It()});const J=o=>{const s=je.value.find(a=>a._id===o);return s?s.name:""},Ot=o=>{const s={};return o.items.forEach(a=>{s[a.channel._id]||(s[a.channel._id]={channelName:a.channel.name,platforms:[]}),s[a.channel._id].platforms.push({platformName:a.platform.name,budget:a.monthlyBudget})}),Object.values(s)},as=(o,s)=>{const a=new Map;return o.forEach(r=>{a.has(r.channelName)||a.set(r.channelName,{channelName:r.channelName,platforms:new Map}),r.platforms.forEach(u=>{const g=a.get(r.channelName).platforms;g.has(u.platformName)||g.set(u.platformName,{platformName:u.platformName,budget:u.budget||null,expense:null,hasBudget:!0,hasExpense:!1})})}),s.forEach(r=>{a.has(r.channelName)||a.set(r.channelName,{channelName:r.channelName,platforms:new Map}),r.platforms.forEach(u=>{const g=a.get(r.channelName).platforms;if(!g.has(u.platformName))g.set(u.platformName,{platformName:u.platformName,budget:null,expense:u.expense,hasBudget:!1,hasExpense:!0});else{const h=g.get(u.platformName);h.expense=u.expense,h.hasExpense=!0}})}),Array.from(a.values()).map(r=>({channelName:r.channelName,platforms:Array.from(r.platforms.values()).map(u=>{var g,h,y,c,E,v,d,T,R,O,se,M,I,$,G,ie,he,pe,ve,me,ge,be,ye,fe;return{...u,difference:{JAN:(((g=u.budget)==null?void 0:g.JAN)||0)-(((h=u.expense)==null?void 0:h.JAN)||0),FEB:(((y=u.budget)==null?void 0:y.FEB)||0)-(((c=u.expense)==null?void 0:c.FEB)||0),MAR:(((E=u.budget)==null?void 0:E.MAR)||0)-(((v=u.expense)==null?void 0:v.MAR)||0),APR:(((d=u.budget)==null?void 0:d.APR)||0)-(((T=u.expense)==null?void 0:T.APR)||0),MAY:(((R=u.budget)==null?void 0:R.MAY)||0)-(((O=u.expense)==null?void 0:O.MAY)||0),JUN:(((se=u.budget)==null?void 0:se.JUN)||0)-(((M=u.expense)==null?void 0:M.JUN)||0),JUL:(((I=u.budget)==null?void 0:I.JUL)||0)-((($=u.expense)==null?void 0:$.JUL)||0),AUG:(((G=u.budget)==null?void 0:G.AUG)||0)-(((ie=u.expense)==null?void 0:ie.AUG)||0),SEP:(((he=u.budget)==null?void 0:he.SEP)||0)-(((pe=u.expense)==null?void 0:pe.SEP)||0),OCT:(((ve=u.budget)==null?void 0:ve.OCT)||0)-(((me=u.expense)==null?void 0:me.OCT)||0),NOV:(((ge=u.budget)==null?void 0:ge.NOV)||0)-(((be=u.expense)==null?void 0:be.NOV)||0),DEC:(((ye=u.budget)==null?void 0:ye.DEC)||0)-(((fe=u.expense)==null?void 0:fe.DEC)||0)}}})}))},P=o=>({"month-col":!0,"difference-positive":o>0,"difference-negative":o<0}),N=o=>f.value.reduce((s,a)=>s+a.platforms.reduce((r,u)=>{var g;return r+(((g=u.budget)==null?void 0:g[o])||0)},0),0),k=o=>f.value.reduce((s,a)=>s+a.platforms.reduce((r,u)=>{var g;return r+(((g=u.expense)==null?void 0:g[o])||0)},0),0),_=o=>N(o)-k(o),oe=o=>({1:["JAN","FEB","MAR"],2:["APR","MAY","JUN"],3:["JUL","AUG","SEP"],4:["OCT","NOV","DEC"]})[o].reduce((a,r)=>a+N(r),0),ne=o=>({1:["JAN","FEB","MAR"],2:["APR","MAY","JUN"],3:["JUL","AUG","SEP"],4:["OCT","NOV","DEC"]})[o].reduce((a,r)=>a+k(r),0),W=o=>oe(o)-ne(o),He=o=>o?Object.values(o).reduce((s,a)=>s+(a||0),0):0,Xe=o=>o?Object.values(o).reduce((s,a)=>s+(a||0),0):0,xt=o=>He(o.budget)-Xe(o.expense),_t=()=>f.value.reduce((o,s)=>o+s.platforms.reduce((a,r)=>a+He(r.budget),0),0),At=()=>f.value.reduce((o,s)=>o+s.platforms.reduce((a,r)=>a+Xe(r.expense),0),0),Et=()=>_t()-At(),re=(o,s)=>({1:["JAN","FEB","MAR"],2:["APR","MAY","JUN"],3:["JUL","AUG","SEP"],4:["OCT","NOV","DEC"]})[s].reduce((r,u)=>{var g;return r+(((g=o.budget)==null?void 0:g[u])||0)},0),ce=(o,s)=>({1:["JAN","FEB","MAR"],2:["APR","MAY","JUN"],3:["JUL","AUG","SEP"],4:["OCT","NOV","DEC"]})[s].reduce((r,u)=>{var g;return r+(((g=o.expense)==null?void 0:g[u])||0)},0),H=(o,s)=>re(o,s)-ce(o,s),qe=o=>{if(typeof o=="string"){const s=ae.value.find(a=>a._id===o);return s?s.name:o}return(o==null?void 0:o.name)||""},os=o=>{if(!o||o.length===0||!Array.isArray(o))return[{platformName:"無資料",expenses:{},total:0}];const s=o.filter(a=>a.platformName!=="Total");return s.length===0?[{platformName:"無資料",expenses:{},total:0}]:s.map(a=>({platformName:a.platformName,expenses:a.expenses||{},total:a.total||Object.values(a.expenses||{}).reduce((r,u)=>r+(u||0),0)}))},ns=o=>/^[a-fA-F0-9]{24}$/.test(o),rs=()=>{Oe.value="",n.value.line.length===ae.value.length?n.value.line=[]:n.value.line=ae.value.map(o=>o._id)},te=o=>!f.value||n.value.reportType!=="lineExpenseTotal"?0:f.value.reduce((s,a)=>s+(Number(a.expenses[o])||0),0),Ie=o=>!f.value||n.value.reportType!=="lineExpenseTotal"?0:{1:["JAN","FEB","MAR"],2:["APR","MAY","JUN"],3:["JUL","AUG","SEP"],4:["OCT","NOV","DEC"]}[o].reduce((a,r)=>a+te(r),0),Mt=()=>!f.value||n.value.reportType!=="lineExpenseTotal"?0:f.value.reduce((o,s)=>o+Object.values(s.expenses).reduce((a,r)=>a+(Number(r)||0),0),0),X=Rt(()=>{if(!f.value||!Array.isArray(f.value)||f.value.length===0)return{title:{text:"各線別費用佔比",left:"center",top:20,textStyle:{fontSize:24,fontWeight:"bold",padding:[0,0,20,0]}},series:[{type:"pie",data:[]}]};const o=f.value.reduce((a,r)=>r.expenses?a+Object.values(r.expenses).reduce((u,g)=>u+(Number(g)||0),0):a,0),s=f.value.filter(a=>a.expenses).map(a=>{const r=Object.values(a.expenses).reduce((g,h)=>g+(Number(h)||0),0),u=ae.value.find(g=>g.name===a.lineName);return{name:a.lineName||"",value:r,percentage:o>0?(r/o*100).toFixed(2):"0.00",order:(u==null?void 0:u.order)||999}}).sort((a,r)=>a.order-r.order);return{tooltip:{trigger:"item",formatter:a=>`${a.name}<br/>金額: $${a.value.toLocaleString("en-US")}<br/>佔比: ${a.data.percentage}%`},series:[{name:"費用佔比",type:"pie",radius:["30%","70%"],center:["50%","50%"],roseType:!1,itemStyle:{borderRadius:3,borderColor:"#fff",borderWidth:1},label:{show:!0,formatter:a=>`${a.name}
$${a.value.toLocaleString("en-US")}
${a.data.percentage}%`,fontSize:11,lineHeight:15,alignTo:"edge",edgeDistance:"6%",distanceToLabelLine:6},labelLine:{show:!0,length:15,length2:25,minTurnAngle:90,maxSurfaceAngle:90},labelLayout:{hideOverlap:!1,moveOverlap:"none",draggable:!0},emphasis:{scale:!0,scaleSize:10,label:{show:!0,fontSize:14,fontWeight:"bold"}},data:s,animationType:"scale",animationEasing:"elasticOut"}]}}),z=Rt(()=>{if(!f.value||!Array.isArray(f.value)||f.value.length===0)return{xAxis:{type:"category",data:[]},yAxis:{type:"value"},series:[{type:"bar",data:[]}]};const o=f.value.filter(a=>a.expenses).map(a=>a.lineName||""),s=f.value.filter(a=>a.expenses).map(a=>Object.values(a.expenses).reduce((r,u)=>r+(Number(u)||0),0));return{tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:a=>`${a[0].name}<br/>金額: $${a[0].value.toLocaleString("en-US")}`},grid:{left:"1%",right:"2%",top:"14%",bottom:"4%",containLabel:!0},xAxis:{type:"category",data:o,axisLabel:{interval:0,rotate:40}},yAxis:{type:"value",name:"金額",nameGap:25,axisLabel:{formatter:a=>`$${a.toLocaleString("en-US")}`,margin:4}},series:[{name:"費用金額",type:"bar",data:s,itemStyle:{color:"#00ACC1",borderRadius:[4,4,0,0]},label:{show:!0,position:"top",formatter:a=>`$${a.value.toLocaleString("en-US")}`,distance:15,rotate:20,fontSize:11,overflow:"break"},barWidth:"55%",barGap:"100%"}]}}),xe=V(null),_e=V(null);Ce(()=>f.value,o=>{n.value.reportType==="lineExpenseTotal"&&Q.value&&o&&Se(()=>{xe.value&&xe.value.resize(),_e.value&&_e.value.resize()})},{deep:!0}),Ce(()=>Q.value,o=>{o&&n.value.reportType==="lineExpenseTotal"&&Se(()=>{xe.value&&xe.value.resize(),_e.value&&_e.value.resize()})}),Ce([()=>f.value,()=>Q.value],([o,s])=>{n.value.reportType==="lineExpenseTotal"&&s&&o&&Se(async()=>{await new Promise(a=>setTimeout(a,100)),xe.value&&(xe.value.resize(),xe.value.setOption(X.value)),_e.value&&(_e.value.resize(),_e.value.setOption(z.value))})},{deep:!0}),Pt(()=>{window.addEventListener("resize",Vt)}),Js(()=>{window.removeEventListener("resize",Vt)});const Vt=()=>{n.value.reportType==="lineExpenseTotal"&&Q.value&&Se(()=>{xe.value&&xe.value.resize(),_e.value&&_e.value.resize()})},cs=async()=>{try{le.value=!0;const o=document.createElement("div");o.style.width="1680px",o.style.height="920px",o.style.backgroundColor="white",o.style.padding="20px",o.style.boxSizing="border-box",document.body.appendChild(o);const s=document.createElement("div");s.style.width="1680px",s.style.height="920px",s.style.backgroundColor="white",s.style.padding="20px",s.style.boxSizing="border-box",document.body.appendChild(s);const a=wt(o,null,{renderer:"canvas",devicePixelRatio:4}),r=wt(s,null,{renderer:"canvas",devicePixelRatio:4}),u={...X.value,title:{...X.value.title,textStyle:{fontSize:20,fontWeight:"bold"}},tooltip:{...X.value.tooltip,textStyle:{fontSize:16}},series:[{...X.value.series[0],label:{...X.value.series[0].label,fontSize:14,lineHeight:24},emphasis:{...X.value.series[0].emphasis,label:{...X.value.series[0].emphasis.label,fontSize:16}}}]},g={...z.value,title:{...z.value.title,textStyle:{fontSize:20,fontWeight:"bold"}},tooltip:{...z.value.tooltip,textStyle:{fontSize:16}},xAxis:{...z.value.xAxis,axisLabel:{...z.value.xAxis.axisLabel,fontSize:16},nameTextStyle:{fontSize:16}},yAxis:{...z.value.yAxis,nameTextStyle:{fontSize:16},axisLabel:{...z.value.yAxis.axisLabel,fontSize:16}},series:[{...z.value.series[0],label:{...z.value.series[0].label,fontSize:16}}]};a.setOption(u),r.setOption(g),await new Promise(h=>setTimeout(h,1e3));try{const h=new Lt({orientation:"landscape",unit:"mm",format:"a4"}),y=297,c=210,E=255,v=142,d=(y-E)/2,T=(c-v)/2,O=(await Ct(o,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",logging:!1,letterRendering:!0,onclone:function(I){const $=I.querySelector("div");$&&($.style.backgroundColor="white")}})).toDataURL("image/png",1);h.addImage(O,"PNG",d,T,E,v),h.addPage();const M=(await Ct(s,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",logging:!1,letterRendering:!0,onclone:function(I){const $=I.querySelector("div");$&&($.style.backgroundColor="white")}})).toDataURL("image/png",1);h.addImage(M,"PNG",d,T,E,v),h.save(`${n.value.year}年度${J(n.value.theme)}行銷各線實際支出統計圖表.pdf`),Y({text:"PDF 匯出成功",snackbarProps:{color:"teal-lighten-1"}})}catch(h){throw console.error("PDF 生成失敗:",h),h}finally{a.dispose(),r.dispose(),document.body.removeChild(o),document.body.removeChild(s)}}catch(o){F(o)}finally{le.value=!1}},Fe=V(!1),p=V({theme:null,year:null,selectedReports:[],selectedMonths:[],selectedLines:[],selectAllMonths:!1,fileFormats:["pdf"],availableDataTypes:{hasBudget:!1,hasExpense:!1}}),ze=V(""),Ze=V(""),Ye=V([]),ds=async()=>{var o,s,a;try{ze.value="",Ze.value="";let r=!1;if(p.value.theme||(ze.value="請選擇行銷主題",r=!0),p.value.year||(Ze.value="請選擇年度",r=!0),p.value.selectedReports.length===0&&(Y({text:"請至少選擇一種報表類型",snackbarProps:{color:"warning"}}),r=!0),p.value.selectedReports.some(g=>g!=="charts")&&p.value.fileFormats.length===0&&(Y({text:"請至少選擇一種檔案格式",snackbarProps:{color:"warning"}}),r=!0),p.value.selectedReports.includes("lineExpense")&&(p.value.selectedMonths.length===0&&(Y({text:"請至少選擇一個月份",snackbarProps:{color:"warning"}}),r=!0),p.value.selectedLines.length===0&&(Y({text:"請至少選擇一條線別",snackbarProps:{color:"warning"}}),r=!0)),r)return;le.value=!0;const u=new ws;try{Ke.value=!0,Ae.value=0,Te.value="準備匯出...",Q.value=!1,f.value=[];let g=0,h=0;for(const v of p.value.selectedReports)v==="charts"?g+=1:v==="lineExpense"?g+=p.value.selectedMonths.length*p.value.fileFormats.length:g+=p.value.fileFormats.length;const y={theme:p.value.theme,year:p.value.year,reportType:null,line:[],month:null};for(const v of p.value.selectedReports){if(v==="charts"){if(Te.value="正在生成統計圖表...",y.reportType="lineExpenseTotal",n.value={...y},f.value=[],await ft(),await Se(),f.value&&f.value.length>0){const d=await ps();if(d){const T=`${n.value.year}年度${J(n.value.theme)}行銷各線實際支出統計圖表.pdf`;u.file(T,d)}}h++,Ae.value=h/g*100,await new Promise(d=>setTimeout(d,500));continue}if(y.reportType=v,v==="lineExpense"){y.line=p.value.selectedLines;for(const d of p.value.selectedMonths){if(Te.value=`正在處理 ${d} 月資料...`,y.month=d,n.value={...y},f.value=[],await ft(),await Se(),p.value.fileFormats.includes("pdf")){const T=await Nt();if(T){const R=`${n.value.year}年度${J(n.value.theme)}行銷各線實際支出表_${d}月.pdf`;u.file(R,T)}h++,Ae.value=h/g*100}if(p.value.fileFormats.includes("excel")){const T=await Tt();if(T){const R=`${n.value.year}年度${J(n.value.theme)}行銷各線實際支出表_${d}月.xlsx`;u.file(R,T)}h++,Ae.value=h/g*100}await new Promise(T=>setTimeout(T,500))}}else{if(Te.value=`正在處理${((o=K.value.find(d=>d.value===v))==null?void 0:o.title)||""}...`,n.value={...y},f.value=[],await ft(),await Se(),f.value&&f.value.length>0){if(p.value.fileFormats.includes("pdf")){const d=await Nt();if(d){const T=`${n.value.year}年度${J(n.value.theme)}${((s=K.value.find(R=>R.value===v))==null?void 0:s.title)||""}.pdf`;u.file(T,d)}h++,Ae.value=h/g*100}if(p.value.fileFormats.includes("excel")){const d=await Tt();if(d){const T=`${n.value.year}年度${J(n.value.theme)}${((a=K.value.find(R=>R.value===v))==null?void 0:a.title)||""}.xlsx`;u.file(T,d)}h++,Ae.value=h/g*100}}await new Promise(d=>setTimeout(d,500))}}Te.value="正在打包檔案...";const c=await u.generateAsync({type:"blob"}),E=document.createElement("a");E.href=URL.createObjectURL(c),E.download=`${n.value.year}年度${J(n.value.theme)}報表.zip`,document.body.appendChild(E),E.click(),document.body.removeChild(E),URL.revokeObjectURL(E.href),Fe.value=!1,n.value={year:null,theme:null,reportType:null,line:[],month:null},Q.value=!1,f.value=[],await Se(),Y({text:"報表匯出完成",snackbarProps:{color:"teal-lighten-1"}})}finally{Ke.value=!1,Ae.value=0,Te.value="",le.value=!1}}catch(r){F(r),Q.value=!1,f.value=[],Ke.value=!1,Ae.value=0,Te.value=""}},us=()=>{p.value={theme:null,year:null,selectedReports:[],selectedMonths:[],selectedLines:[],selectAllMonths:!1,fileFormats:["pdf"],availableDataTypes:{hasBudget:!1,hasExpense:!1}},ze.value="",Ze.value="",Ye.value=[],Fe.value=!0},is=()=>{p.value.selectAllMonths?p.value.selectedMonths=We.value.map(o=>o.value):p.value.selectedMonths=[]},hs=()=>{p.value.selectedLines.length===ae.value.length?p.value.selectedLines=[]:p.value.selectedLines=ae.value.map(o=>o._id)};Ce(()=>p.value.selectedMonths,o=>{p.value.selectAllMonths=o.length===We.value.length},{deep:!0}),Ce(()=>p.value.theme,async o=>{if(ze.value="",p.value.year=null,Ye.value=[],p.value.selectedReports=[],p.value.selectedMonths=[],p.value.selectedLines=[],p.value.selectAllMonths=!1,p.value.fileFormats=["pdf"],p.value.availableDataTypes={hasBudget:!1,hasExpense:!1},o)try{const[s,a]=await Promise.all([B.get(`/marketing/budgets/years/${o}`),B.get(`/marketing/expenses/years/${o}`)]),r=s.data.success?s.data.result:[],u=a.data.success?a.data.result:[];p.value.availableDataTypes={hasBudget:r.length>0,hasExpense:u.length>0};const g=[...new Set([...r,...u])];Ye.value=g.sort((h,y)=>y-h),!r.length&&!u.length&&(Y({text:`「${J(o)}」尚未有任何「預算」或是「實際支出」資料`,snackbarProps:{color:"warning"}}),p.value.year=null,Ye.value=[],p.value.availableDataTypes={hasBudget:!1,hasExpense:!1})}catch(s){F(s),Ye.value=[],p.value.availableDataTypes={hasBudget:!1,hasExpense:!1}}}),Ce(()=>p.value.year,async o=>{if(Ze.value="",p.value.selectedReports=[],p.value.selectedMonths=[],p.value.selectedLines=[],p.value.selectAllMonths=!1,p.value.fileFormats=["pdf"],o&&p.value.theme)try{const[s,a]=await Promise.all([B.get(`/marketing/budgets/check/${o}/${p.value.theme}`),B.get(`/marketing/expenses/check/${o}/${p.value.theme}`)]),r=s.data.success&&s.data.result,u=a.data.success&&a.data.result;p.value.availableDataTypes={hasBudget:r,hasExpense:u},r&&!u?Y({text:`「${J(p.value.theme)}」只有「預算」資料`,snackbarProps:{color:"info"}}):!r&&u&&Y({text:`「${J(p.value.theme)}」只有「實際支出」資料`,snackbarProps:{color:"info"}})}catch(s){F(s),p.value.availableDataTypes={hasBudget:!1,hasExpense:!1}}}),Ce(()=>p.value.selectedReports,o=>{o.length===1&&o[0]==="charts"&&(p.value.fileFormats=["pdf"])},{deep:!0});const ps=async()=>{try{const o=document.createElement("div");o.style.width="1680px",o.style.height="920px",o.style.backgroundColor="white",o.style.padding="20px",o.style.boxSizing="border-box",document.body.appendChild(o);const s=document.createElement("div");s.style.width="1680px",s.style.height="920px",s.style.backgroundColor="white",s.style.padding="20px",s.style.boxSizing="border-box",document.body.appendChild(s);const a=wt(o,null,{renderer:"canvas",devicePixelRatio:4}),r=wt(s,null,{renderer:"canvas",devicePixelRatio:4}),u={...X.value,title:{...X.value.title,textStyle:{fontSize:20,fontWeight:"bold"}},tooltip:{...X.value.tooltip,textStyle:{fontSize:16}},series:[{...X.value.series[0],label:{...X.value.series[0].label,fontSize:14,lineHeight:24},emphasis:{...X.value.series[0].emphasis,label:{...X.value.series[0].emphasis.label,fontSize:14}}}]},g={...z.value,title:{...z.value.title,textStyle:{fontSize:20,fontWeight:"bold"}},tooltip:{...z.value.tooltip,textStyle:{fontSize:16}},xAxis:{...z.value.xAxis,axisLabel:{...z.value.xAxis.axisLabel,fontSize:16},nameTextStyle:{fontSize:16}},yAxis:{...z.value.yAxis,nameTextStyle:{fontSize:16},axisLabel:{...z.value.yAxis.axisLabel,fontSize:16}},series:[{...z.value.series[0],label:{...z.value.series[0].label,fontSize:16}}]};a.setOption(u),r.setOption(g),await new Promise(h=>setTimeout(h,1e3));try{const h=new Lt({orientation:"landscape",unit:"mm",format:"a4"}),y=297,c=210,E=255,v=142,d=(y-E)/2,T=(c-v)/2,O=(await Ct(o,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",logging:!1,onclone:function($){const G=$.querySelector("div");G&&(G.style.backgroundColor="white")}})).toDataURL("image/png",1);h.addImage(O,"PNG",d,T,E,v),h.addPage();const M=(await Ct(s,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",logging:!1,onclone:function($){const G=$.querySelector("div");G&&(G.style.backgroundColor="white")}})).toDataURL("image/png",1);return h.addImage(M,"PNG",d,T,E,v),h.output("blob")}catch(h){throw console.error("PDF 生成失敗:",h),h}finally{a.dispose(),r.dispose(),document.body.removeChild(o),document.body.removeChild(s)}}catch(o){return F(o),null}},vs=async()=>{var o;try{const s=await Nt();if(s){const a=n.value.reportType==="lineExpense"?`${n.value.year}年度${J(n.value.theme)}行銷各線實際支出表(${n.value.month}月).pdf`:`${n.value.year}年度${J(n.value.theme)}${((o=K.value.find(u=>u.value===n.value.reportType))==null?void 0:o.title)||""}.pdf`,r=document.createElement("a");r.href=URL.createObjectURL(s),r.download=a,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(r.href),Y({text:"PDF 匯出成功",snackbarProps:{color:"teal-lighten-1"}})}}catch(s){F(s)}},ms=async()=>{var o;try{const s=await Tt();if(s){const a=n.value.reportType==="lineExpense"?`${n.value.year}年度${J(n.value.theme)}行銷各線實際支出表(${n.value.month}月).xlsx`:`${n.value.year}年度${J(n.value.theme)}${((o=K.value.find(u=>u.value===n.value.reportType))==null?void 0:o.title)||""}.xlsx`,r=document.createElement("a");r.href=URL.createObjectURL(s),r.download=a,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(r.href),Y({text:"Excel 匯出成功",snackbarProps:{color:"teal-lighten-1"}})}}catch(s){F(s)}},Ke=V(!1),Ae=V(0),Te=V("");Ce(()=>p.value.availableDataTypes,o=>{o&&(p.value.selectedReports=p.value.selectedReports.filter(s=>{switch(s){case"budget":return o.hasBudget;case"expense":case"lineExpense":case"lineExpenseTotal":case"charts":return o.hasExpense;case"comparison":return o.hasBudget&&o.hasExpense;default:return!1}}))},{deep:!0});const gs=o=>{ze.value="",p.value.theme=o};return(o,s)=>(A(),Ve(Ts,{fluid:""},{default:b(()=>[m(ks,{modelValue:Ke.value,"onUpdate:modelValue":s[0]||(s[0]=a=>Ke.value=a),class:"align-center justify-center",persistent:"",opacity:"1",scrim:"#fff"},{default:b(()=>[m(Bt,{color:"white",width:"300",class:"px-6 py-8",elevation:"0"},{default:b(()=>[e("div",Ms,[m(Ns,{"model-value":Ae.value,color:"deep-purple-darken-2",size:"150",width:"18"},{default:b(()=>[L(l(Math.round(Ae.value))+" % ",1)]),_:1},8,["model-value"])]),s[22]||(s[22]=e("div",{class:"text-center h2 text-body-1 font-weight-medium mb-4"}," 正在處理報表... ",-1)),e("div",Vs,l(Te.value),1)]),_:1})]),_:1},8,["modelValue"]),m(Z,null,{default:b(()=>[m(Z,{class:"mt-0"},{default:b(()=>[m(S,{cols:"12",lg:"10",class:"pb-0 pb-lg-4"},{default:b(()=>[m(Z,{class:"elevation-4 rounded-lg py-3 pt-sm-8 px-4 px-lg-8 mx-3 mt-2 mt-sm-6 ms-lg-6 me-lg-1 mb-4 bg-white"},{default:b(()=>[m(S,{cols:"12",md:"2"},{default:b(()=>s[23]||(s[23]=[e("h3",null,"行銷費用分析",-1)])),_:1}),m(S,{cols:"12",md:"10",class:"ps-md-10"},{default:b(()=>[m(Z,null,{default:b(()=>[m(S,{cols:"12"},{default:b(()=>[m(Z,null,{default:b(()=>[m(S,{cols:"12",sm:"6",md:"auto",class:"search-field"},{default:b(()=>[m(kt,{modelValue:n.value.theme,"onUpdate:modelValue":[s[1]||(s[1]=a=>n.value.theme=a),Ht],items:je.value,label:"行銷主題","item-title":"name","item-value":"_id",variant:"outlined",density:"compact","error-messages":Qe.value,clearable:""},null,8,["modelValue","items","error-messages"])]),_:1}),m(S,{cols:"12",sm:"6",md:"auto",class:"search-field"},{default:b(()=>[m(gt,{modelValue:n.value.year,"onUpdate:modelValue":[s[2]||(s[2]=a=>n.value.year=a),Zt],items:Me.value,label:"年度",variant:"outlined",density:"compact","error-messages":Le.value,clearable:"",disabled:!n.value.theme||Me.value.length===0},null,8,["modelValue","items","error-messages","disabled"])]),_:1}),m(S,{cols:"12",sm:"6",md:"auto",class:"search-field"},{default:b(()=>[m(gt,{modelValue:n.value.reportType,"onUpdate:modelValue":[s[3]||(s[3]=a=>n.value.reportType=a),Xt],items:K.value,label:"報表類型",variant:"outlined",density:"compact","error-messages":Je.value,clearable:"",disabled:!n.value.year||K.value.length===0},null,8,["modelValue","items","error-messages","disabled"])]),_:1}),n.value.reportType==="lineExpense"?(A(),Ve(S,{key:0,cols:"12",sm:"6",md:"auto",class:"search-field"},{default:b(()=>[m(gt,{modelValue:n.value.month,"onUpdate:modelValue":[s[4]||(s[4]=a=>n.value.month=a),es],items:We.value,"item-title":"name","item-value":"value",label:"月份",variant:"outlined",density:"compact","error-messages":Be.value,clearable:""},null,8,["modelValue","items","error-messages"])]),_:1})):D("",!0),n.value.reportType==="lineExpense"?(A(),Ve(S,{key:1,cols:"12",sm:"6",md:"auto",class:"search-field"},{default:b(()=>[n.value.reportType==="lineExpense"?(A(),Ve(gt,{key:0,modelValue:n.value.line,"onUpdate:modelValue":[s[5]||(s[5]=a=>n.value.line=a),Kt],items:ae.value,label:"線別","item-title":"name","item-value":"_id",variant:"outlined",density:"compact","error-messages":Oe.value,clearable:"",multiple:""},{selection:b(({item:a,index:r})=>[r===0?(A(),C("span",Ls,l(a.raw.name),1)):r===1?(A(),C("span",Bs,"...")):D("",!0)]),"prepend-item":b(()=>[m($t,{title:"全選",color:"deep-purple-darken-2","prepend-icon":"mdi-checkbox-multiple-marked",active:n.value.line.length===ae.value.length,onClick:rs},null,8,["active"]),m(Ge,{class:"mt-2"})]),_:1},8,["modelValue","items","error-messages"])):D("",!0)]),_:1})):D("",!0),m(S,{cols:"12",sm:"6",md:"3"},{default:b(()=>[m(Z,{class:"d-flex justify-space-between"},{default:b(()=>[m(S,{cols:"3",class:"pe-0"},{default:b(()=>[m(we,{color:"grey",width:"40",block:"",onClick:ts},{default:b(()=>[m(Ut,null,{default:b(()=>s[24]||(s[24]=[L("mdi-refresh")])),_:1})]),_:1})]),_:1}),m(S,{cols:"9",class:"ps-4"},{default:b(()=>[m(we,{color:"cyan-darken-2",loading:ue.value,block:"",onClick:ft},{default:b(()=>s[25]||(s[25]=[L(" 查看報表 ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),m(S,{cols:"12",lg:"2",class:"pt-0 pt-lg-4"},{default:b(()=>[m(Z,{class:"elevation-4 rounded-lg pt-3 pb-3 px-4 mx-3 mt-2 mt-lg-5 me-lg-6 ms-lg-1 mb-4 bg-white"},{default:b(()=>[m(S,{cols:"12",class:"pb-2"},{default:b(()=>s[26]||(s[26]=[e("div",{class:"card-title"}," 批次匯出報表 ",-1)])),_:1}),m(S,null,{default:b(()=>[m(we,{"prepend-icon":"mdi-file-export",color:"deep-orange-darken-1",loading:le.value,block:"",onClick:us},{default:b(()=>s[27]||(s[27]=[L(" 批次匯出 ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),Q.value?(A(),Ve(Z,{key:0,class:"elevation-4 rounded-lg py-4 py-md-8 px-2 px-md-8 mt-5 mt-lg-6 mx-0 mx-lg-3 mb-4 bg-white"},{default:b(()=>[m(S,{cols:"12"},{default:b(()=>{var a,r,u,g;return[e("div",$s,[e("div",null,[m(we,{color:"teal-darken-1",class:"me-4","prepend-icon":"mdi-microsoft-excel",loading:le.value,size:bt.value,onClick:ms},{default:b(()=>s[28]||(s[28]=[L(" 匯出 EXCEL ")])),_:1},8,["loading","size"]),m(we,{color:"red-darken-1","prepend-icon":"mdi-file-pdf-box",loading:le.value,size:bt.value,onClick:vs},{default:b(()=>s[29]||(s[29]=[L(" 匯出 PDF ")])),_:1},8,["loading","size"])])]),n.value.reportType==="budget"?(A(),C("div",Ds,[e("span",qs,l(n.value.year?`${n.value.year}`:"( 請先選擇年度 )"),1),s[30]||(s[30]=L(" 年度 ")),e("span",Fs,l(n.value.theme?J(n.value.theme):"( 請先選擇行銷主題 )"),1),L(" "+l(((a=K.value.find(h=>h.value===n.value.reportType))==null?void 0:a.title)||""),1)])):D("",!0),n.value.reportType==="expense"?(A(),C("div",zs,[e("span",Ys,l(n.value.year?`${n.value.year}`:"( 請先選擇年度 )"),1),s[31]||(s[31]=L(" 年度 ")),e("span",Gs,l(n.value.theme?J(n.value.theme):"( 請先選擇行銷主題 )"),1),L(" "+l(((r=K.value.find(h=>h.value==="expense"))==null?void 0:r.title)||""),1)])):D("",!0),n.value.reportType==="lineExpense"?(A(),C("div",Qs,[e("span",js,l(n.value.year?`${n.value.year}`:"( 請先選擇年度 )"),1),s[32]||(s[32]=L(" 年度 ")),e("span",Ws,l(n.value.theme?J(n.value.theme):"( 請先選擇行銷主題 )"),1),s[33]||(s[33]=L(" 行銷各線實際支出表 ")),e("span",Hs,"("+l(n.value.month?`${n.value.month}月`:"( 請先選擇月份 )")+")",1)])):D("",!0),n.value.reportType==="lineExpenseTotal"?(A(),C("div",Xs,[e("span",Is,l(n.value.year?`${n.value.year}`:"( 請先選擇年度 )"),1),s[34]||(s[34]=L(" 年度 ")),e("span",Zs,l(n.value.theme?J(n.value.theme):"( 請先選擇行銷主題 )"),1),s[35]||(s[35]=L(" 行銷各線實際支出總表 "))])):D("",!0),n.value.reportType==="comparison"?(A(),C("div",Ks,[e("span",el,l(n.value.year?`${n.value.year}`:"( 請先選擇年度 )"),1),s[36]||(s[36]=L(" 年度 ")),e("span",tl,l(n.value.theme?J(n.value.theme):"( 請先選擇行銷主題 )"),1),L(" "+l(((u=K.value.find(h=>h.value==="comparison"))==null?void 0:u.title)||""),1)])):D("",!0),n.value.reportType==="budget"||n.value.reportType==="expense"||n.value.reportType==="comparison"?(A(),C("div",sl,[n.value.reportType==="budget"?(A(),C("table",ll,[s[38]||(s[38]=e("thead",null,[e("tr",{class:"header-row"},[e("th",{rowspan:"1",class:"header-cell"}," 廣告渠道 "),e("th",{rowspan:"1",class:"header-cell"}," 平台 "),e("th",{class:"header-cell"}," JAN "),e("th",{class:"header-cell"}," FEB "),e("th",{class:"header-cell"}," MAR "),e("th",{class:"header-cell-quarter"}," Q1 "),e("th",{class:"header-cell"}," APR "),e("th",{class:"header-cell"}," MAY "),e("th",{class:"header-cell"}," JUN "),e("th",{class:"header-cell-quarter"}," Q2 "),e("th",{class:"header-cell"}," JUL "),e("th",{class:"header-cell"}," AUG "),e("th",{class:"header-cell"}," SEP "),e("th",{class:"header-cell-quarter"}," Q3 "),e("th",{class:"header-cell"}," OCT "),e("th",{class:"header-cell"}," NOV "),e("th",{class:"header-cell"}," DEC "),e("th",{class:"header-cell-quarter"}," Q4 "),e("th",{class:"header-cell"}," Total ")])],-1)),e("tbody",null,[(A(!0),C(ee,null,de(f.value,(h,y)=>(A(),C(ee,{key:y},[(A(!0),C(ee,null,de(h.platforms,(c,E)=>(A(),C("tr",{key:`${y}-${E}`,class:U({"row-odd":y%2===0})},[E===0?(A(),C("td",{key:0,rowspan:h.platforms.length,class:"channel-col"},l(h.channelName),9,al)):D("",!0),e("td",ol,l(c.platformName),1),e("td",nl,l(t(c.budget.JAN)),1),e("td",rl,l(t(c.budget.FEB)),1),e("td",cl,l(t(c.budget.MAR)),1),e("td",dl,l(i(q(c.budget,1))),1),e("td",ul,l(t(c.budget.APR)),1),e("td",il,l(t(c.budget.MAY)),1),e("td",hl,l(t(c.budget.JUN)),1),e("td",pl,l(i(q(c.budget,2))),1),e("td",vl,l(t(c.budget.JUL)),1),e("td",ml,l(t(c.budget.AUG)),1),e("td",gl,l(t(c.budget.SEP)),1),e("td",bl,l(i(q(c.budget,3))),1),e("td",yl,l(t(c.budget.OCT)),1),e("td",fl,l(t(c.budget.NOV)),1),e("td",xl,l(t(c.budget.DEC)),1),e("td",_l,l(i(q(c.budget,4))),1),e("td",Al,l(t($e(c.budget))),1)],2))),128))],64))),128)),e("tr",El,[s[37]||(s[37]=e("td",{colspan:"2"}," 月度總計 ",-1)),e("td",wl,l(t(x("JAN"))),1),e("td",Cl,l(t(x("FEB"))),1),e("td",Tl,l(t(x("MAR"))),1),e("td",Nl,l(i(j(1))),1),e("td",kl,l(t(x("APR"))),1),e("td",Ul,l(t(x("MAY"))),1),e("td",Rl,l(t(x("JUN"))),1),e("td",Pl,l(i(j(2))),1),e("td",Sl,l(t(x("JUL"))),1),e("td",Jl,l(t(x("AUG"))),1),e("td",Ol,l(t(x("SEP"))),1),e("td",Ml,l(i(j(3))),1),e("td",Vl,l(t(x("OCT"))),1),e("td",Ll,l(t(x("NOV"))),1),e("td",Bl,l(t(x("DEC"))),1),e("td",$l,l(i(j(4))),1),e("td",Dl,l(t(De())),1)])])])):D("",!0),n.value.reportType==="expense"?(A(),C("table",ql,[s[40]||(s[40]=e("thead",null,[e("tr",{class:"header-row"},[e("th",{rowspan:"1",class:"header-cell"}," 廣告渠道 "),e("th",{rowspan:"1",class:"header-cell"}," 平台 "),e("th",{class:"header-cell"}," JAN "),e("th",{class:"header-cell"}," FEB "),e("th",{class:"header-cell"}," MAR "),e("th",{class:"header-cell-quarter"}," Q1 "),e("th",{class:"header-cell"}," APR "),e("th",{class:"header-cell"}," MAY "),e("th",{class:"header-cell"}," JUN "),e("th",{class:"header-cell-quarter"}," Q2 "),e("th",{class:"header-cell"}," JUL "),e("th",{class:"header-cell"}," AUG "),e("th",{class:"header-cell"}," SEP "),e("th",{class:"header-cell-quarter"}," Q3 "),e("th",{class:"header-cell"}," OCT "),e("th",{class:"header-cell"}," NOV "),e("th",{class:"header-cell"}," DEC "),e("th",{class:"header-cell-quarter"}," Q4 "),e("th",{class:"header-cell"}," Total ")])],-1)),e("tbody",null,[(A(!0),C(ee,null,de(f.value,(h,y)=>(A(),C(ee,{key:y},[(A(!0),C(ee,null,de(h.platforms,(c,E)=>(A(),C("tr",{key:`${y}-${E}`,class:U({"row-odd":y%2===0})},[E===0?(A(),C("td",{key:0,rowspan:h.platforms.length,class:"channel-col"},l(h.channelName),9,Fl)):D("",!0),e("td",zl,l(c.platformName),1),e("td",Yl,l(t(c.expense.JAN)),1),e("td",Gl,l(t(c.expense.FEB)),1),e("td",Ql,l(t(c.expense.MAR)),1),e("td",jl,l(i(q(c.expense,1))),1),e("td",Wl,l(t(c.expense.APR)),1),e("td",Hl,l(t(c.expense.MAY)),1),e("td",Xl,l(t(c.expense.JUN)),1),e("td",Il,l(i(q(c.expense,2))),1),e("td",Zl,l(t(c.expense.JUL)),1),e("td",Kl,l(t(c.expense.AUG)),1),e("td",ea,l(t(c.expense.SEP)),1),e("td",ta,l(i(q(c.expense,3))),1),e("td",sa,l(t(c.expense.OCT)),1),e("td",la,l(t(c.expense.NOV)),1),e("td",aa,l(t(c.expense.DEC)),1),e("td",oa,l(i(q(c.expense,4))),1),e("td",na,l(t($e(c.expense))),1)],2))),128))],64))),128)),e("tr",ra,[s[39]||(s[39]=e("td",{colspan:"2"}," 月度總計 ",-1)),e("td",ca,l(t(x("JAN"))),1),e("td",da,l(t(x("FEB"))),1),e("td",ua,l(t(x("MAR"))),1),e("td",ia,l(i(j(1))),1),e("td",ha,l(t(x("APR"))),1),e("td",pa,l(t(x("MAY"))),1),e("td",va,l(t(x("JUN"))),1),e("td",ma,l(i(j(2))),1),e("td",ga,l(t(x("JUL"))),1),e("td",ba,l(t(x("AUG"))),1),e("td",ya,l(t(x("SEP"))),1),e("td",fa,l(i(j(3))),1),e("td",xa,l(t(x("OCT"))),1),e("td",_a,l(t(x("NOV"))),1),e("td",Aa,l(t(x("DEC"))),1),e("td",Ea,l(i(j(4))),1),e("td",wa,l(t(De())),1)])])])):D("",!0),n.value.reportType==="comparison"?(A(),C("table",Ca,[s[42]||(s[42]=e("thead",null,[e("tr",{class:"header-row"},[e("th",{rowspan:"2",class:"header-cell"}," 廣告渠道 "),e("th",{rowspan:"2",class:"header-cell"}," 平台 "),e("th",{colspan:"3",class:"header-cell"}," JAN "),e("th",{colspan:"3",class:"header-cell"}," FEB "),e("th",{colspan:"3",class:"header-cell"}," MAR "),e("th",{colspan:"3",class:"header-cell-quarter"}," Q1 "),e("th",{colspan:"3",class:"header-cell"}," APR "),e("th",{colspan:"3",class:"header-cell"}," MAY "),e("th",{colspan:"3",class:"header-cell"}," JUN "),e("th",{colspan:"3",class:"header-cell-quarter"}," Q2 "),e("th",{colspan:"3",class:"header-cell"}," JUL "),e("th",{colspan:"3",class:"header-cell"}," AUG "),e("th",{colspan:"3",class:"header-cell"}," SEP "),e("th",{colspan:"3",class:"header-cell-quarter"}," Q3 "),e("th",{colspan:"3",class:"header-cell"}," OCT "),e("th",{colspan:"3",class:"header-cell"}," NOV "),e("th",{colspan:"3",class:"header-cell"}," DEC "),e("th",{colspan:"3",class:"header-cell-quarter"}," Q4 "),e("th",{colspan:"3",class:"header-cell"}," Total ")]),e("tr",{class:"header-row"},[e("th",{class:"sub-header-cell"}," 預算 "),e("th",{class:"sub-header-cell"}," 實際 "),e("th",{class:"sub-header-cell"}," 差異 "),e("th",{class:"sub-header-cell"}," 預算 "),e("th",{class:"sub-header-cell"}," 實際 "),e("th",{class:"sub-header-cell"}," 差異 "),e("th",{class:"sub-header-cell"}," 預算 "),e("th",{class:"sub-header-cell"}," 實際 "),e("th",{class:"sub-header-cell"}," 差異 "),e("th",{class:"sub-header-cell-quarter"}," 預算 "),e("th",{class:"sub-header-cell-quarter"}," 實際 "),e("th",{class:"sub-header-cell-quarter"}," 差異 "),e("th",{class:"sub-header-cell"}," 預算 "),e("th",{class:"sub-header-cell"}," 實際 "),e("th",{class:"sub-header-cell"}," 差異 "),e("th",{class:"sub-header-cell"}," 預算 "),e("th",{class:"sub-header-cell"}," 實際 "),e("th",{class:"sub-header-cell"}," 差異 "),e("th",{class:"sub-header-cell"}," 預算 "),e("th",{class:"sub-header-cell"}," 實際 "),e("th",{class:"sub-header-cell"}," 差異 "),e("th",{class:"sub-header-cell-quarter"}," 預算 "),e("th",{class:"sub-header-cell-quarter"}," 實際 "),e("th",{class:"sub-header-cell-quarter"}," 差異 "),e("th",{class:"sub-header-cell"}," 預算 "),e("th",{class:"sub-header-cell"}," 實際 "),e("th",{class:"sub-header-cell"}," 差異 "),e("th",{class:"sub-header-cell"}," 預算 "),e("th",{class:"sub-header-cell"}," 實際 "),e("th",{class:"sub-header-cell"}," 差異 "),e("th",{class:"sub-header-cell"}," 預算 "),e("th",{class:"sub-header-cell"}," 實際 "),e("th",{class:"sub-header-cell"}," 差異 "),e("th",{class:"sub-header-cell-quarter"}," 預算 "),e("th",{class:"sub-header-cell-quarter"}," 實際 "),e("th",{class:"sub-header-cell-quarter"}," 差異 "),e("th",{class:"sub-header-cell"}," 預算 "),e("th",{class:"sub-header-cell"}," 實際 "),e("th",{class:"sub-header-cell"}," 差異 "),e("th",{class:"sub-header-cell"}," 預算 "),e("th",{class:"sub-header-cell"}," 實際 "),e("th",{class:"sub-header-cell"}," 差異 "),e("th",{class:"sub-header-cell"}," 預算 "),e("th",{class:"sub-header-cell"}," 實際 "),e("th",{class:"sub-header-cell"}," 差異 "),e("th",{class:"sub-header-cell-quarter"}," 預算 "),e("th",{class:"sub-header-cell-quarter"}," 實際 "),e("th",{class:"sub-header-cell-quarter"}," 差異 "),e("th",{class:"sub-header-cell"}," 預算 "),e("th",{class:"sub-header-cell"}," 實際 "),e("th",{class:"sub-header-cell"}," 差異 ")])],-1)),e("tbody",null,[(A(!0),C(ee,null,de(f.value,(h,y)=>(A(),C(ee,{key:y},[(A(!0),C(ee,null,de(h.platforms,(c,E)=>{var v,d,T,R,O,se,M,I,$,G,ie,he,pe,ve,me,ge,be,ye,fe,Ne,ke,Ue,Re,Pe;return A(),C("tr",{key:`${y}-${E}`,class:U({"row-odd":y%2===0})},[E===0?(A(),C("td",{key:0,rowspan:h.platforms.length,class:"channel-col"},l(h.channelName),9,Ta)):D("",!0),e("td",Na,l(c.platformName),1),e("td",ka,l(t(((v=c.budget)==null?void 0:v.JAN)||0)),1),e("td",Ua,l(t(((d=c.expense)==null?void 0:d.JAN)||0)),1),e("td",{class:U(P(c.difference.JAN))},l(t(c.difference.JAN)),3),e("td",Ra,l(t(((T=c.budget)==null?void 0:T.FEB)||0)),1),e("td",Pa,l(t(((R=c.expense)==null?void 0:R.FEB)||0)),1),e("td",{class:U(P(c.difference.FEB))},l(t(c.difference.FEB)),3),e("td",Sa,l(t(((O=c.budget)==null?void 0:O.MAR)||0)),1),e("td",Ja,l(t(((se=c.expense)==null?void 0:se.MAR)||0)),1),e("td",{class:U(P(c.difference.MAR))},l(t(c.difference.MAR)),3),e("td",Oa,l(i(re(c,1))),1),e("td",Ma,l(i(ce(c,1))),1),e("td",{class:U(["quarter-col",P(H(c,1))])},l(i(H(c,1))),3),e("td",Va,l(t(((M=c.budget)==null?void 0:M.APR)||0)),1),e("td",La,l(t(((I=c.expense)==null?void 0:I.APR)||0)),1),e("td",{class:U(P(c.difference.APR))},l(t(c.difference.APR)),3),e("td",Ba,l(t((($=c.budget)==null?void 0:$.MAY)||0)),1),e("td",$a,l(t(((G=c.expense)==null?void 0:G.MAY)||0)),1),e("td",{class:U(P(c.difference.MAY))},l(t(c.difference.MAY)),3),e("td",Da,l(t(((ie=c.budget)==null?void 0:ie.JUN)||0)),1),e("td",qa,l(t(((he=c.expense)==null?void 0:he.JUN)||0)),1),e("td",{class:U(P(c.difference.JUN))},l(t(c.difference.JUN)),3),e("td",Fa,l(i(re(c,2))),1),e("td",za,l(i(ce(c,2))),1),e("td",{class:U(["quarter-col",P(H(c,2))])},l(i(H(c,2))),3),e("td",Ya,l(t(((pe=c.budget)==null?void 0:pe.JUL)||0)),1),e("td",Ga,l(t(((ve=c.expense)==null?void 0:ve.JUL)||0)),1),e("td",{class:U(P(c.difference.JUL))},l(t(c.difference.JUL)),3),e("td",Qa,l(t(((me=c.budget)==null?void 0:me.AUG)||0)),1),e("td",ja,l(t(((ge=c.expense)==null?void 0:ge.AUG)||0)),1),e("td",{class:U(P(c.difference.AUG))},l(t(c.difference.AUG)),3),e("td",Wa,l(t(((be=c.budget)==null?void 0:be.SEP)||0)),1),e("td",Ha,l(t(((ye=c.expense)==null?void 0:ye.SEP)||0)),1),e("td",{class:U(P(c.difference.SEP))},l(t(c.difference.SEP)),3),e("td",Xa,l(i(re(c,3))),1),e("td",Ia,l(i(ce(c,3))),1),e("td",{class:U(["quarter-col",P(H(c,3))])},l(i(H(c,3))),3),e("td",Za,l(t(((fe=c.budget)==null?void 0:fe.OCT)||0)),1),e("td",Ka,l(t(((Ne=c.expense)==null?void 0:Ne.OCT)||0)),1),e("td",{class:U(P(c.difference.OCT))},l(t(c.difference.OCT)),3),e("td",eo,l(t(((ke=c.budget)==null?void 0:ke.NOV)||0)),1),e("td",to,l(t(((Ue=c.expense)==null?void 0:Ue.NOV)||0)),1),e("td",{class:U(P(c.difference.NOV))},l(t(c.difference.NOV)),3),e("td",so,l(t(((Re=c.budget)==null?void 0:Re.DEC)||0)),1),e("td",lo,l(t(((Pe=c.expense)==null?void 0:Pe.DEC)||0)),1),e("td",{class:U(P(c.difference.DEC))},l(t(c.difference.DEC)),3),e("td",ao,l(i(re(c,4))),1),e("td",oo,l(i(ce(c,4))),1),e("td",{class:U(["quarter-col",P(H(c,4))])},l(i(H(c,4))),3),e("td",no,l(t(He(c.budget))),1),e("td",ro,l(t(Xe(c.expense))),1),e("td",{class:U(["total-col",P(xt(c))])},l(t(xt(c))),3)],2)}),128))],64))),128)),e("tr",co,[s[41]||(s[41]=e("td",{colspan:"2",class:"total-label"}," 月度總計 ",-1)),e("td",uo,l(t(N("JAN"))),1),e("td",io,l(t(k("JAN"))),1),e("td",{class:U(P(_("JAN")))},l(t(_("JAN"))),3),e("td",ho,l(t(N("FEB"))),1),e("td",po,l(t(k("FEB"))),1),e("td",{class:U(P(_("FEB")))},l(t(_("FEB"))),3),e("td",vo,l(t(N("MAR"))),1),e("td",mo,l(t(k("MAR"))),1),e("td",{class:U(P(_("MAR")))},l(t(_("MAR"))),3),e("td",go,l(i(oe(1))),1),e("td",bo,l(i(ne(1))),1),e("td",{class:U(["quarter-col",P(W(1))])},l(i(W(1))),3),e("td",yo,l(t(N("APR"))),1),e("td",fo,l(t(k("APR"))),1),e("td",{class:U(P(_("APR")))},l(t(_("APR"))),3),e("td",xo,l(t(N("MAY"))),1),e("td",_o,l(t(k("MAY"))),1),e("td",{class:U(P(_("MAY")))},l(t(_("MAY"))),3),e("td",Ao,l(t(N("JUN"))),1),e("td",Eo,l(t(k("JUN"))),1),e("td",{class:U(P(_("JUN")))},l(t(_("JUN"))),3),e("td",wo,l(i(oe(2))),1),e("td",Co,l(i(ne(2))),1),e("td",{class:U(["quarter-col",P(W(2))])},l(i(W(2))),3),e("td",To,l(t(N("JUL"))),1),e("td",No,l(t(k("JUL"))),1),e("td",{class:U(P(_("JUL")))},l(t(_("JUL"))),3),e("td",ko,l(t(N("AUG"))),1),e("td",Uo,l(t(k("AUG"))),1),e("td",{class:U(P(_("AUG")))},l(t(_("AUG"))),3),e("td",Ro,l(t(N("SEP"))),1),e("td",Po,l(t(k("SEP"))),1),e("td",{class:U(P(_("SEP")))},l(t(_("SEP"))),3),e("td",So,l(i(oe(3))),1),e("td",Jo,l(i(ne(3))),1),e("td",{class:U(["quarter-col",P(W(3))])},l(i(W(3))),3),e("td",Oo,l(t(N("OCT"))),1),e("td",Mo,l(t(k("OCT"))),1),e("td",{class:U(P(_("OCT")))},l(t(_("OCT"))),3),e("td",Vo,l(t(N("NOV"))),1),e("td",Lo,l(t(k("NOV"))),1),e("td",{class:U(P(_("NOV")))},l(t(_("NOV"))),3),e("td",Bo,l(t(N("DEC"))),1),e("td",$o,l(t(k("DEC"))),1),e("td",{class:U(P(_("DEC")))},l(t(_("DEC"))),3),e("td",Do,l(i(oe(4))),1),e("td",qo,l(i(ne(4))),1),e("td",{class:U(["quarter-col",P(W(4))])},l(i(W(4))),3),e("td",Fo,l(t(_t())),1),e("td",zo,l(t(At())),1),e("td",{class:U(["total-col","highlight-total",P(Et())])},l(t(Et())),3)])])])):D("",!0)])):D("",!0),n.value.reportType==="lineExpense"?(A(),C("div",Yo,[e("table",Go,[e("thead",null,[e("tr",Qo,[s[43]||(s[43]=e("th",{class:"header-cell sticky-col",style:{width:"180px",left:"0","z-index":"2"}}," 平台 / 線別 ",-1)),(A(!0),C(ee,null,de(n.value.line,h=>(A(),C("th",{key:h,class:"header-cell",style:{width:"180px"}},l(qe(h)),1))),128)),s[44]||(s[44]=e("th",{class:"header-cell sticky-col",style:{width:"180px",right:"0","z-index":"2"}}," Total ",-1))])]),e("tbody",null,[(A(!0),C(ee,null,de(f.value,h=>(A(),C("tr",{key:h.platformName},[e("td",jo,l(h.platformName),1),(A(!0),C(ee,null,de(n.value.line,y=>(A(),C("td",{key:y,class:"month-col",style:{width:"180px"}},l(t(h.expenses[qe(y)]||0)),1))),128)),e("td",Wo,l(Number(h.total)>0?t(h.total):"-"),1)]))),128)),e("tr",Ho,[s[45]||(s[45]=e("td",{class:"sticky-col",style:{width:"180px",left:"0","z-index":"1"}}," 總計 ",-1)),(A(!0),C(ee,null,de(n.value.line,h=>(A(),C("td",{key:h,class:"month-col",style:{width:"180px"}},l(t(f.value.reduce((y,c)=>y+(c.expenses[qe(h)]||0),0))),1))),128)),e("td",Xo,l(f.value.reduce((h,y)=>h+(Number(y.total)||0),0)>0?t(f.value.reduce((h,y)=>h+(Number(y.total)||0),0)):"-"),1)])])])])):D("",!0),n.value.reportType==="lineExpenseTotal"?(A(),C("div",Io,[e("table",Zo,[s[47]||(s[47]=e("thead",null,[e("tr",{class:"header-row"},[e("th",{rowspan:"1",class:"header-cell"}," 線別 "),e("th",{class:"header-cell"}," JAN "),e("th",{class:"header-cell"}," FEB "),e("th",{class:"header-cell"}," MAR "),e("th",{class:"header-cell-quarter"}," Q1 "),e("th",{class:"header-cell"}," APR "),e("th",{class:"header-cell"}," MAY "),e("th",{class:"header-cell"}," JUN "),e("th",{class:"header-cell-quarter"}," Q2 "),e("th",{class:"header-cell"}," JUL "),e("th",{class:"header-cell"}," AUG "),e("th",{class:"header-cell"}," SEP "),e("th",{class:"header-cell-quarter"}," Q3 "),e("th",{class:"header-cell"}," OCT "),e("th",{class:"header-cell"}," NOV "),e("th",{class:"header-cell"}," DEC "),e("th",{class:"header-cell-quarter"}," Q4 "),e("th",{class:"header-cell"}," Total ")])],-1)),e("tbody",null,[(A(!0),C(ee,null,de(f.value,(h,y)=>(A(),C("tr",{key:h.lineName,class:U({"row-odd":y%2===0})},[e("td",Ko,l(h.lineName),1),e("td",en,l(t(h.expenses.JAN)),1),e("td",tn,l(t(h.expenses.FEB)),1),e("td",sn,l(t(h.expenses.MAR)),1),e("td",ln,l(i(q(h.expenses,1))),1),e("td",an,l(t(h.expenses.APR)),1),e("td",on,l(t(h.expenses.MAY)),1),e("td",nn,l(t(h.expenses.JUN)),1),e("td",rn,l(i(q(h.expenses,2))),1),e("td",cn,l(t(h.expenses.JUL)),1),e("td",dn,l(t(h.expenses.AUG)),1),e("td",un,l(t(h.expenses.SEP)),1),e("td",hn,l(i(q(h.expenses,3))),1),e("td",pn,l(t(h.expenses.OCT)),1),e("td",vn,l(t(h.expenses.NOV)),1),e("td",mn,l(t(h.expenses.DEC)),1),e("td",gn,l(i(q(h.expenses,4))),1),e("td",bn,l(t($e(h.expenses))),1)],2))),128)),e("tr",yn,[s[46]||(s[46]=e("td",null," 月度總計 ",-1)),e("td",fn,l(t(x("JAN"))),1),e("td",xn,l(t(x("FEB"))),1),e("td",_n,l(t(x("MAR"))),1),e("td",An,l(i(j(1))),1),e("td",En,l(t(x("APR"))),1),e("td",wn,l(t(x("MAY"))),1),e("td",Cn,l(t(x("JUN"))),1),e("td",Tn,l(i(j(2))),1),e("td",Nn,l(t(x("JUL"))),1),e("td",kn,l(t(x("AUG"))),1),e("td",Un,l(t(x("SEP"))),1),e("td",Rn,l(i(j(3))),1),e("td",Pn,l(t(x("OCT"))),1),e("td",Sn,l(t(x("NOV"))),1),e("td",Jn,l(t(x("DEC"))),1),e("td",On,l(i(j(4))),1),e("td",Mn,l(t(De())),1)])])])])):D("",!0),n.value.reportType==="budget"?(A(),C("div",Vn,[m(Dt,{color:"blue-darken-3",class:"me-4 budget-info-chip",label:"",variant:"outlined"},{default:b(()=>{var h;return[L(" 年度總預算: "+l(t(((h=yt.value)==null?void 0:h.annualTotalBudget)||0)),1)]}),_:1}),m(Dt,{color:(((g=yt.value)==null?void 0:g.annualTotalBudget)||0)-De()>=0?"teal-darken-2":"error",label:"",class:"budget-info-chip",variant:"outlined"},{default:b(()=>{var h;return[L(" 預算差異: "+l(t((((h=yt.value)==null?void 0:h.annualTotalBudget)||0)-De())),1)]}),_:1},8,["color"])])):D("",!0)]}),_:1})]),_:1})):D("",!0),n.value.reportType==="lineExpenseTotal"&&Q.value?(A(),Ve(Z,{key:1,class:"elevation-4 rounded-lg py-lg-8 px-4 mt-6 mx-0 mt-lg-6 mx-lg-3 mb-4 bg-white"},{default:b(()=>[m(S,{cols:"12",class:"pt-6 pt-lg-4"},{default:b(()=>[e("div",Ln,[m(we,{color:"red-darken-1","prepend-icon":"mdi-file-chart",loading:le.value,onClick:cs},{default:b(()=>s[48]||(s[48]=[L(" 匯出圖表 ")])),_:1},8,["loading"])]),e("div",Bn,[m(Z,null,{default:b(()=>[m(S,{cols:"12",lg:"6",class:"d-flex justify-center align-center pa-0"},{default:b(()=>[e("div",$n,[m(Ft(St),{ref_key:"pieChart",ref:xe,option:X.value,"init-options":{renderer:"canvas"},style:{width:"100%",height:"400px"}},null,8,["option"])])]),_:1}),m(S,{cols:"12",lg:"6",class:"d-flex justify-center align-center pa-0"},{default:b(()=>[e("div",Dn,[m(Ft(St),{ref_key:"barChart",ref:_e,option:z.value,"init-options":{renderer:"canvas"},style:{width:"100%",height:"400px"}},null,8,["option"])])]),_:1})]),_:1})])]),_:1})]),_:1})):D("",!0),m(Ps,{modelValue:Fe.value,"onUpdate:modelValue":s[21]||(s[21]=a=>Fe.value=a),"max-width":"640"},{default:b(()=>[m(Bt,{class:"rounded-lg"},{default:b(()=>[e("div",qn,[m(Ut,{size:"20",color:"white",class:"me-2"},{default:b(()=>s[49]||(s[49]=[L(" mdi-file-export ")])),_:1}),s[51]||(s[51]=L(" 批次匯出報表 ")),m(qt),m(we,{icon:"",color:"white",variant:"plain",class:"opacity-100",ripple:!1,size:"20",onClick:s[6]||(s[6]=a=>Fe.value=!1)},{default:b(()=>[m(Ut,{size:"20"},{default:b(()=>s[50]||(s[50]=[L(" mdi-close ")])),_:1})]),_:1})]),m(Us,{class:"mt-6 mb-4 px-6"},{default:b(()=>[m(Z,null,{default:b(()=>[m(S,{cols:"12",sm:"6",class:"pb-1"},{default:b(()=>[m(kt,{modelValue:p.value.theme,"onUpdate:modelValue":[s[7]||(s[7]=a=>p.value.theme=a),gs],items:je.value,label:"行銷主題","item-title":"name","item-value":"_id",variant:"outlined",density:"compact","error-messages":ze.value,clearable:""},null,8,["modelValue","items","error-messages"])]),_:1}),m(S,{cols:"12",sm:"6",class:"pb-1"},{default:b(()=>[m(gt,{modelValue:p.value.year,"onUpdate:modelValue":s[8]||(s[8]=a=>p.value.year=a),items:Ye.value,label:"年度",variant:"outlined",density:"compact","error-messages":Ze.value,disabled:!p.value.theme||!p.value.availableDataTypes.hasBudget&&!p.value.availableDataTypes.hasExpense,clearable:""},null,8,["modelValue","items","error-messages","disabled"])]),_:1})]),_:1}),m(Ge,{class:"my-4"}),m(Z,null,{default:b(()=>[m(S,{cols:"12",class:"pb-0"},{default:b(()=>[s[52]||(s[52]=e("div",{class:"sub-title mb-2"}," 選擇要匯出的報表： ",-1)),m(Z,null,{default:b(()=>[m(S,{cols:"6"},{default:b(()=>[m(Ee,{modelValue:p.value.selectedReports,"onUpdate:modelValue":s[9]||(s[9]=a=>p.value.selectedReports=a),label:"行銷廣告預算表",density:"compact",value:"budget",color:"deep-purple-darken-2","hide-details":"",disabled:!p.value.year||!p.value.availableDataTypes.hasBudget,class:"checkbox-small-label"},null,8,["modelValue","disabled"])]),_:1}),m(S,{cols:"6"},{default:b(()=>[m(Ee,{modelValue:p.value.selectedReports,"onUpdate:modelValue":s[10]||(s[10]=a=>p.value.selectedReports=a),label:"行銷實際支出表",density:"compact",value:"expense","hide-details":"",color:"deep-purple-darken-2",disabled:!p.value.year||!p.value.availableDataTypes.hasExpense,class:"checkbox-small-label"},null,8,["modelValue","disabled"])]),_:1}),m(S,{cols:"6"},{default:b(()=>[m(Ee,{modelValue:p.value.selectedReports,"onUpdate:modelValue":s[11]||(s[11]=a=>p.value.selectedReports=a),label:"行銷預算與實際支出比較表",density:"compact",value:"comparison","hide-details":"",color:"deep-purple-darken-2",disabled:!p.value.year||!p.value.availableDataTypes.hasBudget||!p.value.availableDataTypes.hasExpense,class:"checkbox-small-label"},null,8,["modelValue","disabled"])]),_:1}),m(S,{cols:"6"},{default:b(()=>[Os(m(Ee,{modelValue:p.value.selectedReports,"onUpdate:modelValue":s[12]||(s[12]=a=>p.value.selectedReports=a),label:"行銷各線實際支出表",density:"compact",value:"lineExpense","hide-details":"",color:"deep-purple-darken-2",disabled:!p.value.year||!p.value.availableDataTypes.hasExpense,class:"checkbox-small-label"},null,8,["modelValue","disabled"]),[[Ss,"要選擇月份及線別","start"]])]),_:1}),m(S,{cols:"6"},{default:b(()=>[m(Ee,{modelValue:p.value.selectedReports,"onUpdate:modelValue":s[13]||(s[13]=a=>p.value.selectedReports=a),label:"行銷各線實際支出總表",density:"compact",value:"lineExpenseTotal","hide-details":"",color:"deep-purple-darken-2",disabled:!p.value.year||!p.value.availableDataTypes.hasExpense,class:"checkbox-small-label"},null,8,["modelValue","disabled"])]),_:1}),m(S,{cols:"6"},{default:b(()=>[m(Ee,{modelValue:p.value.selectedReports,"onUpdate:modelValue":s[14]||(s[14]=a=>p.value.selectedReports=a),label:"行銷各線實際支出統計圖表",density:"compact",value:"charts","hide-details":"",color:"deep-purple-darken-2",disabled:!p.value.year||!p.value.availableDataTypes.hasExpense,class:"checkbox-small-label"},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1})]),_:1}),m(Z,null,{default:b(()=>[m(S,{cols:"12"},{default:b(()=>[m(Ge,{class:"my-4"}),s[53]||(s[53]=e("div",{class:"sub-title mb-3"}," 選擇線別： ",-1)),m(kt,{modelValue:p.value.selectedLines,"onUpdate:modelValue":s[15]||(s[15]=a=>p.value.selectedLines=a),items:ae.value,label:"線別","item-title":"name","item-value":"_id",variant:"outlined",density:"compact","hide-details":"",clearable:"",multiple:"","select-all":"",disabled:!p.value.selectedReports.includes("lineExpense")},{"prepend-item":b(()=>[m($t,{title:"全選",color:"deep-purple-darken-2","prepend-icon":"mdi-checkbox-multiple-marked",active:p.value.selectedLines.length===ae.value.length,onClick:hs},null,8,["active"]),m(Ge,{class:"mt-2"})]),_:1},8,["modelValue","items","disabled"]),m(Ge,{class:"mt-5 mb-4"}),s[54]||(s[54]=e("div",{class:"sub-title mb-2"}," 選擇月份： ",-1)),m(Z,null,{default:b(()=>[m(S,{cols:"12",class:"pb-0"},{default:b(()=>[m(Ee,{modelValue:p.value.selectAllMonths,"onUpdate:modelValue":s[16]||(s[16]=a=>p.value.selectAllMonths=a),label:"全選",color:"deep-purple-darken-2","hide-details":"",density:"compact",disabled:!p.value.selectedReports.includes("lineExpense"),class:"checkbox-small-label",onChange:is},null,8,["modelValue","disabled"])]),_:1}),(A(!0),C(ee,null,de(We.value,a=>(A(),Ve(S,{key:a.value,class:"pb-0",cols:"4",sm:"2"},{default:b(()=>[m(Ee,{modelValue:p.value.selectedMonths,"onUpdate:modelValue":s[17]||(s[17]=r=>p.value.selectedMonths=r),label:a.name,value:a.value,color:"deep-purple-darken-2",density:"compact","hide-details":"",disabled:!p.value.selectedReports.includes("lineExpense"),class:"checkbox-small-label"},null,8,["modelValue","label","value","disabled"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),m(Ge,{class:"mt-6 mb-4"}),m(Z,null,{default:b(()=>[m(S,{cols:"12"},{default:b(()=>[s[55]||(s[55]=e("div",{class:"sub-title mb-2"}," 選擇檔案格式： ",-1)),m(Ee,{modelValue:p.value.fileFormats,"onUpdate:modelValue":s[18]||(s[18]=a=>p.value.fileFormats=a),label:"PDF",value:"pdf","hide-details":"",density:"compact",color:"deep-purple-darken-2",class:"mb-2 checkbox-small-label",disabled:!p.value.selectedReports.length},null,8,["modelValue","disabled"]),m(Ee,{modelValue:p.value.fileFormats,"onUpdate:modelValue":s[19]||(s[19]=a=>p.value.fileFormats=a),label:"Excel",value:"excel","hide-details":"",density:"compact",color:"deep-purple-darken-2",class:"checkbox-small-label",disabled:!p.value.selectedReports.length||p.value.selectedReports.length===1&&p.value.selectedReports[0]==="charts"},null,8,["modelValue","disabled"]),s[56]||(s[56]=e("div",{class:"text-caption text-grey mt-2"}," 統計圖表僅支援 PDF 格式 ",-1))]),_:1})]),_:1})]),_:1}),m(Rs,{class:"px-6 pb-5"},{default:b(()=>[m(qt),m(we,{color:"grey",variant:"outlined",size:bt.value,onClick:s[20]||(s[20]=a=>Fe.value=!1)},{default:b(()=>s[57]||(s[57]=[L(" 取消 ")])),_:1},8,["size"]),m(we,{color:"teal-darken-1",variant:"outlined",size:bt.value,loading:le.value,class:"ms-2",onClick:ds},{default:b(()=>s[58]||(s[58]=[L(" 匯出 ")])),_:1},8,["size","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},mr=bs(Fn,[["__scopeId","data-v-4d04576e"]]);export{mr as default};

import{f as le,r as p,w as Ae,k as gt,aV as g,Z as B,bH as l,b2 as ft,a8 as a,a7 as m,a0 as i,bJ as x,bf as _,u as v,aG as De,_ as j,bM as Ue,$ as A,aH as Pe,F as z,b0 as se,bK as bt}from"./@vue-Cr_z6yfx.js";import{_ as yt,u as kt,b as ht}from"./index-wwmbXvRV.js";import{u as Vt,a as oe}from"./vee-validate-BXV9nMa7.js";import{i as wt}from"./vuetify-use-dialog-C5oZ13xz.js";import{u as Ct}from"./vue-router-CS4OewbW.js";import{b as xt,c as Ne,f as At}from"./yup-WHNMwcW8.js";import{C as Dt}from"./ConfirmDeleteDialogWithTextField-Dbb5flU2.js";import{_ as _e}from"./ConfirmDeleteDialog-CuZPFffe.js";import{l as Ut}from"./lodash-CiJWSuVn.js";import{f as pe,A as ve}from"./AmountInput-Cqp699wo.js";import{q as Pt,Q as Nt,w,v as G,a as ne,b as _t,c as re,P as Bt,_ as ue,g as f,r as D,d as Be,R as Et,C as Tt,U as Ee,J as St,a1 as Ot,Z as $t,e as Te,W as zt,f as Se,V as Oe,T as U}from"./vuetify-CbddcmEc.js";import"./perfect-debounce-Cp2ysxOb.js";import"./hookable-B8xFkYCm.js";/* empty css             */import"./pinia-DBRIaiZ_.js";import"./vue-demi-Dq6ymT-8.js";import"./pinia-plugin-persistedstate-RV7uh3T-.js";import"./jspdf-DacfHTdZ.js";import"./core-js-D2hAHviU.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./unplugin-vue-router-B1N3mqWX.js";import"./axios-upsvKRUO.js";import"./vue3-google-login-Dx7TV_Hx.js";import"./vue-easy-lightbox-D952uME8.js";import"./property-expr-DEi1ZLzV.js";import"./tiny-case-BJ7jYKNY.js";import"./toposort-DzadwsAs.js";const Mt={class:"d-flex align-center mb-4"},Jt={style:{width:"260px"},class:"ms-auto d-flex align-center"},Rt={class:"menu-header px-3 py-2"},Ft={class:"menu-card-text pa-4 pt-3"},It={class:"card-title px-6 py-6 d-flex justify-space-between align-center"},Yt={key:0,class:"d-flex justify-center align-center",style:{"min-height":"300px"}},Lt={class:"budget-table"},jt={class:"budget-table-title mb-4 d-flex align-center position-relative"},Gt={class:"budget-title-center"},qt={class:"align-self-center"},Ht={class:"text-orange-darken-2"},Qt={class:"text-pink-darken-1"},Wt={class:"budget-title-right d-flex align-center ms-auto me-1"},Zt={class:"budget-header"},Kt={class:"channel-col"},Xt=["rowspan"],ea=["rowspan"],ta={class:"d-flex align-center"},aa=["rowspan"],la={class:"d-flex flex-column align-center"},sa=["rowspan"],oa={class:"delete-button-col"},na={class:"platform-col"},ra={class:"sort-buttons-col"},ua={class:"d-flex flex-column align-center"},ia={class:"quick-fill-col"},da={class:"h-100 py-2 d-flex flex-column align-center justify-space-between"},ma={__name:"marketingBudgetManagement",setup(ca){const{apiAuth:P}=ht(),h=wt(),$e=Ct(),ze=kt(),{smAndUp:ge}=Pt(),q=le(()=>ge.value?"default":"small"),X=p(!1),M=p(null),S=p(!1),J=p(!1),ie=p(!1),Me=xt({year:Ne().required("請選擇年度"),theme:Ne().required("請選擇行銷主題"),annualTotalBudget:At().required("請輸入").min(0,"年度總預算不能小於0")}),{handleSubmit:Je,resetForm:fe}=Vt({validationSchema:Me,initialValues:{year:"",theme:"",annualTotalBudget:""}}),C=oe("year"),O=oe("theme"),H=oe("note"),R=oe("annualTotalBudget"),V=p({open:!1,id:""}),Re=[{title:"建立日期",key:"createdAt",align:"start",sortable:!0},{title:"年度",key:"year",align:"start",sortable:!0},{title:"行銷主題",key:"theme.name",align:"start",sortable:!0},{title:"年度總預算",key:"annualTotalBudget",align:"start",sortable:!0},{title:"總預算預估",key:"totalBudget",align:"start",sortable:!1},{title:"備註",key:"note",align:"start",sortable:!0},{title:"建立者",key:"creator.name",align:"start",sortable:!0},{title:"操作",key:"actions",align:"center",sortable:!1}],be=p([]),ye=p(0),Q=p(10),$=p(1),W=p([{key:"createdAt",order:"desc"}]),Fe=p([]),ee=p([]),de=p([]),me=p([]),b=p({year:null,theme:null,createdDateRange:[]}),te={JAN:"一月",FEB:"二月",MAR:"三月",APR:"四月",MAY:"五月",JUN:"六月",JUL:"七月",AUG:"八月",SEP:"九月",OCT:"十月",NOV:"十一月",DEC:"十二月"},Ie=le(()=>(V.value.id,!0)),ce=le(()=>{const t=parseFloat(R.value.value)||0,e=d.value.reduce((s,n)=>s+n.platforms.reduce((r,u)=>r+Object.values(u.budget).reduce((T,L)=>T+(parseFloat(L)||0),0),0),0);return t-e}),Ye=le(()=>{const t=ce.value;return t===0?"text-grey-darken-1":t>0?"text-teal-darken-1":"text-red-lighten-1"}),d=p([{channelId:"",platforms:[{platformId:"",budget:{JAN:"",FEB:"",MAR:"",APR:"",MAY:"",JUN:"",JUL:"",AUG:"",SEP:"",OCT:"",NOV:"",DEC:""}}]}]),Le=t=>{const e=ee.value.find(s=>s._id===t);return e?e.name:""},F=p({show:!1,channelId:"",channelIndex:-1}),I=p({show:!1,platformId:"",channelIndex:-1,platformIndex:-1}),je=t=>{const e=de.value.find(s=>s._id===t);return e?e.name:""},Ge=t=>{const e=me.value.find(s=>s._id===t);return e?e.name:""},qe=t=>{const e=d.value[t];!e.channelId&&e.platforms.every(n=>!n.platformId&&Object.values(n.budget).every(r=>!r))&&d.value.length>1?d.value.splice(t,1):F.value={show:!0,channelId:e.channelId,channelIndex:t}},He=()=>{const{channelIndex:t}=F.value;d.value.length>1&&d.value.splice(t,1),F.value.show=!1},Qe=t=>{d.value[t].platforms.push({platformId:"",budget:{JAN:"",FEB:"",MAR:"",APR:"",MAY:"",JUN:"",JUL:"",AUG:"",SEP:"",OCT:"",NOV:"",DEC:""}})},We=(t,e)=>{const s=d.value[t].platforms;if(s.length<=1){h({text:"若廣告渠道只剩一個平台，請直接刪除廣告渠道",snackbarProps:{color:"orange-darken-1"}});return}const n=s[e];!n.platformId&&Object.values(n.budget).every(u=>!u)?s.splice(e,1):I.value={show:!0,platformId:n.platformId,channelIndex:t,platformIndex:e}},Ze=()=>{const{channelIndex:t,platformIndex:e}=I.value,s=d.value[t].platforms;s.length>1&&s.splice(e,1),I.value.show=!1},Ke=()=>{d.value.push({channelId:"",platforms:[{platformId:"",budget:{JAN:"",FEB:"",MAR:"",APR:"",MAY:"",JUN:"",JUL:"",AUG:"",SEP:"",OCT:"",NOV:"",DEC:""}}]})},E=async()=>{var t,e;try{J.value=!0;const s={page:$.value,itemsPerPage:Q.value,sortBy:((t=W.value[0])==null?void 0:t.key)||"createdAt",sortOrder:((e=W.value[0])==null?void 0:e.order)||"desc"};if(ae.value&&(s.search=ae.value),b.value.year&&(s.year=b.value.year),b.value.theme&&(s.theme=b.value.theme),b.value.createdDateRange&&b.value.createdDateRange.length>0){const r=new Date(b.value.createdDateRange[0]);r.setHours(0,0,0,0);const u=new Date(b.value.createdDateRange[b.value.createdDateRange.length-1]);u.setHours(23,59,59,999),s.createdDateStart=r.toISOString(),s.createdDateEnd=u.toISOString()}const{data:n}=await P.get("/marketing/budgets/all",{params:s});n.success&&(be.value=n.result.data,ye.value=n.result.totalItems)}catch(s){Z(s)}finally{J.value=!1}},Xe=async t=>{var e;$.value=t.page,Q.value=t.itemsPerPage,((e=t.sortBy)==null?void 0:e.length)>0&&(W.value=t.sortBy),await E()},ke=p([]),et=async()=>{try{const{data:t}=await P.get("/marketing/budgets/all",{params:{page:1,itemsPerPage:9999}});if(t.success){const u=[...new Set(t.result.data.map(T=>T.year))];ke.value=u.sort((T,L)=>L-T)}const[{data:e},{data:s},{data:n},{data:r}]=await Promise.all([P.get("/marketing/budgets/years"),P.get("/marketing/categories/options",{params:{type:0}}),P.get("/marketing/categories/options",{params:{type:1}}),P.get("/marketing/categories/options",{params:{type:2}})]);e.success&&(Fe.value=e.result),s.success&&(ee.value=s.result),n.success&&(de.value=n.result),r.success&&(me.value=r.result)}catch(t){Z(t)}},tt=()=>{b.value={year:null,theme:null,createdDateRange:[]},he()},he=async()=>{$.value=1,await E()},at=()=>{V.value={open:!0,id:""},fe(),d.value=[{channelId:"",platforms:[{platformId:"",budget:{JAN:"",FEB:"",MAR:"",APR:"",MAY:"",JUN:"",JUL:"",AUG:"",SEP:"",OCT:"",NOV:"",DEC:""}}]}]},lt=async t=>{try{if(!t||!t._id)return;V.value={open:!0,id:t._id},ie.value=!0;const{data:e}=await P.get(`/marketing/budgets/${t._id}`);if(e.success){const s=e.result;C.value.value=s.year,O.value.value=s.theme._id,H.value.value=s.note,R.value.value=s.annualTotalBudget;const n={};s.items.forEach(r=>{n[r.channel._id]||(n[r.channel._id]={channelId:r.channel._id,platforms:[]}),n[r.channel._id].platforms.push({platformId:r.platform._id,budget:r.monthlyBudget})}),d.value=Object.values(n),M.value=s}}catch(e){console.error("編輯項目發生錯誤:",e),Z(e),Y()}finally{ie.value=!1}},Y=()=>{try{V.value={open:!1,id:""},M.value=null,fe(),d.value=[{channelId:"",platforms:[{platformId:"",budget:{JAN:"",FEB:"",MAR:"",APR:"",MAY:"",JUN:"",JUL:"",AUG:"",SEP:"",OCT:"",NOV:"",DEC:""}}]}],C.value.value="",O.value.value="",H.value.value="",R.value.value=""}catch(t){console.error("關閉對話框時發生錯誤:",t)}},st=Je(async t=>{if(!S.value)try{if(S.value=!0,!t.year){h({text:"請選擇年度",snackbarProps:{color:"red-lighten-1"}});return}if(!t.theme){h({text:"請選擇行銷主題",snackbarProps:{color:"red-lighten-1"}});return}if(!t.annualTotalBudget){h({text:"請輸入年度總預算",snackbarProps:{color:"red-lighten-1"}});return}const e=d.value.some(r=>!r.channelId),s=d.value.some(r=>r.platforms.some(u=>!u.platformId));if(e||s){h({text:"請選擇所有廣告渠道和平台",snackbarProps:{color:"red-lighten-1"}});return}const n={year:parseInt(t.year),theme:t.theme,annualTotalBudget:parseFloat(t.annualTotalBudget),note:t.note||"",items:d.value.flatMap(r=>r.platforms.map(u=>({channel:r.channelId,platform:u.platformId,monthlyBudget:{JAN:u.budget.JAN===""?0:Number(u.budget.JAN),FEB:u.budget.FEB===""?0:Number(u.budget.FEB),MAR:u.budget.MAR===""?0:Number(u.budget.MAR),APR:u.budget.APR===""?0:Number(u.budget.APR),MAY:u.budget.MAY===""?0:Number(u.budget.MAY),JUN:u.budget.JUN===""?0:Number(u.budget.JUN),JUL:u.budget.JUL===""?0:Number(u.budget.JUL),AUG:u.budget.AUG===""?0:Number(u.budget.AUG),SEP:u.budget.SEP===""?0:Number(u.budget.SEP),OCT:u.budget.OCT===""?0:Number(u.budget.OCT),NOV:u.budget.NOV===""?0:Number(u.budget.NOV),DEC:u.budget.DEC===""?0:Number(u.budget.DEC)}})))};if(V.value.id){const{data:r}=await P.patch(`/marketing/budgets/${V.value.id}`,n);r.success&&(h({text:"預算表更新成功",snackbarProps:{color:"teal-lighten-1"}}),Y(),E())}else{const{data:r}=await P.post("/marketing/budgets",n);r.success&&(h({text:"預算表新增成功",snackbarProps:{color:"teal-lighten-1"}}),Y(),E())}}catch(e){console.error("提交表單時發生錯誤:",e),Z(e)}finally{S.value=!1}}),ot=async()=>{if(V.value.id)try{await P.delete(`/marketing/budgets/${V.value.id}`),h({text:"預算表刪除成功",snackbarProps:{color:"teal-lighten-1"}}),Y(),E()}catch(t){Z(t)}finally{X.value=!1}},Z=t=>{var s,n,r;console.error("Error:",t);const e=((n=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:n.message)||"操作失敗";((r=t==null?void 0:t.response)==null?void 0:r.status)===401?(ze.logout(),$e.push("/login"),h({text:"登入已過期，請重新登入",snackbarProps:{color:"red-lighten-1"}})):h({text:e,snackbarProps:{color:"red-lighten-1"}})};Ae([$,Q],()=>{E()}),gt(async()=>{await Promise.all([E(),et()])});const k=p({show:!1,amount:"",error:"",channelIndex:-1,platformIndex:-1}),Ve=()=>{if(!k.value.amount){k.value.error="請輸入金額";return}const t=Number(k.value.amount);if(isNaN(t)||t<0){k.value.error="請輸入有效金額";return}const{channelIndex:e,platformIndex:s}=k.value;if(e===-1||s===-1)return;const n=d.value[e].platforms[s];Object.keys(te).forEach(r=>{n.budget[r]=t}),k.value.show=!1,k.value.error=""},nt=(t,e)=>{k.value={show:!0,amount:"",error:"",channelIndex:t,platformIndex:e}},we=(t,e)=>{const s=e==="up"?t-1:t+1;if(s<0||s>=d.value.length)return;const n=d.value[t];d.value[t]=d.value[s],d.value[s]=n},Ce=(t,e,s)=>{const n=d.value[t].platforms,r=s==="up"?e-1:e+1;if(r<0||r>=n.length)return;const u=n[e];n[e]=n[r],n[r]=u},ae=p(""),rt=Ut.debounce(()=>{E()},300),ut=()=>{J.value=!0,$.value=1,rt()},it=t=>{if(!t)return"";const e=new Date(t),s=new Date(e.getTime()+8*60*60*1e3),n=s.getUTCFullYear(),r=String(s.getUTCMonth()+1).padStart(2,"0"),u=String(s.getUTCDate()).padStart(2,"0");return`${n}/${r}/${u}`};Ae(()=>b.value.createdDateRange,t=>{if(t&&t.length>0){const e=new Date(t[0]),s=new Date(t[t.length-1]);e>s&&(h({text:"建立日期的結束日期不能早於開始日期",snackbarProps:{color:"warning"}}),b.value.createdDateRange=[])}});const dt=(t,e)=>{const s=d.value[t].platforms[e];Object.keys(te).forEach(n=>{s.budget[n]=""}),h({text:"已清空所有月份金額",snackbarProps:{color:"teal-lighten-1"}})},mt=t=>{const e=t.target.value;if(!e){C.setValue("");return}const s=parseInt(e);if(isNaN(s)){h({text:"請輸入有效的年度",snackbarProps:{color:"red-lighten-1"}}),C.setValue("");return}if(s<1911||s>9999){h({text:"年度必須在 1911 到 9999 之間",snackbarProps:{color:"red-lighten-1"}}),C.setValue("");return}C.setValue(s.toString())},ct=t=>t?me.value.filter(e=>{var s;return((s=e.parentId)==null?void 0:s._id)===t}):[],pt=(t,e)=>{d.value[e].platforms.forEach(n=>{n.platformId=""})};return(t,e)=>{const s=ft("v-date-input");return g(),B(Nt,{"max-width":"2160"},{default:l(()=>{var n,r,u,T,L,xe;return[a(G,{class:"pt-md-5"},{default:l(()=>[a(w,{cols:"12",lg:"2"},{default:l(()=>[a(G,null,{default:l(()=>[a(w,{cols:"12",class:"mt-1 ps-lg-6 pe-lg-0"},{default:l(()=>[a(ne,{class:"elevation-4 rounded-lg py-6 px-4 px-sm-2 px-xl-4"},{default:l(()=>[a(_t,{class:"font-weight-bold d-flex align-center"},{default:l(()=>e[21]||(e[21]=[m(" 搜尋條件 ")])),_:1}),a(re,{class:"pa-2"},{default:l(()=>[a(G,null,{default:l(()=>[a(w,{cols:"12",sm:"6",lg:"12"},{default:l(()=>[a(Bt,{modelValue:b.value.year,"onUpdate:modelValue":e[0]||(e[0]=o=>b.value.year=o),items:ke.value,label:"年度",variant:"outlined",density:"compact","hide-details":"",clearable:"",class:"mb-6"},null,8,["modelValue","items"]),a(ue,{modelValue:b.value.theme,"onUpdate:modelValue":e[1]||(e[1]=o=>b.value.theme=o),items:ee.value,label:"行銷主題","item-title":"name","item-value":"_id",variant:"outlined",density:"compact","hide-details":"",clearable:"",class:"mb-6"},null,8,["modelValue","items"]),a(s,{modelValue:b.value.createdDateRange,"onUpdate:modelValue":e[2]||(e[2]=o=>b.value.createdDateRange=o),label:"建立日期",variant:"outlined",density:"compact","hide-details":"",multiple:"range","prepend-icon":"",clearable:"","cancel-text":"取消","ok-text":"確認",class:"mb-6"},null,8,["modelValue"]),a(G,{class:"d-flex justify-space-between"},{default:l(()=>[a(w,{cols:"3"},{default:l(()=>[a(f,{color:"grey",width:"40",block:"",onClick:tt},{default:l(()=>[a(D,null,{default:l(()=>e[22]||(e[22]=[m("mdi-refresh")])),_:1})]),_:1})]),_:1}),a(w,{cols:"9",class:"ps-0"},{default:l(()=>[a(f,{color:"cyan-darken-2","prepend-icon":"mdi-magnify",loading:J.value,block:"",onClick:he},{default:l(()=>e[23]||(e[23]=[m(" 搜尋 ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(w,null,{default:l(()=>[a(G,{class:"elevation-4 rounded-lg py-4 py-sm-8 px-1 px-sm-10 mt-1 mx-0 mx-sm-4 ms-md-4 me-md-4 mb-4 bg-white"},{default:l(()=>[a(w,{cols:"12",class:"ps-3 pb-6 d-flex align-center"},{default:l(()=>e[24]||(e[24]=[i("h3",{class:"d-inline"}," 行銷預算管理 ",-1)])),_:1}),a(w,{cols:"12"},{default:l(()=>[i("div",Mt,[a(f,{color:"blue-grey-darken-1",variant:"outlined","prepend-icon":"mdi-plus",onClick:e[3]||(e[3]=o=>at())},{default:l(()=>e[25]||(e[25]=[m(" 新增預算表 ")])),_:1}),i("div",Jt,[x(a(D,{icon:"mdi-information",size:"small",color:"blue-grey-darken-2",class:"me-2"},null,512),[[U,"可搜尋備註、建立者","start"]]),a(Be,{modelValue:ae.value,"onUpdate:modelValue":[e[4]||(e[4]=o=>ae.value=o),ut],label:"快速搜尋","append-inner-icon":"mdi-magnify",loading:J.value,"base-color":"#666",color:"blue-grey-darken-3",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue","loading"])])])]),_:1}),a(w,{cols:"12"},{default:l(()=>[a(Et,{"items-per-page":Q.value,"onUpdate:itemsPerPage":e[5]||(e[5]=o=>Q.value=o),page:$.value,"onUpdate:page":e[6]||(e[6]=o=>$.value=o),"sort-by":W.value,"onUpdate:sortBy":e[7]||(e[7]=o=>W.value=o),density:"compact",headers:Re,items:be.value,"items-length":ye.value,"items-per-page-options":[10,20,50,100],loading:J.value,class:"elevation-0 rounded-lg","onUpdate:options":Xe},{"item.actions":l(({item:o})=>[a(f,{icon:"",color:"light-blue-darken-4",variant:"plain",size:q.value,onClick:c=>lt(o)},{default:l(()=>[a(D,null,{default:l(()=>e[26]||(e[26]=[m("mdi-pencil")])),_:1})]),_:2},1032,["size","onClick"])]),"item.annualTotalBudget":l(({item:o})=>[m(_(v(pe)(o.annualTotalBudget)),1)]),"item.totalBudget":l(({item:o})=>[m(_(v(pe)(o.totalBudget)),1)]),"item.createdAt":l(({item:o})=>[m(_(it(o.createdAt)),1)]),"item.note":l(({item:o})=>[o.note?(g(),B(Tt,{key:0,location:"top",transition:"fade-transition","close-on-content-click":!0,"close-on-back":!0},{activator:l(({props:c})=>[i("div",De(c,{class:"note-cell"}),_(o.note),17)]),default:l(()=>[a(ne,{"min-width":"300","max-width":"400",class:"rounded-lg menu-card",elevation:"3"},{default:l(()=>[a(re,{class:"pa-0"},{default:l(()=>[i("div",Rt,[a(D,{size:"16",color:"white",class:"me-2"},{default:l(()=>e[27]||(e[27]=[m(" mdi-text-box ")])),_:1}),e[28]||(e[28]=i("span",{class:"text-white text-subtitle-2"},"備註內容",-1))]),i("div",Ft,_(o.note),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)):j("",!0)]),_:2},1032,["items-per-page","page","sort-by","items","items-length","loading"])]),_:1})]),_:1})]),_:1})]),_:1}),a(Oe,{modelValue:V.value.open,"onUpdate:modelValue":e[13]||(e[13]=o=>V.value.open=o),persistent:"","max-width":"2600",fullscreen:!v(ge)},{default:l(()=>[a(Ee,{ref:"form",disabled:S.value,onSubmit:Ue(v(st),["prevent"])},{default:l(()=>[a(ne,{class:"rounded-lg pb-4"},{default:l(()=>[i("div",It,[m(_(V.value.id?"編輯預算表":"新增預算表")+" ",1),a(f,{icon:"",color:"red-lighten-1",variant:"plain",size:q.value,onClick:Y},{default:l(()=>[a(D,null,{default:l(()=>e[29]||(e[29]=[m("mdi-close")])),_:1})]),_:1},8,["size"])]),a(re,null,{default:l(()=>[ie.value?(g(),A("div",Yt,[a(St,{indeterminate:"",color:"deep-purple-darken-2",size:"64"})])):(g(),A(z,{key:1},[a(G,{class:"mb-6"},{default:l(()=>[a(w,{cols:"3"},{default:l(()=>[a(Be,{modelValue:v(C).value.value,"onUpdate:modelValue":e[8]||(e[8]=o=>v(C).value.value=o),"error-messages":v(C).errorMessage.value,label:"*年度",variant:"outlined",density:"compact",type:"number",min:"1911",max:"9999","hide-details":"",class:"mb-6",onBlur:mt},null,8,["modelValue","error-messages"])]),_:1}),a(w,{cols:"3"},{default:l(()=>[a(ue,{modelValue:v(O).value.value,"onUpdate:modelValue":e[9]||(e[9]=o=>v(O).value.value=o),"error-messages":v(O).errorMessage.value,items:ee.value,"item-title":"name","item-value":"_id",label:"*行銷主題",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","error-messages","items"])]),_:1}),a(w,{cols:"3"},{default:l(()=>[a(ve,{modelValue:v(R).value.value,"onUpdate:modelValue":e[10]||(e[10]=o=>v(R).value.value=o),"error-messages":v(R).errorMessage.value,label:"*年度總預算",variant:"outlined",density:"compact","hide-details":"",class:"mb-6"},null,8,["modelValue","error-messages"])]),_:1}),a(w,null,{default:l(()=>[a(Ot,{modelValue:v(H).value.value,"onUpdate:modelValue":e[11]||(e[11]=o=>v(H).value.value=o),"error-messages":v(H).errorMessage.value,label:"備註",variant:"outlined",density:"compact",clearable:"","auto-grow":"",rows:"1"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),i("div",Lt,[i("div",jt,[i("div",Gt,[i("span",qt,[i("span",Ht,_(v(C).value.value?`${v(C).value.value}`:"( 請先選擇年度 )"),1),e[30]||(e[30]=m(" 年度 ")),i("span",Qt,_(v(O).value.value?Le(v(O).value.value):"( 請先選擇行銷主題 )"),1),e[31]||(e[31]=m(" 行銷廣告預算表 "))])]),i("div",Wt,[e[32]||(e[32]=i("span",{class:"text-grey-darken-1 me-2",style:{"font-size":"16px"}},"預算差異 : ",-1)),i("span",{class:Pe(Ye.value),style:{"font-size":"16px"}},_(ce.value===0?"0":v(pe)(ce.value)),3)])]),a($t,{class:"budget-grid"},{default:l(()=>[i("thead",Zt,[i("tr",null,[e[35]||(e[35]=i("th",{class:"delete-button-col"},null,-1)),i("th",Kt,[e[34]||(e[34]=i("span",{class:"ms-10 me-3"},"廣告渠道",-1)),x((g(),B(f,{icon:"",size:"24",onClick:Ke},{default:l(()=>[a(D,{size:"18",color:"teal-darken-2",style:{"font-weight":"900"}},{default:l(()=>e[33]||(e[33]=[m(" mdi-plus ")])),_:1})]),_:1})),[[U,"新增廣告渠道"]])]),e[36]||(e[36]=i("th",{class:"sort-buttons-col"},null,-1)),e[37]||(e[37]=i("th",{class:"add-platform-col"},null,-1)),e[38]||(e[38]=i("th",{class:"delete-button-col"},null,-1)),e[39]||(e[39]=i("th",{class:"platform-col"}," 平台 ",-1)),e[40]||(e[40]=i("th",{class:"sort-buttons-col"},null,-1)),e[41]||(e[41]=i("th",{class:"quick-fill-col"},null,-1)),(g(),A(z,null,se(te,(o,c)=>i("th",{key:c,class:"month-col text-center"},_(o),1)),64))])]),i("tbody",null,[(g(!0),A(z,null,se(d.value,(o,c)=>(g(),A(z,{key:c},[(g(!0),A(z,null,se(o.platforms,(K,N)=>(g(),A("tr",{key:`${c}-${N}`,class:Pe({"row-odd":c%2===0})},[N===0?(g(),A(z,{key:0},[N===0?(g(),A("td",{key:0,class:"delete-button-col",rowspan:o.platforms.length},[d.value.length>1?x((g(),B(f,{key:0,icon:"",size:"24",color:"red-lighten-1",class:"delete-button",onClick:y=>qe(c)},{default:l(()=>[a(D,{size:"14"},{default:l(()=>e[42]||(e[42]=[m(" mdi-minus ")])),_:1})]),_:2},1032,["onClick"])),[[U,"刪除廣告渠道"]]):j("",!0)],8,Xt)):j("",!0),i("td",{class:"channel-col pe-1",rowspan:o.platforms.length},[i("div",ta,[a(ue,{modelValue:o.channelId,"onUpdate:modelValue":[y=>o.channelId=y,y=>pt(y,c)],items:de.value,"item-title":"name","item-value":"_id",variant:"outlined",density:"compact","hide-details":"",class:"channel-select"},null,8,["modelValue","onUpdate:modelValue","items"])])],8,ea),i("td",{class:"sort-buttons-col",rowspan:o.platforms.length},[i("div",la,[x(a(f,{icon:"mdi-chevron-up",size:"24",density:"compact",variant:"text",disabled:c===0,onClick:y=>we(c,"up")},null,8,["disabled","onClick"]),[[U,"上移"]]),x(a(f,{icon:"mdi-chevron-down",size:"24",density:"compact",variant:"text",disabled:c===d.value.length-1,onClick:y=>we(c,"down")},null,8,["disabled","onClick"]),[[U,"下移"]])])],8,aa),i("td",{class:"add-platform-col",rowspan:o.platforms.length},[x((g(),B(f,{icon:"",size:"24",color:"blue-grey-darken-2",onClick:y=>Qe(c)},{default:l(()=>[a(D,{size:"14"},{default:l(()=>e[43]||(e[43]=[m(" mdi-plus ")])),_:1})]),_:2},1032,["onClick"])),[[U,"新增平台"]])],8,sa)],64)):j("",!0),i("td",oa,[o.platforms.length>1?x((g(),B(f,{key:0,icon:"",size:"24",color:"amber-darken-4",class:"delete-button",onClick:y=>We(c,N)},{default:l(()=>[a(D,{size:"14"},{default:l(()=>e[44]||(e[44]=[m(" mdi-minus ")])),_:1})]),_:2},1032,["onClick"])),[[U,"刪除平台"]]):j("",!0)]),i("td",na,[a(ue,{modelValue:K.platformId,"onUpdate:modelValue":y=>K.platformId=y,items:ct(o.channelId),"item-title":"name","item-value":"_id",variant:"outlined",density:"compact","hide-details":"",class:"platform-select"},null,8,["modelValue","onUpdate:modelValue","items"])]),i("td",ra,[i("div",ua,[x(a(f,{icon:"mdi-chevron-up",size:"24",density:"compact",variant:"text",disabled:N===0,onClick:y=>Ce(c,N,"up")},null,8,["disabled","onClick"]),[[U,"上移"]]),x(a(f,{icon:"mdi-chevron-down",size:"24",density:"compact",variant:"text",disabled:N===o.platforms.length-1,onClick:y=>Ce(c,N,"down")},null,8,["disabled","onClick"]),[[U,"下移"]])])]),i("td",ia,[i("div",da,[x((g(),B(f,{icon:"",size:"20",color:"teal-darken-2",onClick:y=>nt(c,N)},{default:l(()=>[a(D,{size:"14"},{default:l(()=>e[45]||(e[45]=[m(" mdi-pencil-plus-outline ")])),_:1})]),_:2},1032,["onClick"])),[[U,"快速填入所有月份金額"]]),x((g(),B(f,{icon:"",size:"20",color:"red-lighten-1",onClick:y=>dt(c,N)},{default:l(()=>[a(D,{size:"14"},{default:l(()=>e[46]||(e[46]=[m(" mdi-eraser ")])),_:1})]),_:2},1032,["onClick"])),[[U,"刪除所有月份金額"]])])]),(g(!0),A(z,null,se(Object.keys(te),y=>(g(),A("td",{key:y,class:"month-col"},[a(ve,{modelValue:K.budget[y],"onUpdate:modelValue":vt=>K.budget[y]=vt,variant:"outlined",density:"compact","hide-details":"",class:"month-input"},null,8,["modelValue","onUpdate:modelValue"])]))),128))],2))),128))],64))),128))])]),_:1})])],64))]),_:1}),a(Te,{class:"px-6 py-4"},{default:l(()=>[a(zt,null,{default:l(({isHovering:o,props:c})=>[V.value.id?(g(),B(f,De({key:0},c,{color:o?"red-lighten-1":"grey",variant:"outlined","prepend-icon":"mdi-delete",size:q.value,onClick:e[12]||(e[12]=K=>X.value=!0)}),{default:l(()=>e[47]||(e[47]=[m(" 永久刪除 ")])),_:2},1040,["color","size"])):j("",!0)]),_:1}),a(Se),a(f,{color:"grey-darken-1",variant:"outlined",size:q.value,loading:S.value,onClick:Y},{default:l(()=>e[48]||(e[48]=[m(" 取消 ")])),_:1},8,["size","loading"]),a(f,{color:"teal-darken-1",variant:"outlined",type:"submit",class:"ms-2",size:q.value,loading:S.value,disabled:V.value.id&&!Ie.value||S.value},{default:l(()=>e[49]||(e[49]=[m(" 送出 ")])),_:1},8,["size","loading","disabled"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue","fullscreen"]),a(Dt,{modelValue:X.value,"onUpdate:modelValue":e[14]||(e[14]=o=>X.value=o),title:"確認刪除預算表",message:`確定要刪除「<span class='text-pink-lighten-1' style='font-weight: 800;'>${(n=M.value)==null?void 0:n.year}年度${(u=(r=M.value)==null?void 0:r.theme)==null?void 0:u.name}</span>」的預算表嗎？此操作無法復原。`,"expected-name":`${(T=M.value)==null?void 0:T.year}年度${(xe=(L=M.value)==null?void 0:L.theme)==null?void 0:xe.name}`,"input-label":"預算表名稱",onConfirm:ot},null,8,["modelValue","message","expected-name"]),a(_e,{modelValue:F.value.show,"onUpdate:modelValue":e[15]||(e[15]=o=>F.value.show=o),title:"確認刪除廣告渠道",message:`確定要刪除「<span class='text-pink-lighten-1' style='font-weight: 800;'> ${je(F.value.channelId)} </span>」廣告渠道嗎？會連同底下平台及金額一併刪除。`,onConfirm:He},null,8,["modelValue","message"]),a(_e,{modelValue:I.value.show,"onUpdate:modelValue":e[16]||(e[16]=o=>I.value.show=o),title:"確認刪除平台",message:`確定要刪除「<span class='text-teal-darken-1' style='font-weight: 800;'> ${Ge(I.value.platformId)} </span>」平台嗎？ 會連同底下金額一併刪除。`,onConfirm:Ze},null,8,["modelValue","message"]),a(Oe,{modelValue:k.value.show,"onUpdate:modelValue":e[20]||(e[20]=o=>k.value.show=o),"max-width":"320"},{default:l(()=>[a(Ee,{ref:"quickFillForm",onSubmit:Ue(Ve,["prevent"])},{default:l(()=>[a(ne,{class:"px-6 pt-6 pb-3 rounded-lg"},{default:l(()=>[e[53]||(e[53]=i("div",{class:"card-title"}," 快速填入月份金額 ",-1)),a(re,{class:"px-0 pb-2"},{default:l(()=>[e[50]||(e[50]=i("div",{class:"text-grey mb-4"}," 輸入金額將填入該平台的所有月份 ",-1)),a(ve,{modelValue:k.value.amount,"onUpdate:modelValue":[e[17]||(e[17]=o=>k.value.amount=o),e[18]||(e[18]=o=>k.value.error="")],label:"請輸入金額",variant:"outlined",density:"compact","error-messages":k.value.error,onKeyup:bt(Ve,["enter"])},null,8,["modelValue","error-messages"])]),_:1}),a(Te,{class:"px-0 pt-0"},{default:l(()=>[a(Se),a(f,{color:"grey-darken-1",variant:"outlined",onClick:e[19]||(e[19]=o=>k.value.show=!1)},{default:l(()=>e[51]||(e[51]=[m(" 取消 ")])),_:1}),a(f,{color:"teal-darken-1",variant:"outlined",type:"submit"},{default:l(()=>e[52]||(e[52]=[m(" 確認 ")])),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1},8,["modelValue"])]}),_:1})}}},Fa=yt(ma,[["__scopeId","data-v-d191f6d4"]]);export{Fa as default};

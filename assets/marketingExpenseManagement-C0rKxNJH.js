import{f as N,r as b,w as ve,k as wl,aV as y,Z as D,bH as t,b2 as Cl,a8 as l,a7 as n,a0 as r,bJ as P,bf as $,aG as xe,$ as Z,b0 as qe,F as fe,u as f,bM as zl,_ as De,bK as We}from"./@vue-Cr_z6yfx.js";import{u as _l}from"./vue-router-CS4OewbW.js";import{u as hl,a as X}from"./vee-validate-BXV9nMa7.js";import{_ as Ul,u as Al,b as Sl}from"./index-ZcDhEpUM.js";import{i as $l}from"./vuetify-use-dialog-C5oZ13xz.js";import{C as Pl}from"./ConfirmDeleteDialogWithTextField-DtpfDroW.js";import{b as El,e as Ml,c as ge}from"./yup-WHNMwcW8.js";import{l as Tl}from"./lodash-CiJWSuVn.js";import{f as Ke,A as Le}from"./AmountInput-CZxHDdLf.js";import{q as Rl,Q as jl,w as c,v as U,a as j,b as Bl,c as B,_ as I,g as d,r as g,d as Ye,R as Il,C as Je,J as Ol,U as Fl,f as H,a1 as Nl,e as oe,W as Hl,V as ie,T as E}from"./vuetify-CbddcmEc.js";import"./perfect-debounce-Cp2ysxOb.js";import"./hookable-B8xFkYCm.js";/* empty css             */import"./pinia-DBRIaiZ_.js";import"./vue-demi-Dq6ymT-8.js";import"./pinia-plugin-persistedstate-RV7uh3T-.js";import"./jspdf-DacfHTdZ.js";import"./core-js-D2hAHviU.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./unplugin-vue-router-B1N3mqWX.js";import"./axios-upsvKRUO.js";import"./vue3-google-login-Dx7TV_Hx.js";import"./vue-easy-lightbox-D952uME8.js";import"./property-expr-DEi1ZLzV.js";import"./tiny-case-BJ7jYKNY.js";import"./toposort-DzadwsAs.js";const ql={class:"d-flex align-center mb-4"},Wl={style:{width:"260px"},class:"ms-auto d-flex align-center"},Kl={class:"menu-header px-3 py-2"},Ll={class:"d-flex align-center pa-1"},Yl={class:"text-body-2 text-truncate"},Jl={class:"menu-header px-3 py-2"},Gl={class:"pa-4 pt-3 menu-card-text"},Ql={class:"d-flex justify-center"},Zl={key:0,class:"d-flex justify-center align-center",style:{"min-height":"300px"}},Xl={class:"card-title px-8 py-4 bg-blue-grey-darken-2 d-flex align-center"},et={class:"d-flex align-center justify-space-between mb-4"},lt={class:"d-none d-md-flex align-center"},tt={class:"d-flex d-md-none gap-1 align-center"},at={class:"details-grid"},st={class:"d-flex align-center"},nt={class:"detail-number"},ot={class:"detail-fields"},it={class:"detail-field"},rt={class:"detail-field"},ut={class:"detail-action"},dt={class:"d-flex justify-space-between align-center py-2 px-1"},mt={class:"text-h6"},ct={class:"card-title px-6 py-2 mb-2 d-flex justify-space-between align-center bg-teal-darken-2"},pt={class:"d-flex justify-space-between align-center"},vt={class:"card-title px-6 py-2 mb-2 d-flex justify-space-between align-center bg-grey-darken-3"},ft={class:"d-flex justify-space-between align-center"},gt={class:"card-title px-6 py-2 mb-2 d-flex justify-space-between align-center bg-red-lighten-1"},bt={class:"card-title px-6 py-2 mb-2 d-flex justify-space-between align-center bg-red-lighten-1"},yt={__name:"marketingExpenseManagement",setup(kt){const re=a=>{if(!a)return"";const e=new Date(a),i=new Date(e.getTime()+8*60*60*1e3),o=i.getUTCFullYear(),v=String(i.getUTCMonth()+1).padStart(2,"0"),p=String(i.getUTCDate()).padStart(2,"0");return`${o}/${v}/${p}`},Ge=a=>a?new Date(a):null,{apiAuth:_}=Sl(),Qe=Al(),x=$l(),Ze=_l(),{smAndUp:q,mdAndUp:Ve,lgAndUp:Xe}=Rl(),W=N(()=>q.value?"default":"small"),el=N(()=>q.value?"32":"16"),ll=N(()=>q.value?"18":"14"),tl=N(()=>q.value?"1520":"100%"),ue=b(!1),K=b(null),L=b(!1),de=b(!1),me=b(!1),ee=b(!1),al=El({invoiceDate:Ml().required("請選擇發票日期"),theme:ge().required("請選擇行銷主題"),channel:ge().required("請選擇廣告渠道"),platform:ge().required("請選擇平台"),note:ge()}),{handleSubmit:sl,resetForm:we}=hl({validationSchema:al}),le=X("invoiceDate"),te=X("theme"),M=X("channel"),Y=X("platform"),be=X("details"),ae=X("note"),m=b([{detail:"",amount:""}]),nl=a=>{m.value.length>1&&m.value.splice(a,1)},Ce=N(()=>m.value.reduce((a,e)=>a+(Number(e.amount)||0),0));ve(m,a=>{be.value.value=a},{deep:!0});const V=b({open:!1,id:""}),ol=N(()=>q.value?Ve.value?Xe.value?[{title:"發票日期",key:"invoiceDate",align:"start",sortable:!0},{title:"行銷主題",key:"theme.name",align:"start",sortable:!0},{title:"廣告渠道",key:"channel.name",align:"start",sortable:!0},{title:"平台",key:"platform.name",align:"start",sortable:!0},{title:"線別",key:"details",align:"start",maxWidth:"150",sortable:!0},{title:"總金額",key:"totalExpense",align:"start",sortable:!0},{title:"備註",key:"note",align:"start",width:"130",sortable:!0},{title:"建立者",key:"creator.name",align:"start",sortable:!0},{title:"建立日期",key:"createdAt",align:"start",sortable:!0},{title:"操作",key:"actions",align:"center",sortable:!1}]:[{title:"發票日期",key:"invoiceDate",align:"start",sortable:!0},{title:"行銷主題",key:"theme.name",align:"start",sortable:!0},{title:"廣告渠道",key:"channel.name",align:"start",sortable:!0},{title:"平台",key:"platform.name",align:"start",sortable:!0},{title:"線別",key:"details",align:"start",maxWidth:"150",sortable:!0},{title:"總金額",key:"totalExpense",align:"start",sortable:!0},{title:"建立者",key:"creator.name",align:"start",sortable:!0},{title:"操作",key:"actions",align:"center",sortable:!1}]:[{title:"發票日期",key:"invoiceDate",align:"start",sortable:!0},{title:"行銷主題",key:"theme.name",align:"start",sortable:!0},{title:"平台",key:"platform.name",align:"start",sortable:!0},{title:"總金額",key:"totalExpense",align:"start",sortable:!0},{title:"操作",key:"actions",align:"center",sortable:!1}]:[{title:"發票日期",key:"invoiceDate",align:"start",sortable:!0},{title:"行銷主題",key:"theme.name",align:"start",sortable:!0},{title:"操作",key:"actions",align:"center",sortable:!1}]),ze=b([]),_e=b(0),se=b(10),A=b(1),ne=b([{key:"invoiceDate",order:"desc"}]),ye=b([]),ke=b([]),he=b([]),O=b([]),il=b([]),u=b({theme:null,channel:null,platform:null,detail:null,createdDateRange:[],invoiceDateRange:[]}),J=b(""),Ue=Tl.debounce(()=>{A.value=1,T()},300),rl=()=>{u.value={theme:null,channel:null,platform:null,detail:null,createdDateRange:[],invoiceDateRange:[]},J.value="",A.value=1,T()},ul=async()=>{try{A.value=1,await T()}catch(a){console.error("搜尋時發生錯誤:",a),F(a)}};ve(J,()=>{me.value=!0,A.value=1,Ue()}),ve([A,se],()=>{T()}),ve([()=>u.value.createdDateRange,()=>u.value.invoiceDateRange],([a,e])=>{if(a&&a.length>0){const i=new Date(a[0]),o=new Date(a[a.length-1]);i>o&&(x({text:"建立日期的結束日期不能早於開始日期",snackbarProps:{color:"warning"}}),u.value.createdDateRange=[])}if(e&&e.length>0){const i=new Date(e[0]),o=new Date(e[e.length-1]);i>o&&(x({text:"發票日期的結束日期不能早於開始日期",snackbarProps:{color:"warning"}}),u.value.invoiceDateRange=[])}});const T=async()=>{var a,e,i;try{de.value=!0;const o={page:A.value,itemsPerPage:se.value,sortBy:((a=ne.value[0])==null?void 0:a.key)||"createdAt",sortOrder:((e=ne.value[0])==null?void 0:e.order)||"desc"};if((i=J.value)!=null&&i.trim()&&(o.search=J.value.trim()),u.value.theme&&(o.theme=u.value.theme),u.value.channel&&(o.channel=u.value.channel),u.value.platform&&(o.platform=u.value.platform),u.value.detail&&(o.detail=u.value.detail),u.value.createdDateRange&&u.value.createdDateRange.length>0){const p=new Date(u.value.createdDateRange[0]);p.setHours(0,0,0,0);const w=new Date(u.value.createdDateRange[u.value.createdDateRange.length-1]);w.setHours(23,59,59,999),o.createdDateStart=p.toISOString(),o.createdDateEnd=w.toISOString()}if(u.value.invoiceDateRange&&u.value.invoiceDateRange.length>0){const p=new Date(u.value.invoiceDateRange[0]);p.setHours(0,0,0,0);const w=new Date(u.value.invoiceDateRange[u.value.invoiceDateRange.length-1]);w.setHours(23,59,59,999),o.invoiceDateStart=p.toISOString(),o.invoiceDateEnd=w.toISOString()}const{data:v}=await _.get("/marketing/expenses/all",{params:o});v.success&&(ze.value=v.result.data,_e.value=v.result.totalItems)}catch(o){F(o)}finally{de.value=!1,me.value=!1}},dl=async()=>{try{const[{data:a},{data:e},{data:i},{data:o}]=await Promise.all([_.get("/marketing/categories/options",{params:{type:0}}),_.get("/marketing/categories/options",{params:{type:1}}),_.get("/marketing/categories/options",{params:{type:2}}),_.get("/marketing/categories/options",{params:{type:3}})]);a.success&&(ye.value=a.result),e.success&&(ke.value=e.result),i.success&&(he.value=i.result),o.success&&(O.value=o.result);try{const{data:v}=await _.get("/marketing/budgets/all",{params:{page:1,itemsPerPage:9999}});v.success&&(il.value=v.result.data.map(p=>({_id:p._id,name:`${p.year}年度 - ${p.theme.name}`})))}catch(v){console.error("載入預算表選項失敗:",v)}}catch(a){F(a)}},ml=()=>{V.value={open:!0,id:""},we()},cl=async a=>{try{if(console.log("編輯項目:",a),!a||!a._id){console.error("無效的項目:",a);return}V.value={open:!0,id:a._id},ee.value=!0;const{data:e}=await _.get(`/marketing/expenses/${a._id}`);if(!e.success)throw new Error("獲取資料失敗");const i=e.result;le.value.value=Ge(i.invoiceDate),te.value.value=i.theme._id,M.value.value=i.channel._id,Y.value.value=i.platform._id,m.value=i.details.map(o=>({detail:o.detail._id,amount:o.amount})),ae.value.value=i.note,K.value=i}catch(e){console.error("編輯項目發生錯誤:",e),F(e),V.value.open=!1}finally{ee.value=!1}},ce=()=>{try{V.value={open:!1,id:""},K.value=null,m.value=[{detail:"",amount:""}],we()}catch(a){console.error("關閉對話框時發生錯誤:",a)}},pl=sl(async a=>{try{if(m.value.some(p=>!p.detail||!p.amount)){x({text:"請確認選擇所有線別及費用皆已輸入",snackbarProps:{color:"red-lighten-1"}});return}const i=new Map,o=[];if(m.value.forEach(p=>{if(p.detail){const w=O.value.find(C=>C._id===p.detail),R=(w==null?void 0:w.name)||p.detail;i.has(p.detail)?o.includes(R)||o.push(R):i.set(p.detail,R)}}),o.length>0){x({text:`重複的線別：${o.join("、")}`,snackbarProps:{color:"red-lighten-1",timeout:4e3}});return}L.value=!0;const v={...a,invoiceDate:a.invoiceDate instanceof Date?a.invoiceDate.toISOString():a.invoiceDate,year:a.invoiceDate instanceof Date?a.invoiceDate.getFullYear():new Date(a.invoiceDate).getFullYear(),details:m.value,totalExpense:Ce.value};V.value.id?(await _.patch(`/marketing/expenses/${V.value.id}`,v),x({text:"實際支出更新成功",snackbarProps:{color:"teal-lighten-1"}})):(await _.post("/marketing/expenses",v),x({text:"實際支出新增成功",snackbarProps:{color:"teal-lighten-1"}})),ce(),T()}catch(e){F(e)}finally{L.value=!1}}),vl=async()=>{if(V.value.id)try{await _.delete(`/marketing/expenses/${V.value.id}`),x({text:"實際支出刪除成功",snackbarProps:{color:"teal-lighten-1"}}),ce(),T()}catch(a){F(a)}finally{ue.value=!1}},fl=()=>{me.value=!0,A.value=1,Ue()},F=a=>{var i,o,v;console.error("Error:",a);const e=((o=(i=a==null?void 0:a.response)==null?void 0:i.data)==null?void 0:o.message)||"操作失敗";((v=a==null?void 0:a.response)==null?void 0:v.status)===401?(Qe.logout(),Ze.push("/login"),x({text:"登入已過期，請重新登入",snackbarProps:{color:"red-lighten-1"}})):x({text:e,snackbarProps:{color:"red-lighten-1"}})},z=b({open:!1,amount:""}),Ae=()=>{z.value={open:!0,amount:""}},Se=()=>{const a=Number(z.value.amount);if(!a||a<=0)return;const i=m.value.filter(C=>C.amount>0).reduce((C,s)=>C+Number(s.amount),0),o=a-i,v=m.value.filter(C=>!C.amount||C.amount<=0);if(v.length===0){x({text:"所有線別已填寫金額",snackbarProps:{color:"warning"}}),z.value.open=!1;return}const p=Math.floor(o/v.length),w=o-p*v.length,R=Math.min(w,v.length);v.forEach((C,s)=>{const k=m.value.findIndex(S=>S===C);k!==-1&&(m.value[k].amount=s<R?p+1:p)}),z.value.open=!1},$e=N(()=>m.value.some(a=>Number(a.amount)>0)),G=b(!1),Q=b(!1),Pe=()=>{G.value=!0},gl=()=>{m.value=m.value.map(a=>({...a,amount:""})),x({text:"已清除所有線別金額",snackbarProps:{color:"teal-lighten-1"}}),G.value=!1},Ee=()=>{Q.value=!0},bl=()=>{m.value=[{detail:"",amount:""}],x({text:"已刪除所有線別",snackbarProps:{color:"teal-lighten-1"}}),Q.value=!1},h=b({open:!1,count:""}),Me=()=>{h.value={open:!0,count:""}},Te=()=>{const a=Number(h.value.count);if(!(!a||a<1)){for(let e=0;e<a;e++)m.value.push({detail:"",amount:""});x({text:`已新增 ${a} 個線別`,snackbarProps:{color:"teal-lighten-1"}}),h.value.open=!1}},Re=()=>{m.value.push({detail:"",amount:""})},je=()=>{if(!O.value||O.value.length===0){x({text:"目前沒有可用的線別",snackbarProps:{color:"warning"}});return}const a=new Set(m.value.map(o=>o.detail).filter(Boolean)),e=O.value.filter(o=>!a.has(o._id));if(e.length===0){x({text:"所有線別已經被新增",snackbarProps:{color:"warning"}});return}const i=e.length;m.value[0].detail||(m.value[0].detail=e[0]._id,e.shift()),e.forEach(o=>{m.value.push({detail:o._id,amount:""})}),x({text:`已新增 ${i} 個線別`,snackbarProps:{color:"teal-lighten-1"}})},yl=a=>{if(!Array.isArray(a))return"-";const e=a.map(i=>{var o;return((o=i.detail)==null?void 0:o.name)||""}).filter(Boolean);return e.length===0?"-":e.length<=4?e.join("、"):e.slice(0,4).join("、")+"..."},kl=async a=>{try{if(!a||!a._id){console.error("無效的項目:",a);return}V.value={open:!0,id:""},ee.value=!0;const{data:e}=await _.get(`/marketing/expenses/${a._id}`);if(!e.success)throw new Error("獲取資料失敗");const i=e.result;le.value.value=null,te.value.value=i.theme._id,M.value.value=i.channel._id,Y.value.value=i.platform._id,m.value=i.details.map(o=>({detail:o.detail._id,amount:o.amount})),ae.value.value=i.note,x({text:"請記得選擇發票日期",snackbarProps:{color:"warning",timeout:3e3}})}catch(e){console.error("複製項目發生錯誤:",e),F(e),V.value.open=!1}finally{ee.value=!1}},Be=a=>a?he.value.filter(e=>{var i;return((i=e.parentId)==null?void 0:i._id)===a}):[],xl=()=>{u.value.platform=null},Dl=()=>{Y.value.value=""},Vl=async a=>{var e;A.value=a.page,se.value=a.itemsPerPage,((e=a.sortBy)==null?void 0:e.length)>0&&(ne.value=a.sortBy),await T()};return wl(async()=>{await Promise.all([T(),dl()])}),(a,e)=>{const i=Cl("v-date-input");return y(),D(jl,{"max-width":"2160"},{default:t(()=>{var o,v,p,w,R,C;return[l(U,{class:"pt-md-5"},{default:t(()=>[l(c,{cols:"12",lg:"2"},{default:t(()=>[l(U,null,{default:t(()=>[l(c,{cols:"12",class:"mt-1 ps-lg-6 pe-lg-0"},{default:t(()=>[l(j,{class:"elevation-4 rounded-lg py-4 py-sm-6 px-4 px-sm-4 px-md-4 px-xl-4"},{default:t(()=>[l(Bl,{class:"font-weight-bold d-flex align-center px-3"},{default:t(()=>e[33]||(e[33]=[n(" 搜尋條件 ")])),_:1}),l(B,{class:"pa-2"},{default:t(()=>[l(U,null,{default:t(()=>[l(c,{cols:"12",lg:"12"},{default:t(()=>[l(U,null,{default:t(()=>[l(c,{cols:"12",sm:"6",lg:"12",class:"pb-0"},{default:t(()=>[l(I,{modelValue:u.value.theme,"onUpdate:modelValue":e[0]||(e[0]=s=>u.value.theme=s),items:ye.value,label:"行銷主題","item-title":"name","item-value":"_id",variant:"outlined",density:"compact","hide-details":"",clearable:"",class:"mb-3"},null,8,["modelValue","items"])]),_:1}),l(c,{cols:"12",sm:"6",lg:"12",class:"pb-0"},{default:t(()=>[l(I,{modelValue:u.value.channel,"onUpdate:modelValue":[e[1]||(e[1]=s=>u.value.channel=s),xl],items:ke.value,label:"廣告渠道","item-title":"name","item-value":"_id",variant:"outlined",density:"compact","hide-details":"",clearable:"",class:"mb-3"},null,8,["modelValue","items"])]),_:1}),l(c,{cols:"12",sm:"6",lg:"12",class:"pb-0"},{default:t(()=>[l(I,{modelValue:u.value.platform,"onUpdate:modelValue":e[2]||(e[2]=s=>u.value.platform=s),items:Be(u.value.channel),label:u.value.channel?"平台":"平台 ( 請先選擇廣告渠道 )","item-title":"name","item-value":"_id",variant:"outlined",density:"compact","hide-details":"",clearable:"",class:"mb-3",disabled:!u.value.channel},null,8,["modelValue","items","label","disabled"])]),_:1}),l(c,{cols:"12",sm:"6",lg:"12",class:"pb-0"},{default:t(()=>[l(I,{modelValue:u.value.detail,"onUpdate:modelValue":e[3]||(e[3]=s=>u.value.detail=s),items:O.value,label:"線別","item-title":"name","item-value":"_id",variant:"outlined",density:"compact","hide-details":"",clearable:"",class:"mb-3"},null,8,["modelValue","items"])]),_:1}),l(c,{cols:"12",sm:"6",lg:"12",class:"pb-0"},{default:t(()=>[l(i,{modelValue:u.value.createdDateRange,"onUpdate:modelValue":e[4]||(e[4]=s=>u.value.createdDateRange=s),label:"建立日期",variant:"outlined",density:"compact","hide-details":"",multiple:"range","prepend-icon":"",clearable:"","cancel-text":"取消","ok-text":"確認",class:"mb-3"},null,8,["modelValue"])]),_:1}),l(c,{cols:"12",sm:"6",lg:"12",class:"pb-0"},{default:t(()=>[l(i,{modelValue:u.value.invoiceDateRange,"onUpdate:modelValue":e[5]||(e[5]=s=>u.value.invoiceDateRange=s),label:"發票日期",variant:"outlined",density:"compact","hide-details":"",multiple:"range","prepend-icon":"",clearable:"","cancel-text":"取消","ok-text":"確認",class:"mb-3"},null,8,["modelValue"])]),_:1})]),_:1}),l(U,{class:"d-flex justify-space-between"},{default:t(()=>[l(c,{cols:"3"},{default:t(()=>[l(d,{color:"grey",width:"40",block:"",onClick:rl},{default:t(()=>[l(g,null,{default:t(()=>e[34]||(e[34]=[n("mdi-refresh")])),_:1})]),_:1})]),_:1}),l(c,{cols:"9",class:"ps-0"},{default:t(()=>[l(d,{color:"cyan-darken-2","prepend-icon":"mdi-magnify",loading:de.value,block:"",onClick:ul},{default:t(()=>e[35]||(e[35]=[n(" 搜尋 ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(c,{cols:"12",lg:"10"},{default:t(()=>[l(U,{class:"elevation-4 rounded-lg py-4 py-lg-8 px-1 px-sm-2 px-md-3 px-lg-7 mt-1 mx-0 mx-lg-4 mb-4 bg-white"},{default:t(()=>[l(c,{cols:"12",class:"ps-3 pb-2 pb-lg-6 d-flex align-center"},{default:t(()=>e[36]||(e[36]=[r("h3",{class:"d-inline"}," 實際支出管理 ",-1)])),_:1}),l(c,{cols:"12",class:"pb-0 pb-lg-4"},{default:t(()=>[r("div",ql,[l(d,{color:"blue-grey-darken-1",variant:"outlined",size:W.value,"prepend-icon":"mdi-plus",onClick:e[6]||(e[6]=s=>ml())},{default:t(()=>e[37]||(e[37]=[n(" 新增實際支出 ")])),_:1},8,["size"]),r("div",Wl,[P(l(g,{icon:"mdi-information",size:"small",color:"blue-grey-darken-2",class:"ms-2 me-2"},null,512),[[E,"可搜尋備註、建立者","start"]]),l(Ye,{modelValue:J.value,"onUpdate:modelValue":[e[7]||(e[7]=s=>J.value=s),fl],label:"快速搜尋","append-inner-icon":"mdi-magnify",loading:me.value,"base-color":"#666",color:"blue-grey-darken-3",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue","loading"])])])]),_:1}),l(c,{cols:"12"},{default:t(()=>[l(Il,{"items-per-page":se.value,"onUpdate:itemsPerPage":e[8]||(e[8]=s=>se.value=s),page:A.value,"onUpdate:page":e[9]||(e[9]=s=>A.value=s),"sort-by":ne.value,"onUpdate:sortBy":e[10]||(e[10]=s=>ne.value=s),density:"compact",headers:ol.value,items:ze.value,"items-length":_e.value,"items-per-page-options":[10,20,50,100],loading:de.value,class:"elevation-0 rounded-lg","onUpdate:options":Vl},{"item.invoiceDate":t(({item:s})=>[n($(re(s.invoiceDate)),1)]),"item.createdAt":t(({item:s})=>[n($(re(s.createdAt)),1)]),"item.details":t(({item:s})=>[Array.isArray(s.details)&&s.details.length>0?(y(),D(Je,{key:0,location:"top",transition:"fade-transition","close-on-content-click":!0,"close-on-back":!0},{activator:t(({props:k})=>[r("div",xe(k,{class:"details-cell"}),$(yl(s.details)),17)]),default:t(()=>[l(j,{"min-width":"300","max-width":"360",class:"rounded-lg menu-card",elevation:"3"},{default:t(()=>[l(B,{class:"pa-0"},{default:t(()=>[r("div",Kl,[l(g,{size:"16",color:"white",class:"me-2"},{default:t(()=>e[38]||(e[38]=[n(" mdi-format-list-text ")])),_:1}),e[39]||(e[39]=r("span",{class:"text-white text-subtitle-2"},"線別明細",-1))]),l(U,{dense:"",class:"details-grid-menu px-2 py-2"},{default:t(()=>[(y(!0),Z(fe,null,qe(s.details.filter(k=>{var S;return(S=k.detail)==null?void 0:S.name}),(k,S)=>(y(),D(c,{key:S,cols:"6"},{default:t(()=>[r("div",Ll,[l(g,{size:"small",color:"blue-grey-darken-1",class:"me-2"},{default:t(()=>e[40]||(e[40]=[n(" mdi-circle-small ")])),_:1}),r("span",Yl,$(k.detail.name),1)])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):(y(),Z(fe,{key:1},[n(" - ")],64))]),"item.totalExpense":t(({item:s})=>[n($(f(Ke)(s.totalExpense||0)),1)]),"item.note":t(({item:s})=>[s.note?(y(),D(Je,{key:0,location:"top",transition:"fade-transition","close-on-content-click":!0,"close-on-back":!0},{activator:t(({props:k})=>[r("div",xe(k,{class:"note-cell"}),$(s.note),17)]),default:t(()=>[l(j,{"min-width":"300","max-width":"360",class:"rounded-lg menu-card",elevation:"3"},{default:t(()=>[l(B,{class:"pa-0"},{default:t(()=>[r("div",Jl,[l(g,{size:"16",color:"white",class:"me-2"},{default:t(()=>e[41]||(e[41]=[n(" mdi-text-box ")])),_:1}),e[42]||(e[42]=r("span",{class:"text-white text-subtitle-2"},"備註內容",-1))]),r("div",Gl,$(s.note),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)):(y(),Z(fe,{key:1},[],64))]),"item.actions":t(({item:s})=>[r("div",Ql,[l(d,{icon:"",color:"light-blue-darken-4",variant:"plain",size:W.value,onClick:k=>cl(s)},{default:t(()=>[l(g,null,{default:t(()=>e[43]||(e[43]=[n("mdi-pencil")])),_:1})]),_:2},1032,["size","onClick"]),P((y(),D(d,{icon:"",color:"teal-darken-2",variant:"plain",size:W.value,onClick:k=>kl(s)},{default:t(()=>[l(g,null,{default:t(()=>e[44]||(e[44]=[n("mdi-content-copy")])),_:1})]),_:2},1032,["size","onClick"])),[[E,"複製"]])])]),_:2},1032,["items-per-page","page","sort-by","headers","items","items-length","loading"])]),_:1})]),_:1})]),_:1})]),_:1}),l(ie,{modelValue:V.value.open,"onUpdate:modelValue":e[17]||(e[17]=s=>V.value.open=s),persistent:"",width:tl.value,fullscreen:!f(q)},{default:t(()=>[l(j,{class:"rounded-lg"},{default:t(()=>[ee.value?(y(),Z("div",Zl,[l(Ol,{indeterminate:"",color:"deep-purple-darken-2",size:"64"})])):(y(),D(Fl,{key:1,ref:"form",disabled:L.value,onSubmit:zl(f(pl),["prevent"])},{default:t(()=>[r("div",Xl,[l(g,{size:"20",color:"white",class:"me-2"},{default:t(()=>e[45]||(e[45]=[n(" mdi-list-box-outline ")])),_:1}),n(" "+$(V.value.id?"編輯實際支出":"新增實際支出")+" ",1),l(H),l(d,{icon:"",color:"white",variant:"plain",class:"opacity-100",ripple:!1,size:"20",onClick:ce},{default:t(()=>[l(g,null,{default:t(()=>e[46]||(e[46]=[n("mdi-close")])),_:1})]),_:1})]),l(B,{class:"mt-6 mb-4 px-6"},{default:t(()=>[l(U,null,{default:t(()=>[l(c,{cols:"12",lg:"3",class:"px-4 px-lg-8 mb-4 mb-lg-0"},{default:t(()=>[l(U,{class:"border rounded-lg px-4 pt-2"},{default:t(()=>[l(c,{cols:"12",sm:"6",lg:"12",class:"pb-0"},{default:t(()=>[l(i,{modelValue:f(le).value.value,"onUpdate:modelValue":e[11]||(e[11]=s=>f(le).value.value=s),"error-messages":f(le).errorMessage.value,label:"*發票日期","prepend-icon":"",variant:"outlined",density:"compact","ok-text":"確認","cancel-text":"取消"},null,8,["modelValue","error-messages"])]),_:1}),l(c,{cols:"12",sm:"6",lg:"12",class:"pb-0"},{default:t(()=>[l(I,{modelValue:f(te).value.value,"onUpdate:modelValue":e[12]||(e[12]=s=>f(te).value.value=s),"error-messages":f(te).errorMessage.value,items:ye.value,"item-title":"name","item-value":"_id",label:"*行銷主題",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","error-messages","items"])]),_:1}),l(c,{cols:"12",sm:"6",lg:"12",class:"pb-0"},{default:t(()=>[l(I,{modelValue:f(M).value.value,"onUpdate:modelValue":[e[13]||(e[13]=s=>f(M).value.value=s),Dl],"error-messages":f(M).errorMessage.value,items:ke.value,"item-title":"name","item-value":"_id",label:"*廣告渠道",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","error-messages","items"])]),_:1}),l(c,{cols:"12",sm:"6",lg:"12",class:"pb-0"},{default:t(()=>[l(I,{modelValue:f(Y).value.value,"onUpdate:modelValue":e[14]||(e[14]=s=>f(Y).value.value=s),"error-messages":f(Y).errorMessage.value,items:Be(f(M).value.value),label:f(M).value.value?"*平台":"*平台 ( 請先選擇廣告渠道 )","item-title":"name","item-value":"_id",variant:"outlined",density:"compact",clearable:"",disabled:!f(M).value.value},null,8,["modelValue","error-messages","items","label","disabled"])]),_:1}),l(c,{cols:"12",class:"pb-0"},{default:t(()=>[l(Nl,{modelValue:f(ae).value.value,"onUpdate:modelValue":e[15]||(e[15]=s=>f(ae).value.value=s),"error-messages":f(ae).errorMessage.value,label:"備註",variant:"outlined",density:"compact",clearable:"","auto-grow":"",rows:"4"},null,8,["modelValue","error-messages"])]),_:1})]),_:1})]),_:1}),l(c,{cols:"12",lg:"9",class:"px-4 px-lg-8"},{default:t(()=>[l(U,{class:"border rounded-lg px-1 px-sm-4 pt-2"},{default:t(()=>[l(c,{cols:"12"},{default:t(()=>[r("div",et,[l(U,null,{default:t(()=>[l(c,{cols:"12",sm:"10",md:"2"},{default:t(()=>e[47]||(e[47]=[r("div",{class:"sub-title"}," 線別費用明細 ",-1)])),_:1}),l(c,{md:"10",class:"py-0 py-md-2"},{default:t(()=>[r("div",lt,[f(Ve)?(y(),D(H,{key:0})):De("",!0),l(d,{size:"small","prepend-icon":"mdi-delete-sweep",variant:"outlined",color:"red-lighten-1",disabled:!$e.value,onClick:Pe},{default:t(()=>e[48]||(e[48]=[n(" 清除所有金額 ")])),_:1},8,["disabled"]),l(d,{size:"small","prepend-icon":"mdi-delete-alert",variant:"outlined",color:"red-darken-2",class:"ms-2",disabled:m.value.length<=1,onClick:Ee},{default:t(()=>e[49]||(e[49]=[n(" 刪除所有線別 ")])),_:1},8,["disabled"]),l(d,{size:"small","prepend-icon":"mdi-calculator",variant:"outlined",color:"teal-darken-2",class:"ms-2",disabled:m.value.length===0,onClick:Ae},{default:t(()=>e[50]||(e[50]=[n(" 平均帶入各線別 ")])),_:1},8,["disabled"]),l(d,{size:"small","prepend-icon":"mdi-plus",variant:"outlined",color:"blue-darken-4",class:"ms-2",onClick:je},{default:t(()=>e[51]||(e[51]=[n(" 新增所有線別 ")])),_:1}),l(d,{size:"small","prepend-icon":"mdi-plus",variant:"outlined",class:"ms-2",onClick:Me},{default:t(()=>e[52]||(e[52]=[n(" 批量新增線別 ")])),_:1}),P((y(),D(d,{icon:"",size:"20",color:"grey-darken-2",elevation:"1",class:"ms-2",onClick:Re},{default:t(()=>[l(g,{size:"14"},{default:t(()=>e[53]||(e[53]=[n(" mdi-plus ")])),_:1})]),_:1})),[[E,"新增線別"]])]),r("div",tt,[P((y(),D(d,{icon:"",size:"28",variant:"outlined",color:"red-lighten-1",class:"me-2",disabled:!$e.value,onClick:Pe},{default:t(()=>[l(g,{size:"16"},{default:t(()=>e[54]||(e[54]=[n(" mdi-delete-sweep ")])),_:1})]),_:1},8,["disabled"])),[[E,"清除所有金額"]]),P((y(),D(d,{icon:"",size:"28",variant:"outlined",color:"red-darken-2",class:"me-2",disabled:m.value.length<=1,onClick:Ee},{default:t(()=>[l(g,{size:"16"},{default:t(()=>e[55]||(e[55]=[n(" mdi-delete-alert ")])),_:1})]),_:1},8,["disabled"])),[[E,"刪除所有線別"]]),P((y(),D(d,{icon:"",size:"28",variant:"outlined",class:"me-2",color:"teal-darken-2",disabled:m.value.length===0,onClick:Ae},{default:t(()=>[l(g,{size:"16"},{default:t(()=>e[56]||(e[56]=[n(" mdi-calculator ")])),_:1})]),_:1},8,["disabled"])),[[E,"平均帶入各線別"]]),P((y(),D(d,{icon:"",size:"28",variant:"outlined",class:"me-2",color:"blue-darken-4",onClick:je},{default:t(()=>[l(g,{size:"16"},{default:t(()=>e[57]||(e[57]=[n(" mdi-plus ")])),_:1})]),_:1})),[[E,"新增所有線別"]]),P((y(),D(d,{icon:"",size:"28",variant:"outlined",class:"me-2",onClick:Me},{default:t(()=>[l(g,{size:"16"},{default:t(()=>e[58]||(e[58]=[n(" mdi-plus ")])),_:1})]),_:1})),[[E,"批量新增線別"]]),P((y(),D(d,{icon:"",size:"28",color:"grey-darken-2",elevation:"1",onClick:Re},{default:t(()=>[l(g,{size:"16"},{default:t(()=>e[59]||(e[59]=[n(" mdi-plus ")])),_:1})]),_:1})),[[E,"新增線別"]])])]),_:1})]),_:1})])]),_:1}),l(c,{cols:"12",class:"pe-0"},{default:t(()=>[r("div",at,[(y(!0),Z(fe,null,qe(m.value,(s,k)=>{var S,Ie,Oe,Fe,Ne,He;return y(),Z("div",{key:k,class:"detail-item"},[r("div",st,[r("div",nt,$(k+1),1),r("div",ot,[r("div",it,[l(I,{modelValue:s.detail,"onUpdate:modelValue":pe=>s.detail=pe,"error-messages":(Oe=(Ie=(S=f(be).errorMessage)==null?void 0:S.value)==null?void 0:Ie[k])==null?void 0:Oe.detail,items:O.value,"item-title":"name","item-value":"_id",label:"*線別",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue","onUpdate:modelValue","error-messages","items"])]),r("div",rt,[l(Le,{modelValue:s.amount,"onUpdate:modelValue":pe=>s.amount=pe,"error-messages":(He=(Ne=(Fe=f(be).errorMessage)==null?void 0:Fe.value)==null?void 0:Ne[k])==null?void 0:He.amount,label:"*費用",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue","onUpdate:modelValue","error-messages"])]),r("div",ut,[m.value.length>1?(y(),D(d,{key:0,icon:"",color:"error",variant:"plain",size:el.value,onClick:pe=>nl(k)},{default:t(()=>[l(g,{size:ll.value},{default:t(()=>e[60]||(e[60]=[n(" mdi-delete ")])),_:1},8,["size"])]),_:2},1032,["size","onClick"])):De("",!0)])])])])}),128))])]),_:1}),l(c,{cols:"12"},{default:t(()=>[r("div",dt,[e[61]||(e[61]=r("span",{class:"text-subtitle-1"},"總金額：",-1)),r("span",mt,$(f(Ke)(Ce.value)),1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(oe,{class:"px-7 mb-4"},{default:t(()=>[l(Hl,null,{default:t(({isHovering:s,props:k})=>[V.value.id?(y(),D(d,xe({key:0},k,{color:s?"red-lighten-1":"grey",variant:"outlined",size:W.value,"prepend-icon":"mdi-delete",onClick:e[16]||(e[16]=S=>ue.value=!0)}),{default:t(()=>e[62]||(e[62]=[n(" 刪除 ")])),_:2},1040,["color","size"])):De("",!0)]),_:1}),l(H),l(d,{color:"grey-darken-1",variant:"outlined",class:"me-1",size:W.value,loading:L.value,onClick:ce},{default:t(()=>e[63]||(e[63]=[n(" 取消 ")])),_:1},8,["size","loading"]),l(d,{color:"teal-darken-1",variant:"outlined",type:"submit",class:"ms-1",size:W.value,loading:L.value,disabled:L.value},{default:t(()=>e[64]||(e[64]=[n(" 送出 ")])),_:1},8,["size","loading","disabled"])]),_:1})]),_:1},8,["disabled","onSubmit"]))]),_:1})]),_:1},8,["modelValue","width","fullscreen"]),l(ie,{modelValue:z.value.open,"onUpdate:modelValue":e[21]||(e[21]=s=>z.value.open=s),"max-width":"340",persistent:""},{default:t(()=>[l(j,{class:"rounded-lg"},{default:t(()=>[r("div",ct,[r("div",null,[l(g,{size:"20",class:"me-2"},{default:t(()=>e[65]||(e[65]=[n(" mdi-calculator ")])),_:1}),e[66]||(e[66]=n("平均帶入各線別 "))]),l(d,{icon:"",variant:"plain",size:"36",class:"opacity-100",ripple:!1,onClick:e[18]||(e[18]=s=>z.value.open=!1)},{default:t(()=>[l(g,{size:"20"},{default:t(()=>e[67]||(e[67]=[n(" mdi-close ")])),_:1})]),_:1})]),l(B,{class:"px-6 py-3"},{default:t(()=>[r("div",pt,[r("div",null,[e[68]||(e[68]=r("div",{class:"text-grey-darken-2 mb-4"},[n(" 請輸入要分配給各線別的"),r("span",{class:"text-pink-lighten-1 font-weight-bold"},"總金額"),n("，系統會自動平均分配給未填寫金額的線別。 ")],-1)),l(Le,{modelValue:z.value.amount,"onUpdate:modelValue":e[19]||(e[19]=s=>z.value.amount=s),label:"總金額",variant:"outlined",density:"compact","hide-details":"",onKeyup:We(Se,["enter"])},null,8,["modelValue"])])])]),_:1}),l(oe,{class:"px-6 py-4 mb-2"},{default:t(()=>[l(H),l(d,{color:"grey",variant:"outlined",class:"me-1",onClick:e[20]||(e[20]=s=>z.value.open=!1)},{default:t(()=>e[69]||(e[69]=[n(" 取消 ")])),_:1}),l(d,{color:"teal-darken-1",variant:"outlined",disabled:!z.value.amount||z.value.amount<=0,onClick:Se},{default:t(()=>e[70]||(e[70]=[n(" 確認 ")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(Pl,{modelValue:ue.value,"onUpdate:modelValue":e[22]||(e[22]=s=>ue.value=s),title:"確認刪除實際支出",message:`確定要刪除「<span class='text-pink-lighten-1' style='font-weight: 800;'>${re((o=K.value)==null?void 0:o.invoiceDate)}${(p=(v=K.value)==null?void 0:v.theme)==null?void 0:p.name}</span>」的實際支出嗎？ 此操作無法復原。`,"expected-name":`${re((w=K.value)==null?void 0:w.invoiceDate)}${(C=(R=K.value)==null?void 0:R.theme)==null?void 0:C.name}`,"input-label":"發票日期及行銷主題",onConfirm:vl},null,8,["modelValue","message","expected-name"]),l(ie,{modelValue:h.value.open,"onUpdate:modelValue":e[26]||(e[26]=s=>h.value.open=s),"max-width":"340",persistent:""},{default:t(()=>[l(j,{class:"rounded-lg"},{default:t(()=>[r("div",vt,[r("div",null,[l(g,{size:"20",class:"me-2"},{default:t(()=>e[71]||(e[71]=[n(" mdi-plus-circle ")])),_:1}),e[72]||(e[72]=n("批量新增線別 "))]),l(d,{icon:"",variant:"plain",size:"36",class:"opacity-100",ripple:!1,onClick:e[23]||(e[23]=s=>h.value.open=!1)},{default:t(()=>[l(g,{size:"20"},{default:t(()=>e[73]||(e[73]=[n(" mdi-close ")])),_:1})]),_:1})]),l(B,{class:"px-6 py-3"},{default:t(()=>[r("div",ft,[r("div",null,[e[74]||(e[74]=r("div",{class:"text-grey-darken-2 mb-4"}," 請輸入欲新增的線別數量，系統會自動新增指定數量的空白線別項目。 ",-1)),l(Ye,{modelValue:h.value.count,"onUpdate:modelValue":e[24]||(e[24]=s=>h.value.count=s),label:"線別數量",type:"number",variant:"outlined",density:"compact","hide-details":"",min:"1",rules:[s=>!s||s<1?"數量必須大於0":!0],onKeyup:We(Te,["enter"])},null,8,["modelValue","rules"])])])]),_:1}),l(oe,{class:"px-6 py-4 mb-2"},{default:t(()=>[l(H),l(d,{color:"grey",variant:"outlined",class:"me-1",onClick:e[25]||(e[25]=s=>h.value.open=!1)},{default:t(()=>e[75]||(e[75]=[n(" 取消 ")])),_:1}),l(d,{color:"teal-darken-1",variant:"outlined",disabled:!h.value.count||h.value.count<1,onClick:Te},{default:t(()=>e[76]||(e[76]=[n(" 確認 ")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(ie,{modelValue:G.value,"onUpdate:modelValue":e[29]||(e[29]=s=>G.value=s),persistent:"","max-width":"320"},{default:t(()=>[l(j,{class:"rounded-lg"},{default:t(()=>[r("div",gt,[r("div",null,[l(g,{size:"20",class:"me-2"},{default:t(()=>e[77]||(e[77]=[n(" mdi-delete-sweep ")])),_:1}),e[78]||(e[78]=n("確認清除所有金額 "))]),l(d,{icon:"",variant:"plain",size:"36",class:"opacity-100",ripple:!1,onClick:e[27]||(e[27]=s=>G.value=!1)},{default:t(()=>[l(g,{size:"20"},{default:t(()=>e[79]||(e[79]=[n(" mdi-close ")])),_:1})]),_:1})]),l(B,{class:"px-6 py-3"},{default:t(()=>e[80]||(e[80]=[r("div",{class:"text-grey-darken-2 mb-4"}," 確定要清除所有線別的金額嗎？此操作無法復原。 ",-1)])),_:1}),l(oe,{class:"px-6 pt-2 pb-4 mb-2"},{default:t(()=>[l(H),l(d,{color:"grey",variant:"outlined",class:"me-1",onClick:e[28]||(e[28]=s=>G.value=!1)},{default:t(()=>e[81]||(e[81]=[n(" 取消 ")])),_:1}),l(d,{color:"red-lighten-1",variant:"outlined",onClick:gl},{default:t(()=>e[82]||(e[82]=[n(" 清除 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(ie,{modelValue:Q.value,"onUpdate:modelValue":e[32]||(e[32]=s=>Q.value=s),persistent:"","max-width":"320"},{default:t(()=>[l(j,{class:"rounded-lg"},{default:t(()=>[r("div",bt,[r("div",null,[l(g,{size:"20",class:"me-2"},{default:t(()=>e[83]||(e[83]=[n(" mdi-delete ")])),_:1}),e[84]||(e[84]=n("確認刪除所有線別 "))]),l(d,{icon:"",variant:"plain",size:"36",class:"opacity-100",ripple:!1,onClick:e[30]||(e[30]=s=>Q.value=!1)},{default:t(()=>[l(g,{size:"20"},{default:t(()=>e[85]||(e[85]=[n(" mdi-close ")])),_:1})]),_:1})]),l(B,{class:"px-6 py-3"},{default:t(()=>e[86]||(e[86]=[r("div",{class:"text-grey-darken-2 mb-4"}," 確定要刪除所有線別嗎？此操作無法復原。 ",-1)])),_:1}),l(oe,{class:"px-6 pt-2 pb-4 mb-2"},{default:t(()=>[l(H),l(d,{color:"grey",variant:"outlined",class:"me-1",onClick:e[31]||(e[31]=s=>Q.value=!1)},{default:t(()=>e[87]||(e[87]=[n(" 取消 ")])),_:1}),l(d,{color:"red-lighten-1",variant:"outlined",onClick:bl},{default:t(()=>e[88]||(e[88]=[n(" 刪除 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]}),_:1})}}},Lt=Ul(yt,[["__scopeId","data-v-98271998"]]);export{Lt as default};

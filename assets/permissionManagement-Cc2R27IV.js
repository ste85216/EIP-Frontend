import{r as m,f as z,w as xe,aV as P,Z as x,bH as a,a8 as e,a0 as d,a7 as i,$ as q,F as me,b0 as pe,bf as _,aH as fe,_ as ce,bM as Ne,k as ta}from"./@vue-Cr_z6yfx.js";import{_ as $e,a as Fe}from"./index-n6mFz3XI.js";import{i as He}from"./vuetify-use-dialog-C5oZ13xz.js";import{a as $,r as y,g as E,c as F,al as na,F as J,b as Ie,f as C,S as _e,ad as be,e as Ee,V as ve,U as Me,v as Z,w as v,P as Ve,q as oa,Q as ia,$ as ra,a0 as Oe,am as ua,an as Ge,d as W,O as we,A as Ce,a1 as Le,_ as Ye,x as da}from"./vuetify-CbddcmEc.js";import{_ as ze}from"./ConfirmDeleteDialog-CuZPFffe.js";import"./perfect-debounce-Cp2ysxOb.js";import"./hookable-B8xFkYCm.js";/* empty css             */import"./pinia-DBRIaiZ_.js";import"./vue-demi-Dq6ymT-8.js";import"./pinia-plugin-persistedstate-RV7uh3T-.js";import"./vue-router-BFBClpR6.js";import"./jspdf-DsdNZwtm.js";import"./core-js-D2hAHviU.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./unplugin-vue-router-B1N3mqWX.js";import"./axios-upsvKRUO.js";import"./vue3-google-login-Dx7TV_Hx.js";import"./vue-easy-lightbox-D952uME8.js";const ma={class:"d-flex align-center justify-space-between px-6 py-4 bg-teal-darken-1 text-white"},pa={class:"d-flex align-center card-title"},ca={class:"d-flex align-center"},Ea={class:"d-flex align-center mb-4"},va={class:"d-flex align-center mb-2"},ya={class:"bock-title text-teal-darken-2 font-weight-bold"},Aa={class:"permission-grid"},fa={class:"card-title text-subtitle-2"},_a={class:"d-flex align-center ms-3"},Ra={class:"feature-list"},ka={key:1,class:"permission-grid"},ga={class:"card-title text-subtitle-2"},Ta={class:"d-flex align-center ms-3"},Pa={class:"feature-list"},Da={class:"card-title px-8 py-4 bg-blue-grey-darken-2 d-flex align-center"},ba={class:"role-alert-title"},Ca={class:"d-flex align-center"},Na={__name:"PermissionSelector",props:{modelValue:{type:Boolean,default:!1},permissions:{type:Array,default:()=>[]},submitting:{type:Boolean,default:!1},currentRole:{type:Object,default:null}},emits:["update:modelValue","save","copy"],setup(ye,{emit:N}){const p=ye,oe=N,I=Fe(),M=He(),O=m({open:!1}),h=m(null),L=m(!1),G=m(!1),R=m({sourceRoleId:"",replaceExisting:!1}),ee=m([]),V=m([{key:"profile",name:"個人資料管理",icon:"mdi-account-circle",category:"common",pagePermission:"PROFILE_READ",features:[{key:"BackgroundImageUsageStatsDialog.vueImageRead",name:"查看背景使用統計",permission:"SYSTEM_BACKGROUND_IMAGE_READ"}]},{key:"home",name:"首頁",icon:"mdi-home",category:"common",pagePermission:"HOME_READ",features:[]},{key:"extensionList",name:"分機表",icon:"mdi-phone-outline",category:"common",pagePermission:"EXTENSION_LIST_READ",features:[]},{key:"announcement",name:"所有公告",icon:"mdi-bullhorn",category:"common",pagePermission:"ANNOUNCEMENT_PAGE_READ",features:[]},{key:"marketingDesignRequest",name:"行銷美編需求申請",icon:"mdi-form-select",category:"common",pagePermission:"MARKETING_DESIGN_REQUEST_PAGE_READ",features:[{key:"read",name:"查看需求申請",permission:"MARKETING_DESIGN_REQUEST_APPLY_READ"},{key:"designerTag",name:"標註為處理人員",permission:"MARKETING_DESIGN_REQUEST_DESIGNER_TAG"}]},{key:"projectAndTaskManagement",name:"專案與任務管理",icon:"mdi-chart-box-outline",category:"application",pagePermission:"PROJECT_AND_TASK_MANAGEMENT_READ",features:[{key:"teamCreate",name:"新增團隊",permission:"TEAM_CREATE"},{key:"projectAndTaskManage",name:"管理專案與任務",permission:"PROJECT_AND_TASK_MANAGE"}]},{key:"B2CStatistics",name:"直客詢問統計表",icon:"mdi-account-question",category:"business",pagePermission:"B2C_STATISTICS_READ",features:[{key:"read",name:"查看直客詢問",permission:"CUSTOMER_INQUIRY_STATISTICS_READ"}]},{key:"marketingAnalysis",name:"行銷費用分析",icon:"mdi-chart-multiple",category:"business",pagePermission:"MARKETING_ANALYSIS_READ",features:[]},{key:"marketingExpenseManagement",name:"實際支出管理",icon:"mdi-cash-100",category:"business",pagePermission:"MARKETING_EXPENSE_MANAGEMENT_READ",features:[{key:"read",name:"查看實際支出",permission:"MARKETING_EXPENSE_READ"},{key:"create",name:"新增實際支出",permission:"MARKETING_EXPENSE_CREATE"},{key:"update",name:"編輯實際支出",permission:"MARKETING_EXPENSE_UPDATE"},{key:"delete",name:"刪除實際支出",permission:"MARKETING_EXPENSE_DELETE"}]},{key:"marketingBudgetManagement",name:"行銷預算管理",icon:"mdi-table-edit",category:"business",pagePermission:"MARKETING_BUDGET_MANAGEMENT_READ",features:[{key:"read",name:"查看行銷預算",permission:"MARKETING_BUDGET_READ"},{key:"create",name:"新增行銷預算",permission:"MARKETING_BUDGET_CREATE"},{key:"update",name:"編輯行銷預算",permission:"MARKETING_BUDGET_UPDATE"},{key:"delete",name:"刪除行銷預算",permission:"MARKETING_BUDGET_DELETE"}]},{key:"marketingCategoryManagement",name:"行銷分類管理",icon:"mdi-shape-plus-outline",category:"business",pagePermission:"MARKETING_CATEGORY_MANAGEMENT_READ",features:[{key:"read",name:"查看行銷分類",permission:"MARKETING_CATEGORY_READ"},{key:"create",name:"新增行銷分類",permission:"MARKETING_CATEGORY_CREATE"},{key:"update",name:"編輯行銷分類",permission:"MARKETING_CATEGORY_UPDATE"},{key:"delete",name:"刪除行銷分類",permission:"MARKETING_CATEGORY_DELETE"}]},{key:"b2CStatisticsManagement",name:"直客詢問管理",icon:"mdi-account-question",category:"business",pagePermission:"B2C_STATISTICS_MANAGEMENT_READ",features:[{key:"read",name:"查看直客詢問",permission:"CUSTOMER_INQUIRY_READ"},{key:"create",name:"新增直客詢問",permission:"CUSTOMER_INQUIRY_CREATE"},{key:"update",name:"編輯直客詢問",permission:"CUSTOMER_INQUIRY_UPDATE"},{key:"delete",name:"刪除直客詢問",permission:"CUSTOMER_INQUIRY_DELETE"},{key:"export",name:"匯出直客詢問",permission:"CUSTOMER_INQUIRY_EXPORT"},{key:"import",name:"匯入直客詢問",permission:"CUSTOMER_INQUIRY_IMPORT"}]},{key:"marketingDesignRequestManagement",name:"行銷美編需求申請管理",icon:"mdi-form-select",category:"business",pagePermission:"MARKETING_DESIGN_REQUEST_MANAGEMENT_READ",features:[{key:"read",name:"查看行美申請",permission:"MARKETING_DESIGN_REQUEST_READ"},{key:"update",name:"編輯行美申請",permission:"MARKETING_DESIGN_REQUEST_UPDATE"},{key:"notificationManage",name:"通知設定管理",permission:"MARKETING_DESIGN_REQUEST_NOTIFICATION_MANAGE"}]},{key:"formGenerator",name:"表單產生器",icon:"mdi-list-box-outline",category:"business",pagePermission:"FORM_GENERATOR_READ",features:[{key:"templateManage",name:"管理表單模板",permission:"FORM_TEMPLATE_MANAGE"},{key:"update",name:"編輯表單",permission:"FORM_UPDATE"},{key:"delete",name:"刪除表單",permission:"FORM_DELETE"}]},{key:"lineCategoryManagement",name:"線別分類管理",icon:"mdi-shape-plus-outline",category:"business",pagePermission:"LINE_CATEGORY_MANAGEMENT_READ",features:[{key:"read",name:"查看線別分類",permission:"LINE_CATEGORY_READ"},{key:"create",name:"新增線別分類",permission:"LINE_CATEGORY_CREATE"},{key:"update",name:"編輯線別分類",permission:"LINE_CATEGORY_UPDATE"},{key:"delete",name:"刪除線別分類",permission:"LINE_CATEGORY_DELETE"}]},{key:"sparePartManagement",name:"備品管理",icon:"mdi-package-variant",category:"business",pagePermission:"SPARE_PART_MANAGEMENT_READ",features:[{key:"sparePartRead",name:"查看備品",permission:"SPARE_PART_READ"},{key:"sparePartCreate",name:"新增備品",permission:"SPARE_PART_CREATE"},{key:"sparePartUpdate",name:"編輯備品",permission:"SPARE_PART_UPDATE"},{key:"sparePartDelete",name:"刪除備品",permission:"SPARE_PART_DELETE"},{key:"warehouseRead",name:"查看倉庫",permission:"SPARE_PART_WAREHOUSE_READ"},{key:"warehouseCreate",name:"新增倉庫",permission:"SPARE_PART_WAREHOUSE_CREATE"},{key:"warehouseUpdate",name:"編輯倉庫",permission:"SPARE_PART_WAREHOUSE_UPDATE"},{key:"warehouseDelete",name:"刪除倉庫",permission:"SPARE_PART_WAREHOUSE_DELETE"},{key:"manufacturerRead",name:"查看廠商",permission:"SPARE_PART_MANUFACTURER_READ"},{key:"manufacturerCreate",name:"新增廠商",permission:"SPARE_PART_MANUFACTURER_CREATE"},{key:"manufacturerUpdate",name:"編輯廠商",permission:"SPARE_PART_MANUFACTURER_UPDATE"},{key:"manufacturerDelete",name:"刪除廠商",permission:"SPARE_PART_MANUFACTURER_DELETE"}]},{key:"sparePartInventoryManagement",name:"備品庫存管理",icon:"mdi-package-variant",category:"business",pagePermission:"SPARE_PART_INVENTORY_MANAGEMENT_READ",features:[{key:"sparePartInventoryRead",name:"查看備品庫存",permission:"SPARE_PART_INVENTORY_READ"},{key:"sparePartInventoryUpdate",name:"編輯備品庫存",permission:"SPARE_PART_INVENTORY_UPDATE"}]},{key:"employeeList",name:"公司員工列表",icon:"mdi-account-group",category:"organization",pagePermission:"EMPLOYEE_LIST_READ",features:[]},{key:"employeeManagement",name:"員工管理",icon:"mdi-account-group",category:"organization",pagePermission:"EMPLOYEE_MANAGEMENT_READ",features:[{key:"read",name:"查看員工",permission:"EMPLOYEE_READ"},{key:"create",name:"新增員工",permission:"EMPLOYEE_CREATE"},{key:"update",name:"編輯員工",permission:"EMPLOYEE_UPDATE"},{key:"delete",name:"刪除員工",permission:"EMPLOYEE_DELETE"},{key:"export",name:"匯出員工資料",permission:"EMPLOYEE_EXPORT"},{key:"import",name:"匯入員工資料",permission:"EMPLOYEE_IMPORT"}]},{key:"companyAndDepartmentManagement",name:"公司部門管理",icon:"mdi-office-building-cog",category:"organization",pagePermission:"COMPANY_AND_DEPARTMENT_MANAGEMENT_READ",features:[{key:"companyRead",name:"查看公司",permission:"COMPANY_READ"},{key:"companyCreate",name:"新增公司",permission:"COMPANY_CREATE"},{key:"companyUpdate",name:"修改公司",permission:"COMPANY_UPDATE"},{key:"companyDelete",name:"刪除公司",permission:"COMPANY_DELETE"},{key:"departmentRead",name:"查看部門",permission:"DEPARTMENT_READ"},{key:"departmentCreate",name:"新增部門",permission:"DEPARTMENT_CREATE"},{key:"departmentUpdate",name:"修改部門",permission:"DEPARTMENT_UPDATE"},{key:"departmentDelete",name:"刪除部門",permission:"DEPARTMENT_DELETE"},{key:"locationCreate",name:"新增公司地點",permission:"COMPANY_LOCATION_CREATE"},{key:"locationUpdate",name:"修改公司地點",permission:"COMPANY_LOCATION_UPDATE"},{key:"locationDelete",name:"刪除公司地點",permission:"COMPANY_LOCATION_DELETE"}]},{key:"hardwareDeviceManagement",name:"硬體設備管理",icon:"mdi-server-outline",category:"organization",pagePermission:"HARDWARE_DEVICE_MANAGEMENT_READ",features:[{key:"read",name:"查看硬體設備",permission:"HARDWARE_DEVICE_READ"},{key:"create",name:"新增硬體設備",permission:"HARDWARE_DEVICE_CREATE"},{key:"update",name:"編輯硬體設備",permission:"HARDWARE_DEVICE_UPDATE"},{key:"delete",name:"刪除硬體設備",permission:"HARDWARE_DEVICE_DELETE"},{key:"export",name:"匯出硬體設備",permission:"HARDWARE_DEVICE_EXPORT"},{key:"import",name:"匯入硬體設備",permission:"HARDWARE_DEVICE_IMPORT"}]},{key:"hardwareMaintenanceRecord",name:"硬體維修記錄",icon:"mdi-wrench",category:"organization",pagePermission:"HARDWARE_MAINTENANCE_RECORD_PAGE_READ",features:[{key:"read",name:"查看硬修記錄",permission:"HARDWARE_MAINTENANCE_RECORD_READ"},{key:"create",name:"新增維修記錄",permission:"HARDWARE_MAINTENANCE_RECORD_CREATE"},{key:"update",name:"編輯維修記錄",permission:"HARDWARE_MAINTENANCE_RECORD_UPDATE"},{key:"delete",name:"刪除維修記錄",permission:"HARDWARE_MAINTENANCE_RECORD_DELETE"},{key:"export",name:"匯出維修記錄",permission:"HARDWARE_MAINTENANCE_RECORD_EXPORT"}]},{key:"hardwareCategoryManagement",name:"硬體類型管理",icon:"mdi-shape-plus-outline",category:"organization",pagePermission:"HARDWARE_CATEGORY_MANAGEMENT_READ",features:[{key:"read",name:"查看硬體類型",permission:"HARDWARE_CATEGORY_READ"},{key:"create",name:"新增硬體類型",permission:"HARDWARE_CATEGORY_CREATE"},{key:"update",name:"編輯硬體類型",permission:"HARDWARE_CATEGORY_UPDATE"},{key:"delete",name:"刪除硬體類型",permission:"HARDWARE_CATEGORY_DELETE"}]},{key:"userManagement",name:"用戶管理",icon:"mdi-account-multiple",category:"system",pagePermission:"USER_MANAGEMENT_READ",features:[{key:"read",name:"查看用戶",permission:"SYSTEM_USER_READ"},{key:"create",name:"新增用戶",permission:"SYSTEM_USER_CREATE"},{key:"update",name:"編輯用戶",permission:"SYSTEM_USER_UPDATE"},{key:"delete",name:"刪除用戶",permission:"SYSTEM_USER_DELETE"}]},{key:"permissionManagement",name:"權限管理",icon:"mdi-shield-account",category:"system",pagePermission:"PERMISSION_MANAGEMENT_READ",features:[{key:"permissionRead",name:"查看權限",permission:"SYSTEM_PERMISSION_READ"},{key:"permissionCreate",name:"新增權限",permission:"SYSTEM_PERMISSION_CREATE"},{key:"permissionUpdate",name:"編輯權限",permission:"SYSTEM_PERMISSION_UPDATE"},{key:"permissionDelete",name:"刪除權限",permission:"SYSTEM_PERMISSION_DELETE"},{key:"roleRead",name:"查看角色",permission:"SYSTEM_ROLE_READ"},{key:"roleCreate",name:"新增角色",permission:"SYSTEM_ROLE_CREATE"},{key:"roleUpdate",name:"編輯角色",permission:"SYSTEM_ROLE_UPDATE"},{key:"roleDelete",name:"刪除角色",permission:"SYSTEM_ROLE_DELETE"}]},{key:"announcementManagement",name:"公告管理",icon:"mdi-bullhorn",category:"system",pagePermission:"ANNOUNCEMENT_MANAGEMENT_READ",features:[{key:"read",name:"查看公告",permission:"ANNOUNCEMENT_READ"},{key:"create",name:"新增公告",permission:"ANNOUNCEMENT_CREATE"},{key:"update",name:"編輯公告",permission:"ANNOUNCEMENT_UPDATE"},{key:"delete",name:"刪除公告",permission:"ANNOUNCEMENT_DELETE"}]},{key:"marqueeManagement",name:"跑馬燈管理",icon:"mdi-bullhorn-outline",category:"system",pagePermission:"MARQUEE_MANAGEMENT_READ",features:[{key:"read",name:"查看跑馬燈",permission:"MARQUEE_READ"},{key:"create",name:"新增跑馬燈",permission:"MARQUEE_CREATE"},{key:"update",name:"編輯跑馬燈",permission:"MARQUEE_UPDATE"},{key:"delete",name:"刪除跑馬燈",permission:"MARQUEE_DELETE"}]},{key:"carouselManagement",name:"輪播圖管理",icon:"mdi-image-multiple",category:"system",pagePermission:"CAROUSEL_MANAGEMENT_READ",features:[{key:"read",name:"查看輪播圖",permission:"CAROUSEL_READ"},{key:"create",name:"新增輪播圖",permission:"CAROUSEL_CREATE"},{key:"update",name:"編輯輪播圖",permission:"CAROUSEL_UPDATE"},{key:"delete",name:"刪除輪播圖",permission:"CAROUSEL_DELETE"}]},{key:"sharedResourceManagement",name:"共享資源管理",icon:"mdi-share-all",category:"system",pagePermission:"SHARED_RESOURCE_MANAGEMENT_READ",features:[{key:"read",name:"查看共享資源",permission:"SHARED_RESOURCE_READ"},{key:"create",name:"新增共享資源",permission:"SHARED_RESOURCE_CREATE"},{key:"update",name:"編輯共享資源",permission:"SHARED_RESOURCE_UPDATE"},{key:"delete",name:"刪除共享資源",permission:"SHARED_RESOURCE_DELETE"}]},{key:"auditLog",name:"異動紀錄",icon:"mdi-history",category:"system",pagePermission:"AUDIT_LOG_PAGE_READ",features:[{key:"read",name:"查看異動紀錄",permission:"AUDIT_LOG_READ"},{key:"delete",name:"刪除異動紀錄",permission:"AUDIT_LOG_DELETE"}]}]),c=m({}),ae=z(()=>{var u;return((u=p.currentRole)==null?void 0:u.name)||"當前角色"}),B=z(()=>p.currentRole?ee.value.filter(u=>u._id!==p.currentRole._id):ee.value),w=m("all"),D=z(()=>[{id:"common",label:"常用"},{id:"application",label:"應用"},{id:"business",label:"業務"},{id:"organization",label:"組織"},{id:"system",label:"系統"}].map(s=>({...s,items:V.value.filter(o=>o.category===s.id)})).filter(s=>s.items.length>0)),A=z(()=>V.value.filter(u=>u.category===w.value)),S=()=>{const u={};V.value.forEach(s=>{u[s.key]={pageAccess:!1,...s.features.reduce((o,r)=>(o[r.key]=!1,o),{})}}),c.value=u},le=()=>{if(!p.permissions||p.permissions.length===0){S();return}S(),V.value.forEach(u=>{const s=p.permissions.some(o=>o.code===u.pagePermission);c.value[u.key].pageAccess=s,u.features.forEach(o=>{const r=p.permissions.some(k=>k.code===o.permission);c.value[u.key][o.key]=r})})},b=u=>{const s=V.value.find(o=>o.key===u);s&&(c.value[u].pageAccess||s.features.forEach(o=>{c.value[u][o.key]=!1}))},Re=()=>{const u=[];V.value.forEach(s=>{c.value[s.key].pageAccess&&u.push(s.pagePermission),s.features.forEach(o=>{c.value[s.key][o.key]&&u.push(o.permission)})}),oe("save",u)},se=()=>{oe("update:modelValue",!1)},te=()=>{S(),M({text:"權限已重置",snackbarProps:{color:"teal-lighten-1"}})},K=u=>{const s=V.value.find(r=>r.key===u);if(!s||!s.features||s.features.length===0)return;s.features.every(r=>c.value[u][r.key])?(s.features.forEach(r=>{c.value[u][r.key]=!1}),M({text:`已取消 ${s.name} 的所有功能權限`,snackbarProps:{color:"orange-darken-2"}})):(s.features.forEach(r=>{c.value[u][r.key]=!0}),M({text:`已全選 ${s.name} 的所有功能權限`,snackbarProps:{color:"teal-lighten-1"}}))},Q=async()=>{try{const u=await I.getAllRoles();ee.value=u,O.value.open=!0,R.value={sourceRoleId:"",replaceExisting:!1}}catch{M({text:"載入角色失敗",snackbarProps:{color:"red"}})}},f=()=>{O.value.open=!1,R.value={sourceRoleId:"",replaceExisting:!1}},ne=async()=>{var u,s,o;if(L.value){G.value=!0;try{const r=R.value.sourceRoleId,k=R.value.replaceExisting,X=ee.value.find(H=>H._id===r);if(!X)throw new Error("來源角色不存在");const ie=((u=X.permissions)==null?void 0:u.map(H=>H._id||H))||[],re={permissions:ie};if(k)await I.updateRole(p.currentRole._id,re);else{const H=((o=(s=p.currentRole)==null?void 0:s.permissions)==null?void 0:o.map(Ae=>Ae._id||Ae))||[],ke=[...new Set([...H,...ie])];re.permissions=ke,await I.updateRole(p.currentRole._id,re)}M({text:`權限複製成功：${X.name} → ${p.currentRole.name}`,snackbarProps:{color:"teal"}}),oe("copy",ie),f()}catch(r){M({text:r.message||"複製權限失敗",snackbarProps:{color:"red"}})}finally{G.value=!1}}};return xe(()=>p.permissions,()=>{le()},{immediate:!0}),xe(()=>p.modelValue,u=>{u&&le()}),(u,s)=>(P(),x(ve,{"model-value":ye.modelValue,"max-width":"1800",persistent:"","onUpdate:modelValue":s[5]||(s[5]=o=>u.$emit("update:modelValue",o))},{default:a(()=>[e($,{class:"rounded-lg",style:{"min-height":"calc(100vh - 48px) !important"}},{default:a(()=>[d("div",ma,[d("div",pa,[e(y,{class:"me-2"},{default:a(()=>s[6]||(s[6]=[i(" mdi-shield-account ")])),_:1}),s[7]||(s[7]=i(" 權限管理 "))]),d("div",ca,[e(E,{color:"white",variant:"outlined",class:"me-2",size:"small",onClick:te},{default:a(()=>s[8]||(s[8]=[i(" 重置 ")])),_:1}),e(E,{color:"white",variant:"outlined",class:"me-6",size:"small",onClick:Q},{default:a(()=>s[9]||(s[9]=[i(" 複製角色 ")])),_:1}),e(E,{icon:"",color:"white",variant:"plain",class:"opacity-100",ripple:!1,size:"20",onClick:se},{default:a(()=>[e(y,null,{default:a(()=>s[10]||(s[10]=[i("mdi-close")])),_:1})]),_:1})])]),e(F,{class:"px-6 pt-4"},{default:a(()=>[d("div",Ea,[e(na,{modelValue:w.value,"onUpdate:modelValue":s[0]||(s[0]=o=>w.value=o),"selected-class":"text-white"},{default:a(()=>[e(J,{label:"",value:"all",color:"teal-darken-2",variant:"outlined"},{default:a(()=>s[11]||(s[11]=[i(" 全部 ")])),_:1}),e(J,{label:"",value:"common",color:"teal-darken-2",variant:"outlined"},{default:a(()=>s[12]||(s[12]=[i(" 常用 ")])),_:1}),e(J,{label:"",value:"application",color:"teal-darken-2",variant:"outlined"},{default:a(()=>s[13]||(s[13]=[i(" 應用 ")])),_:1}),e(J,{label:"",value:"business",color:"teal-darken-2",variant:"outlined"},{default:a(()=>s[14]||(s[14]=[i(" 業務 ")])),_:1}),e(J,{label:"",value:"organization",color:"teal-darken-2",variant:"outlined"},{default:a(()=>s[15]||(s[15]=[i(" 組織 ")])),_:1}),e(J,{label:"",value:"system",color:"teal-darken-2",variant:"outlined"},{default:a(()=>s[16]||(s[16]=[i(" 系統 ")])),_:1})]),_:1},8,["modelValue"])]),w.value==="all"?(P(!0),q(me,{key:0},pe(D.value,o=>(P(),q("div",{key:o.id,class:"mb-12"},[d("div",va,[e(y,{class:"ms-1 me-2",size:"20",color:"teal-darken-2"},{default:a(()=>s[17]||(s[17]=[i(" mdi-folder-multiple-outline ")])),_:1}),d("span",ya,_(o.label),1)]),d("div",Aa,[(P(!0),q(me,null,pe(o.items,r=>(P(),x($,{key:r.key,elevation:"0",class:fe(["permission-card",{"has-features":r.features&&r.features.length>0}])},{default:a(()=>[e(Ie,{class:"d-flex align-center px-5 pt-2 pb-0"},{default:a(()=>[e(y,{class:"me-2",size:"18"},{default:a(()=>[i(_(r.icon),1)]),_:2},1024),d("span",fa,_(r.name),1),e(C),d("div",_a,[r.features&&r.features.length>0&&c.value[r.key].pageAccess?(P(),x(E,{key:0,icon:"",color:"teal",variant:"text",size:"x-small",class:"me-3",title:"全選/取消此模組的功能權限",onClick:k=>K(r.key)},{default:a(()=>[e(y,{size:"16"},{default:a(()=>s[18]||(s[18]=[i(" mdi-check-all ")])),_:1})]),_:2},1032,["onClick"])):ce("",!0),e(_e,{modelValue:c.value[r.key].pageAccess,"onUpdate:modelValue":k=>c.value[r.key].pageAccess=k,color:"teal",density:"compact","hide-details":"",onChange:k=>b(r.key)},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),c.value[r.key].pageAccess&&r.features&&r.features.length>0?(P(),x(F,{key:0,class:"px-4 pb-5"},{default:a(()=>[d("div",Ra,[(P(!0),q(me,null,pe(r.features,k=>(P(),x(be,{key:k.key,modelValue:c.value[r.key][k.key],"onUpdate:modelValue":X=>c.value[r.key][k.key]=X,label:k.name,color:"teal","hide-details":"",density:"compact",class:"feature-checkbox"},null,8,["modelValue","onUpdate:modelValue","label"]))),128))])]),_:2},1024)):ce("",!0)]),_:2},1032,["class"]))),128))])]))),128)):(P(),q("div",ka,[(P(!0),q(me,null,pe(A.value,o=>(P(),x($,{key:o.key,elevation:"0",class:fe(["permission-card",{"has-features":o.features&&o.features.length>0}])},{default:a(()=>[e(Ie,{class:"d-flex align-center px-5 pt-2 pb-0"},{default:a(()=>[e(y,{class:"me-2",size:"18"},{default:a(()=>[i(_(o.icon),1)]),_:2},1024),d("span",ga,_(o.name),1),e(C),d("div",Ta,[o.features&&o.features.length>0&&c.value[o.key].pageAccess?(P(),x(E,{key:0,icon:"",color:"teal",variant:"text",size:"x-small",class:"me-3",title:"全選/取消此模組的功能權限",onClick:r=>K(o.key)},{default:a(()=>[e(y,{size:"16"},{default:a(()=>s[19]||(s[19]=[i(" mdi-check-all ")])),_:1})]),_:2},1032,["onClick"])):ce("",!0),e(_e,{modelValue:c.value[o.key].pageAccess,"onUpdate:modelValue":r=>c.value[o.key].pageAccess=r,color:"teal",density:"compact","hide-details":"",onChange:r=>b(o.key)},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),c.value[o.key].pageAccess&&o.features&&o.features.length>0?(P(),x(F,{key:0,class:"px-4 pb-5"},{default:a(()=>[d("div",Pa,[(P(!0),q(me,null,pe(o.features,r=>(P(),x(be,{key:r.key,modelValue:c.value[o.key][r.key],"onUpdate:modelValue":k=>c.value[o.key][r.key]=k,label:r.name,color:"teal","hide-details":"",density:"compact",class:"feature-checkbox"},null,8,["modelValue","onUpdate:modelValue","label"]))),128))])]),_:2},1024)):ce("",!0)]),_:2},1032,["class"]))),128))]))]),_:1}),e(Ee,{class:"px-6 pb-6"},{default:a(()=>[e(C),e(E,{color:"grey-darken-1",variant:"outlined",onClick:se},{default:a(()=>s[20]||(s[20]=[i(" 取消 ")])),_:1}),e(E,{color:"teal-darken-1",variant:"outlined",loading:ye.submitting,class:"ms-2",onClick:Re},{default:a(()=>s[21]||(s[21]=[i(" 確定 ")])),_:1},8,["loading"])]),_:1})]),_:1}),e(ve,{modelValue:O.value.open,"onUpdate:modelValue":s[4]||(s[4]=o=>O.value.open=o),persistent:"","max-width":"400","no-click-animation":G.value},{default:a(()=>[e($,{class:"rounded-lg"},{default:a(()=>[d("div",Da,[e(y,{size:"20",color:"white",class:"me-2"},{default:a(()=>s[22]||(s[22]=[i(" mdi-content-copy ")])),_:1}),s[24]||(s[24]=i(" 複製權限 ")),e(C),e(E,{icon:"",color:"white",variant:"plain",class:"opacity-100",ripple:!1,size:"20",onClick:f},{default:a(()=>[e(y,null,{default:a(()=>s[23]||(s[23]=[i("mdi-close")])),_:1})]),_:1})]),e(F,{class:"mt-2 mb-0 px-6 pb-3"},{default:a(()=>[e(Me,{ref_key:"copyFormRef",ref:h,modelValue:L.value,"onUpdate:modelValue":s[3]||(s[3]=o=>L.value=o),onSubmit:Ne(ne,["prevent"])},{default:a(()=>[e(Z,null,{default:a(()=>[e(v,{cols:"12",class:"mb-1"},{default:a(()=>[d("div",ba,[d("span",Ca,[e(y,{size:"15",class:"me-2"},{default:a(()=>s[25]||(s[25]=[i(" mdi-information-outline ")])),_:1}),i(" 目標角色 : "+_(ae.value),1)])])]),_:1}),e(v,{cols:"12"},{default:a(()=>[e(Ve,{modelValue:R.value.sourceRoleId,"onUpdate:modelValue":s[1]||(s[1]=o=>R.value.sourceRoleId=o),items:B.value,"item-title":"name","item-value":"_id",label:"*選擇來源角色",variant:"outlined",density:"compact","hide-details":"",rules:[o=>!!o||"請選擇來源角色"],disabled:G.value},null,8,["modelValue","items","rules","disabled"])]),_:1}),e(v,{cols:"12",class:"px-2 py-0 copy-role-checkbox"},{default:a(()=>[e(be,{modelValue:R.value.replaceExisting,"onUpdate:modelValue":s[2]||(s[2]=o=>R.value.replaceExisting=o),label:"覆蓋當前角色的現有權限","hide-details":"",color:"blue-grey-darken-1",density:"compact",disabled:G.value},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e(Ee,{class:"px-0 mt-4"},{default:a(()=>[e(C),e(E,{color:"grey-darken-1",variant:"outlined",onClick:f},{default:a(()=>s[26]||(s[26]=[i(" 取消 ")])),_:1}),e(E,{color:"blue-grey-darken-1",variant:"outlined",type:"submit",class:"ms-2",loading:G.value},{default:a(()=>s[27]||(s[27]=[i(" 確認複製 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","no-click-animation"])]),_:1},8,["model-value"]))}},Ma=$e(Na,[["__scopeId","data-v-252eb08f"]]),Va={class:"py-2"},Sa={class:"text-center"},Ua={class:"text-center"},xa={class:"card-title px-8 py-4 bg-blue-grey-darken-2 d-flex align-center"},Ia={class:"card-title px-8 py-4 bg-blue-grey-darken-2 d-flex align-center"},Oa={class:"card-title px-6 py-4 bg-teal-darken-1 d-flex align-center"},Ga={class:"mb-4"},wa={__name:"permissionManagement",setup(ye){const N=Fe(),p=He(),{smAndUp:oe}=oa(),I=z(()=>oe.value?"default":"small"),M=m("roles"),O=m(""),h=m(""),L=m([]),G=m(!1),R=m({open:!1,id:null}),ee=m(null),V=m(!1),c=m(!1),ae=m(!1),B=m(null),w=m({open:!1,initialPermissions:[]}),D=m(null),A=m({code:"",name:"",module:"",action:"",resource:"",description:"",isActive:!0}),S=m([]),le=m(!1),b=m({open:!1,id:null}),Re=m(null),se=m(!1),te=m(!1),K=m(!1),Q=m(null),f=m({name:"",code:"",description:"",permissions:[],isActive:!0,level:0}),ne=m(!1),u=m(!1),s=m([]),o=m([]),r=z(()=>{const n=new Set,l=[];return L.value.forEach(g=>{const T=g&&g._id;T&&(n.has(T)||(n.add(T),l.push({name:g.name,_id:T})))}),l}),k=z(()=>S.value.filter(n=>n.isActive!==!1).map(n=>({name:n.name,_id:n._id}))),X=[{title:"權限代碼",key:"code",sortable:!0},{title:"權限名稱",key:"name",sortable:!0},{title:"模組",key:"module",sortable:!0},{title:"操作",key:"action",sortable:!0},{title:"資源",key:"resource",sortable:!0},{title:"描述",key:"description"},{title:"操作",key:"action",sortable:!1,align:"center"}],ie=[{title:"角色名稱",key:"name",sortable:!0},{title:"角色代碼",key:"code",sortable:!0},{title:"角色層級",key:"level",sortable:!0},{title:"描述",key:"description"},{title:"權限",key:"permissions"},{title:"操作",key:"action",sortable:!1,align:"center"}],re=[{title:"系統管理",value:"system"},{title:"公司管理",value:"company"},{title:"部門管理",value:"department"},{title:"員工相關",value:"employee"},{title:"行銷管理",value:"marketing"},{title:"硬體管理",value:"hardware"},{title:"專案管理",value:"project"},{title:"審計管理",value:"audit"}],H=[{title:"新增",value:"create"},{title:"查看",value:"read"},{title:"修改",value:"update"},{title:"刪除",value:"delete"},{title:"匯出",value:"export"},{title:"匯入",value:"import"},{title:"管理",value:"manage"},{title:"標註",value:"tag"}],ke=z(()=>O.value?L.value.filter(n=>n.name.toLowerCase().includes(O.value.toLowerCase())||n.code.toLowerCase().includes(O.value.toLowerCase())):L.value),Ae=z(()=>h.value?S.value.filter(n=>n.name.toLowerCase().includes(h.value.toLowerCase())||n.code.toLowerCase().includes(h.value.toLowerCase())):S.value),ge=async()=>{try{G.value=!0;const n=await N.getAllPermissions();L.value=n}catch(n){p({text:n.message||"載入權限失敗",snackbarProps:{color:"red"}})}finally{G.value=!1}},ue=async()=>{try{le.value=!0;const n=await N.getAllRoles();S.value=n}catch(n){p({text:n.message||"載入角色失敗",snackbarProps:{color:"red"}})}finally{le.value=!1}},We=n=>{Ue(n)},he=n=>{Q.value=n,K.value=!0},Be=n=>{Se(n)},Ke=n=>{B.value=n,ae.value=!0},Qe=async()=>{const n=B.value;if(n!=null&&n._id)try{await N.deletePermission(n._id),p({text:`已刪除權限：${n.name}`,snackbarProps:{color:"teal"}}),ae.value=!1,B.value=null,await ge()}catch(l){p({text:l.message||"刪除權限失敗",snackbarProps:{color:"red"}})}},Xe=async()=>{var l,g;const n=Q.value;if(n!=null&&n._id)try{await N.deleteRole(n._id),p({text:`已刪除角色：${n.name}`,snackbarProps:{color:"teal"}}),K.value=!1,Q.value=null,await ue()}catch(T){console.error("刪除角色失敗:",T);const U=((g=(l=T.response)==null?void 0:l.data)==null?void 0:g.message)||T.message||"刪除角色失敗";p({text:U,snackbarProps:{color:"red"}})}},Se=(n=null)=>{R.value.open=!0,R.value.id=(n==null?void 0:n._id)||null,n?A.value={code:n.code||"",name:n.name||"",module:n.module||"",action:n.action||"",resource:n.resource||"",description:n.description||"",isActive:n.isActive!==!1}:A.value={code:"",name:"",module:"",action:"",resource:"",description:"",isActive:!0}},Te=()=>{R.value.open=!1,R.value.id=null,A.value={code:"",name:"",module:"",action:"",resource:"",description:"",isActive:!0}},Ue=(n=null)=>{b.value.open=!0,b.value.id=(n==null?void 0:n._id)||null,n?f.value={name:n.name||"",code:n.code||"",description:n.description||"",permissions:n.permissions||[],isActive:n.isActive!==!1,level:n.level||0}:f.value={name:"",code:"",description:"",permissions:[],isActive:!0,level:0}},Pe=()=>{b.value.open=!1,b.value.id=null,f.value={name:"",code:"",description:"",permissions:[],isActive:!0,level:0}},je=n=>{D.value=n,w.value.initialPermissions=n.permissions||[],w.value.open=!0},qe=async n=>{const l=[];if(n.forEach(g=>{const T=L.value.find(U=>U.code===g);T&&l.push(T)}),b.value.open)f.value.permissions=l;else if(D.value)try{const g=D.value._id,T=l.map(Y=>Y._id);await N.updateRole(g,{name:D.value.name,code:D.value.code,description:D.value.description,level:D.value.level,permissions:T});const U=S.value.findIndex(Y=>Y._id===g);U!==-1&&(S.value[U].permissions=l),p({text:"角色權限已更新",snackbarProps:{color:"teal"}})}catch(g){console.error("更新角色權限失敗:",g),p({text:"更新角色權限失敗",snackbarProps:{color:"red"}})}w.value.open=!1,D.value=null},Je=async()=>{try{if(await ue(),D.value){const n=S.value.find(l=>l._id===D.value._id);n&&(D.value.permissions=n.permissions)}}catch{p({text:"更新權限失敗",snackbarProps:{color:"red"}})}},Ze=()=>{s.value=[],o.value=[],ne.value=!0},ea=()=>{o.value.length===k.value.length?o.value=[]:o.value=k.value.map(n=>n._id)},De=()=>{ne.value=!1,s.value=[],o.value=[]},aa=async()=>{if(!(!s.value||s.value.length===0)&&!(!o.value||o.value.length===0)){u.value=!0;try{const n=Array.from(new Set(s.value)),l=Array.from(new Set(o.value));let g=!1;for(const T of l)for(const U of n)try{await N.applyPermissionToRole(T,U)}catch(Y){Y.message&&Y.message.includes("角色已經擁有此權限")||(g=!0)}p(g?{text:"批次套用部分完成",snackbarProps:{color:"orange"}}:{text:"批次套用完成",snackbarProps:{color:"teal"}}),De(),await ue()}catch(n){p({text:n.message||"批次套用失敗",snackbarProps:{color:"red"}})}finally{u.value=!1}}},la=async()=>{if(V.value){c.value=!0;try{R.value.id?(await N.updatePermission(R.value.id,A.value),p({text:"權限更新成功",snackbarProps:{color:"teal"}})):(await N.createPermission(A.value),p({text:"權限新增成功",snackbarProps:{color:"teal"}})),Te(),await ge()}catch(n){p({text:n.message||"操作失敗",snackbarProps:{color:"red"}})}finally{c.value=!1}}},sa=async()=>{if(se.value){te.value=!0;try{const n={...f.value,permissions:f.value.permissions.map(l=>l._id||l)};b.value.id?(await N.updateRole(b.value.id,n),p({text:"角色更新成功",snackbarProps:{color:"teal"}})):(await N.createRole(n),p({text:"角色新增成功",snackbarProps:{color:"teal"}})),Pe(),await ue()}catch(n){p({text:n.message||"操作失敗",snackbarProps:{color:"red"}})}finally{te.value=!1}}};return ta(async()=>{await ge(),await ue()}),(n,l)=>(P(),x(ia,{"max-width":"1920"},{default:a(()=>{var g,T,U,Y;return[e(Z,{class:"elevation-4 rounded-lg py-4 py-sm-8 px-1 px-sm-10 mt-2 mt-sm-6 mx-0 mx-sm-4 mx-md-4 mb-4 bg-white"},{default:a(()=>[e(v,{cols:"12",class:"ps-3 pb-0"},{default:a(()=>l[28]||(l[28]=[d("h3",null,"權限管理",-1)])),_:1}),e(v,{cols:"12"},{default:a(()=>[e(ra,{modelValue:M.value,"onUpdate:modelValue":l[0]||(l[0]=t=>M.value=t),color:"teal-darken-1","align-tabs":"start"},{default:a(()=>[e(Oe,{value:"roles"},{default:a(()=>[e(y,{start:""},{default:a(()=>l[29]||(l[29]=[i(" mdi-account-group ")])),_:1}),l[30]||(l[30]=i(" 角色管理 "))]),_:1}),e(Oe,{value:"permissions"},{default:a(()=>[e(y,{start:""},{default:a(()=>l[31]||(l[31]=[i(" mdi-shield-account ")])),_:1}),l[32]||(l[32]=i(" 權限管理 "))]),_:1})]),_:1},8,["modelValue"]),e(ua,{modelValue:M.value,"onUpdate:modelValue":l[5]||(l[5]=t=>M.value=t)},{default:a(()=>[e(Ge,{value:"roles"},{default:a(()=>[e($,{flat:""},{default:a(()=>[e(F,{class:"px-0 pt-6"},{default:a(()=>[e(Z,{class:"pb-2"},{default:a(()=>[e(v,{cols:"12",md:"6"},{default:a(()=>[e(E,{"prepend-icon":"mdi-plus",color:"blue-grey-darken-2",variant:"outlined",onClick:l[1]||(l[1]=t=>Ue(null))},{default:a(()=>l[33]||(l[33]=[i(" 新增角色 ")])),_:1}),e(E,{class:"ms-3","prepend-icon":"mdi-shield-key",color:"teal-darken-2",variant:"outlined",onClick:Ze},{default:a(()=>l[34]||(l[34]=[i(" 一鍵套用 ")])),_:1})]),_:1}),e(C),e(v,{cols:"12",md:"3"},{default:a(()=>[e(W,{modelValue:h.value,"onUpdate:modelValue":l[2]||(l[2]=t=>h.value=t),"prepend-inner-icon":"mdi-magnify",label:"搜尋角色",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(we,{items:Ae.value,headers:ie,loading:le.value,hover:"",density:"compact",class:"mt-4 rounded-ts-lg rounded-te-lg"},{item:a(({item:t,index:de})=>[d("tr",{class:fe({"odd-row":de%2===0,"even-row":de%2!==0})},[d("td",null,_(t.name),1),d("td",null,_(t.code),1),d("td",null,_(t.level||0),1),d("td",null,_(t.description||"-"),1),d("td",Va,[e(E,{color:"teal-darken-2",variant:"outlined",size:"small","prepend-icon":"mdi-shield-account",onClick:j=>je(t)},{default:a(()=>{var j;return[l[35]||(l[35]=i(" 管理權限 ")),((j=t.permissions)==null?void 0:j.length)>0?(P(),x(J,{key:0,size:"x-small",density:"compact",color:"teal-darken-2",class:"ms-1 px-1"},{default:a(()=>[i(_(t.permissions.length),1)]),_:2},1024)):ce("",!0)]}),_:2},1032,["onClick"])]),d("td",Sa,[e(E,{icon:"",color:"light-blue-darken-4",variant:"plain",size:"22",class:"mx-2",ripple:!1,onClick:j=>We(t)},{default:a(()=>[e(y,null,{default:a(()=>l[36]||(l[36]=[i("mdi-pencil")])),_:1})]),_:2},1032,["onClick"]),e(E,{icon:"",color:"red-lighten-1",variant:"plain",size:"22",class:"mx-2",ripple:!1,onClick:j=>he(t)},{default:a(()=>[e(y,null,{default:a(()=>l[37]||(l[37]=[i("mdi-delete")])),_:1})]),_:2},1032,["onClick"])])],2)]),_:1},8,["items","loading"])]),_:1})]),_:1})]),_:1}),e(Ge,{value:"permissions"},{default:a(()=>[e($,{flat:""},{default:a(()=>[e(F,{class:"px-0 pt-6"},{default:a(()=>[e(Z,{class:"pb-2"},{default:a(()=>[e(v,{cols:"12",md:"6"},{default:a(()=>[e(E,{"prepend-icon":"mdi-plus",color:"blue-grey-darken-2",variant:"outlined",onClick:l[3]||(l[3]=t=>Se(null))},{default:a(()=>l[38]||(l[38]=[i(" 新增權限 ")])),_:1})]),_:1}),e(C),e(v,{cols:"12",md:"3"},{default:a(()=>[e(W,{modelValue:O.value,"onUpdate:modelValue":l[4]||(l[4]=t=>O.value=t),"prepend-inner-icon":"mdi-magnify",label:"搜尋權限",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(we,{items:ke.value,headers:X,loading:G.value,hover:"",density:"compact",class:"mt-4 rounded-ts-lg rounded-te-lg"},{item:a(({item:t,index:de})=>[d("tr",{class:fe({"odd-row":de%2===0,"even-row":de%2!==0})},[d("td",null,_(t.code),1),d("td",null,_(t.name),1),d("td",null,_(t.module),1),d("td",null,_(t.action),1),d("td",null,_(t.resource),1),d("td",null,_(t.description||"-"),1),d("td",Ua,[e(E,{icon:"",color:"light-blue-darken-4",variant:"plain",size:"22",class:"mx-2",ripple:!1,onClick:j=>Be(t)},{default:a(()=>[e(y,null,{default:a(()=>l[39]||(l[39]=[i(" mdi-pencil ")])),_:1})]),_:2},1032,["onClick"]),e(E,{icon:"",color:"red-lighten-1",variant:"plain",size:"22",class:"mx-2",ripple:!1,onClick:j=>Ke(t)},{default:a(()=>[e(y,null,{default:a(()=>l[40]||(l[40]=[i("mdi-delete")])),_:1})]),_:2},1032,["onClick"])])],2)]),_:1},8,["items","loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(ze,{modelValue:ae.value,"onUpdate:modelValue":l[6]||(l[6]=t=>ae.value=t),"dialog-width":"320",title:"確認刪除",message:`確定要刪除權限「<span class='text-red'>${((g=B.value)==null?void 0:g.name)||""}</span>」嗎？<br/>代碼：${((T=B.value)==null?void 0:T.code)||""}`,"confirm-button-color":"red-darken-1","cancel-button-color":"grey-darken-1",onConfirm:Qe},null,8,["modelValue","message"]),e(ze,{modelValue:K.value,"onUpdate:modelValue":l[7]||(l[7]=t=>K.value=t),"dialog-width":"320",title:"確認刪除角色",message:`確定要刪除角色「<span class='text-red'>${((U=Q.value)==null?void 0:U.name)||""}</span>」嗎？<br/>代碼：${((Y=Q.value)==null?void 0:Y.code)||""}<br/><br/><span class='text-orange-darken-2'>注意：如果此角色正在被用戶使用，將無法刪除。</span>`,"confirm-button-color":"red-darken-1","cancel-button-color":"grey-darken-1",onConfirm:Xe},null,8,["modelValue","message"]),e(ve,{modelValue:R.value.open,"onUpdate:modelValue":l[16]||(l[16]=t=>R.value.open=t),persistent:"","max-width":"800","no-click-animation":c.value},{default:a(()=>[e($,{class:"rounded-lg"},{default:a(()=>[d("div",xa,[e(y,{size:"20",color:"white",class:"me-2"},{default:a(()=>l[41]||(l[41]=[i(" mdi-shield-account ")])),_:1}),i(" "+_(R.value.id?"編輯權限":"新增權限")+" ",1),e(C),e(E,{icon:"",color:"white",variant:"plain",class:"opacity-100",ripple:!1,size:"20",onClick:Te},{default:a(()=>[e(y,null,{default:a(()=>l[42]||(l[42]=[i("mdi-close")])),_:1})]),_:1})]),e(F,{class:"mt-4 mb-0 px-6"},{default:a(()=>[e(Me,{ref_key:"permissionFormRef",ref:ee,modelValue:V.value,"onUpdate:modelValue":l[15]||(l[15]=t=>V.value=t),onSubmit:Ne(la,["prevent"])},{default:a(()=>[e(Z,null,{default:a(()=>[e(v,{cols:"12",class:"sub-title text-blue-grey-darken-2 d-flex align-center justify-center"},{default:a(()=>[e(Z,null,{default:a(()=>[e(v,{cols:"3",sm:"5",class:"d-flex align-center justify-center"},{default:a(()=>[e(Ce,{class:"border-opacity-25",color:"blue-grey-darken-2"})]),_:1}),e(v,{cols:"6",sm:"2",class:"d-flex align-center justify-center"},{default:a(()=>[e(y,{size:"18",class:"me-2"},{default:a(()=>l[43]||(l[43]=[i(" mdi-shield-key ")])),_:1}),l[44]||(l[44]=i(" 權限資訊 "))]),_:1}),e(v,{cols:"3",sm:"5",class:"d-flex align-center justify-center"},{default:a(()=>[e(Ce,{class:"border-opacity-25",color:"blue-grey-darken-2"})]),_:1})]),_:1})]),_:1}),e(v,{cols:"12",sm:"6"},{default:a(()=>[e(W,{modelValue:A.value.code,"onUpdate:modelValue":l[8]||(l[8]=t=>A.value.code=t),label:"*權限代碼",variant:"outlined",density:"compact",rules:[t=>!!t||"請輸入權限代碼"]},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12",sm:"6"},{default:a(()=>[e(W,{modelValue:A.value.name,"onUpdate:modelValue":l[9]||(l[9]=t=>A.value.name=t),label:"*權限名稱",variant:"outlined",density:"compact",rules:[t=>!!t||"請輸入權限名稱"]},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12",sm:"6"},{default:a(()=>[e(Ve,{modelValue:A.value.module,"onUpdate:modelValue":l[10]||(l[10]=t=>A.value.module=t),items:re,label:"*所屬模組",variant:"outlined",density:"compact",rules:[t=>!!t||"請選擇模組"]},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12",sm:"6"},{default:a(()=>[e(Ve,{modelValue:A.value.action,"onUpdate:modelValue":l[11]||(l[11]=t=>A.value.action=t),items:H,label:"*操作類型",variant:"outlined",density:"compact",rules:[t=>!!t||"請選擇操作類型"]},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12",sm:"6"},{default:a(()=>[e(W,{modelValue:A.value.resource,"onUpdate:modelValue":l[12]||(l[12]=t=>A.value.resource=t),label:"*資源類型",variant:"outlined",density:"compact",rules:[t=>!!t||"請輸入資源類型"]},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12",sm:"6"},{default:a(()=>[e(_e,{modelValue:A.value.isActive,"onUpdate:modelValue":l[13]||(l[13]=t=>A.value.isActive=t),label:"啟用狀態",color:"teal-darken-1","hide-details":""},null,8,["modelValue"])]),_:1}),e(v,{cols:"12"},{default:a(()=>[e(Le,{modelValue:A.value.description,"onUpdate:modelValue":l[14]||(l[14]=t=>A.value.description=t),label:"描述",variant:"outlined",density:"compact",rows:"3",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(Ee,{class:"px-3 mt-4"},{default:a(()=>[e(C),e(E,{color:"grey-darken-1",variant:"outlined",size:I.value,onClick:Te},{default:a(()=>l[45]||(l[45]=[i(" 取消 ")])),_:1},8,["size"]),e(E,{color:"teal-darken-1",variant:"outlined",type:"submit",class:"ms-2",size:I.value,loading:c.value},{default:a(()=>[i(_(R.value.id?"修改":"新增"),1)]),_:1},8,["size","loading"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","no-click-animation"]),e(ve,{modelValue:b.value.open,"onUpdate:modelValue":l[23]||(l[23]=t=>b.value.open=t),persistent:"","max-width":"800","no-click-animation":te.value},{default:a(()=>[e($,{class:"rounded-lg"},{default:a(()=>[d("div",Ia,[e(y,{size:"20",color:"white",class:"me-2"},{default:a(()=>l[46]||(l[46]=[i(" mdi-account-group ")])),_:1}),i(" "+_(b.value.id?"編輯角色":"新增角色")+" ",1),e(C),e(E,{icon:"",color:"white",variant:"plain",class:"opacity-100",ripple:!1,size:"20",onClick:Pe},{default:a(()=>[e(y,null,{default:a(()=>l[47]||(l[47]=[i("mdi-close")])),_:1})]),_:1})]),e(F,{class:"mt-4 mb-0 px-6 pb-4"},{default:a(()=>[e(Me,{ref_key:"roleFormRef",ref:Re,modelValue:se.value,"onUpdate:modelValue":l[22]||(l[22]=t=>se.value=t),onSubmit:Ne(sa,["prevent"])},{default:a(()=>[e(Z,null,{default:a(()=>[e(v,{cols:"12",sm:"6"},{default:a(()=>[e(W,{modelValue:f.value.name,"onUpdate:modelValue":l[17]||(l[17]=t=>f.value.name=t),label:"*角色名稱",variant:"outlined",density:"compact",rules:[t=>!!t||"請輸入角色名稱"]},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12",sm:"6"},{default:a(()=>[e(W,{modelValue:f.value.code,"onUpdate:modelValue":l[18]||(l[18]=t=>f.value.code=t),label:"*角色代碼",variant:"outlined",density:"compact",rules:[t=>!!t||"請輸入角色代碼"]},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12",sm:"6"},{default:a(()=>[e(W,{modelValue:f.value.level,"onUpdate:modelValue":l[19]||(l[19]=t=>f.value.level=t),label:"角色層級",variant:"outlined",density:"compact",type:"number",min:"0",hint:"數字越大權限越高","persistent-hint":""},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",sm:"6"},{default:a(()=>[e(_e,{modelValue:f.value.isActive,"onUpdate:modelValue":l[20]||(l[20]=t=>f.value.isActive=t),label:"啟用狀態",color:"teal-darken-1","hide-details":""},null,8,["modelValue"])]),_:1}),e(v,{cols:"12"},{default:a(()=>[e(Le,{modelValue:f.value.description,"onUpdate:modelValue":l[21]||(l[21]=t=>f.value.description=t),label:"描述",variant:"outlined",density:"compact",rows:"2","no-resize":"",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(Ee,{class:"px-0"},{default:a(()=>[e(C),e(E,{color:"grey-darken-1",variant:"outlined",size:I.value,onClick:Pe},{default:a(()=>l[48]||(l[48]=[i(" 取消 ")])),_:1},8,["size"]),e(E,{color:"teal-darken-1",variant:"outlined",type:"submit",class:"ms-2",size:I.value,loading:te.value},{default:a(()=>[i(_(b.value.id?"修改":"新增"),1)]),_:1},8,["size","loading"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","no-click-animation"]),e(Ma,{modelValue:w.value.open,"onUpdate:modelValue":l[24]||(l[24]=t=>w.value.open=t),permissions:D.value?D.value.permissions:f.value.permissions,submitting:c.value,"current-role":D.value,onSave:qe,onCopy:Je},null,8,["modelValue","permissions","submitting","current-role"]),e(ve,{modelValue:ne.value,"onUpdate:modelValue":l[27]||(l[27]=t=>ne.value=t),"max-width":"480","no-click-animation":u.value},{default:a(()=>[e($,{class:"rounded-lg"},{default:a(()=>[d("div",Oa,[e(y,{size:"20",color:"white",class:"me-2"},{default:a(()=>l[49]||(l[49]=[i(" mdi-shield-key ")])),_:1}),l[51]||(l[51]=i(" 一鍵套用權限 ")),e(C),e(E,{icon:"",color:"white",variant:"plain",class:"opacity-100",ripple:!1,size:"20",onClick:De},{default:a(()=>[e(y,null,{default:a(()=>l[50]||(l[50]=[i("mdi-close")])),_:1})]),_:1})]),e(F,{class:"mt-3 mb-0 pb-3 px-6"},{default:a(()=>[l[52]||(l[52]=d("div",{class:"mb-6 text-teal-darken-2 font-weight-bold"}," * 選擇權限後，再選擇要套用的角色。 ",-1)),d("div",Ga,[e(Ye,{modelValue:s.value,"onUpdate:modelValue":l[25]||(l[25]=t=>s.value=t),items:r.value,"item-title":"name","item-value":"_id",label:"選擇權限（可搜尋，可多選）",multiple:"",chips:"","closable-chips":"",variant:"outlined",density:"compact",clearable:"",rules:[t=>t&&t.length>0||"請選擇至少一個權限"]},null,8,["modelValue","items","rules"])]),d("div",null,[e(Ye,{modelValue:o.value,"onUpdate:modelValue":l[26]||(l[26]=t=>o.value=t),items:k.value,"item-title":"name","item-value":"_id",label:"選擇角色（可搜尋，可多選）",multiple:"",chips:"","closable-chips":"",variant:"outlined",density:"compact",clearable:"",rules:[t=>t&&t.length>0||"請選擇至少一個角色"]},{"prepend-item":a(()=>[e(da,{title:"全選",color:"teal-darken-1","prepend-icon":"mdi-checkbox-multiple-marked",active:o.value.length===k.value.length,onClick:ea},null,8,["active"]),e(Ce,{class:"mt-2"})]),_:1},8,["modelValue","items","rules"])])]),_:1}),e(Ee,{class:"px-6 pb-5"},{default:a(()=>[e(C),e(E,{color:"grey-darken-1",variant:"outlined",size:I.value,onClick:De},{default:a(()=>l[53]||(l[53]=[i(" 取消 ")])),_:1},8,["size"]),e(E,{color:"teal-darken-1",variant:"outlined",size:I.value,loading:u.value,disabled:u.value||s.value.length===0||o.value.length===0,onClick:aa},{default:a(()=>l[54]||(l[54]=[i(" 套用 ")])),_:1},8,["size","loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue","no-click-animation"])]}),_:1}))}},tl=$e(wa,[["__scopeId","data-v-92c54110"]]);export{tl as default};

import{r as m,f as ve,w as qe,k as ze,aV as H,Z as Se,bH as s,a8 as t,a0 as l,$ as X,bf as c,aH as Q,a7 as u,F as ye,b0 as De,_ as We,u as g,bM as he}from"./@vue-Cr_z6yfx.js";import{i as Ae}from"./vuetify-use-dialog-C5oZ13xz.js";import{_ as $e,b as Me}from"./index-mGnb0KKF.js";import{q as Qe,Q as Ue,w as q,f as z,d as ee,O as we,g as b,r as _,v as ae,a as te,b as se,c as re,U as be,a1 as _e,e as le,V as oe,P as Fe}from"./vuetify-CbddcmEc.js";import"./perfect-debounce-Cp2ysxOb.js";import"./hookable-B8xFkYCm.js";/* empty css             */import"./pinia-DBRIaiZ_.js";import"./vue-demi-Dq6ymT-8.js";import"./pinia-plugin-persistedstate-RV7uh3T-.js";import"./vue-router-CS4OewbW.js";import"./jspdf-DacfHTdZ.js";import"./core-js-D2hAHviU.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./unplugin-vue-router-B1N3mqWX.js";import"./axios-upsvKRUO.js";import"./vue3-google-login-Dx7TV_Hx.js";import"./vue-easy-lightbox-D952uME8.js";const Te=["rowspan"],je={class:"sub-title"},Be=["rowspan"],He={class:"sub-title"},Ee={class:"font-weight-bold"},Le={class:"warehouse-col right-group pa-2 text-center"},Oe={class:"quantity-col right-group text-center pa-2"},Re={class:"font-weight-bold"},Ge={class:"actions-col right-group text-center pa-2"},Ye={class:"card-title text-white"},Ze={class:"mb-6 mt-3 rounded"},Je={class:"card-title"},Ke={class:"font-weight-bold me-3 text-grey-darken-3"},Xe={class:"text-teal-darken-1"},ea={class:"font-weight-bold me-3 text-grey-darken-3"},aa={class:"text-teal-darken-1"},ta={class:"font-weight-bold me-3 text-grey-darken-3"},sa={class:"text-teal-darken-1"},ra={class:"mb-6 mt-3 rounded"},la={class:"card-title"},oa={class:"font-weight-bold me-3 text-grey-darken-3"},na={class:"text-orange-darken-1"},ia={class:"font-weight-bold me-3 text-grey-darken-3"},ua={class:"text-orange-darken-1"},da={class:"font-weight-bold me-3 text-grey-darken-3"},pa={class:"text-orange-darken-1"},ca={class:"mb-6 mt-3 rounded"},ma={class:"card-title"},fa={class:"font-weight-bold me-3 text-grey-darken-3"},ga={class:"text-blue-grey-darken-2"},va={class:"font-weight-bold me-3 text-grey-darken-3"},ya={class:"text-blue-grey-darken-2"},ha={__name:"sparePartInventoryManagement",setup(wa){const{apiAuth:U}=Me(),{smAndUp:f}=Qe(),S=Ae(),E=m(!1),D=m([]),L=m(1),ke=m(10),W=m(""),xe=[{title:"備品名稱",key:"sparePartName",sortable:!1,align:"center"},{title:"總數量",key:"totalQuantity",sortable:!1,align:"center"},{title:"倉庫",key:"warehouse",sortable:!1,align:"center"},{title:"倉庫數量",key:"quantity",sortable:!1,align:"center"},{title:"操作",key:"action",sortable:!1,align:"center"}],O=ve(()=>{const r={};let e=0;const a=new Map;D.value.forEach(n=>{var w,x,P,M;const d=(x=(w=n.sparePart)==null?void 0:w._id)==null?void 0:x.toString(),h=(M=(P=n.warehouse)==null?void 0:P._id)==null?void 0:M.toString();if(d&&h){const I=`${d}_${h}`;a.set(I,n)}}),R.value.filter(n=>n.isActive!==!1).forEach(n=>{var w;const d=(w=n._id)==null?void 0:w.toString();if(!d)return;r[d]||(r[d]={sparePartId:d,sparePartName:n.name||"",warehouses:[],totalQuantity:0,isGroup:!0,index:e++,order:n.order||0,createdAt:n.createdAt||null}),(n.warehouses||[]).forEach(x=>{var ge;const P=(ge=x._id||x)==null?void 0:ge.toString();if(!P)return;const M=`${d}_${P}`,I=a.get(M),j={warehouseId:P,warehouseName:x.name||"",inventoryId:(I==null?void 0:I._id)||null,quantity:(I==null?void 0:I.quantity)||0,warehouse:{_id:P,name:x.name||"",order:x.order||0}};r[d].warehouses.push(j),r[d].totalQuantity+=j.quantity})}),Object.values(r).forEach(n=>{n.warehouses.sort((d,h)=>{var I,j;const w=((I=d.warehouse)==null?void 0:I.order)||0,x=((j=h.warehouse)==null?void 0:j.order)||0;if(w!==x)return w-x;const P=d.warehouseName||"",M=h.warehouseName||"";return P.localeCompare(M)})});const o=Object.values(r);o.sort((n,d)=>{const h=n.order||0,w=d.order||0;return h!==w?h-w:new Date(n.createdAt||0)-new Date(d.createdAt||0)});let p=0,i=o.map(n=>{const d={...n,warehouseCount:n.warehouses.length,globalStartIndex:p};return p+=n.warehouses.length,d});if(W.value&&W.value.trim()){const n=W.value.trim().toLowerCase();i=i.filter(d=>d.sparePartName.toLowerCase().includes(n)),p=0,i=i.map(d=>{const h={...d,globalStartIndex:p};return p+=d.warehouses.length,h})}return i}),R=m([]),v=m({open:!1,sparePartId:"",sparePartName:"",warehouseId:"",warehouseName:"",inventoryId:null,currentQuantity:0}),A=m(null),ne=m(!1),F=m(!1),V=m({quantityChange:null,note:""}),y=m({open:!1,sparePartId:"",sparePartName:"",fromWarehouseId:"",fromWarehouseName:"",currentQuantity:0,sparePartWarehouses:[]}),$=m(null),ie=m(!1),T=m(!1),k=m({toWarehouseId:null,quantity:null,note:""}),Ie=ve(()=>y.value.sparePartWarehouses.filter(r=>{var a;const e=r.warehouseId||((a=r.warehouse)==null?void 0:a._id)||r._id;return e&&e.toString()!==y.value.fromWarehouseId.toString()}).map(r=>{var e,a,o;return{_id:r.warehouseId||((e=r.warehouse)==null?void 0:e._id)||r._id,name:r.warehouseName||((a=r.warehouse)==null?void 0:a.name)||r.name,order:((o=r.warehouse)==null?void 0:o.order)||r.order||0}}).sort((r,e)=>r.order!==e.order?r.order-e.order:(r.name||"").localeCompare(e.name||""))),C=m({open:!1,inventoryId:"",sparePartName:"",warehouseName:""}),B=m([]),G=m(!1),Y=m(1),Pe=m(25),Ve=[{title:"操作者",key:"createdBy",sortable:!1},{title:"操作",key:"action",sortable:!1},{title:"數量變更",key:"quantityChange",sortable:!1,align:"center"},{title:"調整後數量",key:"quantity",sortable:!1,align:"center"},{title:"備註",key:"note",sortable:!1,align:"center"},{title:"時間",key:"createdAt",sortable:!1,align:"center"}],Z=async()=>{var r,e;try{E.value=!0;const{data:a}=await U.get("/spareParts",{params:{activeOnly:"true",page:1,itemsPerPage:9999}});if(!a.success)throw new Error("載入備品列表失敗");R.value=a.result.data||[];const o=[];for(const p of R.value){const{data:i}=await U.get(`/sparePartInventories/spare-part/${p._id}`);i.success&&i.result.data&&i.result.data.length>0&&o.push(...i.result.data.map(n=>({_id:n._id,sparePart:{_id:p._id,name:p.name,order:p.order||0,createdAt:p.createdAt},warehouse:n.warehouse?{...n.warehouse,order:n.warehouse.order||0}:null,quantity:n.quantity||0,lastModifier:n.lastModifier})))}D.value=o}catch(a){console.error("載入庫存資料失敗:",a),S({text:((e=(r=a.response)==null?void 0:r.data)==null?void 0:e.message)||"載入庫存資料失敗",snackbarProps:{color:"red-lighten-1"}})}finally{E.value=!1}},ue=(r,e)=>{v.value={open:!0,sparePartId:r.sparePartId||r._id||"",sparePartName:r.sparePartName||r.name||"",warehouseId:e.warehouseId||e._id||"",warehouseName:e.warehouseName||e.name||"",inventoryId:e.inventoryId||null,currentQuantity:e.quantity||0},V.value={quantityChange:null,note:""},A.value&&A.value.reset()},J=()=>{v.value={open:!1,sparePartId:"",sparePartName:"",warehouseId:"",warehouseName:"",inventoryId:null,currentQuantity:0},V.value={quantityChange:null,note:""},A.value&&A.value.reset()},de=async()=>{var e,a;const{valid:r}=await A.value.validate();if(r)try{F.value=!0;const{data:o}=await U.post("/sparePartInventories/adjust",{sparePart:v.value.sparePartId,warehouse:v.value.warehouseId,quantityChange:V.value.quantityChange,note:V.value.note||""});if(o.success){const p=D.value.findIndex(i=>{var n,d,h,w;return i._id===o.result._id||((d=(n=i.sparePart)==null?void 0:n._id)==null?void 0:d.toString())===v.value.sparePartId.toString()&&((w=(h=i.warehouse)==null?void 0:h._id)==null?void 0:w.toString())===v.value.warehouseId.toString()});if(p>=0){const i=D.value[p];D.value[p]={_id:o.result._id,sparePart:i.sparePart||{_id:v.value.sparePartId,name:v.value.sparePartName},warehouse:o.result.warehouse||i.warehouse,quantity:o.result.quantity||0,lastModifier:o.result.lastModifier}}else D.value.push({_id:o.result._id,sparePart:{_id:v.value.sparePartId,name:v.value.sparePartName},warehouse:o.result.warehouse,quantity:o.result.quantity||0,lastModifier:o.result.lastModifier});S({text:"庫存調整成功",snackbarProps:{color:"teal-lighten-1"}}),J(),await Z()}}catch(o){console.error("調整庫存失敗:",o),S({text:((a=(e=o.response)==null?void 0:e.data)==null?void 0:a.message)||"調整庫存失敗",snackbarProps:{color:"red-lighten-1"}})}finally{F.value=!1}},pe=async(r,e)=>{C.value={open:!0,inventoryId:e.inventoryId||null,sparePartName:r.sparePartName||r.name||"",warehouseName:e.warehouseName||e.name||""},await Ce()},Ce=async()=>{var r,e;try{if(G.value=!0,!C.value.inventoryId){B.value=[];return}const{data:a}=await U.get(`/sparePartInventories/${C.value.inventoryId}/history`);a.success&&(B.value=a.result.data||[])}catch(a){console.error("載入歷史紀錄失敗:",a),S({text:((e=(r=a.response)==null?void 0:r.data)==null?void 0:e.message)||"載入歷史紀錄失敗",snackbarProps:{color:"red-lighten-1"}})}finally{G.value=!1}},ce=async(r,e)=>{const a=O.value.find(o=>{var p,i;return((p=o.sparePartId||o._id)==null?void 0:p.toString())===((i=r.sparePartId||r._id)==null?void 0:i.toString())});y.value={open:!0,sparePartId:r.sparePartId||r._id||"",sparePartName:r.sparePartName||r.name||"",fromWarehouseId:e.warehouseId||e._id||"",fromWarehouseName:e.warehouseName||e.name||"",currentQuantity:e.quantity||0,sparePartWarehouses:(a==null?void 0:a.warehouses)||[]},k.value={toWarehouseId:null,quantity:null,note:""},$.value&&$.value.reset()},K=()=>{y.value={open:!1,sparePartId:"",sparePartName:"",fromWarehouseId:"",fromWarehouseName:"",currentQuantity:0,sparePartWarehouses:[]},k.value={toWarehouseId:null,quantity:null,note:""},$.value&&$.value.reset()},me=async()=>{var e,a;const{valid:r}=await $.value.validate();if(r)try{T.value=!0;const{data:o}=await U.post("/sparePartInventories/transfer",{sparePart:y.value.sparePartId,fromWarehouse:y.value.fromWarehouseId,toWarehouse:k.value.toWarehouseId,quantity:k.value.quantity,note:k.value.note||""});o.success&&(S({text:"轉倉成功",snackbarProps:{color:"orange-darken-1"}}),K(),await Z())}catch(o){console.error("轉倉失敗:",o),S({text:((a=(e=o.response)==null?void 0:e.data)==null?void 0:a.message)||"轉倉失敗",snackbarProps:{color:"red-lighten-1"}})}finally{T.value=!1}},fe=()=>{C.value={open:!1,inventoryId:"",sparePartName:"",warehouseName:""},B.value=[],Y.value=1},N=r=>r==null||r===""?"0":new Intl.NumberFormat("zh-TW").format(r),Ne=r=>{if(!r)return"-";const e=new Date(r),a=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),p=String(e.getDate()).padStart(2,"0"),i=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0");return`${a}/${o}/${p} ${i}:${n}`};return qe(W,()=>{L.value=1}),ze(async()=>{await Z()}),(r,e)=>(H(),Se(Ue,{"max-width":"1920"},{default:s(()=>[t(ae,{class:"elevation-4 rounded-lg py-4 py-sm-8 px-1 px-sm-10 mt-2 mt-sm-6 mx-0 mx-sm-4 mx-md-4 mb-4 bg-white"},{default:s(()=>[t(q,{cols:"5",class:"ps-3 d-flex align-center"},{default:s(()=>e[13]||(e[13]=[l("h3",null,"備品庫存管理",-1)])),_:1}),t(z),t(q,{cols:"7",sm:"5",md:"4",lg:"3",xl:"2",class:"ps-3"},{default:s(()=>[t(ee,{modelValue:W.value,"onUpdate:modelValue":e[0]||(e[0]=a=>W.value=a),label:"快速搜尋",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-magnify",clearable:"","hide-details":""},null,8,["modelValue"])]),_:1}),t(q,{cols:"12"},{default:s(()=>[t(we,{items:O.value,headers:xe,loading:E.value,density:"compact",class:"inventory-table mt-4 rounded-ts-lg rounded-te-lg","items-per-page":ke.value,page:L.value,"onUpdate:page":e[1]||(e[1]=a=>L.value=a)},{item:s(({item:a})=>{var o,p;return[a.isGroup?(H(),X(ye,{key:0},[l("tr",{class:Q({"group-header-odd":a.index%2===0,"group-header-even":a.index%2!==0,"is-last-group":a.index===O.value.length-1})},[l("td",{rowspan:a.warehouseCount,class:"spare-part-col left-group align-top pa-4 text-center"},[l("span",je,c(a.sparePartName),1)],8,Te),l("td",{rowspan:a.warehouseCount,class:"total-quantity-col left-group align-top pa-4 text-center"},[l("span",He,c(N(a.totalQuantity)),1)],8,Be),l("td",{class:Q(["warehouse-col right-group pa-2 text-center",a.globalStartIndex%2===0?"warehouse-row-odd":"warehouse-row-even"])},c(((o=a.warehouses[0])==null?void 0:o.warehouseName)||"-"),3),l("td",{class:Q(["quantity-col right-group text-center pa-2",a.globalStartIndex%2===0?"warehouse-row-odd":"warehouse-row-even"])},[l("span",Ee,c(N(((p=a.warehouses[0])==null?void 0:p.quantity)||0)),1)],2),l("td",{class:Q(["actions-col right-group text-center pa-2",a.globalStartIndex%2===0?"warehouse-row-odd":"warehouse-row-even"])},[t(b,{icon:"",color:"blue-grey-darken-2",variant:"plain",size:"22",class:"me-2",ripple:!1,onClick:i=>pe(a,a.warehouses[0])},{default:s(()=>[t(_,null,{default:s(()=>e[14]||(e[14]=[u("mdi-history")])),_:1})]),_:2},1032,["onClick"]),t(b,{icon:"",color:"orange-darken-3",variant:"plain",size:"22",class:"mx-1",ripple:!1,onClick:i=>ce(a,a.warehouses[0])},{default:s(()=>[t(_,null,{default:s(()=>e[15]||(e[15]=[u("mdi-swap-horizontal")])),_:1})]),_:2},1032,["onClick"]),t(b,{icon:"",color:"teal-darken-1",variant:"plain",size:"22",class:"ms-2",ripple:!1,onClick:i=>ue(a,a.warehouses[0])},{default:s(()=>[t(_,null,{default:s(()=>e[16]||(e[16]=[u("mdi-pencil")])),_:1})]),_:2},1032,["onClick"])],2)],2),(H(!0),X(ye,null,De(a.warehouses.slice(1),(i,n)=>(H(),X("tr",{key:i.inventoryId||n,class:Q({"warehouse-row-odd":(a.globalStartIndex+n+1)%2===0,"warehouse-row-even":(a.globalStartIndex+n+1)%2!==0})},[l("td",Le,c(i.warehouseName||"-"),1),l("td",Oe,[l("span",Re,c(N(i.quantity||0)),1)]),l("td",Ge,[t(b,{icon:"",color:"blue-grey-darken-2",variant:"plain",size:"22",class:"me-2",ripple:!1,onClick:d=>pe(a,i)},{default:s(()=>[t(_,null,{default:s(()=>e[17]||(e[17]=[u("mdi-history")])),_:1})]),_:2},1032,["onClick"]),t(b,{icon:"",color:"orange-darken-3",variant:"plain",size:"22",class:"mx-1",ripple:!1,onClick:d=>ce(a,i)},{default:s(()=>[t(_,null,{default:s(()=>e[18]||(e[18]=[u("mdi-swap-horizontal")])),_:1})]),_:2},1032,["onClick"]),t(b,{icon:"",color:"teal-darken-1",variant:"plain",size:"22",class:"ms-2",ripple:!1,onClick:d=>ue(a,i)},{default:s(()=>[t(_,null,{default:s(()=>e[19]||(e[19]=[u("mdi-pencil")])),_:1})]),_:2},1032,["onClick"])])],2))),128))],64)):We("",!0)]}),_:1},8,["items","loading","items-per-page","page"])]),_:1})]),_:1}),t(oe,{modelValue:v.value.open,"onUpdate:modelValue":e[5]||(e[5]=a=>v.value.open=a),persistent:"",width:"600",fullscreen:!g(f),"no-click-animation":F.value},{default:s(()=>[t(te,{class:"rounded-lg"},{default:s(()=>[t(se,{class:"d-flex align-center px-6 py-2 bg-teal-darken-1"},{default:s(()=>[t(_,{size:g(f)?"20":"18",color:"white",class:"me-2"},{default:s(()=>e[20]||(e[20]=[u(" mdi-pencil ")])),_:1},8,["size"]),l("span",Ye,c(v.value.inventoryId?"調整庫存":"新增庫存"),1),t(z),t(b,{icon:"",variant:"plain",class:"opacity-100",ripple:!1,color:"white",size:g(f)?"36":"32",onClick:J},{default:s(()=>[t(_,{size:g(f)?"22":"18"},{default:s(()=>e[21]||(e[21]=[u(" mdi-close ")])),_:1},8,["size"])]),_:1},8,["size"])]),_:1}),t(re,{class:"px-6 pt-3 pb-5"},{default:s(()=>[l("div",Ze,[l("div",Je,[l("span",Ke,[e[22]||(e[22]=u("備品 : ")),l("span",Xe,c(v.value.sparePartName||"-"),1)]),l("span",ea,[e[23]||(e[23]=u("倉庫 : ")),l("span",aa,c(v.value.warehouseName||"-"),1)]),l("span",ta,[e[24]||(e[24]=u("目前數量 : ")),l("span",sa,c(N(v.value.currentQuantity||0)),1)])])]),t(be,{ref_key:"adjustForm",ref:A,modelValue:ne.value,"onUpdate:modelValue":e[4]||(e[4]=a=>ne.value=a),disabled:F.value,onSubmit:he(de,["prevent"])},{default:s(()=>[t(ae,null,{default:s(()=>[t(q,{cols:"12"},{default:s(()=>[t(ee,{modelValue:V.value.quantityChange,"onUpdate:modelValue":e[2]||(e[2]=a=>V.value.quantityChange=a),modelModifiers:{number:!0},label:"*數量變更",variant:"outlined",density:"compact",type:"number",rules:[a=>a!=null&&a!==""||"請輸入數量變更",a=>a!==0||"數量變更不能為0"],hint:"正數為增加，負數為減少","persistent-hint":""},null,8,["modelValue","rules"])]),_:1}),t(q,{cols:"12"},{default:s(()=>[t(_e,{modelValue:V.value.note,"onUpdate:modelValue":e[3]||(e[3]=a=>V.value.note=a),label:"備註",variant:"outlined",density:"compact","hide-details":"",rows:"3",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),t(le,{class:"px-6 pb-5 pt-0"},{default:s(()=>[t(z),t(b,{variant:"outlined",color:"grey-darken-1",size:g(f)?"default":"small",onClick:J},{default:s(()=>e[25]||(e[25]=[u(" 取消 ")])),_:1},8,["size"]),t(b,{color:"teal-darken-1",variant:"outlined",class:"ms-2",size:g(f)?"default":"small",loading:F.value,onClick:de},{default:s(()=>e[26]||(e[26]=[u(" 確認 ")])),_:1},8,["size","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue","fullscreen","no-click-animation"]),t(oe,{modelValue:y.value.open,"onUpdate:modelValue":e[10]||(e[10]=a=>y.value.open=a),persistent:"",width:"600",fullscreen:!g(f),"no-click-animation":T.value},{default:s(()=>[t(te,{class:"rounded-lg"},{default:s(()=>[t(se,{class:"d-flex align-center px-6 py-2 bg-orange-darken-2"},{default:s(()=>[t(_,{size:g(f)?"20":"18",color:"white",class:"me-2"},{default:s(()=>e[27]||(e[27]=[u(" mdi-swap-horizontal ")])),_:1},8,["size"]),e[29]||(e[29]=l("span",{class:"card-title text-white"},"轉倉",-1)),t(z),t(b,{icon:"",variant:"plain",class:"opacity-100",ripple:!1,color:"white",size:g(f)?"36":"32",onClick:K},{default:s(()=>[t(_,{size:g(f)?"22":"18"},{default:s(()=>e[28]||(e[28]=[u(" mdi-close ")])),_:1},8,["size"])]),_:1},8,["size"])]),_:1}),t(re,{class:"px-6 pt-3 pb-5"},{default:s(()=>[l("div",ra,[l("div",la,[l("span",oa,[e[30]||(e[30]=u("備品 : ")),l("span",na,c(y.value.sparePartName||"-"),1)]),l("span",ia,[e[31]||(e[31]=u("來源倉庫 : ")),l("span",ua,c(y.value.fromWarehouseName||"-"),1)]),l("span",da,[e[32]||(e[32]=u("目前數量 : ")),l("span",pa,c(N(y.value.currentQuantity||0)),1)])])]),t(be,{ref_key:"transferForm",ref:$,modelValue:ie.value,"onUpdate:modelValue":e[9]||(e[9]=a=>ie.value=a),disabled:T.value,onSubmit:he(me,["prevent"])},{default:s(()=>[t(ae,null,{default:s(()=>[t(q,{cols:"12"},{default:s(()=>[t(Fe,{modelValue:k.value.toWarehouseId,"onUpdate:modelValue":e[6]||(e[6]=a=>k.value.toWarehouseId=a),items:Ie.value,"item-title":"name","item-value":"_id",label:"*目標倉庫",variant:"outlined",density:"compact",rules:[a=>!!a||"請選擇目標倉庫",a=>a!==y.value.fromWarehouseId||"目標倉庫不能與來源倉庫相同"]},null,8,["modelValue","items","rules"])]),_:1}),t(q,{cols:"12"},{default:s(()=>[t(ee,{modelValue:k.value.quantity,"onUpdate:modelValue":e[7]||(e[7]=a=>k.value.quantity=a),modelModifiers:{number:!0},label:"*轉倉數量",variant:"outlined",density:"compact",type:"number",rules:[a=>a!=null&&a!==""||"請輸入轉倉數量",a=>a>0||"轉倉數量必須大於0",a=>a<=y.value.currentQuantity||`轉倉數量不能超過目前庫存（${N(y.value.currentQuantity||0)}）`],max:y.value.currentQuantity},null,8,["modelValue","rules","max"])]),_:1}),t(q,{cols:"12"},{default:s(()=>[t(_e,{modelValue:k.value.note,"onUpdate:modelValue":e[8]||(e[8]=a=>k.value.note=a),label:"備註",variant:"outlined",density:"compact","hide-details":"",rows:"3",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),t(le,{class:"px-6 pb-5 pt-0"},{default:s(()=>[t(z),t(b,{variant:"outlined",color:"grey-darken-1",size:g(f)?"default":"small",onClick:K},{default:s(()=>e[33]||(e[33]=[u(" 取消 ")])),_:1},8,["size"]),t(b,{color:"orange-darken-2",variant:"outlined",class:"ms-2",size:g(f)?"default":"small",loading:T.value,onClick:me},{default:s(()=>e[34]||(e[34]=[u(" 確認 ")])),_:1},8,["size","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue","fullscreen","no-click-animation"]),t(oe,{modelValue:C.value.open,"onUpdate:modelValue":e[12]||(e[12]=a=>C.value.open=a),persistent:"",width:"900",fullscreen:!g(f)},{default:s(()=>[t(te,{class:"rounded-lg"},{default:s(()=>[t(se,{class:"d-flex align-center px-6 py-2 bg-blue-grey-darken-2"},{default:s(()=>[t(_,{size:g(f)?"20":"18",color:"white",class:"me-2"},{default:s(()=>e[35]||(e[35]=[u(" mdi-history ")])),_:1},8,["size"]),e[37]||(e[37]=l("span",{class:"card-title text-white"},"歷史紀錄",-1)),t(z),t(b,{icon:"",variant:"plain",class:"opacity-100",ripple:!1,color:"white",size:g(f)?"36":"32",onClick:fe},{default:s(()=>[t(_,{size:g(f)?"22":"18"},{default:s(()=>e[36]||(e[36]=[u(" mdi-close ")])),_:1},8,["size"])]),_:1},8,["size"])]),_:1}),t(re,{class:"px-6 pt-3 pb-5"},{default:s(()=>[l("div",ca,[l("div",ma,[l("span",fa,[e[38]||(e[38]=u("備品 : ")),l("span",ga,c(C.value.sparePartName||"-"),1)]),l("span",va,[e[39]||(e[39]=u("倉庫 : ")),l("span",ya,c(C.value.warehouseName||"-"),1)])])]),t(we,{items:B.value,headers:Ve,loading:G.value,density:"compact",class:"history-table border rounded-lg","items-per-page":Pe.value,page:Y.value,"onUpdate:page":e[11]||(e[11]=a=>Y.value=a)},{"item.createdBy":s(({item:a})=>{var o;return[u(c(((o=a.createdBy)==null?void 0:o.name)||"-"),1)]}),"item.action":s(({item:a})=>[u(c(a.action),1)]),"item.quantityChange":s(({item:a})=>[l("span",{class:Q(a.quantityChange>=0?"text-success":"text-error")},c(a.quantityChange>=0?"+":"")+c(N(a.quantityChange||0)),3)]),"item.quantity":s(({item:a})=>[u(c(N(a.quantity||0)),1)]),"item.note":s(({item:a})=>[u(c(a.note||"-"),1)]),"item.createdAt":s(({item:a})=>[u(c(Ne(a.createdAt)),1)]),_:2},1032,["items","loading","items-per-page","page"])]),_:1}),t(le,{class:"px-6 pb-5 pt-0"},{default:s(()=>[t(z),t(b,{variant:"outlined",color:"grey-darken-1",size:g(f)?"default":"small",onClick:fe},{default:s(()=>e[40]||(e[40]=[u(" 關閉 ")])),_:1},8,["size"])]),_:1})]),_:1})]),_:1},8,["modelValue","fullscreen"])]),_:1}))}},Fa=$e(ha,[["__scopeId","data-v-46757f04"]]);export{Fa as default};

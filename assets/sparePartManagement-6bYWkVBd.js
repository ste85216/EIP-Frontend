import{f as C,r as o,w as ie,k as Ba,aV as g,Z as H,bH as s,a8 as l,a0 as r,a7 as n,_ as Fe,bf as u,$ as V,F as qa,b0 as Qa,aH as Re,u as d,bM as Ie}from"./@vue-Cr_z6yfx.js";import{u as Ya}from"./vue-router-BFBClpR6.js";import{_ as Za,u as ja,a as Ga,b as Ja}from"./index-BBlsm_-Y.js";import{i as Ka}from"./vuetify-use-dialog-C5oZ13xz.js";import{l as Me}from"./lodash-CiJWSuVn.js";import{d as sa}from"./vuedraggable-6ak-rXVU.js";import{_ as Oe}from"./ConfirmDeleteDialog-CuZPFffe.js";import{q as Xa,Q as el,w as p,$ as al,a0 as Le,r as f,am as ll,an as He,a as E,c as W,v as N,g as m,f as P,d as S,R as Ne,F,b as de,U as Be,a1 as qe,S as Qe,e as ce,V as me,P as Ye,x as oa,y as na}from"./vuetify-CbddcmEc.js";import"./perfect-debounce-Cp2ysxOb.js";import"./hookable-B8xFkYCm.js";/* empty css             */import"./pinia-DBRIaiZ_.js";import"./vue-demi-Dq6ymT-8.js";import"./pinia-plugin-persistedstate-RV7uh3T-.js";import"./jspdf-DacfHTdZ.js";import"./core-js-D2hAHviU.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./unplugin-vue-router-B1N3mqWX.js";import"./axios-upsvKRUO.js";import"./vue3-google-login-Dx7TV_Hx.js";import"./vue-easy-lightbox-D952uME8.js";import"./vue-lrpUOyH4.js";import"./sortablejs-CtLrRV7F.js";const tl={class:"text-center"},sl={style:{"max-width":"280px"}},ol={key:0,class:"d-flex flex-wrap ga-1 py-2"},nl={key:1,class:"text-grey"},rl={key:0},ul={key:1,class:"text-grey"},il={key:0},dl={key:1,class:"text-grey"},cl={class:"text-center"},ml={class:"text-center"},pl={key:0},vl={key:1,class:"text-grey"},fl={key:0},gl={key:1,class:"text-grey"},yl={class:"text-center"},bl={key:0},kl={key:1,class:"text-grey"},wl={class:"text-center"},Vl={class:"card-title text-white"},Pl={class:"card-title text-white"},xl={class:"card-title text-white"},hl={class:"drag-handle cursor-move me-2"},zl={class:"drag-handle cursor-move me-2"},_l={__name:"sparePartManagement",setup(Al){const{apiAuth:b}=Ja(),ra=ja(),pe=Ga(),w=Ka(),ua=Ya(),{smAndUp:i}=Xa(),ae=C(()=>i.value?"default":"small"),we=C(()=>i.value?"500":"100%"),_=o("spareParts"),R=C(()=>pe.hasPermission("SPARE_PART_READ")),B=C(()=>pe.hasPermission("SPARE_PART_MANUFACTURER_READ")),q=C(()=>pe.hasPermission("SPARE_PART_WAREHOUSE_READ")),ia=C(()=>pe.hasPermission("SPARE_PART_READ")),ve=()=>{R.value?_.value="spareParts":q.value?_.value="warehouses":B.value&&(_.value="manufacturers")};ie(_,t=>{t==="spareParts"&&!R.value&&ve(),t==="warehouses"&&!q.value&&ve(),t==="manufacturers"&&!B.value&&ve()}),ie([R,q,B],()=>{(_.value==="spareParts"&&!R.value||_.value==="warehouses"&&!q.value||_.value==="manufacturers"&&!B.value)&&ve()},{immediate:!0});const Q=o(!1),Y=o(!1),Ve=o(!1),le=o(null),Pe=o(!1),xe=o([]),fe=o(1),da=o(1),Ze=o(0),x=o(10),te=o(""),ca=Me.debounce(()=>{fe.value=1,X()},300);ie(te,()=>{Q.value=!0,ca()});const U=o({open:!1,id:""}),h=o({name:"",note:"",isActive:!0}),I=o({open:!1,id:"",name:""}),Z=o(!1),j=o(!1),he=o(!1),se=o(null),ze=o(!1),_e=o([]),ge=o(1),ma=o(1),je=o(0),G=o(!1),ye=o([]),Ae=o(!1),oe=o(""),pa=Me.debounce(()=>{ge.value=1,L()},300);ie(oe,()=>{Z.value=!0,pa()});const D=o({open:!1,id:""}),y=o({name:"",company:"",address:"",note:"",isActive:!0}),M=o({open:!1,id:"",name:""}),Ge=o([]),Ce=o(!1),ne=o(!1),J=o(!1),Se=o(!1),re=o(null),Ue=o(!1),Je=o([]),K=o(!1),be=o([]),De=o(!1),ke=o(1),va=o(1),Ke=o(0),ue=o(""),fa=Me.debounce(()=>{ke.value=1,ee()},300);ie(ue,()=>{ne.value=!0,fa()});const T=o({open:!1,id:""}),c=o({name:"",manufacturer:"",warehouses:[],packaging:"",cost:0,price:0,note:"",isActive:!0}),O=o({open:!1,id:"",name:""}),ga=C(()=>xe.value.filter(t=>t.isActive!==!1).map(t=>({name:t.name,_id:t._id}))),ya=C(()=>Q.value),ba=C(()=>_e.value.filter(t=>t.isActive!==!1).map(t=>({name:t.name,_id:t._id}))),ka=C(()=>Z.value),wa=[{title:"廠商名稱",key:"name",sortable:!0},{title:"狀態",key:"isActive",sortable:!0},{title:"建立時間",key:"createdAt",sortable:!0},{title:"建立者",key:"creator",sortable:!1},{title:"備註",key:"note"},{title:"操作",key:"action",sortable:!1,align:"center"}],Va=[{title:"排序",key:"order",sortable:!1,align:"center",width:"80px"},{title:"倉庫名稱",key:"name",sortable:!0},{title:"狀態",key:"isActive",sortable:!0},{title:"建立時間",key:"createdAt",sortable:!0},{title:"建立者",key:"creator",sortable:!1},{title:"公司",key:"company",sortable:!1},{title:"地址",key:"address"},{title:"備註",key:"note"},{title:"操作",key:"action",sortable:!1,align:"center"}],Pa=[{title:"排序",key:"order",sortable:!1,align:"center",width:"80px"},{title:"備品名稱",key:"name",sortable:!0},{title:"狀態",key:"isActive",sortable:!0},{title:"建立時間",key:"createdAt",sortable:!0},{title:"建立者",key:"creator",sortable:!1},{title:"廠商",key:"manufacturer",sortable:!1},{title:"倉庫",key:"warehouses",sortable:!1},{title:"包裝形式",key:"packaging"},{title:"成本",key:"cost",sortable:!0},{title:"價格",key:"price",sortable:!0},{title:"備註",key:"note"},{title:"操作",key:"action",sortable:!1,align:"center"}],Xe=async()=>{try{Ce.value=!0;const{data:t}=await b.get("/companies/all");t.success&&(Ge.value=t.result.data)}catch(t){z(t)}finally{Ce.value=!1}},X=async()=>{try{Q.value=!0;const t={page:fe.value,itemsPerPage:x.value};te.value&&(t.search=te.value);const{data:e}=await b.get("/manufacturers",{params:t});e.success&&(xe.value=e.result.data,da.value=e.result.totalPages,Ze.value=e.result.totalItems||0)}catch(t){z(t)}finally{Q.value=!1}},L=async()=>{try{Z.value=!0;const t={page:ge.value,itemsPerPage:x.value};oe.value&&(t.search=oe.value);const{data:e}=await b.get("/warehouses",{params:t});e.success&&(_e.value=e.result.data,ma.value=e.result.totalPages,je.value=e.result.totalItems||0)}catch(t){z(t)}finally{Z.value=!1}},ee=async()=>{try{ne.value=!0;const t={page:ke.value,itemsPerPage:x.value};ue.value&&(t.search=ue.value);const{data:e}=await b.get("/spareParts",{params:t});e.success&&(Je.value=e.result.data,va.value=e.result.totalPages,Ke.value=e.result.totalItems||0)}catch(t){z(t)}finally{ne.value=!1}},xa=()=>{U.value={open:!0,id:""},h.value={name:"",note:"",isActive:!0},le.value&&le.value.reset()},ha=t=>{U.value={open:!0,id:t._id},h.value={name:t.name,note:t.note||"",isActive:t.isActive}},Te=()=>{U.value={open:!1,id:""},h.value={name:"",note:"",isActive:!0},le.value&&le.value.reset()},ea=async()=>{if(!(!Pe.value||Y.value))try{Y.value=!0;const t={name:h.value.name,note:h.value.note||"",isActive:h.value.isActive};if(U.value.id){const{data:e}=await b.patch(`/manufacturers/${U.value.id}`,t);if(!e.success)throw new Error(e.message||"更新失敗");w({text:"廠商更新成功",snackbarProps:{color:"teal-lighten-1"}})}else{const{data:e}=await b.post("/manufacturers",t);if(!e.success)throw new Error(e.message||"新增失敗");w({text:"廠商新增成功",snackbarProps:{color:"teal-lighten-1"}})}Te(),await X()}catch(t){z(t)}finally{Y.value=!1}},za=t=>{I.value={open:!0,id:t._id,name:t.name}},_a=async()=>{if(!(!I.value.id||Ve.value))try{Ve.value=!0;const{data:t}=await b.delete(`/manufacturers/${I.value.id}`);if(!t.success)throw new Error(t.message||"刪除失敗");w({text:"廠商刪除成功",snackbarProps:{color:"teal-lighten-1"}}),I.value={open:!1,id:"",name:""},await X()}catch(t){z(t)}finally{Ve.value=!1}},$e=t=>{if(!t)return"-";const e=new Date(t),a=e.getFullYear(),v=String(e.getMonth()+1).padStart(2,"0"),k=String(e.getDate()).padStart(2,"0");return`${a}/${v}/${k}`},z=t=>{var a,v,k;console.error("Error:",t);const e=((v=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:v.message)||"操作失敗";((k=t==null?void 0:t.response)==null?void 0:k.status)===401?(ra.logout(),ua.push("/login"),w({text:"登入已過期，請重新登入",snackbarProps:{color:"red-lighten-1"}})):w({text:e,snackbarProps:{color:"red-lighten-1"}})},Aa=()=>{D.value={open:!0,id:""},y.value={name:"",company:"",address:"",note:"",isActive:!0},se.value&&se.value.reset()},Ca=t=>{var e;D.value={open:!0,id:t._id},y.value={name:t.name,company:((e=t.company)==null?void 0:e._id)||t.company||"",address:t.address||"",note:t.note||"",isActive:t.isActive}},Ee=()=>{D.value={open:!1,id:""},y.value={name:"",company:"",address:"",note:"",isActive:!0},se.value&&se.value.reset()},aa=async()=>{if(!(!ze.value||j.value))try{j.value=!0;const t={name:y.value.name,company:y.value.company,address:y.value.address||"",note:y.value.note||"",isActive:y.value.isActive};if(D.value.id){const{data:e}=await b.patch(`/warehouses/${D.value.id}`,t);if(!e.success)throw new Error(e.message||"更新失敗");w({text:"倉庫更新成功",snackbarProps:{color:"teal-lighten-1"}})}else{const{data:e}=await b.post("/warehouses",t);if(!e.success)throw new Error(e.message||"新增失敗");w({text:"倉庫新增成功",snackbarProps:{color:"teal-lighten-1"}})}Ee(),await L()}catch(t){z(t)}finally{j.value=!1}},Sa=t=>{M.value={open:!0,id:t._id,name:t.name}},Ua=async()=>{if(!(!M.value.id||he.value))try{he.value=!0;const{data:t}=await b.delete(`/warehouses/${M.value.id}`);if(!t.success)throw new Error(t.message||"刪除失敗");w({text:"倉庫刪除成功",snackbarProps:{color:"teal-lighten-1"}}),M.value={open:!1,id:"",name:""},await L()}catch(t){z(t)}finally{he.value=!1}},Da=()=>{T.value={open:!0,id:""},c.value={name:"",manufacturer:"",warehouses:[],packaging:"",cost:0,price:0,note:"",isActive:!0},re.value&&re.value.reset()},Ta=t=>{var e;T.value={open:!0,id:t._id},c.value={name:t.name,manufacturer:((e=t.manufacturer)==null?void 0:e._id)||t.manufacturer||"",warehouses:t.warehouses?t.warehouses.map(a=>a._id||a):[],packaging:t.packaging||"",cost:t.cost||0,price:t.price||0,note:t.note||"",isActive:t.isActive}},We=()=>{T.value={open:!1,id:""},c.value={name:"",manufacturer:"",warehouses:[],packaging:"",cost:0,price:0,note:"",isActive:!0},re.value&&re.value.reset()},la=async()=>{if(!(!Ue.value||J.value))try{J.value=!0;const t={name:c.value.name,manufacturer:c.value.manufacturer||null,warehouses:c.value.warehouses||[],packaging:c.value.packaging||"",cost:c.value.cost||0,price:c.value.price||0,note:c.value.note||"",isActive:c.value.isActive};if(T.value.id){const{data:e}=await b.patch(`/spareParts/${T.value.id}`,t);if(!e.success)throw new Error(e.message||"更新失敗");w({text:"備品更新成功",snackbarProps:{color:"teal-lighten-1"}})}else{const{data:e}=await b.post("/spareParts",t);if(!e.success)throw new Error(e.message||"新增失敗");w({text:"備品新增成功",snackbarProps:{color:"teal-lighten-1"}})}We(),await ee()}catch(t){z(t)}finally{J.value=!1}},$a=t=>{O.value={open:!0,id:t._id,name:t.name}},Ea=async()=>{if(!(!O.value.id||Se.value))try{Se.value=!0;const{data:t}=await b.delete(`/spareParts/${O.value.id}`);if(!t.success)throw new Error(t.message||"刪除失敗");w({text:"備品刪除成功",snackbarProps:{color:"teal-lighten-1"}}),O.value={open:!1,id:"",name:""},await ee()}catch(t){z(t)}finally{Se.value=!1}},ta=t=>t==null||t===""?"-":new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0,maximumFractionDigits:0}).format(t),Wa=async()=>{try{const t={page:1,itemsPerPage:9999},{data:e}=await b.get("/spareParts",{params:t});return e.success?e.result.data:[]}catch(t){return z(t),[]}},Fa=async()=>{const t=await Wa();be.value=[...t].sort((e,a)=>(e.order||0)-(a.order||0)),K.value=!0},Ra=async()=>{var t,e;try{De.value=!0;const a=be.value.map((k,A)=>({id:k._id,order:A+1})),v=await b.patch("/spareParts/order/update",{spareParts:a});w({text:v.data.message,snackbarProps:{color:"teal-lighten-1"}}),K.value=!1,await ee()}catch(a){console.error("更新順序錯誤:",a),w({text:((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||a.message||"更新順序失敗",snackbarProps:{color:"red-lighten-1"}})}finally{De.value=!1}},Ia=async()=>{try{const t={page:1,itemsPerPage:9999},{data:e}=await b.get("/warehouses",{params:t});return e.success?e.result.data:[]}catch(t){return z(t),[]}},Ma=async()=>{const t=await Ia();ye.value=[...t].sort((e,a)=>(e.order||0)-(a.order||0)),G.value=!0},Oa=async()=>{var t,e;try{Ae.value=!0;const a=ye.value.map((k,A)=>({id:k._id,order:A+1})),v=await b.patch("/warehouses/order/update",{warehouses:a});w({text:v.data.message,snackbarProps:{color:"teal-lighten-1"}}),G.value=!1,await L()}catch(a){console.error("更新倉庫順序錯誤:",a),w({text:((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||a.message||"更新倉庫順序失敗",snackbarProps:{color:"red-lighten-1"}})}finally{Ae.value=!1}},La=async t=>{ke.value=t.page,x.value=t.itemsPerPage,await ee()},Ha=async t=>{ge.value=t.page,x.value=t.itemsPerPage,await L()},Na=async t=>{fe.value=t.page,x.value=t.itemsPerPage,await X()};return Ba(async()=>{const t=[];R.value&&(t.push(Xe(),ee()),ia.value&&t.push(X(),L())),q.value&&(t.push(L()),R.value||t.push(Xe())),B.value&&t.push(X()),await Promise.all(t)}),(t,e)=>(g(),H(el,{"max-width":"1920"},{default:s(()=>[l(N,{class:"elevation-4 rounded-lg py-4 py-sm-6 px-1 px-sm-6 mt-2 mt-sm-6 mx-0 mx-sm-4 mx-md-4 mb-4 bg-white"},{default:s(()=>[l(p,{cols:"12",class:"ps-3 pb-0"},{default:s(()=>e[41]||(e[41]=[r("h3",null,"備品管理",-1)])),_:1}),l(p,{cols:"12"},{default:s(()=>[l(al,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=a=>_.value=a),color:"teal-darken-1","align-tabs":"start"},{default:s(()=>[R.value?(g(),H(Le,{key:0,value:"spareParts"},{default:s(()=>[l(f,{start:""},{default:s(()=>e[42]||(e[42]=[n(" mdi-package-variant ")])),_:1}),e[43]||(e[43]=n(" 備品管理 "))]),_:1})):Fe("",!0),q.value?(g(),H(Le,{key:1,value:"warehouses"},{default:s(()=>[l(f,{start:""},{default:s(()=>e[44]||(e[44]=[n(" mdi-warehouse ")])),_:1}),e[45]||(e[45]=n(" 倉庫管理 "))]),_:1})):Fe("",!0),B.value?(g(),H(Le,{key:2,value:"manufacturers"},{default:s(()=>[l(f,{start:""},{default:s(()=>e[46]||(e[46]=[n(" mdi-factory ")])),_:1}),e[47]||(e[47]=n(" 廠商管理 "))]),_:1})):Fe("",!0)]),_:1},8,["modelValue"]),l(ll,{modelValue:_.value,"onUpdate:modelValue":e[7]||(e[7]=a=>_.value=a)},{default:s(()=>[l(He,{value:"spareParts"},{default:s(()=>[l(E,{flat:""},{default:s(()=>[l(W,{class:"px-0 pt-6"},{default:s(()=>[l(N,{class:"pb-2"},{default:s(()=>[l(p,{cols:"12",md:"6"},{default:s(()=>[l(m,{"prepend-icon":"mdi-plus",color:"teal-darken-1",variant:"outlined",size:ae.value,onClick:Da},{default:s(()=>e[48]||(e[48]=[n(" 新增備品 ")])),_:1},8,["size"]),l(m,{"prepend-icon":"mdi-sort",color:"blue-grey-darken-2",variant:"outlined",size:ae.value,class:"ms-3",onClick:Fa},{default:s(()=>e[49]||(e[49]=[n(" 排序 ")])),_:1},8,["size"])]),_:1}),l(P),l(p,{cols:"12",md:"3"},{default:s(()=>[l(S,{modelValue:ue.value,"onUpdate:modelValue":e[1]||(e[1]=a=>ue.value=a),"prepend-inner-icon":"mdi-magnify",label:"搜尋備品",variant:"outlined",density:"compact","hide-details":"",clearable:"",loading:ne.value},null,8,["modelValue","loading"])]),_:1})]),_:1}),l(Ne,{"items-per-page":x.value,"onUpdate:itemsPerPage":e[2]||(e[2]=a=>x.value=a),items:Je.value,headers:Pa,loading:ne.value,page:ke.value,"items-length":Ke.value,hover:"",density:"compact",class:"mt-4 rounded-ts-lg rounded-te-lg","onUpdate:options":La},{item:s(({item:a,index:v})=>{var k,A;return[r("tr",{class:Re({"odd-row":v%2===0,"even-row":v%2!==0})},[r("td",tl,[l(F,{size:"small",color:"blue-grey",variant:"tonal"},{default:s(()=>[n(u(a.order||0),1)]),_:2},1024)]),r("td",null,u(a.name),1),r("td",null,[l(F,{color:a.isActive?"success":"error",size:"small",variant:"tonal"},{default:s(()=>[n(u(a.isActive?"啟用":"停用"),1)]),_:2},1032,["color"])]),r("td",null,u($e(a.createdAt)),1),r("td",null,u(((k=a.creator)==null?void 0:k.name)||"-"),1),r("td",null,u(((A=a.manufacturer)==null?void 0:A.name)||"-"),1),r("td",sl,[a.warehouses&&a.warehouses.length>0?(g(),V("div",ol,[(g(!0),V(qa,null,Qa(a.warehouses,$=>(g(),H(F,{key:$._id||$,size:"small",variant:"tonal",color:"teal-darken-1"},{default:s(()=>[n(u($.name||$),1)]),_:2},1024))),128))])):(g(),V("span",nl," - "))]),r("td",null,[a.packaging?(g(),V("span",rl,u(a.packaging),1)):(g(),V("span",ul," - "))]),r("td",null,u(ta(a.cost)),1),r("td",null,u(ta(a.price)),1),r("td",null,[a.note?(g(),V("span",il,u(a.note),1)):(g(),V("span",dl," - "))]),r("td",cl,[l(m,{icon:"",color:"light-blue-darken-4",variant:"plain",size:"22",class:"mx-2",ripple:!1,onClick:$=>Ta(a)},{default:s(()=>[l(f,null,{default:s(()=>e[50]||(e[50]=[n("mdi-pencil")])),_:1})]),_:2},1032,["onClick"]),l(m,{icon:"",color:"red-lighten-1",variant:"plain",size:"22",class:"mx-2",ripple:!1,onClick:$=>$a(a)},{default:s(()=>[l(f,null,{default:s(()=>e[51]||(e[51]=[n("mdi-delete")])),_:1})]),_:2},1032,["onClick"])])],2)]}),_:1},8,["items-per-page","items","loading","page","items-length"])]),_:1})]),_:1})]),_:1}),l(He,{value:"warehouses"},{default:s(()=>[l(E,{flat:""},{default:s(()=>[l(W,{class:"px-0 pt-6"},{default:s(()=>[l(N,{class:"pb-2"},{default:s(()=>[l(p,{cols:"12",md:"6"},{default:s(()=>[l(m,{"prepend-icon":"mdi-plus",color:"teal-darken-1",variant:"outlined",size:ae.value,onClick:Aa},{default:s(()=>e[52]||(e[52]=[n(" 新增倉庫 ")])),_:1},8,["size"]),l(m,{"prepend-icon":"mdi-sort",color:"blue-grey-darken-2",variant:"outlined",size:ae.value,class:"ms-3",onClick:Ma},{default:s(()=>e[53]||(e[53]=[n(" 排序 ")])),_:1},8,["size"])]),_:1}),l(P),l(p,{cols:"12",md:"3"},{default:s(()=>[l(S,{modelValue:oe.value,"onUpdate:modelValue":e[3]||(e[3]=a=>oe.value=a),"prepend-inner-icon":"mdi-magnify",label:"搜尋倉庫",variant:"outlined",density:"compact","hide-details":"",clearable:"",loading:Z.value},null,8,["modelValue","loading"])]),_:1})]),_:1}),l(Ne,{"items-per-page":x.value,"onUpdate:itemsPerPage":e[4]||(e[4]=a=>x.value=a),items:_e.value,headers:Va,loading:Z.value,page:ge.value,"items-length":je.value,hover:"",density:"compact",class:"mt-4 rounded-ts-lg rounded-te-lg","onUpdate:options":Ha},{item:s(({item:a,index:v})=>{var k,A;return[r("tr",{class:Re({"odd-row":v%2===0,"even-row":v%2!==0})},[r("td",ml,[l(F,{size:"small",color:"blue-grey",variant:"tonal"},{default:s(()=>[n(u(a.order||0),1)]),_:2},1024)]),r("td",null,u(a.name),1),r("td",null,[l(F,{color:a.isActive?"success":"error",size:"small",variant:"tonal"},{default:s(()=>[n(u(a.isActive?"啟用":"停用"),1)]),_:2},1032,["color"])]),r("td",null,u($e(a.createdAt)),1),r("td",null,u(((k=a.creator)==null?void 0:k.name)||"-"),1),r("td",null,u(((A=a.company)==null?void 0:A.name)||"-"),1),r("td",null,[a.address?(g(),V("span",pl,u(a.address),1)):(g(),V("span",vl," - "))]),r("td",null,[a.note?(g(),V("span",fl,u(a.note),1)):(g(),V("span",gl," - "))]),r("td",yl,[l(m,{icon:"",color:"light-blue-darken-4",variant:"plain",size:"22",class:"mx-2",ripple:!1,onClick:$=>Ca(a)},{default:s(()=>[l(f,null,{default:s(()=>e[54]||(e[54]=[n("mdi-pencil")])),_:1})]),_:2},1032,["onClick"]),l(m,{icon:"",color:"red-lighten-1",variant:"plain",size:"22",class:"mx-2",ripple:!1,onClick:$=>Sa(a)},{default:s(()=>[l(f,null,{default:s(()=>e[55]||(e[55]=[n("mdi-delete")])),_:1})]),_:2},1032,["onClick"])])],2)]}),_:1},8,["items-per-page","items","loading","page","items-length"])]),_:1})]),_:1})]),_:1}),l(He,{value:"manufacturers"},{default:s(()=>[l(E,{flat:""},{default:s(()=>[l(W,{class:"px-0 pt-6"},{default:s(()=>[l(N,{class:"pb-2"},{default:s(()=>[l(p,{cols:"12",md:"6"},{default:s(()=>[l(m,{"prepend-icon":"mdi-plus",color:"teal-darken-1",variant:"outlined",size:ae.value,onClick:xa},{default:s(()=>e[56]||(e[56]=[n(" 新增廠商 ")])),_:1},8,["size"])]),_:1}),l(P),l(p,{cols:"12",md:"3"},{default:s(()=>[l(S,{modelValue:te.value,"onUpdate:modelValue":e[5]||(e[5]=a=>te.value=a),"prepend-inner-icon":"mdi-magnify",label:"搜尋廠商",variant:"outlined",density:"compact","hide-details":"",clearable:"",loading:Q.value},null,8,["modelValue","loading"])]),_:1})]),_:1}),l(Ne,{"items-per-page":x.value,"onUpdate:itemsPerPage":e[6]||(e[6]=a=>x.value=a),items:xe.value,headers:wa,loading:Q.value,page:fe.value,"items-length":Ze.value,hover:"",density:"compact",class:"mt-4 rounded-ts-lg rounded-te-lg","onUpdate:options":Na},{item:s(({item:a,index:v})=>{var k;return[r("tr",{class:Re({"odd-row":v%2===0,"even-row":v%2!==0})},[r("td",null,u(a.name),1),r("td",null,[l(F,{color:a.isActive?"success":"error",size:"small",variant:"tonal"},{default:s(()=>[n(u(a.isActive?"啟用":"停用"),1)]),_:2},1032,["color"])]),r("td",null,u($e(a.createdAt)),1),r("td",null,u(((k=a.creator)==null?void 0:k.name)||"-"),1),r("td",null,[a.note?(g(),V("span",bl,u(a.note),1)):(g(),V("span",kl," - "))]),r("td",wl,[l(m,{icon:"",color:"light-blue-darken-4",variant:"plain",size:"22",class:"mx-2",ripple:!1,onClick:A=>ha(a)},{default:s(()=>[l(f,null,{default:s(()=>e[57]||(e[57]=[n("mdi-pencil")])),_:1})]),_:2},1032,["onClick"]),l(m,{icon:"",color:"red-lighten-1",variant:"plain",size:"22",class:"mx-2",ripple:!1,onClick:A=>za(a)},{default:s(()=>[l(f,null,{default:s(()=>e[58]||(e[58]=[n("mdi-delete")])),_:1})]),_:2},1032,["onClick"])])],2)]}),_:1},8,["items-per-page","items","loading","page","items-length"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(me,{modelValue:U.value.open,"onUpdate:modelValue":e[12]||(e[12]=a=>U.value.open=a),persistent:"",width:we.value,fullscreen:!d(i),"no-click-animation":Y.value},{default:s(()=>[l(E,{class:"rounded-lg"},{default:s(()=>[l(de,{class:"d-flex align-center px-6 py-2 bg-teal-darken-1"},{default:s(()=>[l(f,{size:d(i)?"20":"18",color:"white",class:"me-2"},{default:s(()=>e[59]||(e[59]=[n(" mdi-factory ")])),_:1},8,["size"]),r("span",Vl,u(U.value.id?"編輯廠商":"新增廠商"),1),l(P),l(m,{icon:"",variant:"plain",class:"opacity-100",ripple:!1,color:"white",size:d(i)?"36":"32",onClick:Te},{default:s(()=>[l(f,{size:d(i)?"22":"18"},{default:s(()=>e[60]||(e[60]=[n(" mdi-close ")])),_:1},8,["size"])]),_:1},8,["size"])]),_:1}),l(W,{class:"px-6 py-4 mt-4"},{default:s(()=>[l(Be,{ref_key:"form",ref:le,modelValue:Pe.value,"onUpdate:modelValue":e[11]||(e[11]=a=>Pe.value=a),disabled:Y.value,onSubmit:Ie(ea,["prevent"])},{default:s(()=>[l(N,null,{default:s(()=>[l(p,{cols:"12"},{default:s(()=>[l(S,{modelValue:h.value.name,"onUpdate:modelValue":e[8]||(e[8]=a=>h.value.name=a),label:"*廠商名稱",variant:"outlined",density:"compact",rules:[a=>!!a||"請輸入廠商名稱",a=>a&&a.length<=200||"廠商名稱不能超過200個字元"]},null,8,["modelValue","rules"])]),_:1}),l(p,{cols:"12"},{default:s(()=>[l(qe,{modelValue:h.value.note,"onUpdate:modelValue":e[9]||(e[9]=a=>h.value.note=a),label:"備註",variant:"outlined",density:"compact",rows:"3",clearable:"","hide-details":""},null,8,["modelValue"])]),_:1}),l(p,{cols:"12",sm:"6"},{default:s(()=>[l(Qe,{modelValue:h.value.isActive,"onUpdate:modelValue":e[10]||(e[10]=a=>h.value.isActive=a),label:"啟用狀態",color:"teal-darken-1","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),l(ce,{class:"px-6 pb-5 pt-0"},{default:s(()=>[l(P),l(m,{variant:"outlined",color:"grey-darken-1",size:d(i)?"default":"small",onClick:Te},{default:s(()=>e[61]||(e[61]=[n(" 取消 ")])),_:1},8,["size"]),l(m,{color:"teal-darken-1",variant:"outlined",class:"ms-2",size:d(i)?"default":"small",loading:Y.value,onClick:ea},{default:s(()=>[n(u(U.value.id?"修改":"新增"),1)]),_:1},8,["size","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue","width","fullscreen","no-click-animation"]),l(me,{modelValue:T.value.open,"onUpdate:modelValue":e[22]||(e[22]=a=>T.value.open=a),persistent:"",width:we.value,fullscreen:!d(i),"no-click-animation":J.value},{default:s(()=>[l(E,{class:"rounded-lg"},{default:s(()=>[l(de,{class:"d-flex align-center px-6 py-2 bg-teal-darken-1"},{default:s(()=>[l(f,{size:d(i)?"20":"18",color:"white",class:"me-2"},{default:s(()=>e[62]||(e[62]=[n(" mdi-package-variant ")])),_:1},8,["size"]),r("span",Pl,u(T.value.id?"編輯備品":"新增備品"),1),l(P),l(m,{icon:"",variant:"plain",class:"opacity-100",ripple:!1,color:"white",size:d(i)?"36":"32",onClick:We},{default:s(()=>[l(f,{size:d(i)?"22":"18"},{default:s(()=>e[63]||(e[63]=[n(" mdi-close ")])),_:1},8,["size"])]),_:1},8,["size"])]),_:1}),l(W,{class:"px-6 py-4 mt-4"},{default:s(()=>[l(Be,{ref_key:"sparePartForm",ref:re,modelValue:Ue.value,"onUpdate:modelValue":e[21]||(e[21]=a=>Ue.value=a),disabled:J.value,onSubmit:Ie(la,["prevent"])},{default:s(()=>[l(N,null,{default:s(()=>[l(p,{cols:"12"},{default:s(()=>[l(S,{modelValue:c.value.name,"onUpdate:modelValue":e[13]||(e[13]=a=>c.value.name=a),label:"*備品名稱",variant:"outlined",density:"compact",rules:[a=>!!a||"請輸入備品名稱"]},null,8,["modelValue","rules"])]),_:1}),l(p,{cols:"12"},{default:s(()=>[l(Ye,{modelValue:c.value.manufacturer,"onUpdate:modelValue":e[14]||(e[14]=a=>c.value.manufacturer=a),items:ga.value,"item-title":"name","item-value":"_id",label:"廠商",variant:"outlined",density:"compact",clearable:"",loading:ya.value},null,8,["modelValue","items","loading"])]),_:1}),l(p,{cols:"12"},{default:s(()=>[l(Ye,{modelValue:c.value.warehouses,"onUpdate:modelValue":e[15]||(e[15]=a=>c.value.warehouses=a),items:ba.value,"item-title":"name","item-value":"_id",label:"*倉庫",variant:"outlined",density:"compact",multiple:"",chips:"",loading:ka.value,rules:[a=>a&&a.length>0||"請至少選擇一個倉庫"]},null,8,["modelValue","items","loading","rules"])]),_:1}),l(p,{cols:"12"},{default:s(()=>[l(S,{modelValue:c.value.packaging,"onUpdate:modelValue":e[16]||(e[16]=a=>c.value.packaging=a),label:"包裝形式",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1}),l(p,{cols:"12",sm:"6"},{default:s(()=>[l(S,{modelValue:c.value.cost,"onUpdate:modelValue":e[17]||(e[17]=a=>c.value.cost=a),modelModifiers:{number:!0},label:"成本",variant:"outlined",density:"compact",type:"number",min:"0",rules:[a=>a===""||a===null||a>=0||"成本不能為負數"]},null,8,["modelValue","rules"])]),_:1}),l(p,{cols:"12",sm:"6"},{default:s(()=>[l(S,{modelValue:c.value.price,"onUpdate:modelValue":e[18]||(e[18]=a=>c.value.price=a),modelModifiers:{number:!0},label:"價格",variant:"outlined",density:"compact",type:"number",min:"0",rules:[a=>a===""||a===null||a>=0||"價格不能為負數"]},null,8,["modelValue","rules"])]),_:1}),l(p,{cols:"12"},{default:s(()=>[l(qe,{modelValue:c.value.note,"onUpdate:modelValue":e[19]||(e[19]=a=>c.value.note=a),label:"備註",variant:"outlined",density:"compact",rows:"3",clearable:"","hide-details":""},null,8,["modelValue"])]),_:1}),l(p,{cols:"12",sm:"6"},{default:s(()=>[l(Qe,{modelValue:c.value.isActive,"onUpdate:modelValue":e[20]||(e[20]=a=>c.value.isActive=a),label:"啟用狀態",color:"teal-darken-1","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),l(ce,{class:"px-6 pb-5 pt-0"},{default:s(()=>[l(P),l(m,{variant:"outlined",color:"grey-darken-1",size:d(i)?"default":"small",onClick:We},{default:s(()=>e[64]||(e[64]=[n(" 取消 ")])),_:1},8,["size"]),l(m,{color:"teal-darken-1",variant:"outlined",class:"ms-2",size:d(i)?"default":"small",loading:J.value,onClick:la},{default:s(()=>[n(u(T.value.id?"修改":"新增"),1)]),_:1},8,["size","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue","width","fullscreen","no-click-animation"]),l(me,{modelValue:D.value.open,"onUpdate:modelValue":e[29]||(e[29]=a=>D.value.open=a),persistent:"",width:we.value,fullscreen:!d(i),"no-click-animation":j.value},{default:s(()=>[l(E,{class:"rounded-lg"},{default:s(()=>[l(de,{class:"d-flex align-center px-6 py-2 bg-teal-darken-1"},{default:s(()=>[l(f,{size:d(i)?"20":"18",color:"white",class:"me-2"},{default:s(()=>e[65]||(e[65]=[n(" mdi-warehouse ")])),_:1},8,["size"]),r("span",xl,u(D.value.id?"編輯倉庫":"新增倉庫"),1),l(P),l(m,{icon:"",variant:"plain",class:"opacity-100",ripple:!1,color:"white",size:d(i)?"36":"32",onClick:Ee},{default:s(()=>[l(f,{size:d(i)?"22":"18"},{default:s(()=>e[66]||(e[66]=[n(" mdi-close ")])),_:1},8,["size"])]),_:1},8,["size"])]),_:1}),l(W,{class:"px-6 py-4 mt-4"},{default:s(()=>[l(Be,{ref_key:"warehouseForm",ref:se,modelValue:ze.value,"onUpdate:modelValue":e[28]||(e[28]=a=>ze.value=a),disabled:j.value,onSubmit:Ie(aa,["prevent"])},{default:s(()=>[l(N,null,{default:s(()=>[l(p,{cols:"12"},{default:s(()=>[l(S,{modelValue:y.value.name,"onUpdate:modelValue":e[23]||(e[23]=a=>y.value.name=a),label:"*倉庫名稱",variant:"outlined",density:"compact",rules:[a=>!!a||"請輸入倉庫名稱",a=>a&&a.length<=200||"倉庫名稱不能超過200個字元"]},null,8,["modelValue","rules"])]),_:1}),l(p,{cols:"12"},{default:s(()=>[l(Ye,{modelValue:y.value.company,"onUpdate:modelValue":e[24]||(e[24]=a=>y.value.company=a),items:Ge.value,"item-title":"name","item-value":"_id",label:"*公司",variant:"outlined",density:"compact",rules:[a=>!!a||"請選擇公司"],loading:Ce.value},null,8,["modelValue","items","rules","loading"])]),_:1}),l(p,{cols:"12"},{default:s(()=>[l(S,{modelValue:y.value.address,"onUpdate:modelValue":e[25]||(e[25]=a=>y.value.address=a),label:"地址",variant:"outlined",density:"compact",rules:[a=>!a||a.length<=500||"地址不能超過500個字元"]},null,8,["modelValue","rules"])]),_:1}),l(p,{cols:"12"},{default:s(()=>[l(qe,{modelValue:y.value.note,"onUpdate:modelValue":e[26]||(e[26]=a=>y.value.note=a),label:"備註",variant:"outlined",density:"compact",rows:"3",clearable:"","hide-details":""},null,8,["modelValue"])]),_:1}),l(p,{cols:"12",sm:"6"},{default:s(()=>[l(Qe,{modelValue:y.value.isActive,"onUpdate:modelValue":e[27]||(e[27]=a=>y.value.isActive=a),label:"啟用狀態",color:"teal-darken-1","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),l(ce,{class:"px-6 pb-5 pt-0"},{default:s(()=>[l(P),l(m,{variant:"outlined",color:"grey-darken-1",size:d(i)?"default":"small",onClick:Ee},{default:s(()=>e[67]||(e[67]=[n(" 取消 ")])),_:1},8,["size"]),l(m,{color:"teal-darken-1",variant:"outlined",class:"ms-2",size:d(i)?"default":"small",loading:j.value,onClick:aa},{default:s(()=>[n(u(D.value.id?"修改":"新增"),1)]),_:1},8,["size","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue","width","fullscreen","no-click-animation"]),l(Oe,{modelValue:I.value.open,"onUpdate:modelValue":e[30]||(e[30]=a=>I.value.open=a),"dialog-width":"320",title:"確認刪除廠商",message:`確定要刪除廠商「<span class='text-red'>${I.value.name}</span>」嗎？此操作無法復原。`,"confirm-button-color":"red-lighten-1","cancel-button-color":"grey-darken-1","confirm-button-text":"刪除","cancel-button-text":"取消",onConfirm:_a},null,8,["modelValue","message"]),l(Oe,{modelValue:M.value.open,"onUpdate:modelValue":e[31]||(e[31]=a=>M.value.open=a),"dialog-width":"320",title:"確認刪除倉庫",message:`確定要刪除倉庫「<span class='text-red'>${M.value.name}</span>」嗎？此操作無法復原。`,"confirm-button-color":"red-lighten-1","cancel-button-color":"grey-darken-1","confirm-button-text":"刪除","cancel-button-text":"取消",onConfirm:Ua},null,8,["modelValue","message"]),l(Oe,{modelValue:O.value.open,"onUpdate:modelValue":e[32]||(e[32]=a=>O.value.open=a),"dialog-width":"320",title:"確認刪除備品",message:`確定要刪除備品「<span class='text-red'>${O.value.name}</span>」嗎？此操作無法復原。`,"confirm-button-color":"red-lighten-1","cancel-button-color":"grey-darken-1","confirm-button-text":"刪除","cancel-button-text":"取消",onConfirm:Ea},null,8,["modelValue","message"]),l(me,{modelValue:G.value,"onUpdate:modelValue":e[36]||(e[36]=a=>G.value=a),"max-width":"400"},{default:s(()=>[l(E,{class:"rounded-lg"},{default:s(()=>[l(de,{class:"d-flex align-center px-6 py-2 bg-blue-grey-darken-2"},{default:s(()=>[l(f,{size:d(i)?"20":"18",color:"white",class:"me-2"},{default:s(()=>e[68]||(e[68]=[n(" mdi-sort ")])),_:1},8,["size"]),e[70]||(e[70]=r("span",{class:"card-title text-white"},"倉庫排序",-1)),l(P),l(m,{icon:"",variant:"plain",class:"opacity-100",ripple:!1,color:"white",size:d(i)?"36":"32",onClick:e[33]||(e[33]=a=>G.value=!1)},{default:s(()=>[l(f,{size:d(i)?"22":"18"},{default:s(()=>e[69]||(e[69]=[n(" mdi-close ")])),_:1},8,["size"])]),_:1},8,["size"])]),_:1}),l(W,{class:"px-6 py-4"},{default:s(()=>[e[72]||(e[72]=r("div",{class:"text-subtitle-1 mb-4"}," 拖拽調整倉庫顯示順序 ",-1)),l(d(sa),{modelValue:ye.value,"onUpdate:modelValue":e[34]||(e[34]=a=>ye.value=a),"item-key":"_id",class:"sortable-list",handle:".drag-handle",animation:"200","ghost-class":"ghost-item","chosen-class":"chosen-item"},{item:s(({element:a,index:v})=>[(g(),H(oa,{key:a._id,class:"border rounded mb-2"},{prepend:s(()=>[r("div",hl,[l(f,{color:"grey-darken-1"},{default:s(()=>e[71]||(e[71]=[n(" mdi-drag-vertical ")])),_:1})])]),append:s(()=>[l(F,{size:"small",color:"blue-grey"},{default:s(()=>[n(u(v+1),1)]),_:2},1024)]),default:s(()=>[l(na,null,{default:s(()=>[n(u(a.name),1)]),_:2},1024)]),_:2},1024))]),_:1},8,["modelValue"])]),_:1}),l(ce,{class:"px-6 pb-5 pt-0"},{default:s(()=>[l(P),l(m,{variant:"outlined",color:"grey-darken-1",size:d(i)?"default":"small",onClick:e[35]||(e[35]=a=>G.value=!1)},{default:s(()=>e[73]||(e[73]=[n(" 取消 ")])),_:1},8,["size"]),l(m,{color:"blue-grey-darken-2",variant:"outlined",class:"ms-2",size:d(i)?"default":"small",loading:Ae.value,onClick:Oa},{default:s(()=>e[74]||(e[74]=[n(" 更新 ")])),_:1},8,["size","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(me,{modelValue:K.value,"onUpdate:modelValue":e[40]||(e[40]=a=>K.value=a),"max-width":"400"},{default:s(()=>[l(E,{class:"rounded-lg"},{default:s(()=>[l(de,{class:"d-flex align-center px-6 py-2 bg-blue-grey-darken-2"},{default:s(()=>[l(f,{size:d(i)?"20":"18",color:"white",class:"me-2"},{default:s(()=>e[75]||(e[75]=[n(" mdi-sort ")])),_:1},8,["size"]),e[77]||(e[77]=r("span",{class:"card-title text-white"},"備品排序",-1)),l(P),l(m,{icon:"",variant:"plain",class:"opacity-100",ripple:!1,color:"white",size:d(i)?"36":"32",onClick:e[37]||(e[37]=a=>K.value=!1)},{default:s(()=>[l(f,{size:d(i)?"22":"18"},{default:s(()=>e[76]||(e[76]=[n(" mdi-close ")])),_:1},8,["size"])]),_:1},8,["size"])]),_:1}),l(W,{class:"px-6 py-4"},{default:s(()=>[e[79]||(e[79]=r("div",{class:"text-subtitle-1 mb-4"}," 拖拽調整備品顯示順序 ",-1)),l(d(sa),{modelValue:be.value,"onUpdate:modelValue":e[38]||(e[38]=a=>be.value=a),"item-key":"_id",class:"sortable-list",handle:".drag-handle",animation:"200","ghost-class":"ghost-item","chosen-class":"chosen-item"},{item:s(({element:a,index:v})=>[(g(),H(oa,{key:a._id,class:"border rounded mb-2"},{prepend:s(()=>[r("div",zl,[l(f,{color:"grey-darken-1"},{default:s(()=>e[78]||(e[78]=[n(" mdi-drag-vertical ")])),_:1})])]),append:s(()=>[l(F,{size:"small",color:"blue-grey"},{default:s(()=>[n(u(v+1),1)]),_:2},1024)]),default:s(()=>[l(na,null,{default:s(()=>[n(u(a.name),1)]),_:2},1024)]),_:2},1024))]),_:1},8,["modelValue"])]),_:1}),l(ce,{class:"px-6 pb-5 pt-0"},{default:s(()=>[l(P),l(m,{variant:"outlined",color:"grey-darken-1",size:d(i)?"default":"small",onClick:e[39]||(e[39]=a=>K.value=!1)},{default:s(()=>e[80]||(e[80]=[n(" 取消 ")])),_:1},8,["size"]),l(m,{color:"blue-grey-darken-2",variant:"outlined",class:"ms-2",size:d(i)?"default":"small",loading:De.value,onClick:Ra},{default:s(()=>e[81]||(e[81]=[n(" 更新 ")])),_:1},8,["size","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Kl=Za(_l,[["__scopeId","data-v-0db48ce5"]]);export{Kl as default};

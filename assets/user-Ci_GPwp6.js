import{f as Q,r as m,w as ke,k as Ne,aV as d,Z as C,bH as s,a8 as a,a0 as y,a7 as f,u as r,bJ as We,_ as b,bf as k,$ as w,F as Qe,b0 as Ge,aG as xe,bM as Ve,aH as Je}from"./@vue-Cr_z6yfx.js";import{l as Ke}from"./lodash-CiJWSuVn.js";import{c as H,h as Ze,a as Xe,b as Ye}from"./yup-WHNMwcW8.js";import{u as el}from"./vue-router-CS4OewbW.js";import{u as ll,a as D}from"./vee-validate-BXV9nMa7.js";import{_ as al,u as tl,a as sl,b as ol}from"./index-wwmbXvRV.js";import{i as rl}from"./vuetify-use-dialog-C5oZ13xz.js";import{C as nl}from"./ConfirmDeleteDialogWithTextField-Dbb5flU2.js";import{_ as ul}from"./ConfirmDeleteDialog-CuZPFffe.js";import{_ as il}from"./ConfirmDialog-CJtUY0XN.js";import{_ as dl}from"./UserAvatar-B7fFxd3M.js";import{q as cl,Q as ml,w as i,v as $,g as F,P as we,r as U,d as M,R as vl,F as de,C as pl,a as he,c as _e,S as fl,U as gl,b as yl,f as Ce,A as te,e as bl,W as kl,V as xl,T as Vl}from"./vuetify-CbddcmEc.js";import"./perfect-debounce-Cp2ysxOb.js";import"./hookable-B8xFkYCm.js";import"./core-js-D2hAHviU.js";import"./property-expr-DEi1ZLzV.js";import"./tiny-case-BJ7jYKNY.js";import"./toposort-DzadwsAs.js";/* empty css             */import"./pinia-DBRIaiZ_.js";import"./vue-demi-Dq6ymT-8.js";import"./pinia-plugin-persistedstate-RV7uh3T-.js";import"./jspdf-DacfHTdZ.js";import"./@babel-BsCcpEdk.js";import"./fflate-EnPhvkmS.js";import"./unplugin-vue-router-B1N3mqWX.js";import"./axios-upsvKRUO.js";import"./vue3-google-login-Dx7TV_Hx.js";import"./vue-easy-lightbox-D952uME8.js";const wl={key:0},hl={key:1},_l={key:2},Cl={key:0},Pl={key:0,class:"text-grey text-caption"},Ul={key:1,class:"text-grey"},Il={key:3},Rl={class:"d-flex align-center px-3 py-2 bg-teal-lighten-1 text-white"},zl={class:"d-flex align-center px-3 py-2 bg-teal-lighten-3 text-white"},$l={class:"d-flex align-center px-3 py-2 bg-teal-lighten-2 text-white"},Sl={key:1,class:"text-grey"},Al={key:4},Dl={class:"card-title text-white"},Fl={key:1,class:"text-grey text-caption align-self-center"},Ml={__name:"user",setup(Ll){const{apiAuth:L}=ol(),Pe=tl(),se=sl(),V=rl(),{smAndUp:B,mdAndUp:oe,lgAndUp:N}=cl(),ce=Q(()=>B.value?"default":"small"),x=m(!1),h=m(null),G=m(!1),Ue={class:"header-bg"},Ie=Q(()=>{const t={email:H().required("請輸入 email").email("請輸入正確的 email 格式"),name:H().required("請輸入姓名"),note:H().nullable(),selectedRoles:Ze().min(1,"請至少選擇一個權限").required("請選擇權限")};return x.value&&(t.userId=H().required("請輸入使用者編號")),x.value||(t.password=H().required("請輸入密碼").min(8,"密碼長度至少需要8個字元"),t.confirmPassword=H().required("請再次輸入密碼").oneOf([Xe("password")],"密碼不一致")),Ye(t)}),{handleSubmit:Re,isSubmitting:me,resetForm:ve}=ll({validationSchema:Ie,validateOnMount:!1,initialValues:{email:"",name:"",note:"",selectedRoles:[]}}),j=D("email"),E=D("name"),T=D("note"),J=D("password"),K=D("confirmPassword"),q=D("userId"),g=D("selectedRoles"),S=m(10),Z=m([{key:"userId",order:"asc"}]),I=m(1),O=m([]),ze=m(0),re=Q(()=>[{title:"用戶編號",align:"left",sortable:!0,key:"userId"},{title:"大頭貼",align:"left",sortable:!1,key:"avatar"},{title:"姓名",align:"left",sortable:!0,key:"name"},{title:"Email",align:"left",sortable:!0,key:"email"},{title:"權限",align:"left",sortable:!0,key:"rbacRoles"},{title:"員工關聯",align:"left",sortable:!1,key:"employeeLink"},{title:"備註",align:"left",sortable:!0,key:"note"},{title:"操作",align:"left",sortable:!1,key:"action"},{title:"帳號狀態",align:"left",sortable:!0,key:"isActive"}]),P=m(!0),W=m(0),$e=m(""),X=m(""),Y=m(""),Se=[{text:"全部",value:""},{text:"啟用",value:"active"},{text:"停用",value:"inactive"}],_=m({open:!1,id:""}),pe=m([]),Ae=Q(()=>N.value?re.value:oe.value?re.value.filter(t=>t.key!=="email"&&t.key!=="note"&&t.key!=="employeeLink"&&t.key!=="avatar"):re.value.filter(t=>t.key!=="email"&&t.key!=="note"&&t.key!=="employeeLink"&&t.key!=="avatar"&&t.key!=="rbacRoles")),De=async()=>{var t,e;try{const{data:o}=await L.post("/users/check-employee-links");if(o.success){await R(),console.log("檢查結果:",o.result);let n=`檢查完成！成功關聯 ${o.result.linked} 個用戶`;o.result.errors.length>0&&(n+=`，${o.result.errors.length} 個無法關聯`),V({text:n,snackbarProps:{color:"teal-lighten-1"}}),o.result.errors.length>0&&console.log("無法關聯的用戶:",o.result.errors)}}catch(o){console.error("檢查員工關聯失敗:",o),V({text:((e=(t=o==null?void 0:o.response)==null?void 0:t.data)==null?void 0:e.message)||"檢查失敗",snackbarProps:{color:"red-lighten-1"}})}},Fe=async()=>{try{const t=await se.getAllRoles();pe.value=t.map(e=>({_id:e._id,name:e.name,code:e.code}))}catch(t){console.error("載入角色失敗:",t),V({text:t.message||"載入角色失敗",snackbarProps:{color:"red"}})}},R=async t=>{t&&(I.value=1),S.value===-1&&(I.value=1),await ne()},ne=async()=>{var t,e,o,n,u;P.value=!0;try{const l={page:I.value,itemsPerPage:S.value===-1?W.value>0?W.value:999999:S.value,sortBy:((t=Z.value[0])==null?void 0:t.key)||"userId",sortOrder:((e=Z.value[0])==null?void 0:e.order)||"asc",quickSearch:X.value,statusFilter:Y.value},{data:c}=await L.get("/users/search",{params:l});if(c.success){const p=await Promise.all(c.result.data.map(async v=>{try{const z=await se.getUserRoles(v._id);return{...v,rbacRoles:z||[]}}catch(z){return console.error(`載入用戶 ${v.name} 的角色失敗:`,z),{...v,rbacRoles:[]}}}));O.value=p,W.value=c.result.totalItems}}catch(l){console.error("搜索失敗:",l);const c=((n=(o=l==null?void 0:l.response)==null?void 0:o.data)==null?void 0:n.message)||"搜索失敗";((u=l==null?void 0:l.response)==null?void 0:u.status)===401?(await Pe.logout(),Te.push("/login"),V({text:"登入已過期，請重新登入",snackbarProps:{color:"red-lighten-1"}})):V({text:c,snackbarProps:{color:"red-lighten-1"}})}finally{P.value=!1}},Me=Re(async t=>{var e,o;try{if(x.value){const n=["email","name","note","userId"].some(v=>{const z=v==="email"?j.value.value:v==="name"?E.value.value:v==="note"?T.value.value:v==="userId"?q.value.value:null;return h.value[v]!==z}),u=h.value.selectedRoles||[],l=g.value.value||[],c=u.length!==l.length||!u.every(v=>l.includes(v)),p={...t};c&&(p.roleIds=g.value.value),(n||c)&&(await L.patch(`users/${_.value.id}`,p),await R(!1))}else{const n=Object.fromEntries(Object.entries(t).filter(([u])=>u!=="userId"));g.value.value.length>0&&(n.roleIds=g.value.value),await L.post("/users",n),await R(!0)}V({text:x.value?"用戶資料更新成功":"用戶新增成功",snackbarProps:{color:"teal-lighten-1"}}),ee()}catch(n){const u=((o=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:o.message)||"操作失敗";V({text:u,snackbarProps:{color:"red-lighten-1"}})}}),fe=async t=>{var e;if(_.value.open=!0,t){x.value=!0,_.value.id=t._id,j.value.value=t.email,E.value.value=t.name,T.value.value=t.note,q.value.value=t.userId,J.value.value="",K.value.value="";try{const o=await se.getUserRoles(t._id);g.value.value=((e=o==null?void 0:o.filter(n=>n.isActive))==null?void 0:e.map(n=>n.role._id))||[]}catch(o){console.error("載入用戶角色失敗:",o),g.value.value=[]}h.value={email:t.email,name:t.name,note:t.note,userId:t.userId,selectedRoles:[...g.value.value]}}else x.value=!1,_.value.id="",g.value.value=[],h.value=null,ve()},ee=()=>{_.value.open=!1,h.value=null,ve()},Le=async()=>{var t,e;try{P.value=!0,await L.delete(`/users/${_.value.id}`),ee(),await R(!0),V({text:"用戶刪除成功",snackbarProps:{color:"teal-lighten-1"}})}catch(o){console.error("Delete user error:",o),V({text:((e=(t=o==null?void 0:o.response)==null?void 0:t.data)==null?void 0:e.message)||"刪除失敗",snackbarProps:{color:"red-lighten-1"}})}finally{P.value=!1,G.value=!1}},Be=Q(()=>{if(!x.value)return!0;if(!h.value)return!1;const t=["email","name","note","userId"].some(u=>{const l=u==="email"?j.value.value:u==="name"?E.value.value:u==="note"?T.value.value:u==="userId"?q.value.value:null;return h.value[u]!==l}),e=h.value.selectedRoles||[],o=g.value.value||[],n=e.length!==o.length||!e.every(u=>o.includes(u));return t||n}),je=Ke.debounce(()=>{I.value=1,P.value=!0,ne().finally(()=>{P.value=!1})},300);ke(X,t=>{je(t)}),ke(Y,()=>{I.value=1,P.value=!0,ne().finally(()=>{P.value=!1})}),Ne(async()=>{try{await R(!0),await Fe()}catch(t){console.error("初始化加載失敗:",t)}});const Ee=t=>{if(S.value===-1)return;t<1&&(t=1);const e=Math.ceil(W.value/S.value);t>e&&(t=e),I.value!==t&&(I.value=t,localStorage.removeItem("userTablePage"),R(!1))},Te=el(),le=m(!1),ae=m(!1),ue=m(!1),ie=m(!1),A=m(null),qe=t=>{t.isActive?(A.value=t,ue.value=!0):(A.value=t,ie.value=!0)},Oe=async()=>{A.value&&await ge(A.value,!1)},He=async()=>{A.value&&await ge(A.value,!0)},ge=async(t,e)=>{var o,n;try{if((await L.patch(`/users/${t._id}`,{isActive:e})).data.success){const l=O.value.findIndex(c=>c._id===t._id);l!==-1&&(O.value[l].isActive=e),V({text:`帳號已${e?"啟用":"停用"}`,snackbarProps:{color:e?"teal-lighten-1":"warning"}})}}catch(u){console.error("更新用戶狀態失敗:",u),V({text:((n=(o=u==null?void 0:u.response)==null?void 0:o.data)==null?void 0:n.message)||"更新失敗",snackbarProps:{color:"red-lighten-1"}});const l=O.value.findIndex(c=>c._id===t._id);l!==-1&&(O.value[l].isActive=!e)}};return(t,e)=>(d(),C(ml,{"max-width":"1920"},{default:s(()=>{var o,n,u;return[a($,{class:"elevation-4 rounded-lg py-4 py-sm-8 px-1 px-sm-10 mt-2 mt-sm-6 mx-0 mx-sm-4 mx-md-4 mb-4 bg-white"},{default:s(()=>[a(i,{cols:"12",class:"ps-3 pb-6"},{default:s(()=>e[21]||(e[21]=[y("h3",null,"用戶管理",-1)])),_:1}),a(i,{cols:"12"},{default:s(()=>[a($,null,{default:s(()=>[a(i,null,{default:s(()=>[a($,null,{default:s(()=>[a(i,null,{default:s(()=>[a(F,{"prepend-icon":"mdi-account-plus",variant:"outlined",color:"blue-grey-darken-1",class:"me-4",onClick:e[0]||(e[0]=l=>fe(null))},{default:s(()=>e[22]||(e[22]=[f(" 新增用戶 ")])),_:1}),a(F,{"prepend-icon":"mdi-account-search",variant:"outlined",color:"teal-darken-1",onClick:De},{default:s(()=>e[23]||(e[23]=[f(" 檢查 ")])),_:1})]),_:1}),a(i,{sm:"3",lg:"2",xl:"1",class:"pe-1"},{default:s(()=>[a(we,{modelValue:Y.value,"onUpdate:modelValue":e[1]||(e[1]=l=>Y.value=l),items:Se,"item-title":"text","item-value":"value",label:"狀態篩選",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),a(i,{sm:"4",lg:"3",xl:"2"},{default:s(()=>[a($,{class:"d-flex align-center"},{default:s(()=>[a(i,{class:"d-flex align-center"},{default:s(()=>[r(oe)?We((d(),C(U,{key:0,icon:"mdi-information",size:"small",color:"blue-grey-darken-2",class:"me-4"},null,512)),[[Vl,"可搜尋使用者編號、姓名、Email、備註","start"]]):b("",!0),a(M,{modelValue:X.value,"onUpdate:modelValue":e[2]||(e[2]=l=>X.value=l),label:"快速搜尋","append-inner-icon":"mdi-magnify","base-color":"#666",color:"blue-grey-darken-3",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(i,{cols:"12"},{default:s(()=>[(d(),C(vl,{key:ze.value,"items-per-page":S.value,"onUpdate:itemsPerPage":[e[3]||(e[3]=l=>S.value=l),e[5]||(e[5]=l=>R(!1))],"sort-by":Z.value,"onUpdate:sortBy":[e[4]||(e[4]=l=>Z.value=l),e[6]||(e[6]=l=>R(!1))],page:I.value,density:"compact",class:"rounded-ts-lg rounded-te-lg py-3","items-per-page-options":[10,20,50,{value:-1,title:"全部"}],items:O.value,headers:Ae.value,"header-props":Ue,loading:P.value,"items-length":W.value,search:$e.value,hover:"","onUpdate:page":Ee},{item:s(({item:l,index:c})=>[y("tr",{class:Je({"odd-row":c%2===0,"even-row":c%2!==0})},[y("td",null,k(l.userId),1),r(N)?(d(),w("td",wl,[a(dl,{user:l,size:28},null,8,["user"])])):b("",!0),y("td",null,k(l.name),1),r(N)?(d(),w("td",hl,k(l.email),1)):b("",!0),r(oe)?(d(),w("td",_l,[l.rbacRoles&&l.rbacRoles.length>0?(d(),w("div",Cl,[(d(!0),w(Qe,null,Ge(l.rbacRoles.slice(0,2),p=>(d(),C(de,{key:p._id,label:"",size:"small",color:"blue-darken-2",class:"ma-1"},{default:s(()=>{var v;return[f(k(((v=p.role)==null?void 0:v.name)||"未知角色"),1)]}),_:2},1024))),128)),l.rbacRoles.length>2?(d(),w("span",Pl," (+"+k(l.rbacRoles.length-2)+" 個) ",1)):b("",!0)])):(d(),w("span",Ul,"無權限"))])):b("",!0),r(N)?(d(),w("td",Il,[l.employeeLink?(d(),C(pl,{key:0,location:"end",transition:"fade-transition","open-on-hover":"","close-delay":"30","open-delay":"30",class:"pa-0"},{activator:s(({props:p})=>[y("div",xe(p,{class:"d-inline-block pe-6"}),[a(de,{size:"small",color:"teal-lighten-1","prepend-icon":"mdi-account-check"},{default:s(()=>e[24]||(e[24]=[f(" 已關聯 ")])),_:1})],16)]),default:s(()=>[a(he,{"min-width":"200",class:"rounded-lg pa-0 status-card",elevation:"3"},{default:s(()=>[a(_e,{class:"pa-0"},{default:s(()=>{var p,v,z,ye,be;return[y("div",Rl,[a(U,{size:"16",class:"me-2",color:"white"},{default:s(()=>e[25]||(e[25]=[f(" mdi-office-building ")])),_:1}),y("span",null,"公司："+k(((v=(p=l.employeeLink)==null?void 0:p.company)==null?void 0:v.name)||"無"),1)]),y("div",zl,[a(U,{size:"16",class:"me-2",color:"white"},{default:s(()=>e[26]||(e[26]=[f(" mdi-domain ")])),_:1}),y("span",null,"部門："+k(((ye=(z=l.employeeLink)==null?void 0:z.department)==null?void 0:ye.name)||"無"),1)]),y("div",$l,[a(U,{size:"16",class:"me-2",color:"white"},{default:s(()=>e[27]||(e[27]=[f(" mdi-identifier ")])),_:1}),y("span",null,"科威編號："+k(((be=l.employeeLink)==null?void 0:be.employeeCode)||"無"),1)])]}),_:2},1024)]),_:2},1024)]),_:2},1024)):(d(),w("span",Sl,"無關聯"))])):b("",!0),r(N)?(d(),w("td",Al,k(l.note),1)):b("",!0),y("td",null,[a(F,{icon:"",color:"light-blue-darken-4",variant:"plain",width:"28",size:ce.value,ripple:!1,onClick:p=>fe(l)},{default:s(()=>[a(U,null,{default:s(()=>e[28]||(e[28]=[f("mdi-pencil")])),_:1})]),_:2},1032,["size","onClick"])]),y("td",null,[a(fl,{modelValue:l.isActive,"onUpdate:modelValue":p=>l.isActive=p,color:l.isActive?"teal-darken-1":"grey-darken-4",label:r(B)?l.isActive?"啟用":"停用":void 0,"hide-details":"",onClick:Ve(p=>qe(l),["prevent"])},null,8,["modelValue","onUpdate:modelValue","color","label","onClick"])])],2)]),_:1},8,["items-per-page","sort-by","page","items","headers","loading","items-length","search"]))]),_:1})]),_:1})]),_:1})]),_:1}),a(xl,{modelValue:_.value.open,"onUpdate:modelValue":e[17]||(e[17]=l=>_.value.open=l),persistent:"","max-width":"1100"},{default:s(()=>[a(gl,{disabled:r(me),onSubmit:Ve(r(Me),["prevent"])},{default:s(()=>[a(he,{class:"rounded-lg user-dialog"},{default:s(()=>[a(yl,{class:"d-flex align-center px-6 py-1 bg-blue-grey-darken-2"},{default:s(()=>[a(U,{icon:"mdi-account",size:"18",color:"white",class:"me-2"}),y("span",Dl,k(_.value.id?"用戶資料編輯":"新增用戶"),1),a(Ce),a(F,{icon:"",variant:"text",color:"white",size:r(B)?"40":"36",onClick:ee},{default:s(()=>[a(U,{size:r(B)?"24":"20"},{default:s(()=>e[29]||(e[29]=[f(" mdi-close ")])),_:1},8,["size"])]),_:1},8,["size"])]),_:1}),a(_e,{class:"px-4 px-sm-6 py-4 py-sm-7"},{default:s(()=>[a($,null,{default:s(()=>[a(i,{cols:"12",class:"sub-title text-blue-grey-darken-2 d-flex align-center justify-center"},{default:s(()=>[a($,null,{default:s(()=>[a(i,{cols:"3",sm:"4",md:"5",class:"d-flex align-center justify-center"},{default:s(()=>[a(te,{class:"border-opacity-25",color:"teal-darken-2"})]),_:1}),a(i,{cols:"6",sm:"4",md:"2",class:"d-flex align-center justify-center text-blue-grey-darken-2"},{default:s(()=>[a(U,{size:"18",class:"me-2 text-blue-grey-darken-2"},{default:s(()=>e[30]||(e[30]=[f(" mdi-account-circle ")])),_:1}),e[31]||(e[31]=f(" 基本資訊 "))]),_:1}),a(i,{cols:"3",sm:"4",md:"5",class:"d-flex align-center justify-center"},{default:s(()=>[a(te,{class:"border-opacity-25",color:"blue-grey-darken-2"})]),_:1})]),_:1})]),_:1}),x.value?(d(),C(i,{key:0,cols:"12",sm:"6",md:"4"},{default:s(()=>[a(M,{modelValue:r(q).value.value,"onUpdate:modelValue":e[7]||(e[7]=l=>r(q).value.value=l),"error-messages":r(q).errorMessage.value,label:"用戶編號",type:"text",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","error-messages"])]),_:1})):b("",!0),a(i,{cols:"12",sm:"6",md:"4"},{default:s(()=>[a(M,{modelValue:r(E).value.value,"onUpdate:modelValue":e[8]||(e[8]=l=>r(E).value.value=l),"error-messages":r(E).errorMessage.value,label:"*姓名",type:"text",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","error-messages"])]),_:1}),a(i,{cols:"12",sm:"6",md:"4"},{default:s(()=>[a(M,{modelValue:r(j).value.value,"onUpdate:modelValue":e[9]||(e[9]=l=>r(j).value.value=l),"error-messages":r(j).errorMessage.value,label:"*Email",type:"email",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","error-messages"])]),_:1}),x.value?b("",!0):(d(),C(i,{key:1,cols:"12",sm:"6",md:"4"},{default:s(()=>[a(M,{modelValue:r(J).value.value,"onUpdate:modelValue":e[10]||(e[10]=l=>r(J).value.value=l),"error-messages":r(J).errorMessage.value,type:le.value?"text":"password","append-inner-icon":le.value?"mdi-eye-off":"mdi-eye",label:"*密碼",variant:"outlined",density:"compact","onClick:appendInner":e[11]||(e[11]=l=>le.value=!le.value)},null,8,["modelValue","error-messages","type","append-inner-icon"])]),_:1})),x.value?b("",!0):(d(),C(i,{key:2,cols:"12",sm:"6",md:"4"},{default:s(()=>[a(M,{modelValue:r(K).value.value,"onUpdate:modelValue":e[12]||(e[12]=l=>r(K).value.value=l),"error-messages":r(K).errorMessage.value,type:ae.value?"text":"password","append-inner-icon":ae.value?"mdi-eye-off":"mdi-eye",label:"*確認密碼",variant:"outlined",density:"compact","onClick:appendInner":e[13]||(e[13]=l=>ae.value=!ae.value)},null,8,["modelValue","error-messages","type","append-inner-icon"])]),_:1})),a(i,{cols:"12"},{default:s(()=>[a(M,{modelValue:r(T).value.value,"onUpdate:modelValue":e[14]||(e[14]=l=>r(T).value.value=l),"error-messages":r(T).errorMessage.value,label:"備註",type:"text",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),a($,null,{default:s(()=>[a(i,{cols:"12",class:"sub-title text-blue-grey-darken-2 d-flex align-center justify-center mt-4"},{default:s(()=>[a($,null,{default:s(()=>[a(i,{cols:"3",sm:"4",md:"5",class:"d-flex align-center justify-center"},{default:s(()=>[a(te,{class:"border-opacity-25",color:"blue-grey-darken-2"})]),_:1}),a(i,{cols:"6",sm:"4",md:"2",class:"d-flex align-center justify-center text-blue-grey-darken-2"},{default:s(()=>[a(U,{size:"18",class:"me-2 text-blue-grey-darken-2"},{default:s(()=>e[32]||(e[32]=[f(" mdi-shield-account ")])),_:1}),e[33]||(e[33]=f(" 權限設定 "))]),_:1}),a(i,{cols:"3",sm:"4",md:"5",class:"d-flex align-center justify-center"},{default:s(()=>[a(te,{class:"border-opacity-25",color:"blue-grey-darken-2"})]),_:1})]),_:1})]),_:1}),a(i,{cols:"12",sm:"6",md:"4"},{default:s(()=>[a(we,{modelValue:r(g).value.value,"onUpdate:modelValue":e[15]||(e[15]=l=>r(g).value.value=l),items:pe.value,"item-title":"name","item-value":"_id",label:"*權限",variant:"outlined",density:"compact",multiple:"",chips:"","closable-chips":"","error-messages":r(g).meta.touched?r(g).errorMessage.value:[],"persistent-hint":"",onBlur:r(g).handleBlur},{selection:s(({item:l,index:c})=>[c<2?(d(),C(de,{key:0,size:"small",color:"teal",class:"ma-1"},{default:s(()=>[f(k(l.raw.name),1)]),_:2},1024)):b("",!0),c===2?(d(),w("span",Fl," (+"+k(r(g).value.value.length-2)+" 個權限) ",1)):b("",!0)]),_:1},8,["modelValue","items","error-messages","onBlur"])]),_:1})]),_:1})]),_:1}),a(bl,{class:"px-6 py-4 mb-2"},{default:s(()=>[a(kl,null,{default:s(({isHovering:l,props:c})=>[x.value?(d(),C(F,xe({key:0},c,{color:l?"red-lighten-1":"grey",variant:"outlined","prepend-icon":"mdi-delete",size:ce.value,onClick:e[16]||(e[16]=p=>G.value=!0)}),{default:s(()=>e[34]||(e[34]=[f(" 永久刪除 ")])),_:2},1040,["color","size"])):b("",!0)]),_:1}),a(Ce),a(F,{variant:"outlined",color:"grey-darken-1",size:r(B)?"default":"small",onClick:ee},{default:s(()=>e[35]||(e[35]=[f(" 取消 ")])),_:1},8,["size"]),a(F,{color:"teal-darken-1",variant:"outlined",type:"submit",class:"ms-2",size:r(B)?"default":"small",loading:r(me),disabled:x.value&&!Be.value},{default:s(()=>[f(k(_.value.id?"更新":"送出"),1)]),_:1},8,["size","loading","disabled"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"]),a(nl,{modelValue:G.value,"onUpdate:modelValue":e[18]||(e[18]=l=>G.value=l),title:"確認刪除用戶",message:`確定要刪除用戶「<span class='text-pink-lighten-1' style='font-weight: 800;'>${((o=h.value)==null?void 0:o.name)||""}</span>」嗎？ 此操作無法復原。`,"expected-name":((n=h.value)==null?void 0:n.name)||"","input-label":"用戶",onConfirm:Le},null,8,["modelValue","message","expected-name"]),a(ul,{modelValue:ue.value,"onUpdate:modelValue":e[19]||(e[19]=l=>ue.value=l),width:320,title:"確認停用帳號",message:"確定要停用此帳號嗎？停用後該使用者將無法登入系統。","confirm-button-text":"停用","cancel-button-text":"取消","confirm-button-color":"red-darken-1",onConfirm:Oe},null,8,["modelValue"]),a(il,{modelValue:ie.value,"onUpdate:modelValue":e[20]||(e[20]=l=>ie.value=l),width:320,title:"確認啟用帳號",message:`確定要啟用使用者「<span class='text-teal-lighten-1' style='font-weight: 800;'>${((u=A.value)==null?void 0:u.name)||""}</span>」的帳號嗎？`,"confirm-button-color":"teal-darken-1","header-color":"bg-teal-darken-1","header-icon":"mdi-account-check",onConfirm:He},null,8,["modelValue","message"])]}),_:1}))}},va=al(Ml,[["__scopeId","data-v-23ed13f3"]]);export{va as default};
